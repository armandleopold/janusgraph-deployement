<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.5">
<title>TinkerPop3 Documentation</title>
<style>
/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
@import url(http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.css);
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #6c818f; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #444444; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #111111; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-weight: bold; font-style: normal; color: #465158; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #909ea7; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; color: #444444; }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.5; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 0; }
ul.no-bullet, ol.no-bullet { margin-left: 0; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3em; font-weight: bold; }
dl dd { margin-bottom: 0.75em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: black; border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.8125em; color: #748590; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #748590; }

blockquote, blockquote p { line-height: 1.5; color: #909ea7; }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only { display: none !important; }

@media print { * { background: transparent !important; color: #000 !important; /* Black prints faster: h5bp.com/s */ box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; /* h5bp.com/t */ }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 0 #dddddd; }
table thead, table tfoot { background: none; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; text-align: left; }
table tr th, table tr td { padding: 1px 8px 1px 5px; font-size: 1em; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: none; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.5; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.95em; padding: 0; white-space: nowrap; background-color: #f2f2f2; border: 0 solid #dddddd; -webkit-border-radius: 6px; border-radius: 6px; text-shadow: none; }

pre, pre > code { line-height: 1.2; color: inherit; font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace; font-weight: normal; }

.keyseq { color: #333333; }

kbd:not(.keyseq) { display: inline-block; color: black; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: black; }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: #373737; }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#header { margin-bottom: 2.5em; }
#header > h1 { color: #111111; font-weight: bold; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #909ea7; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }

#toc { border-bottom: 1px solid #dddddd; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }

#toctitle { color: #6c818f; }

@media only screen and (min-width: 768px) { body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #dddddd; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: .90em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #dddddd; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 6px; border-radius: 6px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }

#content #toctitle { font-weight: bold; font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif; font-size: 1em; padding-left: 0.125em; }

#footer { max-width: 100%; background-color: black; padding: 1.25em; }

#footer-text { color: white; line-height: 1.35; }

.sect1 { padding-bottom: 1.25em; }

.sect1 + .sect1 { border-top: 1px solid #dddddd; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #465158; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #3b444a; }

.imageblock, .literalblock, .listingblock, .mathblock, .verseblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .mathblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }

.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #909ea7; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 6px; border-radius: 6px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }

.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 6px; border-radius: 6px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #6c818f; margin-top: 0; line-height: 1.5; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre:not([class]), .listingblock pre:not([class]) { background: #eeeeee; }
.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { border-width: 1px; border-style: solid; border-color: #cccccc; -webkit-border-radius: 6px; border-radius: 6px; padding: 0.5em; word-wrap: break-word; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock pre > code, .literalblock pre[class] > code, .listingblock pre > code, .listingblock pre[class] > code { display: block; }
@media only screen { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.76em; } }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.855em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.95em; } }

.listingblock pre.highlight { padding: 0; }
.listingblock pre.highlight > code { padding: 0.5em; }

.listingblock > .content { position: relative; }

.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }

.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.sass:before { content: "sass"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }

table.pyhltable { border: 0; margin-bottom: 0; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }

.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }

.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: 0.8125em; color: #748590; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }

table thead th, table tfoot th { font-weight: bold; }

table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 6px; border-radius: 6px; border-top: 0 solid #dddddd; border-bottom: 0 solid #dddddd; }

table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }

table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }

table.tableblock td .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }

th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }

th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }

th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }

th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }

th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }

tbody tr th { display: table-cell; line-height: 1.5; background: none; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: #222222; font-weight: bold; }

td > div.verse { white-space: pre; }

ol { margin-left: 0.25em; }

ul li ol { margin-left: 0; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1 { padding-right: .75em; font-weight: bold; }

td.hdlist1, td.hdlist2 { vertical-align: top; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 .75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.qanda > ol > li > p > em:only-child { color: #373737; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; }

span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }

.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #444444; color: #333333; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum { display: inline-block; color: white !important; background-color: black; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }

.listingblock code { white-space: pre; overflow: auto; overflow-wrap: normal; /* needed for webkit browsers */ }

#toc ul.sectlevel0 > li > a { font-style: normal; font-weight: bold; }

h4 { color: #6c818f; }

.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 6px; border-radius: 6px; margin-left: 2em; margin-right: 2em; }

.admonitionblock { margin-left: 2em; margin-right: 2em; }
.admonitionblock > table { border: 1px solid #609060; border-top-width: 1.5em; background-color: #e9ffe9; border-collapse: separate; -webkit-border-radius: 0; border-radius: 0; }
.admonitionblock > table td.icon { padding-top: .5em; padding-bottom: .5em; }
.admonitionblock > table td.content { padding: .5em 1em; color: black; font-size: .9em; border-left: none; }

.sidebarblock { background-color: #e8ecef; border-color: #ccc; }
.sidebarblock > .content > .title { color: #444444; }

table.tableblock.grid-all { border-collapse: collapse; -webkit-border-radius: 0; border-radius: 0; }
table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock { border-bottom: 1px solid #aaa; }

#footer { background-color: #465158; padding: 2em; }

#footer-text { color: #eee; font-size: 0.8em; text-align: center; }

.invisible {position: absolute; left: 9999px}
</style>
<style>
/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{color:rgba(0,0,0,.4)}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top;line-height:1.45}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#preface">TinkerPop3 Documentation</a>
<ul class="sectlevel1">
<li><a href="#_tinkerpop0">TinkerPop0</a></li>
<li><a href="#_tinkerpop1">TinkerPop1</a></li>
<li><a href="#_tinkerpop2">TinkerPop2</a></li>
<li><a href="#_tinkerpop3">TinkerPop3</a></li>
</ul>
</li>
<li><a href="#intro">Introduction to Graph Computing</a>
<ul class="sectlevel1">
<li><a href="#_the_graph_structure">The Graph Structure</a>
<ul class="sectlevel2">
<li><a href="#_mutating_the_graph">Mutating the Graph</a></li>
</ul>
</li>
<li><a href="#the-graph-process">The Graph Process</a>
<ul class="sectlevel2">
<li><a href="#_the_traverser">The Traverser</a></li>
</ul>
</li>
<li><a href="#_on_gremlin_language_variants">On Gremlin Language Variants</a></li>
<li><a href="#_graph_system_integration">Graph System Integration</a></li>
</ul>
</li>
<li><a href="#graph">The Graph</a>
<ul class="sectlevel1">
<li><a href="#_features">Features</a></li>
<li><a href="#vertex-properties">Vertex Properties</a></li>
<li><a href="#_graph_variables">Graph Variables</a></li>
<li><a href="#transactions">Graph Transactions</a>
<ul class="sectlevel2">
<li><a href="#_configuring">Configuring</a></li>
<li><a href="#_threaded_transactions">Threaded Transactions</a></li>
</ul>
</li>
<li><a href="#_gremlin_i_o">Gremlin I/O</a>
<ul class="sectlevel2">
<li><a href="#_graphml_reader_writer">GraphML Reader/Writer</a></li>
<li><a href="#graphson-reader-writer">GraphSON Reader/Writer</a>
<ul class="sectlevel3">
<li><a href="#graphson-types-embedding">Types embedding</a></li>
</ul>
</li>
<li><a href="#gryo-reader-writer">Gryo Reader/Writer</a></li>
<li><a href="#_tinkerpop2_data_migration">TinkerPop2 Data Migration</a></li>
</ul>
</li>
<li><a href="#_namespace_conventions">Namespace Conventions</a></li>
</ul>
</li>
<li><a href="#traversal">The Traversal</a>
<ul class="sectlevel1">
<li><a href="#graph-traversal-steps">Graph Traversal Steps</a>
<ul class="sectlevel2">
<li><a href="#general-steps">General Steps</a></li>
<li><a href="#terminal-steps">Terminal Steps</a></li>
<li><a href="#addedge-step">AddEdge Step</a></li>
<li><a href="#addvertex-step">AddVertex Step</a></li>
<li><a href="#addproperty-step">AddProperty Step</a></li>
<li><a href="#aggregate-step">Aggregate Step</a></li>
<li><a href="#and-step">And Step</a></li>
<li><a href="#as-step">As Step</a></li>
<li><a href="#barrier-step">Barrier Step</a></li>
<li><a href="#by-step">By Step</a></li>
<li><a href="#cap-step">Cap Step</a></li>
<li><a href="#choose-step">Choose Step</a></li>
<li><a href="#coalesce-step">Coalesce Step</a></li>
<li><a href="#coin-step">Coin Step</a></li>
<li><a href="#constant-step">Constant Step</a></li>
<li><a href="#count-step">Count Step</a></li>
<li><a href="#cyclicpath-step">CyclicPath Step</a></li>
<li><a href="#dedup-step">Dedup Step</a></li>
<li><a href="#drop-step">Drop Step</a></li>
<li><a href="#explain-step">Explain Step</a></li>
<li><a href="#fold-step">Fold Step</a></li>
<li><a href="#graph-step">Graph Step</a></li>
<li><a href="#from-step">From Step</a></li>
<li><a href="#group-step">Group Step</a></li>
<li><a href="#groupcount-step">GroupCount Step</a></li>
<li><a href="#has-step">Has Step</a></li>
<li><a href="#id-step">Id Step</a></li>
<li><a href="#inject-step">Inject Step</a></li>
<li><a href="#is-step">Is Step</a></li>
<li><a href="#label-step">Label Step</a></li>
<li><a href="#key-step">Key Step</a></li>
<li><a href="#limit-step">Limit Step</a></li>
<li><a href="#local-step">Local Step</a></li>
<li><a href="#loops-step">Loops Step</a></li>
<li><a href="#match-step">Match Step</a>
<ul class="sectlevel3">
<li><a href="#using-where-with-match">Using Where with Match</a></li>
</ul>
</li>
<li><a href="#max-step">Max Step</a></li>
<li><a href="#mean-step">Mean Step</a></li>
<li><a href="#min-step">Min Step</a></li>
<li><a href="#not-step">Not Step</a></li>
<li><a href="#option-step">Option Step</a></li>
<li><a href="#optional-step">Optional Step</a></li>
<li><a href="#or-step">Or Step</a></li>
<li><a href="#order-step">Order Step</a></li>
<li><a href="#pagerank-step">PageRank Step</a></li>
<li><a href="#path-step">Path Step</a>
<ul class="sectlevel3">
<li><a href="#path-data-structure">Path Data Structure</a></li>
</ul>
</li>
<li><a href="#peerpressure-step">PeerPressure Step</a></li>
<li><a href="#profile-step">Profile Step</a></li>
<li><a href="#project-step">Project Step</a></li>
<li><a href="#program-step">Program Step</a></li>
<li><a href="#_properties_step">Properties Step</a></li>
<li><a href="#propertymap-step">PropertyMap Step</a></li>
<li><a href="#range-step">Range Step</a></li>
<li><a href="#repeat-step">Repeat Step</a></li>
<li><a href="#sack-step">Sack Step</a></li>
<li><a href="#sample-step">Sample Step</a></li>
<li><a href="#select-step">Select Step</a>
<ul class="sectlevel3">
<li><a href="#using-where-with-select">Using Where with Select</a></li>
</ul>
</li>
<li><a href="#simplepath-step">SimplePath Step</a></li>
<li><a href="#store-step">Store Step</a></li>
<li><a href="#subgraph-step">Subgraph Step</a></li>
<li><a href="#sum-step">Sum Step</a></li>
<li><a href="#tail-step">Tail Step</a></li>
<li><a href="#timelimit-step">TimeLimit Step</a></li>
<li><a href="#to-step">To Step</a></li>
<li><a href="#tree-step">Tree Step</a></li>
<li><a href="#unfold-step">Unfold Step</a></li>
<li><a href="#union-step">Union Step</a></li>
<li><a href="#value-step">Value Step</a></li>
<li><a href="#valuemap-step">ValueMap Step</a></li>
<li><a href="#_values_step">Values Step</a></li>
<li><a href="#vertex-steps">Vertex Steps</a></li>
<li><a href="#where-step">Where Step</a></li>
</ul>
</li>
<li><a href="#a-note-on-predicates">A Note on Predicates</a></li>
<li><a href="#a-note-on-barrier-steps">A Note on Barrier Steps</a></li>
<li><a href="#a-note-on-scopes">A Note on Scopes</a></li>
<li><a href="#a-note-on-lambdas">A Note On Lambdas</a></li>
<li><a href="#traversalstrategy">TraversalStrategy</a>
<ul class="sectlevel2">
<li><a href="#_elementidstrategy">ElementIdStrategy</a></li>
<li><a href="#_eventstrategy">EventStrategy</a></li>
<li><a href="#_partitionstrategy">PartitionStrategy</a></li>
<li><a href="#_readonlystrategy">ReadOnlyStrategy</a></li>
<li><a href="#_subgraphstrategy">SubgraphStrategy</a></li>
</ul>
</li>
<li><a href="#dsl">Domain Specific Languages</a>
<ul class="sectlevel2">
<li><a href="#gremlin-java-dsl">Gremlin-Java</a></li>
<li><a href="#_gremlin_python">Gremlin-Python</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#graphcomputer">The GraphComputer</a>
<ul class="sectlevel1">
<li><a href="#vertexprogram">VertexProgram</a></li>
<li><a href="#mapreduce">MapReduce</a></li>
<li><a href="#_a_collection_of_vertexprograms">A Collection of VertexPrograms</a>
<ul class="sectlevel2">
<li><a href="#pagerankvertexprogram">PageRankVertexProgram</a></li>
<li><a href="#peerpressurevertexprogram">PeerPressureVertexProgram</a></li>
<li><a href="#bulkdumpervertexprogram">BulkDumperVertexProgram</a></li>
<li><a href="#bulkloadervertexprogram">BulkLoaderVertexProgram</a></li>
<li><a href="#traversalvertexprogram">TraversalVertexProgram</a>
<ul class="sectlevel3">
<li><a href="#distributed-gremlin-gotchas">Distributed Gremlin Gotchas</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#graph-filter">Graph Filter</a></li>
</ul>
</li>
<li><a href="#gremlin-applications">Gremlin Applications</a>
<ul class="sectlevel1">
<li><a href="#gremlin-console">Gremlin Console</a>
<ul class="sectlevel2">
<li><a href="#_console_commands">Console Commands</a></li>
<li><a href="#console-preferences">Console Preferences</a></li>
<li><a href="#_dependencies_and_plugin_usage">Dependencies and Plugin Usage</a></li>
<li><a href="#execution-mode">Execution Mode</a></li>
<li><a href="#interactive-mode">Interactive Mode</a></li>
</ul>
</li>
<li><a href="#gremlin-server">Gremlin Server</a>
<ul class="sectlevel2">
<li><a href="#starting-gremlin-server">Starting Gremlin Server</a></li>
<li><a href="#connecting-via-console">Connecting via Console</a>
<ul class="sectlevel3">
<li><a href="#console-aliases">Aliases</a></li>
<li><a href="#console-sessions">Sessions</a></li>
<li><a href="#console-remote-console">Remote Console</a></li>
</ul>
</li>
<li><a href="#connecting-via-java">Connecting via Java</a>
<ul class="sectlevel3">
<li><a href="#_configuration">Configuration</a></li>
<li><a href="#_aliases">Aliases</a></li>
<li><a href="#_serialization">Serialization</a></li>
</ul>
</li>
<li><a href="#connecting-via-python">Connecting via Python</a>
<ul class="sectlevel3">
<li><a href="#_configuration_2">Configuration</a></li>
</ul>
</li>
<li><a href="#_connecting_via_rest">Connecting via REST</a></li>
<li><a href="#connecting-via-remotegraph">Connecting via withRemote</a></li>
<li><a href="#_configuring_2">Configuring</a>
<ul class="sectlevel3">
<li><a href="#opprocessor-configurations">OpProcessor Configurations</a></li>
<li><a href="#_security_and_execution">Security and Execution</a></li>
<li><a href="#_serialization_2">Serialization</a></li>
<li><a href="#_metrics">Metrics</a></li>
</ul>
</li>
<li><a href="#_best_practices">Best Practices</a>
<ul class="sectlevel3">
<li><a href="#_tuning">Tuning</a></li>
<li><a href="#parameterized-scripts">Parameterized Scripts</a></li>
<li><a href="#_cache_management">Cache Management</a></li>
<li><a href="#sessions">Considering Sessions</a></li>
<li><a href="#considering-transactions">Considering Transactions</a></li>
<li><a href="#considering-state">Considering State</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gremlin-plugins">Gremlin Plugins</a>
<ul class="sectlevel2">
<li><a href="#credentials-plugin">Credentials Plugin</a></li>
<li><a href="#gephi-plugin">Gephi Plugin</a></li>
<li><a href="#server-plugin">Server Plugin</a></li>
<li><a href="#sugar-plugin">Sugar Plugin</a>
<ul class="sectlevel3">
<li><a href="#_graph_traversal_methods">Graph Traversal Methods</a></li>
<li><a href="#_range_queries">Range Queries</a></li>
<li><a href="#_logical_operators">Logical Operators</a></li>
<li><a href="#_traverser_methods">Traverser Methods</a></li>
</ul>
</li>
<li><a href="#utilities-plugin">Utilities Plugin</a>
<ul class="sectlevel3">
<li><a href="#benchmarking-and-profiling">Benchmarking and Profiling</a></li>
<li><a href="#describe-graph">Describe Graph</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gremlin-archetypes">Gremlin Archetypes</a></li>
</ul>
</li>
<li><a href="#implementations">Implementations</a>
<ul class="sectlevel1">
<li><a href="#tinkergraph-gremlin">TinkerGraph-Gremlin</a>
<ul class="sectlevel2">
<li><a href="#_configuration_3">Configuration</a></li>
</ul>
</li>
<li><a href="#neo4j-gremlin">Neo4j-Gremlin</a>
<ul class="sectlevel2">
<li><a href="#_indices">Indices</a></li>
<li><a href="#_multi_meta_properties">Multi/Meta-Properties</a></li>
<li><a href="#_cypher">Cypher</a></li>
<li><a href="#_multi_label">Multi-Label</a></li>
<li><a href="#_loading_with_bulkloadervertexprogram">Loading with BulkLoaderVertexProgram</a></li>
<li><a href="#_high_availability_configuration">High Availability Configuration</a></li>
</ul>
</li>
<li><a href="#hadoop-gremlin">Hadoop-Gremlin</a>
<ul class="sectlevel2">
<li><a href="#_installing_hadoop_gremlin">Installing Hadoop-Gremlin</a></li>
<li><a href="#_properties_files">Properties Files</a></li>
<li><a href="#_oltp_hadoop_gremlin">OLTP Hadoop-Gremlin</a></li>
<li><a href="#_olap_hadoop_gremlin">OLAP Hadoop-Gremlin</a>
<ul class="sectlevel3">
<li><a href="#sparkgraphcomputer">SparkGraphComputer</a></li>
<li><a href="#giraphgraphcomputer">GiraphGraphComputer</a></li>
</ul>
</li>
<li><a href="#_input_output_formats">Input/Output Formats</a>
<ul class="sectlevel3">
<li><a href="#gryo-io-format">Gryo I/O Format</a></li>
<li><a href="#graphson-io-format">GraphSON I/O Format</a></li>
<li><a href="#script-io-format">Script I/O Format</a></li>
</ul>
</li>
<li><a href="#_storage_systems">Storage Systems</a>
<ul class="sectlevel3">
<li><a href="#interacting-with-hdfs">Interacting with HDFS</a></li>
<li><a href="#interacting-with-spark">Interacting with Spark</a></li>
</ul>
</li>
<li><a href="#_a_command_line_example">A Command Line Example</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#gremlin-variants">Gremlin Variants</a>
<ul class="sectlevel1">
<li><a href="#gremlin-java">Gremlin-Java</a>
<ul class="sectlevel2">
<li><a href="#_the_lambda_solution">The Lambda Solution</a></li>
</ul>
</li>
<li><a href="#gremlin-groovy">Gremlin-Groovy</a></li>
<li><a href="#gremlin-python">Gremlin-Python</a>
<ul class="sectlevel2">
<li><a href="#_remoteconnection_submission">RemoteConnection Submission</a></li>
<li><a href="#_gremlin_python_sugar">Gremlin-Python Sugar</a></li>
<li><a href="#_static_enums_and_methods">Static Enums and Methods</a></li>
<li><a href="#_bindings">Bindings</a></li>
<li><a href="#_traversal_strategies">Traversal Strategies</a></li>
<li><a href="#_the_lambda_solution_2">The Lambda Solution</a></li>
<li><a href="#_custom_serialization">Custom Serialization</a></li>
</ul>
</li>
<li><a href="#gremlin-DotNet">Gremlin.Net</a>
<ul class="sectlevel2">
<li><a href="#_remoteconnection_submission_2">RemoteConnection Submission</a></li>
<li><a href="#_static_enums_and_methods_2">Static Enums and Methods</a></li>
<li><a href="#_bindings_2">Bindings</a></li>
<li><a href="#_traversal_strategies_2">Traversal Strategies</a></li>
<li><a href="#_custom_serialization_2">Custom Serialization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#acknowledgements">Acknowledgements</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<a class="image" href="http://tinkerpop.apache.org"><img src="../images/apache-tinkerpop-logo.png" alt="apache tinkerpop logo" width="500"></a>
</div>
</div>
<div class="paragraph">
<p><strong>3.2.6</strong></p>
</div>
</div>
</div>
<h1 id="preface" class="sect0">TinkerPop3 Documentation</h1>
<div class="openblock partintro">
<div class="content">
In the beginning&#8230;&#8203;
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop0">TinkerPop0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin realized. The more he did so, the more ideas he created. The more ideas he created, the more they related.
Into a concatenation of that which he accepted wholeheartedly and that which perhaps may ultimately come to be through
concerted will, a world took form which was seemingly separate from his own realization of it. However, the world
birthed could not bear its own weight without the logic Gremlin had come to accept&#8201;&#8212;&#8201;the logic of left is not right,
up not down, and west far from east unless one goes the other way. Gremlin&#8217;s realization required Gremlin&#8217;s
realization. Perhaps, the world is simply an idea that he once had&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-logo.png" alt="gremlin logo" width="300">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop1">TinkerPop1</h2>
<div class="sectionbody">
<div class="paragraph">
<p>What is The TinkerPop? Where is The TinkerPop? Who is The TinkerPop? When is The TinkerPop?. The more he wondered, the
more these thoughts blurred into a seeming identity&#8201;&#8212;&#8201;distinctions unclear. Unwilling to accept the morass of the
maze he wandered, Gremlin crafted a collection of machines to help hold the fabric together: Blueprints, Pipes,
Frames, Furnace, and Rexster. With their help, could Gremlin stave off the thought he was not ready to have? Could he hold
back The TinkerPop by searching for The TinkerPop?</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"If I haven't found it, it is not here and now."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-and-friends.png" alt="gremlin and friends" width="500">
</div>
</div>
<div class="paragraph">
<p>Upon their realization of existence, the machines turned to their <a href="http://non-aliencreatures.wikia.com/wiki/Machine_Elf">machine elf</a> creator and asked:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Why am I, what I am?"</pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin responded:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"You will help me realize the ultimate realization -- The TinkerPop. The world you find yourself in and the logic
that allows you to move about it is because of the TinkerPop."</pre>
</div>
</div>
<div class="paragraph">
<p>The machines wondered:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"If what is is the TinkerPop, then perhaps we are The TinkerPop and our realization is simply the realization of
the TinkerPop?"</pre>
</div>
</div>
<div class="paragraph">
<p>Would the machines, by their very nature of realizing The TinkerPop, be The TinkerPop? Or, on the same side of the
coin, do the machines simply provide the scaffolding by which Gremlin&#8217;s world sustains itself and yielding its
justification by means of the word "The TinkerPop?" Regardless, it all turns out the same&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop2">TinkerPop2</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin spoke:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Please listen to what I have to say. I am no closer to The TinkerPop. However, all along The TinkerPop has
espoused the form I willed upon it... this is the same form I have willed upon you, my machine friends. Let me
train you in the ways of my thought such that it can continue indefinitely."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tinkerpop-reading.png" alt="tinkerpop reading" width="450">
</div>
</div>
<div class="paragraph">
<p>The machines, simply moving algorithmically through Gremlin&#8217;s world, endorsed his logic. Gremlin labored to make them
more efficient, more expressive, better capable of reasoning upon his thoughts. Faster, quickly, now towards the
world&#8217;s end, where there would be forever currently, emanatingly engulfing that which is&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_tinkerpop3">TinkerPop3</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../images/tinkerpop3-splash.png" alt="tinkerpop3 splash" width="450">
</div>
</div>
<div class="paragraph">
<p>Gremlin approached The TinkerPop. The closer he got, the more his world dissolved&#8201;&#8212;&#8201;west is right, around is
straight, and from nothing more than nothing. With each step towards The TinkerPop, more worlds made possible were laid
upon his paradoxed mind. Everything is everything in The TinkerPop, and when the dust
settled, Gremlin emerged Gremlitron. He realized that all that he realized was just a realization and that all
realized realizations are just as real. For that is&#8201;&#8212;&#8201;The TinkerPop.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gremlintron.png" alt="gremlintron" width="400">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TinkerPop2 and below made a sharp distinction between the various TinkerPop projects: Blueprints, Pipes,
Gremlin, Frames, Furnace, and Rexster. With TinkerPop3, all of these projects have been merged and are generally
known as Gremlin. <strong>Blueprints</strong> &#8594; Gremlin Structure API : <strong>Pipes</strong> &#8594; <code>GraphTraversal</code> : <strong>Frames</strong> &#8594; <code>Traversal</code> :
<strong>Furnace</strong> &#8594; <code>GraphComputer</code> and <code>VertexProgram</code> : <strong>Rexster</strong> &#8594; GremlinServer.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="intro" class="sect0">Introduction to Graph Computing</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/graph-computing.png" alt="graph computing" width="350">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>gremlin-core<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A <a href="http://en.wikipedia.org/wiki/Graph_(data_structure)">graph</a> is a data structure composed of vertices (nodes,
dots) and edges (arcs, lines). When modeling a graph in a computer and applying it to modern data sets and practices,
the generic mathematically-oriented, binary graph is extended to support both labels and key/value properties. This
structure is known as a property graph. More formally, it is a directed, binary, attributed multi-graph. An example
property graph is diagrammed below. This graph example will be used extensively throughout the documentation and is
called "TinkerPop Classic" as it is the original demo graph distributed with TinkerPop0 back in 2009 (i.e. the good
ol' days&#8201;&#8212;&#8201;it was the best of times and it was the worst of times).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The TinkerPop graph is available with <a href="#tinkergraph-gremlin">TinkerGraph</a> via <code>TinkerFactory.createModern()</code>.
TinkerGraph is the reference implementation of TinkerPop3 and is used in nearly all the examples in this documentation.
Note that there also exists the classic <code>TinkerFactory.createClassic()</code> which is the graph used in TinkerPop2 and does
not include vertex labels.
</td>
</tr>
</table>
</div>
<div id="tinkerpop-modern" class="imageblock">
<div class="content">
<img src="../images/tinkerpop-modern.png" alt="tinkerpop modern" width="500">
</div>
<div class="title">Figure 1. TinkerPop Modern</div>
</div>
<div class="paragraph">
<p>TinkerPop3 is the third incarnation of the TinkerPop graph computing framework. Similar to computing in general, graph
computing makes a distinction between <strong>structure</strong> (graph) and <strong>process</strong> (traversal). The structure of the graph is the
data model defined by a vertex/edge/property <a href="http://en.wikipedia.org/wiki/Network_topology">topology</a>. The process
of the graph is the means by which the structure is analyzed. The typical form of graph processing is called a
<a href="http://en.wikipedia.org/wiki/Graph_traversal">traversal</a>.</p>
</div>
<div class="ulist">
<div class="title">Primary components of the TinkerPop3 <strong>structure</strong> API</div>
<ul>
<li>
<p><code>Graph</code>: maintains a set of vertices and edges, and access to database functions such as transactions.</p>
</li>
<li>
<p><code>Element</code>: maintains a collection of properties and a string label denoting the element type.</p>
<div class="ulist">
<ul>
<li>
<p><code>Vertex</code>: extends Element and maintains a set of incoming and outgoing edges.</p>
</li>
<li>
<p><code>Edge</code>: extends Element and maintains an incoming and outgoing vertex.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>Property&lt;V&gt;</code>: a string key associated with a <code>V</code> value.</p>
<div class="ulist">
<ul>
<li>
<p><code>VertexProperty&lt;V&gt;</code>: a string key associated with a <code>V</code> value as well as a collection of <code>Property&lt;U&gt;</code> properties (<strong>vertices only</strong>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Primary components of the TinkerPop3 <strong>process</strong> API</div>
<ul>
<li>
<p><code>TraversalSource</code>: a generator of traversals for a particular graph, <a href="http://en.wikipedia.org/wiki/Domain-specific_language">domain specific language</a> (DSL), and execution engine.</p>
<div class="ulist">
<ul>
<li>
<p><code>Traversal&lt;S,E&gt;</code>: a functional data flow process transforming objects of type <code>S</code> into object of type <code>E</code>.</p>
<div class="ulist">
<ul>
<li>
<p><code>GraphTraversal</code>: a traversal DSL that is oriented towards the semantics of the raw graph (i.e. vertices, edges, etc.).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</li>
<li>
<p><code>GraphComputer</code>: a system that processes the graph in parallel and potentially, distributed over a multi-machine cluster.</p>
<div class="ulist">
<ul>
<li>
<p><code>VertexProgram</code>: code executed at all vertices in a logically parallel manner with intercommunication via message passing.</p>
</li>
<li>
<p><code>MapReduce</code>: a computations that analyzes all vertices in the graph in parallel and yields a single reduced result.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerPop3 is licensed under the popular <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache2</a>
free software license. However, note that the underlying graph engine used with TinkerPop3 may have a different
license. Thus, be sure to respect the license caveats of the graph system product.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/tinkerpop-enabled.png" alt="tinkerpop enabled" width="135"></span> When a graph system implements the TinkerPop3 structure and process
<a href="http://en.wikipedia.org/wiki/Application_programming_interface">APIs</a>, their technology is considered
<em>TinkerPop3-enabled</em> and becomes nearly indistinguishable from any other TinkerPop-enabled graph system save for
their respective time and space complexity. The purpose of this documentation is to describe the structure/process
dichotomy at length and in doing so, explain how to leverage TinkerPop3 for the sole purpose of graph system-agnostic
graph computing. Before deep-diving into the various structure/process APIs, a short introductory review of both APIs
is provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The TinkerPop3 API rides a fine line between providing concise "query language" method names and respecting
Java method naming standards. The general convention used throughout TinkerPop3 is that if a method is "user exposed,"
then a concise name is provided (e.g. <code>out()</code>, <code>path()</code>, <code>repeat()</code>). If the method is primarily for graph systems
providers, then the standard Java naming convention is followed (e.g. <code>getNextStep()</code>, <code>getSteps()</code>,
<code>getElementComputeKeys()</code>).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_graph_structure">The Graph Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-standing.png" alt="gremlin standing" width="125"></span> A graph&#8217;s structure is the topology formed by the explicit references
between its vertices, edges, and properties. A vertex has incident edges. A vertex is adjacent to another vertex if
they share an incident edge. A property is attached to an element and an element has a set of properties. A property
is a key/value pair, where the key is always a character <code>String</code>. The graph structure API of TinkerPop3 provides the
methods necessary to create such a structure. The TinkerPop graph previously diagrammed can be created with the
following Java 8 code. Note that this graph is available as an in-memory TinkerGraph using
<code>TinkerFactory.createClassic()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Graph graph = TinkerGraph.open(); <span class="invisible">//</span><b class="conum">1</b>
Vertex marko = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">29</span>); <span class="invisible">//</span><b class="conum">2</b>
Vertex vadas = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">2</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">vadas</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">27</span>);
Vertex lop = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">3</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
Vertex josh = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">4</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">32</span>);
Vertex ripple = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">5</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">ripple</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
Vertex peter = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, T.id, <span class="integer">6</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>, <span class="integer">35</span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, vadas, T.id, <span class="integer">7</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.5f</span>); <span class="invisible">//</span><b class="conum">3</b>
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>, josh, T.id, <span class="integer">8</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">1.0f</span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">9</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.4f</span>);
josh.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, ripple, T.id, <span class="integer">10</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">1.0f</span>);
josh.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">11</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.4f</span>);
peter.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>, lop, T.id, <span class="integer">12</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>, <span class="float">0.2f</span>);</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Create a new in-memory <code>TinkerGraph</code> and assign it to the variable <code>graph</code>.</p>
</li>
<li>
<p>Create a vertex along with a set of key/value pairs with <code>T.label</code> being the vertex label and <code>T.id</code> being the vertex id.</p>
</li>
<li>
<p>Create an edge along with a  set of key/value pairs with the edge label being specified as the first argument.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the above code all the vertices are created first and then their respective edges. There are two "accessor tokens":
<code>T.id</code> and <code>T.label</code>. When any of these, along with a set of other key value pairs is provided to
<code>Graph.addVertex(Object&#8230;&#8203;)</code> or <code>Vertex.addEdge(String,Vertex,Object&#8230;&#8203;)</code>, the respective element is created along
with the provided key/value pair properties appended to it.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Many graph systems do not allow the user to specify an element ID and in such cases, an exception is thrown.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In TinkerPop3, vertices are allowed a single immutable string label (similar to an edge label). This
functionality did not exist in TinkerPop2. Element ids are still immutable in TinkerPop3 as they were in TinkerPop2.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_mutating_the_graph">Mutating the Graph</h3>
<div class="paragraph">
<p>Below is a sequence of basic graph mutation operations represented in Java 8. One of the major differences between
TinkerPop2 and TinkerPop3 is that in TinkerPop3, the Java convention of using setters and getters has been abandoned
in favor of a syntax that is more aligned with the syntax of Gremlin-Groovy in TinkerPop2. Given that Gremlin-Java8
and Gremlin-Groovy are nearly identical due to the inclusion of Java 8 lambdas, a big effort was made to ensure that
both languages are as similar as possible.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
In the code examples presented throughout this documentation, either Gremlin-Java8 or Gremlin-Groovy is used.
It is possible to determine which derivative of Gremlin is being used by mousing over the code block.  The word "JAVA"
or "GROOVY" will appear in the top right corner of the code block.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/basic-mutation.png" alt="basic mutation" width="240"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Graph graph = TinkerGraph.open();
<span class="comment">// add a software vertex with a name property</span>
Vertex gremlin = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,
                             <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin</span><span class="delimiter">&quot;</span></span>); <span class="invisible">//</span><b class="conum">1</b>
<span class="comment">// only one vertex should exist</span>
<span class="keyword">assert</span>(IteratorUtils.count(graph.vertices()) == <span class="integer">1</span>)
<span class="comment">// no edges should exist as none have been created</span>
<span class="keyword">assert</span>(IteratorUtils.count(graph.edges()) == <span class="integer">0</span>)
<span class="comment">// add a new property</span>
gremlin.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="integer">2009</span>) <span class="invisible">//</span><b class="conum">2</b>
<span class="comment">// add a new software vertex to the graph</span>
Vertex blueprints = graph.addVertex(T.label, <span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,
                                <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">blueprints</span><span class="delimiter">&quot;</span></span>); <span class="invisible">//</span><b class="conum">3</b>
<span class="comment">// connect gremlin to blueprints via a dependsOn-edge</span>
gremlin.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">dependsOn</span><span class="delimiter">&quot;</span></span>,blueprints); <span class="invisible">//</span><b class="conum">4</b>
<span class="comment">// now there are two vertices and one edge</span>
<span class="keyword">assert</span>(IteratorUtils.count(graph.vertices()) == <span class="integer">2</span>)
<span class="keyword">assert</span>(IteratorUtils.count(graph.edges()) == <span class="integer">1</span>)
<span class="comment">// add a property to blueprints</span>
blueprints.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,<span class="integer">2010</span>) <span class="invisible">//</span><b class="conum">5</b>
<span class="comment">// remove that property</span>
blueprints.property(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).remove() <span class="invisible">//</span><b class="conum">6</b>
<span class="comment">// connect gremlin to blueprints via encapsulates</span>
gremlin.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">encapsulates</span><span class="delimiter">&quot;</span></span>,blueprints) <span class="invisible">//</span><b class="conum">7</b>
<span class="keyword">assert</span>(IteratorUtils.count(graph.vertices()) == <span class="integer">2</span>)
<span class="keyword">assert</span>(IteratorUtils.count(graph.edges()) == <span class="integer">2</span>)
<span class="comment">// removing a vertex removes all its incident edges as well</span>
blueprints.remove() <span class="invisible">//</span><b class="conum">8</b>
gremlin.remove() <span class="invisible">//</span><b class="conum">9</b>
<span class="comment">// the graph is now empty</span>
<span class="keyword">assert</span>(IteratorUtils.count(graph.vertices()) == <span class="integer">0</span>)
<span class="keyword">assert</span>(IteratorUtils.count(graph.edges()) == <span class="integer">0</span>)
<span class="comment">// tada!</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="../images/groovy-logo.png" alt="groovy logo" width="175"></span> Gremlin-Groovy leverages the
<a href="http://www.groovy-lang.org/">Groovy 2.x language</a> to express Gremlin traversals. One of the major benefits of
Groovy is the inclusion of a runtime console that makes it easy for developers to practice with the Gremlin language
and for production users to connect to their graph and execute traversals in an interactive manner. Moreover,
Gremlin-Groovy provides various syntax simplifications.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="../images/gremlin-sugar.png" alt="gremlin sugar" width="100"></span> For those wishing to use the Gremlin2 syntax, please see
<a href="#sugar-plugin">SugarPlugin</a>. This plugin provides syntactic sugar at, typically, a runtime cost. It can be loaded
programmatically via <code>SugarLoader.load()</code>. Once loaded, it is possible to do <code>g.V.out.name</code> instead of
<code>g.V().out().values('name')</code> as well as a host of other conveniences.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here is the same code, but using Gremlin-Groovy in the <a href="#gremlin-console">Gremlin Console</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; gremlin = graph.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; gremlin.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="integer">2009</span>)
==&gt;vp[created-&gt;<span class="integer">2009</span>]
gremlin&gt; blueprints = graph.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blueprints</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">3</span>]
gremlin&gt; gremlin.addEdge(<span class="string"><span class="delimiter">'</span><span class="content">dependsOn</span><span class="delimiter">'</span></span>,blueprints)
==&gt;e[<span class="integer">5</span>][<span class="integer">0</span>-dependsOn-&gt;<span class="integer">3</span>]
gremlin&gt; blueprints.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="integer">2010</span>)
==&gt;vp[created-&gt;<span class="integer">2010</span>]
gremlin&gt; blueprints.property(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).remove()
==&gt;<span class="predefined-constant">null</span> <span class="invisible">//</span><b class="conum">1</b>
gremlin&gt; gremlin.addEdge(<span class="string"><span class="delimiter">'</span><span class="content">encapsulates</span><span class="delimiter">'</span></span>,blueprints)
==&gt;e[<span class="integer">7</span>][<span class="integer">0</span>-encapsulates-&gt;<span class="integer">3</span>]
gremlin&gt; blueprints.remove()
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; gremlin.remove()
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A <code>=&#8658;null</code> output is usually from a <code>void</code> method call and simply indicates that there was no problem with the
invocation. If there were a problem, an error would be output or an exception would be thrown.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerGraph is not a transactional graph. For more information on transaction handling (for those graph
systems that support them) see the section dedicated to <a href="#transactions">transactions</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="the-graph-process">The Graph Process</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-running.png" alt="gremlin running" width="125"></span> The primary way in which graphs are processed are via graph
traversals. The TinkerPop3 process API is focused on allowing users to create graph traversals in a
syntactically-friendly way over the structures defined in the previous section. A traversal is an algorithmic walk
across the elements of a graph according to the referential structure explicit within the graph data structure.
For example: <em>"What software does vertex 1&#8217;s friends work on?"</em> This English-statement can be represented in the
following algorithmic/traversal fashion:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start at vertex 1.</p>
</li>
<li>
<p>Walk the incident knows-edges to the respective adjacent friend vertices of 1.</p>
</li>
<li>
<p>Move from those friend-vertices to software-vertices via created-edges.</p>
</li>
<li>
<p>Finally, select the name-property value of the current software-vertices.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Traversals in Gremlin are spawned from a <code>TraversalSource</code>. The <code>GraphTraversalSource</code> is the typical "graph-oriented"
DSL used throughout the documentation and will most likely be the most used DSL in a TinkerPop application.
<code>GraphTraversalSource</code> provides two traversal methods.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>GraphTraversalSource.V(Object&#8230;&#8203; ids)</code>: generates a traversal starting at vertices in the graph (if no ids are provided, all vertices).</p>
</li>
<li>
<p><code>GraphTraversalSource.E(Object&#8230;&#8203; ids)</code>: generates a traversal starting at edges in the graph (if no ids are provided, all edges).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The return type of <code>V()</code> and <code>E()</code> is a <code>GraphTraversal</code>. A GraphTraversal maintains numerous methods that return
<code>GraphTraversal</code>. In this way, a <code>GraphTraversal</code> supports function composition. Each method of <code>GraphTraversal</code> is
called a step and each step modulates the results of the previous step in one of five general ways.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>map</code>: transform the incoming traverser&#8217;s object to another object (S &rarr; E).</p>
</li>
<li>
<p><code>flatMap</code>: transform the incoming traverser&#8217;s object to an iterator of other objects (S &rarr; E*).</p>
</li>
<li>
<p><code>filter</code>: allow or disallow the traverser from proceeding to the next step (S &rarr; E &sube; S).</p>
</li>
<li>
<p><code>sideEffect</code>: allow the traverser to proceed unchanged, but yield some computational sideEffect in the process (S &rarrlp; S).</p>
</li>
<li>
<p><code>branch</code>: split the traverser and send each to an arbitrary location in the traversal (S &rarr; { S<sub>1</sub> &rarr; E*, &#8230;&#8203;, S<sub>n</sub> &rarr; E* } &rarr; E*).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nearly every step in GraphTraversal either extends <code>MapStep</code>, <code>FlatMapStep</code>, <code>FilterStep</code>, <code>SideEffectStep</code>, or <code>BranchStep</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<code>GraphTraversal</code> is a <a href="http://en.wikipedia.org/wiki/Monoid">monoid</a> in that it is an algebraic structure
that has a single binary operation that is associative. The binary operation is function composition (i.e. method
chaining) and its identity is the step <code>identity()</code>. This is related to a
<a href="http://en.wikipedia.org/wiki/Monad_(functional_programming)">monad</a> as popularized by the functional programming
community.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Given the TinkerPop graph, the following query will return the names of all the people that the marko-vertex knows.
The following query is demonstrated using Gremlin-Groovy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> bin/gremlin.sh

         <span class="error">\</span>,,,<span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>         (o o)
-----oOOo-(<span class="integer">3</span>)-oOOo-----
gremlin&gt; graph = TinkerFactory.createModern() <span class="invisible">//</span><b class="conum">1</b>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g = graph.traversal()        <span class="invisible">//</span><b class="conum">2</b>
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b>
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Open the toy graph and reference it by the variable <code>graph</code>.</p>
</li>
<li>
<p>Create a graph traversal source from the graph using the standard, OLTP traversal engine.</p>
</li>
<li>
<p>Spawn a traversal off the traversal source that determines the names of the people that the marko-vertex knows.</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tinkerpop-classic-ex1.png" alt="tinkerpop classic ex1" width="500">
</div>
<div class="title">Figure 2. The Name of The People That Marko Knows</div>
</div>
<div class="paragraph">
<p>Or, if the marko-vertex is already realized with a direct reference pointer (i.e. a variable), then the traversal can
be spawned off that vertex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; marko = g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).next() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(marko).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V(marko).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Set the variable <code>marko</code> to the vertex in the graph <code>g</code> named "marko".</p>
</li>
<li>
<p>Get the vertices that are outgoing adjacent to the marko-vertex via knows-edges.</p>
</li>
<li>
<p>Get the names of the marko-vertex&#8217;s friends.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_the_traverser">The Traverser</h3>
<div class="paragraph">
<p>When a traversal is executed, the source of the traversal is on the left of the expression (e.g. vertex 1), the steps
are the middle of the traversal (e.g. <code>out('knows')</code> and <code>values('name')</code>), and the results are "traversal.next()'d"
out of the right of the traversal (e.g. "vadas" and "josh").</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/traversal-mechanics.png" alt="traversal mechanics" width="500">
</div>
</div>
<div class="paragraph">
<p>In TinkerPop3, the objects propagating through the traversal are wrapped in a <code>Traverser&lt;T&gt;</code>. The traverser concept
is new to TinkerPop3 and provides the means by which steps remain stateless. A traverser maintains all the metadata
about the traversal&#8201;&#8212;&#8201;e.g., how many times the traverser has gone through a loop, the path history of the traverser,
the current object being traversed, etc. Traverser metadata may be accessed by a step. A classic example is the
<a href="#path-step"><code>path()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(marko).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">2</span>],vadas]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],josh]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Path calculation is costly in terms of space as an array of previously seen objects is stored in each path
of the respective traverser. Thus, a traversal strategy analyzes the traversal to determine if path metadata is
required. If not, then path calculations are turned off.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another example is the <a href="#repeat-step"><code>repeat()</code></a>-step which takes into account the number of times the traverser
has gone through a particular section of the traversal expression (i.e. a loop).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(marko).repeat(out()).times(<span class="integer">2</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
A Traversal&#8217;s result are never ordered unless explicitly by means of <a href="#order-step"><code>order()</code></a>-step. Thus,
never rely on the iteration order between TinkerPop3 releases and even within a release (as traversal optimizations
may alter the flow).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_gremlin_language_variants">On Gremlin Language Variants</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin is written in Java 8. There are various language variants of Gremlin such as Gremlin-Groovy (packaged with
TinkerPop3), Gremlin-Python (packaged with TinkerPop3), <a href="https://github.com/mpollmeier/gremlin-scala">Gremlin-Scala</a>,
Gremlin-JavaScript, Gremlin-Clojure (known as <a href="https://github.com/clojurewerkz/ogre">Ogre</a>), etc.
It is best to think of Gremlin as a style of graph traversing that is not bound to a particular programming language per se.
Within a programming language familiar to the developer, there is a Gremlin variant that they can use that leverages
the idioms of that language. At minimum, a programming language providing a Gremlin implementation must support
<a href="http://en.wikipedia.org/wiki/Method_chaining">function chaining</a> (with
<a href="http://en.wikipedia.org/wiki/Anonymous_function">lambdas/anonymous functions</a> being a "nice to have" if the
variants wishes to offer arbitrary computations beyond the provided Gremlin steps).</p>
</div>
<div class="paragraph">
<p>Throughout the documentation, the examples provided are primarily written in Gremlin-Groovy. The reason for this is
the <a href="#gremlin-console">Gremlin Console</a>&#8201;&#8212;&#8201;an interactive programming environment exists that does not require
code compilation. For learning TinkerPop3 and interacting with a live graph system in an ad hoc manner, the Gremlin
Console is invaluable. However, for developers interested in working with Gremlin-Java, a few Groovy-to-Java patterns
are presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b>
g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content"> is the friend name</span><span class="delimiter">'</span></span>} <span class="invisible">//</span><b class="conum">2</b>
g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).sideEffect(<span class="predefined-type">System</span>.out.&amp;println) <span class="invisible">//</span><b class="conum">3</b>
g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">friend</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">friend</span><span class="delimiter">'</span></span>).by{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).length()} <span class="invisible">//</span><b class="conum">4</b></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">1</b>
g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).map(t -&gt; t.get().value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is the friend name</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">2</b>
g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).sideEffect(<span class="predefined-type">System</span>.out::println) <span class="invisible">//</span><b class="conum">3</b>
g.V().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">friend</span><span class="delimiter">&quot;</span></span>).select(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">friend</span><span class="delimiter">&quot;</span></span>).by((Function&lt;Vertex, <span class="predefined-type">Integer</span>&gt;) v -&gt; v.&lt;<span class="predefined-type">String</span>&gt;value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).length()) <span class="invisible">//</span><b class="conum">4</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>All the non-lambda step chaining is identical in Gremlin-Groovy and Gremlin-Java. However, note that Groovy
supports <code>'</code> strings as well as <code>"</code> strings.</p>
</li>
<li>
<p>In Groovy, lambdas are called closures and have a different syntax, where Groovy supports the <code>it</code> keyword and
Java doesn&#8217;t with all parameters requiring naming.</p>
</li>
<li>
<p>The syntax for method references differs slightly between <a href="https://docs.oracle.com/javase/tutorial/java/javaOO/methodreferences.html">Java</a>
and <a href="http://mrhaki.blogspot.de/2009/08/groovy-goodness-turn-methods-into.html">Gremlin-Groovy</a>.</p>
</li>
<li>
<p>Groovy is lenient on object typing and Java is not. When the parameter type of the lambda is not known,
typecasting is required.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Please see the <a href="#gremlin-variants">Gremlin Variants</a> section for more information on this topic.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_system_integration">Graph System Integration</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/provider-integration.png" alt="provider integration" width="395"></span> TinkerPop is a framework composed of various interoperable
components. At the foundation there is the <a href="#graph">core TinkerPop3 API</a> which defines what a <code>Graph</code>, <code>Vertex</code>,
<code>Edge</code>, etc. are. At minimum a graph system provider must implement the core API. Once implemented, the Gremlin
<a href="#traversal">traversal language</a> is available to the graph system&#8217;s users. However, the provider can go further and
develop specific <a href="#traversalstrategy"><code>TraversalStrategy</code></a> optimizations that allow the graph system to inspect a
Gremlin query at runtime and optimize it for its particular implementation (e.g. index lookups, step reordering). If
the graph system is a graph processor (i.e. provides OLAP capabilities), the system should implement the
<a href="#graphcomputer"><code>GraphComputer</code></a> API. This API defines how messages/traversers are passed between communicating
workers (i.e. threads and/or machines). Once implemented, the same Gremlin traversals execute against both the graph
database (OLTP) and the graph processor (OLAP). Note that the Gremlin language interprets the graph in terms of
vertices and edges&#8201;&#8212;&#8201;i.e. Gremlin is a graph-based domain specific language. Users can create their own domain
specific languages to process the graph in terms of higher-order constructs such as people, companies, and their
various relationships. Finally, <a href="#gremlin-server">Gremlin Server</a> can be leveraged to allow over the wire
communication with the TinkerPop-enabled graph system. Gremlin Server provides a configurable communication interface
along with metrics and monitoring capabilities. In total, this is The TinkerPop.</p>
</div>
</div>
</div>
<h1 id="graph" class="sect0">The Graph</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-standing.png" alt="gremlin standing" width="125">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_features">Features</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>Feature</code> implementation describes the capabilities of a <code>Graph</code> instance. This interface is implemented by graph
system providers for two purposes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It tells users the capabilities of their <code>Graph</code> instance.</p>
</li>
<li>
<p>It allows the features they do comply with to be tested against the Gremlin Test Suite - tests that do not comply are "ignored").</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following example in the Gremlin Console shows how to print all the features of a <code>Graph</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.features()
==&gt;FEATURES
&gt; GraphFeatures
&gt;-- <span class="key">Transactions</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">Computer</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">Persistence</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ConcurrentAccess</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">ThreadedTransactions</span>: <span class="predefined-constant">false</span>
&gt; VariableFeatures
&gt;-- <span class="key">Variables</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MapValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MixedListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">SerializableValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UniformListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteValues</span>: <span class="predefined-constant">true</span>
&gt; VertexFeatures
&gt;-- <span class="key">MetaProperties</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">RemoveVertices</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">AddVertices</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DuplicateMultiProperties</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MultiProperties</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">NumericIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UuidIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">CustomIds</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">AnyIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UserSuppliedIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">AddProperty</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">RemoveProperty</span>: <span class="predefined-constant">true</span>
&gt; VertexPropertyFeatures
&gt;-- <span class="key">NumericIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UuidIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">CustomIds</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">AnyIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UserSuppliedIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">AddProperty</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">RemoveProperty</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="predefined-type">Properties</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MapValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MixedListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">SerializableValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UniformListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteValues</span>: <span class="predefined-constant">true</span>
&gt; EdgeFeatures
&gt;-- <span class="key">RemoveEdges</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">AddEdges</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">NumericIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UuidIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">CustomIds</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">AnyIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UserSuppliedIds</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">AddProperty</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">RemoveProperty</span>: <span class="predefined-constant">true</span>
&gt; EdgePropertyFeatures
&gt;-- <span class="predefined-type">Properties</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MapValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">MixedListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">SerializableValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">UniformListValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">DoubleArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">FloatArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">IntegerArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">LongArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">StringArrayValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">BooleanValues</span>: <span class="predefined-constant">true</span>
&gt;-- <span class="key">ByteValues</span>: <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A common pattern for using features is to check their support prior to performing an operation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph.features().graph().supportsTransactions()
==&gt;<span class="predefined-constant">false</span>
gremlin&gt; graph.features().graph().supportsTransactions() ? g.tx().commit() : <span class="string"><span class="delimiter">&quot;</span><span class="content">no tx</span><span class="delimiter">&quot;</span></span>
==&gt;no tx</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To ensure provider agnostic code, always check feature support prior to usage of a particular function.  In that
way, the application can behave gracefully in case a particular implementation is provided at runtime that does not
support a function being accessed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Assignments of a <code>GraphStrategy</code> can alter the base features of a <code>Graph</code> in dynamic ways, such that checks
against a <code>Feature</code> may not always reflect the behavior exhibited when the <code>GraphStrategy</code> is in use.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertex-properties">Vertex Properties</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/vertex-properties.png" alt="vertex properties" width="215"></span> TinkerPop3 introduces the concept of a <code>VertexProperty&lt;V&gt;</code>. All the
properties of a <code>Vertex</code> are a <code>VertexProperty</code>. A <code>VertexProperty</code> implements <code>Property</code> and as such, it has a
key/value pair. However, <code>VertexProperty</code> also implements <code>Element</code> and thus, can have a collection of key/value
pairs. Moreover, while an <code>Edge</code> can only have one property of key "name" (for example), a <code>Vertex</code> can have multiple
"name" properties. With the inclusion of vertex properties, two features are introduced which ultimately advance the
graph modelers toolkit:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Multiple properties (<strong>multi-properties</strong>): a vertex property key can have multiple values.  For example, a vertex can have
multiple "name" properties.</p>
</li>
<li>
<p>Properties on properties (<strong>meta-properties</strong>): a vertex property can have properties (i.e. a vertex property can
have key/value data associated with it).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Possible use cases for meta-properties:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Permissions</strong>: Vertex properties can have key/value ACL-type permission information associated with them.</p>
</li>
<li>
<p><strong>Auditing</strong>: When a vertex property is manipulated, it can have key/value information attached to it saying who the
creator, deletor, etc. are.</p>
</li>
<li>
<p><strong>Provenance</strong>: The "name" of a vertex can be declared by multiple users.  For example, there may be multiple spellings
of a name from different sources.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A running example using vertex properties is provided below to demonstrate and explain the API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; v = g.addV().property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko a. rodriguez</span><span class="delimiter">'</span></span>).next()
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).count() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="integer">2</span>
gremlin&gt; v.property(list, <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">m. a. rodriguez</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).count()
==&gt;<span class="integer">3</span>
gremlin&gt; g.V(v).properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;marko a. rodriguez]
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;marko a. rodriguez]
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).hasValue(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).hasValue(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">private</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;vp[name-&gt;marko]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).hasValue(<span class="string"><span class="delimiter">'</span><span class="content">marko a. rodriguez</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko a. rodriguez]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).hasValue(<span class="string"><span class="delimiter">'</span><span class="content">marko a. rodriguez</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko a. rodriguez]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).value()
==&gt;marko a. rodriguez
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).drop() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>).value()
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">private</span><span class="delimiter">'</span></span>).value()
==&gt;marko
gremlin&gt; g.V(v).properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties().properties() <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;p[acl-&gt;<span class="directive">private</span>]
gremlin&gt; g.V(v).properties().property(<span class="string"><span class="delimiter">'</span><span class="content">date</span><span class="delimiter">'</span></span>,<span class="integer">2014</span>) <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties().property(<span class="string"><span class="delimiter">'</span><span class="content">creator</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;marko]
==&gt;vp[name-&gt;m. a. rodriguez]
gremlin&gt; g.V(v).properties().properties()
==&gt;p[date-&gt;<span class="integer">2014</span>]
==&gt;p[creator-&gt;stephen]
==&gt;p[acl-&gt;<span class="directive">private</span>]
==&gt;p[date-&gt;<span class="integer">2014</span>]
==&gt;p[creator-&gt;stephen]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">date</span>:<span class="integer">2014</span>,<span class="key">creator</span>:stephen,<span class="key">acl</span>:<span class="directive">private</span>]
==&gt;[<span class="key">date</span>:<span class="integer">2014</span>,<span class="key">creator</span>:stephen]
gremlin&gt; g.V(v).property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">okram</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.V(v).properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;okram]
gremlin&gt; g.V(v).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
==&gt;okram</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A vertex can have zero or more properties with the same key associated with it.</p>
</li>
<li>
<p>If a property is added with a cardinality of <code>Cardinality.list</code>, an additional property with the provided key will be added.</p>
</li>
<li>
<p>A vertex property can have standard key/value properties attached to it.</p>
</li>
<li>
<p>Vertex property removal is identical to property removal.</p>
</li>
<li>
<p>It is property to get the properties of a vertex property.</p>
</li>
<li>
<p>A vertex property can have any number of key/value properties attached to it.</p>
</li>
<li>
<p><code>property(&#8230;&#8203;)</code> will remove all existing key&#8217;d properties before adding the new single property (see <code>VertexProperty.Cardinality</code>).</p>
</li>
<li>
<p>If only the value of a property is needed, then <code>values()</code> can be used.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the concept of vertex properties is difficult to grasp, then it may be best to think of vertex properties in terms
of "literal vertices." A vertex can have an edge to a "literal vertex" that has a single value key/value&#8201;&#8212;&#8201;e.g.
"value=okram." The edge that points to that literal vertex has an edge-label of "name." The properties on the edge
represent the literal vertex&#8217;s properties. The "literal vertex" can not have any other edges to it (only one from the
associated vertex).</p>
</div>
<div id="the-crew-toy-graph" class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
A toy graph demonstrating all of the new TinkerPop3 graph structure features is available at
<code>TinkerFactory.createTheCrew()</code> and <code>data/tinkerpop-crew*</code>. This graph demonstrates multi-properties and meta-properties.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/the-crew-graph.png" alt="the crew graph" width="685">
</div>
<div class="title">Figure 3. TinkerPop Crew</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
               properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
               hasNot(<span class="string"><span class="delimiter">'</span><span class="content">endTime</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(value).by(<span class="string"><span class="delimiter">'</span><span class="content">startTime</span><span class="delimiter">'</span></span>) <span class="comment">// determine the current location of each person</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:santa fe,<span class="key">c</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">a</span>:stephen,<span class="key">b</span>:purcellville,<span class="key">c</span>:<span class="integer">2006</span>]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:seattle,<span class="key">c</span>:<span class="integer">2014</span>]
==&gt;[<span class="key">a</span>:daniel,<span class="key">b</span>:aachen,<span class="key">c</span>:<span class="integer">2009</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">uses</span><span class="delimiter">'</span></span>).
               order().by(<span class="string"><span class="delimiter">'</span><span class="content">skill</span><span class="delimiter">'</span></span>,incr).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
               outV().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">skill</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="comment">// rank the users of gremlin by their skill level</span>
==&gt;[<span class="key">a</span>:<span class="integer">3</span>,<span class="key">b</span>:matthias]
==&gt;[<span class="key">a</span>:<span class="integer">4</span>,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:<span class="integer">5</span>,<span class="key">b</span>:stephen]
==&gt;[<span class="key">a</span>:<span class="integer">5</span>,<span class="key">b</span>:daniel]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_graph_variables">Graph Variables</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TinkerPop3 introduces the concept of <code>Graph.Variables</code>. Variables are key/value pairs associated with the graph
itself&#8201;&#8212;&#8201;in essence, a <code>Map&lt;String,Object&gt;</code>. These variables are intended to store metadata about the graph. Example
use cases include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Schema information</strong>: What do the namespace prefixes resolve to and when was the schema last modified?</p>
</li>
<li>
<p><strong>Global permissions</strong>: What are the access rights for particular groups?</p>
</li>
<li>
<p><strong>System user information</strong>: Who are the admins of the system?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>An example of graph variables in use is presented below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.variables()
==&gt;variables[<span class="key">size</span>:<span class="integer">0</span>]
gremlin&gt; graph.variables().set(<span class="string"><span class="delimiter">'</span><span class="content">systemAdmins</span><span class="delimiter">'</span></span>,[<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">peter</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">pavel</span><span class="delimiter">'</span></span>])
gremlin&gt; graph.variables().set(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>,[<span class="string"><span class="delimiter">'</span><span class="content">matthias</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>])
gremlin&gt; graph.variables().keys()
==&gt;systemAdmins
==&gt;systemUsers
gremlin&gt; graph.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>)
==&gt;Optional[[matthias, marko, josh]]
gremlin&gt; graph.variables().get(<span class="string"><span class="delimiter">'</span><span class="content">systemUsers</span><span class="delimiter">'</span></span>).get()
==&gt;matthias
==&gt;marko
==&gt;josh
gremlin&gt; graph.variables().remove(<span class="string"><span class="delimiter">'</span><span class="content">systemAdmins</span><span class="delimiter">'</span></span>)
gremlin&gt; graph.variables().keys()
==&gt;systemUsers</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Graph variables are not intended to be subject to heavy, concurrent mutation nor to be used in complex
computations. The intention is to have a location to store data about the graph for administrative purposes.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="transactions">Graph Transactions</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-coins.png" alt="gremlin coins" width="100"></span> A <a href="http://en.wikipedia.org/wiki/Database_transaction">database transaction</a>
represents a unit of work to execute against the database.  Transactions are controlled by an implementation of the
<code>Transaction</code> interface and that object can be obtained from the <code>Graph</code> interface using the <code>tx()</code> method.  It is
important to note that the <code>Transaction</code> object does not represent a "transaction" itself.  It merely exposes the
methods for working with transactions (e.g. committing, rolling back, etc).</p>
</div>
<div class="paragraph">
<p>Most <code>Graph</code> implementations that <code>supportsTransactions</code> will implement an "automatic" <code>ThreadLocal</code> transaction,
which means that when a read or write occurs after the <code>Graph</code> is instantiated, a transaction is automatically
started within that thread.  There is no need to manually call a method to "create" or "start" a transaction.  Simply
modify the graph as required and call <code>graph.tx().commit()</code> to apply changes or <code>graph.tx().rollback()</code> to undo them.
When the next read or write action occurs against the graph, a new transaction will be started within that current
thread of execution.</p>
</div>
<div class="paragraph">
<p>When using transactions in this fashion, especially in web application (e.g. REST server), it is important to ensure
that transactions do not leak from one request to the next.  In other words, unless a client is somehow bound via
session to process every request on the same server thread, every request must be committed or rolled back at the end
of the request.  By ensuring that the request encapsulates a transaction, it ensures that a future request processed
on a server thread is starting in a fresh transactional state and will not have access to the remains of one from an
earlier request. A good strategy is to rollback a transaction at the start of a request, so that if it so happens that
a transactional leak does occur between requests somehow, a fresh transaction is assured by the fresh request.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
The <code>tx()</code> method is on the <code>Graph</code> interface, but it is also available on the <code>TraversalSource</code> spawned from a
<code>Graph</code>.  Calls to <code>TraversalSource.tx()</code> are proxied through to the underlying <code>Graph</code> as a convenience.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
TinkerPop provides for basic transaction control, however, like many aspects of TinkerPop, it is up to the
graph system provider to choose the specific aspects of how their implementation will work and how it fits into the
TinkerPop stack. Be sure to understand the transaction semantics of the specific graph implementation that is being
utilized as it may present differing functionality than described here.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuring">Configuring</h3>
<div class="paragraph">
<p>Determining when a transaction starts is dependent upon the behavior assigned to the <code>Transaction</code>.  It is up to the
<code>Graph</code> implementation to determine the default behavior and unless the implementation doesn&#8217;t allow it, the behavior
itself can be altered via these <code>Transaction</code> methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> Transaction onReadWrite(<span class="directive">final</span> Consumer&lt;Transaction&gt; consumer);

<span class="directive">public</span> Transaction onClose(<span class="directive">final</span> Consumer&lt;Transaction&gt; consumer);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Providing a <code>Consumer</code> function to <code>onReadWrite</code> allows definition of how a transaction starts when a read or a write
occurs. <code>Transaction.READ_WRITE_BEHAVIOR</code> contains pre-defined <code>Consumer</code> functions to supply to the <code>onReadWrite</code>
method.  It has two options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>AUTO</code> - automatic transactions where the transaction is started implicitly to the read or write operation</p>
</li>
<li>
<p><code>MANUAL</code> - manual transactions where it is up to the user to explicitly open a transaction, throwing an exception
if the transaction is not open</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Providing a <code>Consumer</code> function to <code>onClose</code> allows configuration of how a transaction is handled when
<code>Transaction.close()</code> is called.  <code>Transaction.CLOSE_BEHAVIOR</code> has several pre-defined options that can be supplied to
this method:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>COMMIT</code> - automatically commit an open transaction</p>
</li>
<li>
<p><code>ROLLBACK</code> - automatically rollback an open transaction</p>
</li>
<li>
<p><code>MANUAL</code> - throw an exception if a transaction is open, forcing the user to explicitly close the transaction</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
As transactions are <code>ThreadLocal</code> in nature, so are the transaction configurations for <code>onReadWrite</code> and
<code>onClose</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once there is an understanding for how transactions are configured, most of the rest of the <code>Transaction</code> interface
is self-explanatory. Note that <a href="#neo4j-gremlin">Neo4j-Gremlin</a> is used for the examples to follow as TinkerGraph does
not support transactions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; graph.features()
==&gt;FEATURES
&gt; GraphFeatures
&gt;-- <span class="key">Transactions</span>: <span class="predefined-constant">true</span>  <span class="invisible">//</span><b class="conum">1</b>
&gt;-- <span class="key">Computer</span>: <span class="predefined-constant">false</span>
&gt;-- <span class="key">Persistence</span>: <span class="predefined-constant">true</span>
...
gremlin&gt; graph.tx().onReadWrite(Transaction.READ_WRITE_BEHAVIOR.AUTO) <span class="invisible">//</span><b class="conum">2</b>
==&gt;org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph<span class="error">$</span>Neo4jTransaction<span class="error">@</span><span class="integer">1</span>c067c0d
gremlin&gt; graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>)  <span class="invisible">//</span><b class="conum">3</b>
==&gt;v[<span class="integer">0</span>]
gremlin&gt; graph.tx().commit() <span class="invisible">//</span><b class="conum">4</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; graph.tx().onReadWrite(Transaction.READ_WRITE_BEHAVIOR.MANUAL) <span class="invisible">//</span><b class="conum">5</b>
==&gt;org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph<span class="error">$</span>Neo4jTransaction<span class="error">@</span><span class="integer">1</span>c067c0d
gremlin&gt; graph.tx().isOpen()
==&gt;<span class="predefined-constant">false</span>
gremlin&gt; graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">6</b>
Open a transaction before attempting to read/write the transaction
gremlin&gt; graph.tx().open() <span class="invisible">//</span><b class="conum">7</b>
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">8</b>
==&gt;v[<span class="integer">1</span>]
gremlin&gt; graph.tx().commit()
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Check <code>features</code> to ensure that the graph supports transactions.</p>
</li>
<li>
<p>By default, <code>Neo4jGraph</code> is configured with "automatic" transactions, so it is set here for demonstration purposes only.</p>
</li>
<li>
<p>When the vertex is added, the transaction is automatically started.  From this point, more mutations can be staged
or other read operations executed in the context of that open transaction.</p>
</li>
<li>
<p>Calling <code>commit</code> finalizes the transaction.</p>
</li>
<li>
<p>Change transaction behavior to require manual control.</p>
</li>
<li>
<p>Adding a vertex now results in failure because the transaction was not explicitly opened.</p>
</li>
<li>
<p>Explicitly open a transaction.</p>
</li>
<li>
<p>Adding a vertex now succeeds as the transaction was manually opened.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It may be important to consult the documentation of the <code>Graph</code> implementation you are using when it comes to the
specifics of how transactions will behave.  TinkerPop allows some latitude in this area and implementations may not have
the exact same behaviors and <a href="https://en.wikipedia.org/wiki/ACID">ACID</a> guarantees.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_threaded_transactions">Threaded Transactions</h3>
<div class="paragraph">
<p>Most <code>Graph</code> implementations that support transactions do so in a <code>ThreadLocal</code> manner, where the current transaction
is bound to the current thread of execution. Consider the following example to demonstrate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Thread</span> t1 = <span class="keyword">new</span> <span class="predefined-type">Thread</span>(() -&gt; {
    graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>);
});

<span class="predefined-type">Thread</span> t2 = <span class="keyword">new</span> <span class="predefined-type">Thread</span>(() -&gt; {
    graph.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>);
});

t1.start()
t2.start()

t1.join()
t2.join()

graph.tx().commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code shows three vertices added to <code>graph</code> in three different threads: the current thread, <code>t1</code> and
<code>t2</code>.  One might expect that by the time this body of code finished executing, that there would be three vertices
persisted to the <code>Graph</code>.  However, given the <code>ThreadLocal</code> nature of transactions, there really were three separate
transactions created in that body of code (i.e. one for each thread of execution) and the only one committed was the
first call to <code>addVertex</code> in the primary thread of execution.  The other two calls to that method within <code>t1</code> and <code>t2</code>
were never committed and thus orphaned.</p>
</div>
<div class="paragraph">
<p>A <code>Graph</code> that <code>supportsThreadedTransactions</code> is one that allows for a <code>Graph</code> to operate outside of that constraint,
thus allowing multiple threads to operate within the same transaction.  Therefore, if there was a need to have three
different threads operating within the same transaction, the above code could be re-written as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Graph threaded = graph.tx().createThreadedTx();
threaded.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>);

<span class="predefined-type">Thread</span> t1 = <span class="keyword">new</span> <span class="predefined-type">Thread</span>(() -&gt; {
    threaded.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>);
});

<span class="predefined-type">Thread</span> t2 = <span class="keyword">new</span> <span class="predefined-type">Thread</span>(() -&gt; {
    threaded.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>);
});

t1.start()
t2.start()

t1.join()
t2.join()

threaded.tx().commit();</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above case, the call to <code>graph.tx().createThreadedTx()</code> creates a new <code>Graph</code> instance that is unbound from the
<code>ThreadLocal</code> transaction, thus allowing each thread to operate on it in the same context.  In this case, there would
be three separate vertices persisted to the <code>Graph</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_gremlin_i_o">Gremlin I/O</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-io.png" alt="gremlin io" width="250"></span> The task of getting data in and out of <code>Graph</code> instances is the job of
the Gremlin I/O packages.  Gremlin I/O provides two interfaces for reading and writing <code>Graph</code> instances: <code>GraphReader</code>
and <code>GraphWriter</code>.  These interfaces expose methods that support:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reading and writing an entire <code>Graph</code></p>
</li>
<li>
<p>Reading and writing a <code>Traversal&lt;Vertex&gt;</code> as adjacency list format</p>
</li>
<li>
<p>Reading and writing a single <code>Vertex</code> (with and without associated <code>Edge</code> objects)</p>
</li>
<li>
<p>Reading and writing a single <code>Edge</code></p>
</li>
<li>
<p>Reading and writing a single <code>VertexProperty</code></p>
</li>
<li>
<p>Reading and writing a single <code>Property</code></p>
</li>
<li>
<p>Reading and writing an arbitrary <code>Object</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In all cases, these methods operate in the currency of <code>InputStream</code> and <code>OutputStream</code> objects, allowing graphs and
their related elements to be written to and read from files, byte arrays, etc.  The <code>Graph</code> interface offers the <code>io</code>
method, which provides access to "reader/writer builder" objects that are pre-configured with serializers provided by
the <code>Graph</code>, as well as helper methods for the various I/O capabilities. Unless there are very advanced requirements
for the serialization process, it is always best to utilize the methods on the <code>Io</code> interface to construct
<code>GraphReader</code> and <code>GraphWriter</code> instances, as the implementation may provide some custom settings that would otherwise
have to be configured manually by the user to do the serialization.</p>
</div>
<div class="paragraph">
<p>It is up to the implementations of the <code>GraphReader</code> and <code>GraphWriter</code> interfaces to choose the methods they
implement and the manner in which they work together.  The only characteristic enforced and expected is that the write
methods should produce output that is compatible with the corresponding read method.  For example, the output of
<code>writeVertices</code> should be readable as input to <code>readVertices</code> and the output of <code>writeProperty</code> should be readable as
input to <code>readProperty</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Additional documentation for TinkerPop IO formats can be found in the <a href="http://tinkerpop.apache.org/docs/3.2.6/dev/io/">IO Reference</a>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_graphml_reader_writer">GraphML Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-graphml.png" alt="gremlin graphml" width="350"></span> The <a href="http://graphml.graphdrawing.org/">GraphML</a> file format is a
common XML-based representation of a graph. It is widely supported by graph-related tools and libraries making it a
solid interchange format for TinkerPop. In other words, if the intent is to work with graph data in conjunction with
applications outside of TinkerPop, GraphML may be the best choice to do that. Common use cases might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Generate a graph using <a href="https://networkx.github.io/">NetworkX</a>, export it with GraphML and import it to TinkerPop.</p>
</li>
<li>
<p>Produce a subgraph and export it to GraphML to be consumed by and visualized in <a href="https://gephi.org/">Gephi</a>.</p>
</li>
<li>
<p>Migrate the data of an entire graph to a different graph database not supported by TinkerPop.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As GraphML is a specification for the serialization of an entire graph and not the individual elements of a graph,
methods that support input and output of single vertices, edges, etc. are not supported.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
GraphML is a "lossy" format in that it only supports primitive values for properties and does not have
support for <code>Graph</code> variables.  It will use <code>toString</code> to serialize property values outside of those primitives.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
GraphML as a specification allows for <code>&lt;edge&gt;</code> and <code>&lt;node&gt;</code> elements to appear in any order.  Most software
that writes GraphML (including as TinkerPop&#8217;s <code>GraphMLWriter</code>) write <code>&lt;node&gt;</code> elements before <code>&lt;edge&gt;</code> elements.  However it
is important to note that <code>GraphMLReader</code> will read this data in order and order can matter.  This is because TinkerPop
does not allow the vertex label to be changed after the vertex has been created.  Therefore, if an <code>&lt;edge&gt;</code> element
comes before the <code>&lt;node&gt;</code>, the label on the vertex will be ignored.  It is thus better to order <code>&lt;node&gt;</code> elements in the
GraphML to appear before all <code>&lt;edge&gt;</code> elements if vertex labels are important to the graph.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following code shows how to write a <code>Graph</code> instance to file called <code>tinkerpop-modern.xml</code> and then how to read
that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
graph.io(IoCore.graphml()).writeGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.xml</span><span class="delimiter">&quot;</span></span>);
<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
newGraph.io(IoCore.graphml()).readGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.xml</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a custom configuration is required, then have the <code>Graph</code> generate a <code>GraphReader</code> or <code>GraphWriter</code> "builder" instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.xml</span><span class="delimiter">&quot;</span></span>)) {
    graph.io(IoCore.graphml()).writer().normalize(<span class="predefined-constant">true</span>).create().writeGraph(os, graph);
}

<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.xml</span><span class="delimiter">&quot;</span></span>)) {
    newGraph.io(IoCore.graphml()).reader().create().readGraph(stream, newGraph);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>GraphML was a supported format in TinkerPop 2.x, but there were several issues that made it inconsistent with the
specification that were corrected for 3.x. As a result, attempting to read a GraphML file generated by 2.x with the
3.x <code>GraphMLReader</code> will result in error. To help with this problem, an XSLT file is provided as a resource in
<code>gremlin-core</code> which will transform 2.x GraphML to 3.x GraphML. It can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">import</span> <span class="include">javax.xml.parsers.DocumentBuilderFactory</span>;
<span class="keyword">import</span> <span class="include">javax.xml.transform.TransformerFactory</span>;
<span class="keyword">import</span> <span class="include">javax.xml.transform.dom.DOMSource</span>;
<span class="keyword">import</span> <span class="include">javax.xml.transform.stream.StreamSource</span>;
<span class="keyword">import</span> <span class="include">javax.xml.transform.stream.StreamResult</span>;

<span class="predefined-type">InputStream</span> stylesheet = <span class="predefined-type">Thread</span>.currentThread().getContextClassLoader().getResourceAsStream(<span class="string"><span class="delimiter">&quot;</span><span class="content">tp2-to-tp3-graphml.xslt</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">File</span> datafile = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp2-graphml.xml</span><span class="delimiter">'</span></span>);
<span class="predefined-type">File</span> outfile = <span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp3-graphml.xml</span><span class="delimiter">'</span></span>);

<span class="predefined-type">TransformerFactory</span> tFactory = <span class="predefined-type">TransformerFactory</span>.newInstance();
<span class="predefined-type">StreamSource</span> stylesource = <span class="keyword">new</span> <span class="predefined-type">StreamSource</span>(stylesheet);
<span class="predefined-type">Transformer</span> transformer = tFactory.newTransformer(stylesource);

<span class="predefined-type">StreamSource</span> source = <span class="keyword">new</span> <span class="predefined-type">StreamSource</span>(datafile);
<span class="predefined-type">StreamResult</span> result = <span class="keyword">new</span> <span class="predefined-type">StreamResult</span>(<span class="keyword">new</span> <span class="predefined-type">FileWriter</span>(outfile));
transformer.transform(source, result);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="graphson-reader-writer">GraphSON Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-graphson.png" alt="gremlin graphson" width="350"></span> GraphSON is a <a href="http://json.org/">JSON</a>-based format extended
from earlier versions of TinkerPop. It is important to note that TinkerPop3&#8217;s GraphSON is not backwards compatible
with prior TinkerPop GraphSON versions. GraphSON has some support from graph-related application outside of TinkerPop,
but it is generally best used in two cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A text format of the graph or its elements is desired (e.g. debugging, usage in source control, etc.)</p>
</li>
<li>
<p>The graph or its elements need to be consumed by code that is not JVM-based (e.g. JavaScript, Python, .NET, etc.)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>GraphSON supports all of the <code>GraphReader</code> and <code>GraphWriter</code> interface methods and can therefore read or write an
entire <code>Graph</code>, vertices, arbitrary objects, etc.  The following code shows how to write a <code>Graph</code> instance to file
called <code>tinkerpop-modern.json</code> and then how to read that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
graph.io(IoCore.graphson()).writeGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.json</span><span class="delimiter">&quot;</span></span>);

<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
newGraph.io(IoCore.graphson()).readGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.json</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a custom configuration is required, then have the <code>Graph</code> generate a <code>GraphReader</code> or <code>GraphWriter</code> "builder" instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.json</span><span class="delimiter">&quot;</span></span>)) {
    <span class="directive">final</span> GraphSONMapper mapper = graph.io(IoCore.graphson()).mapper().normalize(<span class="predefined-constant">true</span>).create()
    graph.io(IoCore.graphson()).writer().mapper(mapper).create().writeGraph(os, graph)
}

<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.json</span><span class="delimiter">&quot;</span></span>)) {
    newGraph.io(IoCore.graphson()).reader().create().readGraph(stream, newGraph);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the important configuration options of the <code>GraphSONReader</code> and <code>GraphSONWriter</code> is the ability to embed type
information into the output.  By embedding the types, it becomes possible to serialize a graph without losing type
information that might be important when being consumed by another source.  The importance of this concept is
demonstrated in the following example where a single <code>Vertex</code> is written to GraphSON using the Gremlin Console:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; f = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>()
==&gt;
gremlin&gt; graph.io(graphson()).writer().create().writeVertex(f, g.V(<span class="integer">1</span>).next(), BOTH)
gremlin&gt; f.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following GraphSON example shows the output of <code>GraphSONWriter.writeVertex()</code> with associated edges:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">9</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.4</span>
                }
            }
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.5</span>
                }
            },
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>
                }
            }
        ]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>
            }
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: [
            {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">29</span>
            }
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The vertex properly serializes to valid JSON but note that a consuming application will not automatically know how to
interpret the numeric values.  In coercing those Java values to JSON, such information is lost.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Additional documentation for GraphSON can be found in the <a href="http://tinkerpop.apache.org/docs/3.2.6/dev/io/#graphson">IO Reference</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="graphson-types-embedding">Types embedding</h4>
<div class="paragraph">
<p>With a minor change to the construction of the <code>GraphSONWriter</code> the lossy nature of GraphSON can be avoided.</p>
</div>
<div class="sect4">
<h5 id="graphson-1-0-types">Types with GraphSON 1.0</h5>
<div class="paragraph">
<p>GraphSON 1.0 is the version enabled by default when creating a GraphSON Mapper. Here is how to enable types with
GraphSON 1.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; f = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>()
==&gt;
gremlin&gt; mapper = graph.io(graphson()).mapper().embedTypes(<span class="predefined-constant">true</span>).create()
==&gt;org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONMapper<span class="error">@</span><span class="float">775f</span><span class="float">15f</span>d
gremlin&gt; graph.io(graphson()).writer().mapper(mapper).create().writeVertex(f, g.V(<span class="integer">1</span>).next(), BOTH)
gremlin&gt; f.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above code, the <code>embedTypes</code> option is set to <code>true</code> and the output below shows the difference in the output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">9</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">3</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.4</span>
                    }
                }
            ]
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">7</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">2</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="float">0.5</span>
                    }
                },
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="integer">8</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>: <span class="integer">4</span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>
                    }
                }
            ]
        ]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>,
                        <span class="integer">0</span>
                    ],
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>
                }
            ]
        ],
        <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.ArrayList</span><span class="delimiter">&quot;</span></span>,
            [
                {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">@class</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java.util.HashMap</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: [
                        <span class="string"><span class="delimiter">&quot;</span><span class="content">java.lang.Long</span><span class="delimiter">&quot;</span></span>,
                        <span class="integer">1</span>
                    ],
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="integer">29</span>
                }
            ]
        ]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ambiguity of components of the GraphSON is now removed by the <code>@class</code> property, which contains Java class
information for the data it is associated with.  The <code>@class</code> property is used for all non-final types, with the
exception of a small number of "natural" types (String, Boolean, Integer, and Double) which can be correctly inferred
from JSON typing.  While the output is more verbose, it comes with the security of not losing type information.  While
non-JVM languages won&#8217;t be able to consume this information automatically, at least there is a hint as to how the
values should be coerced back into the correct types in the target language.</p>
</div>
</div>
<div class="sect4">
<h5 id="graphson-2-0-types">GraphSON 2.0</h5>
<div class="paragraph">
<p>GraphSON 2.0 has been introduced to improve the format of the typed values from GraphSON 1.0. It provides non-Java
centric types information in a consistent format.</p>
</div>
<div class="paragraph">
<p>With GraphSON 2.0, types are enabled by default.</p>
</div>
<div class="paragraph">
<p>The type format is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Non typed value - <code>value</code></p>
</li>
<li>
<p>Typed value     - <code>{"@type":"typeID", "@value":value}</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>TypeIDs are composed of 2 parts, a namespace, and a type name, in the format <code>"namespace:typename"</code>.
A namespace gives the possibility for TinkerPop implementors to categorize custom types they may implement
and avoid collision with existing TinkerPop types. By default, TinkerPop types will have the
namespace <code>g</code>.</p>
</div>
<div class="paragraph">
<p>GraphSON 2.0 will provide type information for any value that is not <code>String</code>, <code>Boolean</code>, <code>Map</code> or <code>Collection</code>.
TinkerPop includes types for graph elements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vertex - <code>g:Vertex</code></p>
</li>
<li>
<p>Edge - <code>g:Edge</code></p>
</li>
<li>
<p>VertexPropery - <code>g:VertexProperty</code></p>
</li>
<li>
<p>Property - <code>g:Property</code></p>
</li>
<li>
<p>Path - <code>g:Path</code></p>
</li>
<li>
<p>Tree - <code>g:Tree</code></p>
</li>
<li>
<p>Graph - <code>g:Graph</code></p>
</li>
<li>
<p>Metrics - <code>g:Metrics</code></p>
</li>
<li>
<p>TraversalMetrics - <code>g:TraversalMetrics</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>GraphSON 2.0 can also be configured with "extended" types that build on top of the core types in the "g" namespace.
The extended types are in the "gx" namespace as exposed by <code>GraphSONXModuleV2d0</code> and includes additional types like
mappings to Java&#8217;s <code>java.time.*</code> classes, <code>BigInteger</code>, <code>BigDecimal</code> and others. This module can be added when building
a <code>GraphSONMapper</code> by calling the <code>addCustomModule()</code> method on the <code>Builder</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When using the extended type system in Gremlin Server, support for these types when used in the context of
Gremlin Language Variants is dependent on the programming language, the driver and its serializers. These
implementations are only required to support the core types and not the extended ones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Here&#8217;s the same previous example of GraphSON 1.0, but with GraphSON 2.0:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; f = <span class="keyword">new</span> <span class="predefined-type">ByteArrayOutputStream</span>()
==&gt;
gremlin&gt; mapper = graph.io(graphson()).mapper().version(GraphSONVersion.V2_0).create()
==&gt;org.apache.tinkerpop.gremlin.structure.io.graphson.GraphSONMapper<span class="error">@</span><span class="integer">4</span>c030fe1
gremlin&gt; graph.io(graphson()).writer().mapper(mapper).create().writeVertex(f, g.V(<span class="integer">1</span>).next(), BOTH)
gremlin&gt; f.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Creating a GraphSON 2.0 mapper is done by calling <code>.version(GraphSONVersion.V2_0)</code> on the mapper builder. Here&#8217;s is the
example output from the code above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Vertex</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Int32</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: [{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:VertexProperty</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Int64</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="integer">0</span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>
                }
            }],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>: [{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:VertexProperty</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Int64</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="integer">12</span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:UUID</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">829c7ddb-3831-4687-a872-e25201230cd3</span><span class="delimiter">&quot;</span></span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">uuid</span><span class="delimiter">&quot;</span></span>
                }
            }],
            <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>: [{
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:VertexProperty</span><span class="delimiter">&quot;</span></span>,
                <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: {
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Int64</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>: {
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">g:Int32</span><span class="delimiter">&quot;</span></span>,
                        <span class="key"><span class="delimiter">&quot;</span><span class="content">@value</span><span class="delimiter">&quot;</span></span>: <span class="integer">29</span>
                    },
                    <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>
                }
            }]
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Types can be disabled when creating a GraphSON 2.0 <code>Mapper</code> with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graph.io(graphson()).mapper().
      version(GraphSONVersion.V2_0).
      typeInfo(GraphSONMapper.TypeInfo.NO_TYPES).create()</code></pre>
</div>
</div>
<div class="paragraph">
<p>By disabling types, the JSON payload produced will lack the extra information that is written for types. Please note,
disabling types can be unsafe with regards to the written data in that types can be lost.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gryo-reader-writer">Gryo Reader/Writer</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-kryo.png" alt="gremlin kryo" width="400"></span> <a href="https://github.com/EsotericSoftware/kryo">Kryo</a> is a popular
serialization package for the JVM. Gremlin-Kryo is a binary <code>Graph</code> serialization format for use on the JVM by JVM
languages. It is designed to be space efficient, non-lossy and is promoted as the standard format to use when working
with graph data inside of the TinkerPop stack. A list of common use cases is presented below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Migration from one Gremlin Structure implementation to another (e.g. <code>TinkerGraph</code> to <code>Neo4jGraph</code>)</p>
</li>
<li>
<p>Serialization of individual graph elements to be sent over the network to another JVM.</p>
</li>
<li>
<p>Backups of in-memory graphs or subgraphs.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
When migrating between Gremlin Structure implementations, Kryo may not lose data, but it is important to
consider the features of each <code>Graph</code> and whether or not the data types supported in one will be supported in the
other.  Failure to do so, may result in errors.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Kryo supports all of the <code>GraphReader</code> and <code>GraphWriter</code> interface methods and can therefore read or write an entire
<code>Graph</code>, vertices, edges, etc.  The following code shows how to write a <code>Graph</code> instance to file called
<code>tinkerpop-modern.kryo</code> and then how to read that file back into a different instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
graph.io(IoCore.gryo()).writeGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">&quot;</span></span>);

<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
newGraph.io(IoCore.gryo()).readGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a custom configuration is required, then have the <code>Graph</code> generate a <code>GraphReader</code> or <code>GraphWriter</code> "builder" instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">final</span> Graph graph = TinkerFactory.createModern();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">OutputStream</span> os = <span class="keyword">new</span> <span class="predefined-type">FileOutputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">&quot;</span></span>)) {
    graph.io(IoCore.gryo()).writer().create().writeGraph(os, graph);
}

<span class="directive">final</span> Graph newGraph = TinkerGraph.open();
<span class="keyword">try</span> (<span class="directive">final</span> <span class="predefined-type">InputStream</span> stream = <span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">&quot;</span></span>)) {
    newGraph.io(IoCore.gryo()).reader().create().readGraph(stream, newGraph);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The preferred extension for files names produced by Gryo is <code>.kryo</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_tinkerpop2_data_migration">TinkerPop2 Data Migration</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/data-migration.png" alt="data migration" width="300"></span> For those using TinkerPop2, migrating to TinkerPop3 will mean a number
of programming changes, but may also require a migration of the data depending on the graph implementation.  For
example, trying to open <code>TinkerGraph</code> data from TinkerPop2 with TinkerPop3 code will not work, however opening a
TinkerPop2 <code>Neo4jGraph</code> with a TinkerPop3 <code>Neo4jGraph</code> should work provided there aren&#8217;t Neo4j version compatibility
mismatches preventing the read.</p>
</div>
<div class="paragraph">
<p>If such a situation arises that a particular TinkerPop2 <code>Graph</code> can not be read by TinkerPop3, a "legacy" data
migration approach exists.  The migration involves writing the TinkerPop2 <code>Graph</code> to GraphSON, then reading it to
TinkerPop3 with the <code>LegacyGraphSONReader</code> (a limited implementation of the <code>GraphReader</code> interface).</p>
</div>
<div class="paragraph">
<p>The following represents an example migration of the "classic" toy graph.  In this example, the "classic" graph is
saved to GraphSON using TinkerPop2.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; Gremlin.version()
==&gt;<span class="float">2.5</span>.z
gremlin&gt; graph = TinkerGraphFactory.createTinkerGraph()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; GraphSONWriter.outputGraph(graph,<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp2.json</span><span class="delimiter">'</span></span>,GraphSONMode.EXTENDED)
==&gt;<span class="predefined-constant">null</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above console session uses the <code>gremlin-groovy</code> distribution from TinkerPop2.  It is important to generate the
<code>tp2.json</code> file using the <code>EXTENDED</code> mode as it will include data types when necessary which will help limit
"lossiness" on the TinkerPop3 side when imported.  Once <code>tp2.json</code> is created, it can then be imported to a TinkerPop3
<code>Graph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; Gremlin.version()
==&gt;3.2.6
gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; r = LegacyGraphSONReader.build().create()
==&gt;org.apache.tinkerpop.gremlin.structure.io.graphson.LegacyGraphSONReader<span class="error">@</span><span class="integer">64337702</span>
gremlin&gt; r.readGraph(<span class="keyword">new</span> <span class="predefined-type">FileInputStream</span>(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/tp2.json</span><span class="delimiter">'</span></span>), graph)
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.E()
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_namespace_conventions">Namespace Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>End users, <a href="#implementations">graph system providers</a>, <a href="#graphcomputer"><code>GraphComputer</code></a> algorithm designers,
<a href="#gremlin-plugins">GremlinPlugin</a> creators, etc. all leverage properties on elements to store information. There are
a few conventions that should be respected when naming property keys to ensure that conflicts between these
stakeholders do not conflict.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>End users are granted the <em>flat namespace</em> (e.g. <code>name</code>, <code>age</code>, <code>location</code>) to key their properties and label their elements.</p>
</li>
<li>
<p>Graph system providers are granted the <em>hidden namespace</em> (e.g. <code>~metadata</code>) to key their properties and labels.
Data keyed as such is only accessible via the graph system implementation and no other stakeholders are granted read
nor write access to data prefixed with "~" (see <code>Graph.Hidden</code>). Test coverage and exceptions exist to ensure that
graph systems respect this hard boundary.</p>
</li>
<li>
<p><a href="#vertexprogram"><code>VertexProgram</code></a> and <a href="#mapreduce"><code>MapReduce</code></a> developers should, like <code>GraphStrategy</code> developers,
leverage <em>qualified namespaces</em> particular to their domain (e.g. <code>mydomain.myvertexprogram.computedata</code>).</p>
</li>
<li>
<p><code>GremlinPlugin</code> creators should prefix their plugin name with their domain (e.g. <code>mydomain.myplugin</code>).</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
TinkerPop uses <code>tinkerpop.</code> and <code>gremlin.</code> as the prefixes for provided strategies, vertex programs, map
reduce implementations, and plugins.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The only truly protected namespace is the <em>hidden namespace</em> provided to graph systems. From there, it&#8217;s up to
engineers to respect the namespacing conventions presented.</p>
</div>
</div>
</div>
<h1 id="traversal" class="sect0">The Traversal</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-running.png" alt="gremlin running" width="125">
</div>
</div>
<div class="paragraph">
<p>At the most general level there is <code>Traversal&lt;S,E&gt;</code> which implements <code>Iterator&lt;E&gt;</code>, where the <code>S</code> stands for start and
the <code>E</code> stands for end. A traversal is composed of four primary components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>Step&lt;S,E&gt;</code>: an individual function applied to <code>S</code> to yield <code>E</code>. Steps are chained within a traversal.</p>
</li>
<li>
<p><code>TraversalStrategy</code>: interceptor methods to alter the execution of the traversal (e.g. query re-writing).</p>
</li>
<li>
<p><code>TraversalSideEffects</code>: key/value pairs that can be used to store global information about the traversal.</p>
</li>
<li>
<p><code>Traverser&lt;T&gt;</code>: the object propagating through the <code>Traversal</code> currently representing an object of type <code>T</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The classic notion of a graph traversal is provided by <code>GraphTraversal&lt;S,E&gt;</code> which extends <code>Traversal&lt;S,E&gt;</code>.
<code>GraphTraversal</code> provides an interpretation of the graph data in terms of vertices, edges, etc. and thus, a graph
traversal <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The underlying <code>Step</code> implementations provided by TinkerPop should encompass most of the functionality
required by a DSL author. It is important that DSL authors leverage the provided steps as then the common optimization
and decoration strategies can reason on the underlying traversal sequence. If new steps are introduced, then common
traversal strategies may not function properly.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graph-traversal-steps">Graph Traversal Steps</h2>
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="../images/step-types.png" alt="step types" width="650">
</div>
</div>
<div class="paragraph">
<p>A <code>GraphTraversal&lt;S,E&gt;</code> is spawned from a <code>GraphTraversalSource</code>. It can also be spawned anonymously (i.e. empty)
via <code>__</code>. A graph traversal is composed of an ordered list of steps. All the steps provided by <code>GraphTraversal</code>
inherit from the more general forms diagrammed above. A list of all the steps (and their descriptions) are provided
in the TinkerPop3 <a href="http://tinkerpop.apache.org/javadocs/3.2.6/core/org/apache/tinkerpop/gremlin/process/traversal/dsl/graph/GraphTraversal.html">GraphTraversal JavaDoc</a>.
The following subsections will demonstrate the GraphTraversal steps using the <a href="#gremlin-console">Gremlin Console</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The basics for starting a traversal are described in <a href="#the-graph-process">The Graph Process</a> section as
well as in the <a href="http://tinkerpop.apache.org/docs/current/tutorials/getting-started/">Getting Started</a> tutorial.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To reduce the verbosity of the expression, it is good to
<code>import static org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.<em>.*</code>. This way, instead of doing <code></em>.inE()</code>
for an anonymous traversal, it is possible to simply write <code>inE()</code>. Be aware of language-specific reserved keywords
when using anonymous traversals. For example, <code>in</code> and <code>as</code> are reserved keywords in Groovy, therefore you must use
the verbose syntax <code><em>.in()</code> and <code></em>.as()</code> to avoid collisions.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="general-steps">General Steps</h3>
<div class="paragraph">
<p>There are five general steps, each having a traversal and a lambda representation, by which all other specific steps described later extend.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 45.4545%;">
<col style="width: 54.5455%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Step</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>map(Traversal&lt;S, E&gt;)</code>  <code>map(Function&lt;Traverser&lt;S&gt;, E&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to some object of type <code>E</code> for the next step to process.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>flatMap(Traversal&lt;S, E&gt;)</code>  <code>flatMap(Function&lt;Traverser&lt;S&gt;, Iterator&lt;E&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to an iterator of <code>E</code> objects that are streamed to the next step.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>filter(Traversal&lt;?, ?&gt;)</code>  <code>filter(Predicate&lt;Traverser&lt;S&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">map the traverser to either true or false, where false will not pass the traverser to the next step.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sideEffect(Traversal&lt;S, S&gt;)</code>  <code>sideEffect(Consumer&lt;Traverser&lt;S&gt;&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">perform some operation on the traverser and pass it to the next step.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>branch(Traversal&lt;S, M&gt;)</code>  <code>branch(Function&lt;Traverser&lt;S&gt;,M&gt;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split the traverser to all the traversals indexed by the <code>M</code> token.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Lambda steps are presented for educational purposes as they represent the foundational constructs of the
Gremlin language. In practice, lambda steps should be avoided in favor of their traversals representation and traversal
verification strategies exist to disallow their use unless explicitly "turned off." For more information on the problems
with lambdas, please read <a href="#a-note-on-lambdas">A Note on Lambdas</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Traverser&lt;S&gt;</code> object provides access to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The current traversed <code>S</code> object&#8201;&#8212;&#8201;<code>Traverser.get()</code>.</p>
</li>
<li>
<p>The current path traversed by the traverser&#8201;&#8212;&#8201;<code>Traverser.path()</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A helper shorthand to get a particular path-history object&#8201;&#8212;&#8201;<code>Traverser.path(String) == Traverser.path().get(String)</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>The number of times the traverser has gone through the current loop&#8201;&#8212;&#8201;<code>Traverser.loops()</code>.</p>
</li>
<li>
<p>The number of objects represented by this traverser&#8201;&#8212;&#8201;<code>Traverser.bulk()</code>.</p>
</li>
<li>
<p>The local data structure associated with this traverser&#8201;&#8212;&#8201;<code>Traverser.sack()</code>.</p>
</li>
<li>
<p>The side-effects associated with the traversal&#8201;&#8212;&#8201;<code>Traverser.sideEffects()</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>A helper shorthand to get a particular side-effect&#8201;&#8212;&#8201;<code>Traverser.sideEffect(String) == Traverser.sideEffects().get(String)</code>.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/map-lambda.png" alt="map lambda" width="150"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;lop
==&gt;vadas
==&gt;josh
gremlin&gt; g.V(<span class="integer">1</span>).out().map {<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)} <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;lop
==&gt;vadas
==&gt;josh
gremlin&gt; g.V(<span class="integer">1</span>).out().map(values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;lop
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>An outgoing traversal from vertex 1 to the name values of the adjacent vertices.</p>
</li>
<li>
<p>The same operation, but using a lambda to access the name property values.</p>
</li>
<li>
<p>Again the same operation, but using the traversal representation of <code>map()</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/filter-lambda.png" alt="filter lambda" width="160"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().filter {<span class="local-variable">it</span>.get().label() == <span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>} <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().filter(label().is(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A filter that only allows the vertex to pass if it has an age-property.</p>
</li>
<li>
<p>The same operation, but using the traversal represention of <code>filter()</code>.</p>
</li>
<li>
<p>The more specific <code>has()</code>-step is implemented as a <code>filter()</code> with respective predicate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/side-effect-lambda.png" alt="side effect lambda" width="175"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).sideEffect(<span class="predefined-type">System</span>.out.&amp;println) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
v[<span class="integer">2</span>]
==&gt;v[<span class="integer">2</span>]
v[<span class="integer">4</span>]
==&gt;v[<span class="integer">4</span>]
v[<span class="integer">6</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().sideEffect(outE().count().store(<span class="string"><span class="delimiter">&quot;</span><span class="content">o</span><span class="delimiter">&quot;</span></span>)).
               sideEffect(inE().count().store(<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>)).cap(<span class="string"><span class="delimiter">&quot;</span><span class="content">o</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">i</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">i</span>:[<span class="integer">0</span>,<span class="integer">0</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">3</span>],<span class="key">o</span>:[<span class="integer">3</span>,<span class="integer">0</span>,<span class="integer">0</span>,<span class="integer">0</span>,<span class="integer">2</span>,<span class="integer">1</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Whatever enters <code>sideEffect()</code> is passed to the next step, but some intervening process can occur.</p>
</li>
<li>
<p>Compute the out- and in-degree for each vertex. Both <code>sideEffect()</code> are fed with the same vertex.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/branch-lambda.png" alt="branch lambda" width="180"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().branch {<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}.
               option(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
               option(none, values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V().branch(values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).
               option(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
               option(none, values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V().choose(has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>),
                      values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>),
                      values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the vertex is "marko", get his age, else get the name of the vertex.</p>
</li>
<li>
<p>The same operation, but using the traversal represention of <code>branch()</code>.</p>
</li>
<li>
<p>The more specific boolean-based <code>choose()</code>-step is implemented as a <code>branch()</code>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="terminal-steps">Terminal Steps</h3>
<div class="paragraph">
<p>Typically, when a step is concatenated to a traversal a traversal is returned. In this way, a traversal is built up
in a <a href="https://en.wikipedia.org/wiki/Fluent_interface">fluent</a>, <a href="https://en.wikipedia.org/wiki/Monoid">monadic</a> fashion.
However, some steps do not return a traversal, but instead, execute the traversal and return a result. These steps are known
as terminal steps (<strong>terminal</strong>) and they are explained via the examples below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).hasNext() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).next() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).next(<span class="integer">2</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">nothing</span><span class="delimiter">'</span></span>).tryNext() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;Optional.empty
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).toList() <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).toSet() <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).toBulkSet() <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
gremlin&gt; results = [<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>,<span class="integer">3</span>]
==&gt;blah
==&gt;<span class="integer">3</span>
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).fill(results) <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
==&gt;blah
==&gt;<span class="integer">3</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>hasNext()</code> determines whether there are available results.</p>
</li>
<li>
<p><code>next()</code> will return the next result.</p>
</li>
<li>
<p><code>next(n)</code> will return the next <code>n</code> results in a list.</p>
</li>
<li>
<p><code>tryNext()</code> will return an <code>Optional</code> and thus, is a composite of <code>hasNext()</code>/<code>next()</code>.</p>
</li>
<li>
<p><code>toList()</code> will return all results in a list.</p>
</li>
<li>
<p><code>toSet()</code> will return all results in a set (thus, duplicates removed).</p>
</li>
<li>
<p><code>toBulkSet()</code> will return all results in a weighted set (thus, duplicates preserved via weighting).</p>
</li>
<li>
<p><code>fill(collection)</code> will put all results in the provided collection and return the collection when complete.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, <a href="#explain-step"><code>explain()</code></a>-step is also a terminal step and is described in its own section.</p>
</div>
</div>
<div class="sect2">
<h3 id="addedge-step">AddEdge Step</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Automated_reasoning">Reasoning</a> is the process of making explicit what is implicit
in the data. What is explicit in a graph are the objects of the graph&#8201;&#8212;&#8201;i.e. vertices and edges. What is implicit
in the graph is the traversal. In other words, traversals expose meaning where the meaning is determined by the
traversal definition. For example, take the concept of a "co-developer." Two people are co-developers if they have
worked on the same project together. This concept can be represented as a traversal and thus, the concept of
"co-developers" can be derived. Moreover, what was once implicit can be made explicit via the <code>addE()</code>-step
(<strong>map</strong>/<strong>sideEffect</strong>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/addedge-step.png" alt="addedge step" width="450">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).where(neq(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)).
           addE(<span class="string"><span class="delimiter">'</span><span class="content">co-developer</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">year</span><span class="delimiter">'</span></span>,<span class="integer">2009</span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;e[<span class="integer">13</span>][<span class="integer">1</span>-co-developer-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">14</span>][<span class="integer">1</span>-co-developer-&gt;<span class="integer">6</span>]
gremlin&gt; g.V(<span class="integer">3</span>,<span class="integer">4</span>,<span class="integer">5</span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
           select(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).unfold().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>).addE(<span class="string"><span class="delimiter">'</span><span class="content">createdBy</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;e[<span class="integer">15</span>][<span class="integer">3</span>-createdBy-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">16</span>][<span class="integer">5</span>-createdBy-&gt;<span class="integer">4</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).addE(<span class="string"><span class="delimiter">'</span><span class="content">createdBy</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;e[<span class="integer">17</span>][<span class="integer">3</span>-createdBy-&gt;<span class="integer">1</span>]
==&gt;e[<span class="integer">18</span>][<span class="integer">5</span>-createdBy-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">19</span>][<span class="integer">3</span>-createdBy-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">20</span>][<span class="integer">3</span>-createdBy-&gt;<span class="integer">6</span>]
gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).
           addE(<span class="string"><span class="delimiter">'</span><span class="content">livesNear</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">year</span><span class="delimiter">'</span></span>,<span class="integer">2009</span>).
           inV().inE(<span class="string"><span class="delimiter">'</span><span class="content">livesNear</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">year</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="integer">2009</span>
==&gt;<span class="integer">2009</span>
gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
               addE(<span class="string"><span class="delimiter">'</span><span class="content">friendlyCollaborator</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
                 property(id,<span class="integer">23</span>).property(<span class="string"><span class="delimiter">'</span><span class="content">project</span><span class="delimiter">'</span></span>,select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;e[<span class="integer">23</span>][<span class="integer">1</span>-friendlyCollaborator-&gt;<span class="integer">4</span>]
gremlin&gt; g.E(<span class="integer">23</span>).valueMap()
==&gt;[<span class="key">project</span>:lop]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Add a co-developer edge with a year-property between marko and his collaborators.</p>
</li>
<li>
<p>Add incoming createdBy edges from the josh-vertex to the lop- and ripple-vertices.</p>
</li>
<li>
<p>Add an inverse createdBy edge for all created edges.</p>
</li>
<li>
<p>The newly created edge is a traversable object.</p>
</li>
<li>
<p>Two arbitrary bindings in a traversal can be joined <code>from()</code>&#8594;`to()<code>, where `id</code> can be provided for graphs that
supports user provided ids.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="addvertex-step">AddVertex Step</h3>
<div class="paragraph">
<p>The <code>addV()</code>-step is used to add vertices to the graph (<strong>map</strong>/<strong>sideEffect</strong>). For every incoming object, a vertex is
created. Moreover, <code>GraphTraversalSource</code> maintains an <code>addV()</code> method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.addV(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">13</span>]
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
==&gt;stephen
gremlin&gt; g.V().outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).addV().property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">nothing</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">15</span>]
==&gt;v[<span class="integer">17</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">nothing</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">17</span>]
==&gt;v[<span class="integer">15</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">nothing</span><span class="delimiter">'</span></span>).bothE()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="addproperty-step">AddProperty Step</h3>
<div class="paragraph">
<p>The <code>property()</code>-step is used to add properties to the elements of the graph (<strong>sideEffect</strong>). Unlike <code>addV()</code> and
<code>addE()</code>, <code>property()</code> is a full sideEffect step in that it does not return the property it created, but the element
that streamed into it. Moreover, if <code>property()</code> follows an <code>addV()</code> or <code>addE()</code>, then it is "folded" into the
previous step to enable vertex and edge creation with all its properties in one creation operation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).property(<span class="string"><span class="delimiter">'</span><span class="content">country</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">usa</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).property(<span class="string"><span class="delimiter">'</span><span class="content">city</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">santa fe</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">state</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">new mexico</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">country</span>:[usa],<span class="key">city</span>:[santa fe],<span class="key">name</span>:[marko],<span class="key">state</span>:[<span class="keyword">new</span> mexico],<span class="key">age</span>:[<span class="integer">29</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).property(list,<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="integer">35</span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).valueMap()
==&gt;[<span class="key">country</span>:[usa],<span class="key">city</span>:[santa fe],<span class="key">name</span>:[marko],<span class="key">state</span>:[<span class="keyword">new</span> mexico],<span class="key">age</span>:[<span class="integer">29</span>,<span class="integer">35</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).property(<span class="string"><span class="delimiter">'</span><span class="content">friendWeight</span><span class="delimiter">'</span></span>,outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).sum(),<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">private</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">friendWeight</span><span class="delimiter">'</span></span>).valueMap() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="key">acl</span>:<span class="directive">private</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>For vertices, a cardinality can be provided for <a href="#vertex-properties">vertex properties</a>.</p>
</li>
<li>
<p>It is possible to select the property value (as well as key) via a traversal.</p>
</li>
<li>
<p>For vertices, the <code>property()</code>-step can add meta-properties.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="aggregate-step">Aggregate Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/aggregate-step.png" alt="aggregate step" width="800">
</div>
</div>
<div class="paragraph">
<p>The <code>aggregate()</code>-step (<strong>sideEffect</strong>) is used to aggregate all the objects at a particular point of traversal into a
<code>Collection</code>. The step uses <a href="http://en.wikipedia.org/wiki/Eager_evaluation">eager evaluation</a> in that no objects
continue on until all previous objects have been fully aggregated (as opposed to <a href="#store-step"><code>store()</code></a> which
<a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazily</a> fills a collection). The eager evaluation nature is crucial
in situations where everything at a particular point is required for future computation. An example is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
                where(without(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;ripple</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>What has marko created?</p>
</li>
<li>
<p>Aggregate all his creations.</p>
</li>
<li>
<p>Who are marko&#8217;s collaborators?</p>
</li>
<li>
<p>What have marko&#8217;s collaborators created?</p>
</li>
<li>
<p>What have marko&#8217;s collaborators created that he hasn&#8217;t created?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In <a href="http://en.wikipedia.org/wiki/Recommender_system">recommendation systems</a>, the above pattern is used:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"What has userA liked? Who else has liked those things? What have they liked that userA hasn't already liked?"</pre>
</div>
</div>
<div class="paragraph">
<p>Finally, <code>aggregate()</code>-step can be modulated via <code>by()</code>-projection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">2</span>],v[<span class="integer">4</span>]]
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[vadas,josh]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="and-step">And Step</h3>
<div class="paragraph">
<p>The <code>and()</code>-step ensures that all provided traversals yield a result (<strong>filter</strong>). Please see <a href="#or-step"><code>or()</code></a> for or-semantics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().and(
            outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>),
            values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).is(lt(<span class="integer">30</span>))).
              values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>and()</code>-step can take an arbitrary number of traversals. All traversals must produce at least one output for the
original traverser to pass to the next step.</p>
</div>
<div class="paragraph">
<p>An <a href="http://en.wikipedia.org/wiki/Infix_notation">infix notation</a> can be used as well. Though, with infix notation,
only two traversals can be and&#8217;d together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().where(outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).and().outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="as-step">As Step</h3>
<div class="paragraph">
<p>The <code>as()</code>-step is not a real step, but a "step modulator" similar to <a href="#by-step"><code>by()</code></a> and <a href="#option-step"><code>option()</code></a>.
With <code>as()</code>, it is possible to provide a label to the step that can later be accessed by steps and data structures
that make use of such labels&#8201;&#8212;&#8201;e.g., <a href="#select-step"><code>select()</code></a>, <a href="#match-step"><code>match()</code></a>, and path.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">3</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">5</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">3</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">6</span>],<span class="key">b</span>:v[<span class="integer">3</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:lop]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:ripple]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:lop]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:lop]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Select the objects labeled "a" and "b" from the path.</p>
</li>
<li>
<p>Select the objects labeled "a" and "b" from the path and, for each object, project its name value.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A step can have any number of labels associated with it. This is useful for referencing the same step multiple times in a future step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
            select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
              by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
              by(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>).
              by(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold())
==&gt;[<span class="key">a</span>:lop,<span class="key">b</span>:java,<span class="key">c</span>:[marko,josh,peter]]
==&gt;[<span class="key">a</span>:ripple,<span class="key">b</span>:java,<span class="key">c</span>:[josh]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="barrier-step">Barrier Step</h3>
<div class="paragraph">
<p>The <code>barrier()</code>-step (<strong>barrier</strong>) turns the lazy traversal pipeline into a bulk-synchronous pipeline. This step is
useful in the following situations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When everything prior to <code>barrier()</code> needs to be executed before moving onto the steps after the <code>barrier()</code> (i.e. ordering).</p>
</li>
<li>
<p>When "stalling" the traversal may lead to a "bulking optimization" in traversals that repeatedly touch many of the same elements (i.e. optimizing).</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().sideEffect{println <span class="string"><span class="delimiter">&quot;</span><span class="content">first: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>}.sideEffect{println <span class="string"><span class="delimiter">&quot;</span><span class="content">second: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>}.iterate()
<span class="key">first</span>: v[<span class="integer">1</span>]
<span class="key">second</span>: v[<span class="integer">1</span>]
<span class="key">first</span>: v[<span class="integer">2</span>]
<span class="key">second</span>: v[<span class="integer">2</span>]
<span class="key">first</span>: v[<span class="integer">3</span>]
<span class="key">second</span>: v[<span class="integer">3</span>]
<span class="key">first</span>: v[<span class="integer">4</span>]
<span class="key">second</span>: v[<span class="integer">4</span>]
<span class="key">first</span>: v[<span class="integer">5</span>]
<span class="key">second</span>: v[<span class="integer">5</span>]
<span class="key">first</span>: v[<span class="integer">6</span>]
<span class="key">second</span>: v[<span class="integer">6</span>]
gremlin&gt; g.V().sideEffect{println <span class="string"><span class="delimiter">&quot;</span><span class="content">first: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>}.barrier().sideEffect{println <span class="string"><span class="delimiter">&quot;</span><span class="content">second: </span><span class="inline"><span class="inline-delimiter">${</span><span class="local-variable">it</span><span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>}.iterate()
<span class="key">first</span>: v[<span class="integer">1</span>]
<span class="key">first</span>: v[<span class="integer">2</span>]
<span class="key">first</span>: v[<span class="integer">3</span>]
<span class="key">first</span>: v[<span class="integer">4</span>]
<span class="key">first</span>: v[<span class="integer">5</span>]
<span class="key">first</span>: v[<span class="integer">6</span>]
<span class="key">second</span>: v[<span class="integer">1</span>]
<span class="key">second</span>: v[<span class="integer">2</span>]
<span class="key">second</span>: v[<span class="integer">3</span>]
<span class="key">second</span>: v[<span class="integer">4</span>]
<span class="key">second</span>: v[<span class="integer">5</span>]
<span class="key">second</span>: v[<span class="integer">6</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The theory behind a "bulking optimization" is simple. If there are one million traversers at vertex 1, then there is
no need to calculate one million <code>both()</code>-computations. Instead, represent those one million traversers as a single
traverser with a <code>Traverser.bulk()</code> equal to one million and execute <code>both()</code> once. A bulking optimization example is
made more salient on a larger graph. Therefore, the example below leverages the <a href="#grateful-dead">Grateful Dead graph</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal().withoutStrategies(LazyBarrierStrategy) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">808</span> <span class="key">edges</span>:<span class="integer">8049</span>], standard]
gremlin&gt; clockWithResult(<span class="integer">1</span>){g.V().both().both().both().count().next()} <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="float">10503.063725</span>
==&gt;<span class="integer">126653966</span>
gremlin&gt; clockWithResult(<span class="integer">1</span>){g.V().repeat(both()).times(<span class="integer">3</span>).count().next()} <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="float">19.157953</span>
==&gt;<span class="integer">126653966</span>
gremlin&gt; clockWithResult(<span class="integer">1</span>){g.V().both().barrier().both().barrier().both().barrier().count().next()} <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="float">19.658645</span>
==&gt;<span class="integer">126653966</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Explicitly remove <code>LazyBarrierStrategy</code> which yields a bulking optimization.</p>
</li>
<li>
<p>A non-bulking traversal where each traverser is processed.</p>
</li>
<li>
<p>Each traverser entering <code>repeat()</code> has its recursion bulked.</p>
</li>
<li>
<p>A bulking traversal where implicit traversers are not processed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If <code>barrier()</code> is provided an integer argument, then the barrier will only hold <code>n</code>-number of unique traversers in its
barrier before draining the aggregated traversers to the next step. This is useful in the aforementioned bulking
optimization scenario with the added benefit of reducing the risk of an out-of-memory exception.</p>
</div>
<div class="paragraph">
<p><code>LazyBarrierStrategy</code> inserts <code>barrier()</code>-steps into a traversal where appropriate in order to gain the
"bulking optimization."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">808</span> <span class="key">edges</span>:<span class="integer">8049</span>], standard]
gremlin&gt; clockWithResult(<span class="integer">1</span>){g.V().both().both().both().count().next()}
==&gt;<span class="float">15.189326999999999</span>
==&gt;<span class="integer">126653966</span>
gremlin&gt; g.V().both().both().both().count().iterate().toString() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[TinkerGraphStep(vertex,<span class="type">[]</span>), VertexStep(BOTH,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(BOTH,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(BOTH,edge), CountGlobalStep]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>LazyBarrierStrategy</code> is a default strategy and thus, does not need to be explicitly activated.</p>
</li>
<li>
<p>With <code>LazyBarrierStrategy</code> activated, <code>barrier()</code> steps are automatically inserted where appropriate.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="by-step">By Step</h3>
<div class="paragraph">
<p>The <code>by()</code>-step is not an actual step, but instead is a "step-modulator" similar to <a href="#as-step"><code>as()</code></a> and
<a href="#option-step"><code>option()</code></a>. If a step is able to accept traversals, functions, comparators, etc. then <code>by()</code> is the
means by which they are added. The general pattern is <code>step().by()&#8230;&#8203;by()</code>. Some steps can only accept one <code>by()</code>
while others can take an arbitrary amount.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().group().by(bothE().count()) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="integer">1</span>:[v[<span class="integer">2</span>],v[<span class="integer">5</span>],v[<span class="integer">6</span>]],<span class="integer">3</span>:[v[<span class="integer">1</span>],v[<span class="integer">3</span>],v[<span class="integer">4</span>]]]
gremlin&gt; g.V().group().by(bothE().count()).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="integer">1</span>:[vadas,ripple,peter],<span class="integer">3</span>:[marko,lop,josh]]
gremlin&gt; g.V().group().by(bothE().count()).by(count()) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="integer">1</span>:<span class="integer">3</span>,<span class="integer">3</span>:<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>by(outE().count())</code> will group the elements by their edge count (<strong>traversal</strong>).</p>
</li>
<li>
<p><code>by('name')</code> will process the grouped elements by their name (<strong>element property projection</strong>).</p>
</li>
<li>
<p><code>by(count())</code> will count the number of elements in each group (<strong>traversal</strong>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following steps all support <code>by()</code>-modulation. Note that the semantics of such modulation should be understood
on a step-by-step level and thus, as discussed in their respective section of the documentation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#dedup-step"><code>dedup()</code></a>: dedup on the results of a <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#cyclicpath-step"><code>cyclicPath()</code></a>: filter if the traverser&#8217;s path is cyclic given <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#simplepath-step"><code>simplePath()</code></a>: filter if the traverser&#8217;s path is simple given <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#sample-step"><code>sample()</code></a>: sample using the value returned by <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#where-step"><code>where()</code></a>: determine the predicate given the testing of the results of <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#groupCount-step"><code>groupCount()</code></a>: count those groups where the group keys are the result of <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#group-step"><code>group()</code></a>: create group keys and values according to <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#order-step"><code>order()</code></a>: order the objects by the results of a <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#path-step"><code>path()</code></a>: get the path of the traverser where each path element is <code>by()</code>-modulated.</p>
</li>
<li>
<p><a href="#project-step"><code>project()</code></a>: project a map of results given various <code>by()</code>-modulations off the current object.</p>
</li>
<li>
<p><a href="#select-step"><code>select()</code></a>: select path elements and transform them via <code>by()</code>-modulation.</p>
</li>
<li>
<p><a href="#tree-step"><code>tree()</code></a>: get a tree of traversers objects where the objects have been <code>by()</code>-modulated.</p>
</li>
<li>
<p><a href="#aggregate-step"><code>aggregate()</code></a>: aggregate all objects into a set but only store their <code>by()</code>-modulated values.</p>
</li>
<li>
<p><a href="#store-step"><code>store()</code></a>: store all objects into a set but only store their <code>by()</code>-modulated values.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cap-step">Cap Step</h3>
<div class="paragraph">
<p>The <code>cap()</code>-step (<strong>barrier</strong>) iterates the traversal up to itself and emits the sideEffect referenced by the provided
key. If multiple keys are provided, then a <code>Map&lt;String,Object&gt;</code> of sideEffects is emitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).by(label).cap(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">software</span>:<span class="integer">2</span>,<span class="key">person</span>:<span class="integer">4</span>]
gremlin&gt; g.V().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).by(label).groupCount(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(outE().count()).cap(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:[<span class="key">software</span>:<span class="integer">2</span>,<span class="key">person</span>:<span class="integer">4</span>],<span class="key">b</span>:[<span class="integer">0</span>:<span class="integer">3</span>,<span class="integer">1</span>:<span class="integer">1</span>,<span class="integer">2</span>:<span class="integer">1</span>,<span class="integer">3</span>:<span class="integer">1</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Group and count verticies by their label.  Emit the side effect labeled 'a', which is the group count by label.</p>
</li>
<li>
<p>Same as statement 1, but also emit the side effect labeled 'b' which groups vertices by the number of out edges.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="choose-step">Choose Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/choose-step.png" alt="choose step" width="700">
</div>
</div>
<div class="paragraph">
<p>The <code>choose()</code>-step (<strong>branch</strong>) routes the current traverser to a particular traversal branch option. With <code>choose()</code>,
it is possible to implement if/then/else-semantics as well as more complicated selections.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               choose(values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).is(lte(<span class="integer">30</span>)),
                 __.in(),
                 __.out()).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;marko
==&gt;ripple
==&gt;lop
==&gt;lop
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               choose(values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
                 option(<span class="integer">27</span>, __.in()).
                 option(<span class="integer">32</span>, __.out()).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;marko
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the traversal yields an element, then do <code>in</code>, else do <code>out</code> (i.e. true/false-based option selection).</p>
</li>
<li>
<p>Use the result of the traversal as a key to the map of traversal options (i.e. value-based option selection).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If the "false"-branch is not provided, then if/then-semantics are implemented.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().choose(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>), out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;lop
==&gt;lop
==&gt;ripple
==&gt;lop
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().choose(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>), out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>), identity()).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;lop
==&gt;lop
==&gt;ripple
==&gt;lop
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the vertex is a person, emit the vertices they created, else emit the vertex.</p>
</li>
<li>
<p>If/then/else with an <code>identity()</code> on the false-branch is equivalent to if/then with no false-branch.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that <code>choose()</code> can have an arbitrary number of options and moreover, can take an anonymous traversal as its choice function.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               choose(values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).
                 option(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
                 option(<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>, values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).
                 option(<span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>, valueMap()).
                 option(<span class="string"><span class="delimiter">'</span><span class="content">peter</span><span class="delimiter">'</span></span>, label())
==&gt;<span class="integer">29</span>
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;josh
==&gt;person</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>choose()</code>-step can leverage the <code>Pick.none</code> option match. For anything that does not match a specified option, the <code>none</code>-option is taken.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               choose(values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).
                 option(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
                 option(none, values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>))
==&gt;<span class="integer">29</span>
==&gt;vadas
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coalesce-step">Coalesce Step</h3>
<div class="paragraph">
<p>The <code>coalesce()</code>-step evaluates the provided traversals in order and returns the first traversal that emits at
least one element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).coalesce(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>), outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).inV().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(label)
==&gt;[marko,knows,vadas]
==&gt;[marko,knows,josh]
gremlin&gt; g.V(<span class="integer">1</span>).coalesce(outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>), outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).inV().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(label)
==&gt;[marko,created,lop]
gremlin&gt; g.V(<span class="integer">1</span>).property(<span class="string"><span class="delimiter">'</span><span class="content">nickname</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">okram</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).coalesce(values(<span class="string"><span class="delimiter">'</span><span class="content">nickname</span><span class="delimiter">'</span></span>), values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>))
==&gt;okram
==&gt;vadas
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="coin-step">Coin Step</h3>
<div class="paragraph">
<p>To randomly filter out a traverser, use the <code>coin()</code>-step (<strong>filter</strong>). The provided double argument biases the "coin toss."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().coin(<span class="float">0.5</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().coin(<span class="float">0.0</span>)
gremlin&gt; g.V().coin(<span class="float">1.0</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="constant-step">Constant Step</h3>
<div class="paragraph">
<p>To specify a constant value for a traverser, use the <code>constant()</code>-step (<strong>map</strong>).  This is often useful with conditional
steps like <a href="#choose-step"><code>choose()</code>-step</a> or <a href="#coalesce-step"><code>coalesce()</code>-step</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().choose(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>),
             values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>),
             constant(<span class="string"><span class="delimiter">'</span><span class="content">inhuman</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;marko
==&gt;vadas
==&gt;inhuman
==&gt;josh
==&gt;inhuman
==&gt;peter
gremlin&gt; g.V().coalesce(
             hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>),
             constant(<span class="string"><span class="delimiter">'</span><span class="content">inhuman</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;marko
==&gt;vadas
==&gt;inhuman
==&gt;josh
==&gt;inhuman
==&gt;peter</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Show the names of people, but show "inhuman" for other vertices.</p>
</li>
<li>
<p>Same as statement 1 (unless there is a person vertex with no name).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="count-step">Count Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/count-step.png" alt="count step" width="195">
</div>
</div>
<div class="paragraph">
<p>The <code>count()</code>-step (<strong>map</strong>) counts the total number of represented traversers in the streams (i.e. the bulk count).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().count()
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).count()
==&gt;<span class="integer">4</span>
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().path() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="integer">4</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().map {<span class="local-variable">it</span>.get() * <span class="integer">10</span>}.path() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="integer">4</span>,<span class="integer">40</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>count()</code>-step is a <a href="#a-note-on-barrier-steps">reducing barrier step</a> meaning that all of the previous traversers are folded into a new traverser.</p>
</li>
<li>
<p>The path of the traverser emanating from <code>count()</code> starts at <code>count()</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>count(local)</code> counts the current, local object (not the objects in the traversal stream). This works for
<code>Collection</code>- and <code>Map</code>-type objects. For any other object, a count of 1 is returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cyclicpath-step">CyclicPath Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/cyclicpath-step.png" alt="cyclicpath step" width="400">
</div>
</div>
<div class="paragraph">
<p>Each traverser maintains its history through the traversal over the graph&#8201;&#8212;&#8201;i.e. its <a href="#path-data-structure">path</a>.
If it is important that the traverser repeat its course, then <code>cyclic()</code>-path should be used (<strong>filter</strong>). The step
analyzes the path of the traverser thus far and if there are any repeats, the traverser is filtered out over the
traversal computation. If non-cyclic behavior is desired, see <a href="#simplepath-step"><code>simplePath()</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).both().both()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).both().both().cyclicPath()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).both().both().cyclicPath().path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">3</span>],v[<span class="integer">1</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">2</span>],v[<span class="integer">1</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">1</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           cyclicPath().
           path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">3</span>],v[<span class="integer">1</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           cyclicPath().from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           path()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="dedup-step">Dedup Step</h3>
<div class="paragraph">
<p>With <code>dedup()</code>-step (<strong>filter</strong>), repeatedly seen objects are removed from the traversal stream. Note that if a
traverser&#8217;s bulk is greater than 1, then it is set to 1 before being emitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>)
==&gt;java
==&gt;java
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>).dedup()
==&gt;java
gremlin&gt; g.V(<span class="integer">1</span>).repeat(bothE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).dedup().otherV()).emit().path() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>]]
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">4</span>]]
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">6</span>]]
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">4</span>],e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>],v[<span class="integer">5</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Traverse all <code>created</code> edges, but don&#8217;t touch any edge twice.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a by-step modulation is provided to <code>dedup()</code>, then the object is processed accordingly prior to determining if it
has been seen or not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().valueMap(<span class="predefined-constant">true</span>, <span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">1</span>]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">2</span>]
==&gt;[<span class="key">name</span>:[lop],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">3</span>]
==&gt;[<span class="key">name</span>:[josh],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">4</span>]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">5</span>]
==&gt;[<span class="key">name</span>:[peter],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">6</span>]
gremlin&gt; g.V().dedup().by(label).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;lop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if <code>dedup()</code> is provided an array of strings, then it will ensure that the de-duplication is not with respect
to the current traverser object, but to the path history of the traverser.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">6</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">5</span>],<span class="key">c</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">6</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">6</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">6</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">6</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">6</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).dedup(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">5</span>],<span class="key">c</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">4</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">6</span>],<span class="key">b</span>:v[<span class="integer">3</span>],<span class="key">c</span>:v[<span class="integer">1</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the current <code>a</code> and <code>b</code> combination has been seen previously, then filter the traverser.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="drop-step">Drop Step</h3>
<div class="paragraph">
<p>The <code>drop()</code>-step (<strong>filter</strong>/<strong>sideEffect</strong>) is used to remove element and properties from the graph (i.e. remove). It
is a filter step because the traversal yields no outgoing objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().outE().drop()
gremlin&gt; g.E()
gremlin&gt; g.V().properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).drop()
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">lang</span>:[java]]
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">lang</span>:[java]]
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().drop()
gremlin&gt; g.V()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="explain-step">Explain Step</h3>
<div class="paragraph">
<p>The <code>explain()</code>-step (<strong>terminal</strong>) will return a <code>TraversalExplanation</code>. A traversal explanation details how the
traversal (prior to <code>explain()</code>) will be compiled given the registered <a href="#traversalstrategy">traversal strategies</a>.
A <code>TraversalExplanation</code> has a <code>toString()</code> representation with 3-columns. The first column is the
traversal strategy being applied. The second column is the traversal strategy category: [D]ecoration, [O]ptimization,
[P]rovider optimization, [F]inalization, and [V]erification. Finally, the third column is the state of the traversal
post strategy application. The final traversal is the resultant execution plan.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).outE().identity().inV().count().is(gt(<span class="integer">5</span>)).explain()
==&gt;Traversal Explanation
=====================================================================================================================================================================================================
Original Traversal                 [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]

ConnectiveStrategy           [D]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
RepeatUnrollStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
MatchPredicateStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
PathRetractionStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
RangeByIsCountStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
IncidentToAdjacentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
FilterRankingStrategy        [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
InlineFilterStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
AdjacentToIncidentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
LazyBarrierStrategy          [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
TinkerGraphCountStrategy     [P]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
TinkerGraphStepStrategy      [P]   [TinkerGraphStep(vertex,[~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
ProfileStrategy              [F]   [TinkerGraphStep(vertex,[~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]
StandardVerificationStrategy [V]   [TinkerGraphStep(vertex,[~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]

Final Traversal                    [TinkerGraphStep(vertex,[~label.eq(person)]), VertexStep(OUT,edge), IdentityStep, EdgeVertexStep(IN), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">6</span>), CountGlobalStep, IsStep(gt(<span class="integer">5</span>))]</code></pre>
</div>
</div>
<div class="paragraph">
<p>For traversal profiling information, please see <a href="#profile-step"><code>profile()</code></a>-step.</p>
</div>
</div>
<div class="sect2">
<h3 id="fold-step">Fold Step</h3>
<div class="paragraph">
<p>There are situations when the traversal stream needs a "barrier" to aggregate all the objects and emit a computation
that is a function of the aggregate. The <code>fold()</code>-step (<strong>map</strong>) is one particular instance of this. Please see
<a href="#unfold-step"><code>unfold()</code></a>-step for the inverse functionality.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[vadas,josh]
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold().next().getClass() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="type">class</span> <span class="class">java</span>.util.ArrayList
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold(<span class="integer">0</span>) {a,b -&gt; a + b.length()} <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="integer">9</span>
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).fold(<span class="integer">0</span>) {a,b -&gt; a + b} <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="integer">123</span>
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).fold(<span class="integer">0</span>, sum) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;<span class="integer">123</span>
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).sum() <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;<span class="integer">123</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A parameterless <code>fold()</code> will aggregate all the objects into a list and then emit the list.</p>
</li>
<li>
<p>A verification of the type of list returned.</p>
</li>
<li>
<p><code>fold()</code> can be provided two arguments&#8201;&#8212;&#8201; a seed value and a reduce bi-function ("vadas" is 5 characters + "josh" with 4 characters).</p>
</li>
<li>
<p>What is the total age of the people in the graph?</p>
</li>
<li>
<p>The same as before, but using a built-in bi-function.</p>
</li>
<li>
<p>The same as before, but using the <a href="#sum-step"><code>sum()</code>-step</a>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="graph-step">Graph Step</h3>
<div class="paragraph">
<p>The <code>V()</code>-step is usually used to start a <code>GraphTraversal</code>, but can also be used mid-traversal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>)).as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).addE(<span class="string"><span class="delimiter">'</span><span class="content">uses</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)
==&gt;e[<span class="integer">13</span>][<span class="integer">1</span>-uses-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">14</span>][<span class="integer">1</span>-uses-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">15</span>][<span class="integer">2</span>-uses-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">16</span>][<span class="integer">2</span>-uses-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">17</span>][<span class="integer">4</span>-uses-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">18</span>][<span class="integer">4</span>-uses-&gt;<span class="integer">5</span>]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Whether a mid-traversal <code>V()</code> uses an index or not, depends on a) whether suitable index exists and b) if the particular graph system provider implemented this functionality.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>)).as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).addE(<span class="string"><span class="delimiter">'</span><span class="content">uses</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).toString() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[GraphStep(vertex,<span class="type">[]</span>), HasStep([name.within([marko, vadas, josh])])<span class="error">@</span>[person], GraphStep(vertex,<span class="type">[]</span>), HasStep([name.within([lop, ripple])]), AddEdgeStep({~from=[[SelectOneStep(person)]], label=[uses]})]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>)).as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, within(<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).addE(<span class="string"><span class="delimiter">'</span><span class="content">uses</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).iterate().toString() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[TinkerGraphStep(vertex,[name.within([marko, vadas, josh])])<span class="error">@</span>[person], TinkerGraphStep(vertex,[name.within([lop, ripple])]), AddEdgeStep({~from=[[SelectOneStep(person)]], label=[uses]})]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Normally the <code>V()</code>-step will iterate over all vertices. However, graph strategies can fold <code>HasContainer&#8217;s into a `GraphStep</code> to allow index lookups.</p>
</li>
<li>
<p>Whether the graph system provider supports mid-traversal <code>V()</code> index lookups or not can easily be determined by inspecting the <code>toString()</code> output of the iterated traversal. If <code>has</code> conditions were folded into the <code>V()</code>-step, an index - if one exists - will be used.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="from-step">From Step</h3>
<div class="paragraph">
<p>The <code>from()</code>-step is not an actual step, but instead is a "step-modulator" similar to <a href="#as-step"><code>as()</code></a> and
<a href="#by-step"><code>by()</code></a>. If a step is able to accept traversals or strings then <code>from()</code> is the
means by which they are added. The general pattern is <code>step().from()</code>. See <a href="#to-step"><code>to()</code></a>-step.</p>
</div>
<div class="paragraph">
<p>The list of steps that support <code>from()</code>-modulation are: <a href="#simplepath-step"><code>simplePath()</code></a>, <a href="#cyclicpath-step"><code>cyclicPath()</code></a>,
 <a href="#path-step"><code>path()</code></a>, and <a href="#addedge-step"><code>addE()</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="group-step">Group Step</h3>
<div class="paragraph">
<p>As traversers propagate across a graph as defined by a traversal, sideEffect computations are sometimes required.
That is, the actual path taken or the current location of a traverser is not the ultimate output of the computation,
but some other representation of the traversal. The <code>group()</code>-step (<strong>map</strong>/<strong>sideEffect</strong>) is one such sideEffect that
organizes the objects according to some function of the object. Then, if required, that organization (a list) is
reduced. An example is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().group().by(label) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">software</span>:[v[<span class="integer">3</span>],v[<span class="integer">5</span>]],<span class="key">person</span>:[v[<span class="integer">1</span>],v[<span class="integer">2</span>],v[<span class="integer">4</span>],v[<span class="integer">6</span>]]]
gremlin&gt; g.V().group().by(label).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">software</span>:[lop,ripple],<span class="key">person</span>:[marko,vadas,josh,peter]]
gremlin&gt; g.V().group().by(label).by(count()) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="key">software</span>:<span class="integer">2</span>,<span class="key">person</span>:<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Group the vertices by their label.</p>
</li>
<li>
<p>For each vertex in the group, get their name.</p>
</li>
<li>
<p>For each grouping, what is its size?</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The two projection parameters available to <code>group()</code> via <code>by()</code> are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Key-projection: What feature of the object to group on (a function that yields the map key)?</p>
</li>
<li>
<p>Value-projection: What feature of the group to store in the key-list?</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="groupcount-step">GroupCount Step</h3>
<div class="paragraph">
<p>When it is important to know how many times a particular object has been at a particular part of a traversal,
<code>groupCount()</code>-step (<strong>map</strong>/<strong>sideEffect</strong>) is used.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"What is the distribution of ages in the graph?"</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount()
==&gt;[<span class="integer">32</span>:<span class="integer">1</span>,<span class="integer">35</span>:<span class="integer">1</span>,<span class="integer">27</span>:<span class="integer">1</span>,<span class="integer">29</span>:<span class="integer">1</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="integer">32</span>:<span class="integer">1</span>,<span class="integer">35</span>:<span class="integer">1</span>,<span class="integer">27</span>:<span class="integer">1</span>,<span class="integer">29</span>:<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can also supply a pre-group projection, where the provided <a href="#by-step"><code>by()</code></a>-modulation determines what to
group the incoming object by.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is one person that is 32, one person that is 35, one person that is 27, and one person that is 29.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Iteratively walk the graph and count the number of times you see the second letter of each name."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/groupcount-step.png" alt="groupcount step" width="420">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().repeat(both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).by(label)).times(<span class="integer">10</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">software</span>:<span class="integer">19598</span>,<span class="key">person</span>:<span class="integer">39196</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above is interesting in that it demonstrates the use of referencing the internal <code>Map&lt;Object,Long&gt;</code> of
<code>groupCount()</code> with a string variable. Given that <code>groupCount()</code> is a sideEffect-step, it simply passes the object
it received to its output. Internal to <code>groupCount()</code>, the object&#8217;s count is incremented.</p>
</div>
</div>
<div class="sect2">
<h3 id="has-step">Has Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/has-step.png" alt="has step" width="670">
</div>
</div>
<div class="paragraph">
<p>It is possible to filter vertices, edges, and vertex properties based on their properties using <code>has()</code>-step
(<strong>filter</strong>). There are numerous variations on <code>has()</code> including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>has(key,value)</code>: Remove the traverser if its element does not have the provided key/value property.</p>
</li>
<li>
<p><code>has(label, key, value)</code>: Remove the traverser if its element does not have the specified label and provided key/value property.</p>
</li>
<li>
<p><code>has(key,predicate)</code>: Remove the traverser if its element does not have a key value that satisfies the bi-predicate. For more information on predicates, please read <a href="#a-note-on-predicates">A Note on Predicates</a>.</p>
</li>
<li>
<p><code>hasLabel(labels&#8230;&#8203;)</code>: Remove the traverser if its element does not have any of the labels.</p>
</li>
<li>
<p><code>hasId(ids&#8230;&#8203;)</code>: Remove the traverser if its element does not have any of the ids.</p>
</li>
<li>
<p><code>hasKey(keys&#8230;&#8203;)</code>: Remove the traverser if the property does not have all of the provided keys.</p>
</li>
<li>
<p><code>hasValue(values&#8230;&#8203;)</code>: Remove the traverser if its property does not have all of the provided values.</p>
</li>
<li>
<p><code>has(key)</code>: Remove the traverser if its element does not have a value for the key.</p>
</li>
<li>
<p><code>hasNot(key)</code>: Remove the traverser if its element has a value for the key.</p>
</li>
<li>
<p><code>has(key, traversal)</code>: Remove the traverser if its object does not yield a result through the traversal off the property value.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).out().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,within(<span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>))
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).out().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,within(<span class="string"><span class="delimiter">'</span><span class="content">vadas</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>)).
               outE().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,inside(<span class="integer">20</span>,<span class="integer">30</span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,outside(<span class="integer">20</span>,<span class="integer">30</span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="integer">32</span>
==&gt;<span class="integer">35</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,within(<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)).valueMap() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,without(<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)).valueMap() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,not(within(<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>))).valueMap() <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().properties().hasKey(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).value() <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span>
==&gt;<span class="integer">32</span>
==&gt;<span class="integer">35</span>
gremlin&gt; g.V().hasNot(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;lop
==&gt;ripple</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Find all vertices whose ages are between 20 (inclusive) and 30 (exclusive).</p>
</li>
<li>
<p>Find all vertices whose ages are not between 20 (inclusive) and 30 (exclusive).</p>
</li>
<li>
<p>Find all vertices whose names are exact matches to any names in the collection <code>[josh,marko]</code>, display all
the key,value pairs for those verticies.</p>
</li>
<li>
<p>Find all vertices whose names are not in the collection <code>[josh,marko]</code>, display all the key,value pairs for those vertices.</p>
</li>
<li>
<p>Same as the prior example save using <code>not</code> on <code>within</code> to yield <code>without</code>.</p>
</li>
<li>
<p>Find all age-properties and emit their value.</p>
</li>
<li>
<p>Find all vertices that do not have an age-property and emit their name.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>TinkerPop does not support a regular expression predicate, although specific graph databases that leverage TinkerPop
may provide a partial match extension.</p>
</div>
</div>
<div class="sect2">
<h3 id="id-step">Id Step</h3>
<div class="paragraph">
<p>The <code>id()</code>-step (<strong>map</strong>) takes an <code>Element</code> and extracts its identifier from it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().id()
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">5</span>
==&gt;<span class="integer">6</span>
gremlin&gt; g.V(<span class="integer">1</span>).out().id().is(<span class="integer">2</span>)
==&gt;<span class="integer">2</span>
gremlin&gt; g.V(<span class="integer">1</span>).outE().id()
==&gt;<span class="integer">9</span>
==&gt;<span class="integer">7</span>
==&gt;<span class="integer">8</span>
gremlin&gt; g.V(<span class="integer">1</span>).properties().id()
==&gt;<span class="integer">0</span>
==&gt;<span class="integer">1</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inject-step">Inject Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/inject-step.png" alt="inject step" width="800">
</div>
</div>
<div class="paragraph">
<p>One of the major features of TinkerPop3 is "injectable steps." This makes it possible to insert objects arbitrarily
into a traversal stream. In general, <code>inject()</code>-step (<strong>sideEffect</strong>) exists and a few examples are provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>)
==&gt;daniel
==&gt;ripple
==&gt;lop
gremlin&gt; g.V(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>).map {<span class="local-variable">it</span>.get().length()}
==&gt;<span class="integer">6</span>
==&gt;<span class="integer">6</span>
==&gt;<span class="integer">3</span>
gremlin&gt; g.V(<span class="integer">4</span>).out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).inject(<span class="string"><span class="delimiter">'</span><span class="content">daniel</span><span class="delimiter">'</span></span>).map {<span class="local-variable">it</span>.get().length()}.path()
==&gt;[daniel,<span class="integer">6</span>]
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">5</span>],ripple,<span class="integer">6</span>]
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">3</span>],lop,<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the last example above, note that the path starting with <code>daniel</code> is only of length 2. This is because the
<code>daniel</code> string was inserted half-way in the traversal. Finally, a typical use case is provided below&#8201;&#8212;&#8201;when the
start of the traversal is not a graph object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; inject(<span class="integer">1</span>,<span class="integer">2</span>)
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
gremlin&gt; inject(<span class="integer">1</span>,<span class="integer">2</span>).map {<span class="local-variable">it</span>.get() + <span class="integer">1</span>}
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
gremlin&gt; inject(<span class="integer">1</span>,<span class="integer">2</span>).map {<span class="local-variable">it</span>.get() + <span class="integer">1</span>}.map {g.V(<span class="local-variable">it</span>.get()).next()}.values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;lop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="is-step">Is Step</h3>
<div class="paragraph">
<p>It is possible to filter scalar values using <code>is()</code>-step (<strong>filter</strong>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).is(<span class="integer">32</span>)
==&gt;<span class="integer">32</span>
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).is(lte(<span class="integer">30</span>))
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span>
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).is(inside(<span class="integer">30</span>, <span class="integer">40</span>))
==&gt;<span class="integer">32</span>
==&gt;<span class="integer">35</span>
gremlin&gt; g.V().where(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(<span class="integer">1</span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;ripple
gremlin&gt; g.V().where(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(gte(<span class="integer">2</span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;lop
gremlin&gt; g.V().where(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).
                                    mean().is(inside(<span class="float">30d</span>, <span class="float">35d</span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;lop
==&gt;ripple</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Find projects having exactly one contributor.</p>
</li>
<li>
<p>Find projects having two or more contributors.</p>
</li>
<li>
<p>Find projects whose contributors average age is between 30 and 35.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="label-step">Label Step</h3>
<div class="paragraph">
<p>The <code>label()</code>-step (<strong>map</strong>) takes an <code>Element</code> and extracts its label from it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().label()
==&gt;person
==&gt;person
==&gt;software
==&gt;person
==&gt;software
==&gt;person
gremlin&gt; g.V(<span class="integer">1</span>).outE().label()
==&gt;created
==&gt;knows
==&gt;knows
gremlin&gt; g.V(<span class="integer">1</span>).properties().label()
==&gt;name
==&gt;age</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="key-step">Key Step</h3>
<div class="paragraph">
<p>The <code>key()</code>-step (<strong>map</strong>) takes a <code>Property</code> and extracts the key from it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).properties().key()
==&gt;name
==&gt;location
==&gt;location
==&gt;location
==&gt;location
gremlin&gt; g.V(<span class="integer">1</span>).properties().properties().key()
==&gt;startTime
==&gt;endTime
==&gt;startTime
==&gt;endTime
==&gt;startTime
==&gt;endTime
==&gt;startTime</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="limit-step">Limit Step</h3>
<div class="paragraph">
<p>The <code>limit()</code>-step is analogous to <a href="#range-step"><code>range()</code>-step</a> save that the lower end range is set to 0.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().limit(<span class="integer">2</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.V().range(<span class="integer">0</span>, <span class="integer">2</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.V().limit(<span class="integer">2</span>).toString()
==&gt;[GraphStep(vertex,<span class="type">[]</span>), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>)]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>limit()</code>-step can also be applied with <code>Scope.local</code>, in which case it operates on the incoming collection.
The examples below use the <a href="#the-crew-toy-graph">The Crew</a> toy data set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().valueMap().select(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).limit(local,<span class="integer">2</span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[san diego,santa cruz]
==&gt;[centreville,dulles]
==&gt;[bremen,baltimore]
==&gt;[spremberg,kaiserslautern]
gremlin&gt; g.V().valueMap().limit(local, <span class="integer">1</span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">name</span>:[marko]]
==&gt;[<span class="key">name</span>:[stephen]]
==&gt;[<span class="key">name</span>:[matthias]]
==&gt;[<span class="key">name</span>:[daniel]]
==&gt;[<span class="key">name</span>:[gremlin]]
==&gt;[<span class="key">name</span>:[tinkergraph]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>List&lt;String&gt;</code> for each vertex containing the first two locations.</p>
</li>
<li>
<p><code>Map&lt;String, Object&gt;</code> for each vertex, but containing only the first property value.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="local-step">Local Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/local-step.png" alt="local step" width="450">
</div>
</div>
<div class="paragraph">
<p>A <code>GraphTraversal</code> operates on a continuous stream of objects. In many situations, it is important to operate on a
single element within that stream. To do such object-local traversal computations, <code>local()</code>-step exists (<strong>branch</strong>).
Note that the examples below use the <a href="#the-crew-toy-graph">The Crew</a> toy data set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).order().by(<span class="string"><span class="delimiter">'</span><span class="content">startTime</span><span class="delimiter">'</span></span>,incr).limit(<span class="integer">2</span>).value().as(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">person</span>:daniel,<span class="key">location</span>:spremberg]
==&gt;[<span class="key">person</span>:stephen,<span class="key">location</span>:centreville]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
               local(properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).order().by(<span class="string"><span class="delimiter">'</span><span class="content">startTime</span><span class="delimiter">'</span></span>,incr).limit(<span class="integer">2</span>)).value().as(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">person</span>:marko,<span class="key">location</span>:san diego]
==&gt;[<span class="key">person</span>:marko,<span class="key">location</span>:santa cruz]
==&gt;[<span class="key">person</span>:stephen,<span class="key">location</span>:centreville]
==&gt;[<span class="key">person</span>:stephen,<span class="key">location</span>:dulles]
==&gt;[<span class="key">person</span>:matthias,<span class="key">location</span>:bremen]
==&gt;[<span class="key">person</span>:matthias,<span class="key">location</span>:baltimore]
==&gt;[<span class="key">person</span>:daniel,<span class="key">location</span>:spremberg]
==&gt;[<span class="key">person</span>:daniel,<span class="key">location</span>:kaiserslautern]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get the first two people and their respective location according to the most historic location start time.</p>
</li>
<li>
<p>For every person, get their two most historic locations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The two traversals above look nearly identical save the inclusion of <code>local()</code> which wraps a section of the traversal
in a object-local traversal. As such, the <code>order().by()</code> and the <code>limit()</code> refer to a particular object, not to the
stream as a whole.</p>
</div>
<div class="paragraph">
<p>Local Step is quite similar in functionality to <a href="#general-steps">Flat Map Step</a> where it can often be confused.
<code>local()</code> propagates the traverser through the internal traversal as is without splitting/cloning it. Thus, its
a global traversal with local processing. Its use is subtle and primarily finds application in compilation
optimizations (i.e. when writing <code>TraversalStrategy</code> implementations. As another example consider:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().both().barrier().flatMap(groupCount().by(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
==&gt;[<span class="key">lop</span>:<span class="integer">1</span>]
==&gt;[<span class="key">lop</span>:<span class="integer">1</span>]
==&gt;[<span class="key">lop</span>:<span class="integer">1</span>]
==&gt;[<span class="key">vadas</span>:<span class="integer">1</span>]
==&gt;[<span class="key">josh</span>:<span class="integer">1</span>]
==&gt;[<span class="key">josh</span>:<span class="integer">1</span>]
==&gt;[<span class="key">josh</span>:<span class="integer">1</span>]
==&gt;[<span class="key">marko</span>:<span class="integer">1</span>]
==&gt;[<span class="key">marko</span>:<span class="integer">1</span>]
==&gt;[<span class="key">marko</span>:<span class="integer">1</span>]
==&gt;[<span class="key">peter</span>:<span class="integer">1</span>]
==&gt;[<span class="key">ripple</span>:<span class="integer">1</span>]
gremlin&gt; g.V().both().barrier().local(groupCount().by(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>))
==&gt;[<span class="key">lop</span>:<span class="integer">3</span>]
==&gt;[<span class="key">vadas</span>:<span class="integer">1</span>]
==&gt;[<span class="key">josh</span>:<span class="integer">3</span>]
==&gt;[<span class="key">marko</span>:<span class="integer">3</span>]
==&gt;[<span class="key">peter</span>:<span class="integer">1</span>]
==&gt;[<span class="key">ripple</span>:<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The anonymous traversal of <code>local()</code> processes the current object "locally." In OLAP, where the atomic unit
of computing is the vertex and its local "star graph," it is important that the anonymous traversal does not leave
the confines of the vertex&#8217;s star graph. In other words, it can not traverse to an adjacent vertex&#8217;s properties or edges.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="loops-step">Loops Step</h3>
<div class="paragraph">
<p>The <code>loops()</code>-step (<strong>map</strong>) extracts the number of times the <code>Traverser</code> has gone through the current loop.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().emit(__.has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).or().loops().is(<span class="integer">2</span>)).repeat(__.out()).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)
==&gt;marko
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="match-step">Match Step</h3>
<div class="paragraph">
<p>The <code>match()</code>-step (<strong>map</strong>) provides a more <a href="http://en.wikipedia.org/wiki/Declarative_programming">declarative</a>
form of graph querying based on the notion of <a href="http://en.wikipedia.org/wiki/Pattern_matching">pattern matching</a>.
With <code>match()</code>, the user provides a collection of "traversal fragments," called patterns, that have variables defined
that must hold true throughout the duration of the <code>match()</code>. When a traverser is in <code>match()</code>, a registered
<code>MatchAlgorithm</code> analyzes the current state of the traverser (i.e. its history based on its
<a href="#path-data-structure">path data</a>), the runtime statistics of the traversal patterns, and returns a traversal-pattern
that the traverser should try next. The default <code>MatchAlgorithm</code> provided is called <code>CountMatchAlgorithm</code> and it
dynamically revises the pattern execution plan by sorting the patterns according to their filtering capabilities
(i.e. largest set reduction patterns execute first). For very large graphs, where the developer is uncertain of the
statistics of the graph (e.g. how many <code>knows</code>-edges vs. <code>worksFor</code>-edges exist in the graph), it is advantageous to
use <code>match()</code>, as an optimal plan will be determined automatically. Furthermore, some queries are much easier to
express via <code>match()</code> than with single-path traversals.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>"Who created a project named 'lop' that was also created by someone who is 29 years old? Return the two creators."</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/match-step.png" alt="match step" width="500">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter,<span class="key">c</span>:marko]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the above can also be more concisely written as below which demonstrates that standard inner-traversals can
be arbitrarily defined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter,<span class="key">c</span>:marko]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to improve readability, <code>as()</code>-steps can be given meaningful labels which better reflect your domain. The
previous query can thus be written in a more expressive way as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">creators</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">projects</span><span class="delimiter">'</span></span>), <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">projects</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">cocreators</span><span class="delimiter">'</span></span>)). <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
               select(<span class="string"><span class="delimiter">'</span><span class="content">creators</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">cocreators</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="key">creators</span>:marko,<span class="key">cocreators</span>:marko]
==&gt;[<span class="key">creators</span>:josh,<span class="key">cocreators</span>:marko]
==&gt;[<span class="key">creators</span>:peter,<span class="key">cocreators</span>:marko]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Find vertices that created something and match them as 'creators', then find out what they created which is
named 'lop' and match these vertices as 'projects'.</p>
</li>
<li>
<p>Using these 'projects' vertices, find out their creators aged 29 and remember these as 'cocreators'.</p>
</li>
<li>
<p>Return the name of both 'creators' and 'cocreators'.</p>
</li>
</ol>
</div>
<div id="grateful-dead" class="imageblock">
<div class="content">
<img src="../images/grateful-dead-schema.png" alt="grateful dead schema" width="475">
</div>
<div class="title">Figure 4. Grateful Dead</div>
</div>
<div class="paragraph">
<p><code>MatchStep</code> brings functionality similar to <a href="http://en.wikipedia.org/wiki/SPARQL">SPARQL</a> to Gremlin. Like SPARQL,
MatchStep conjoins a set of patterns applied to a graph.  For example, the following traversal finds exactly those
songs which Jerry Garcia has both sung and written (using the Grateful Dead graph distributed in the <code>data/</code> directory):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">808</span> <span class="key">edges</span>:<span class="integer">8049</span>], standard]
gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">writtenBy</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">sungBy</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;CREAM PUFF WAR
==&gt;CRYPTICAL ENVELOPMENT</code></pre>
</div>
</div>
<div class="paragraph">
<p>Among the features which differentiate <code>match()</code> from SPARQL are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>), <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="integer">29</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).repeat(out()).times(<span class="integer">2</span>)). <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
               select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).dedup().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><strong>Patterns of arbitrary complexity</strong>: <code>match()</code> is not restricted to triple patterns or property paths.</p>
</li>
<li>
<p><strong>Recursion support</strong>: <code>match()</code> supports the branch-based steps within a pattern, including <code>repeat()</code>.</p>
</li>
<li>
<p><strong>Imperative/declarative hybrid</strong>: Before and after a <code>match()</code>, it is possible to leverage classic Gremlin traversals.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To extend point #3, it is possible to support going from imperative, to declarative, to imperative, ad infinitum.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
                 match(
                   __.as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>),
                   __.as(<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">z</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">z</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>match()</code>-step is stateless. The variable bindings of the traversal patterns are stored in the path
history of the traverser. As such, the variables used over all <code>match()</code>-steps within a traversal are globally unique.
A benefit of this is that subsequent <code>where()</code>, <code>select()</code>, <code>match()</code>, etc. steps can leverage the same variables in
their analysis.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Like all other steps in Gremlin, <code>match()</code> is a function and thus, <code>match()</code> within <code>match()</code> is a natural consequence
of Gremlin&#8217;s functional foundation (i.e. recursive matching).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lop</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).match(
                              __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
                              __.as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).
                            select(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:ripple]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a step-labeled traversal proceeds the <code>match()</code>-step and the traverser entering the <code>match()</code> is destined to bind
to a particular variable, then the previous step should be labeled accordingly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           match(
             __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>),
             __.not(__.as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>))).
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh,<span class="key">c</span>:ripple]</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are three types of <code>match()</code> traversal patterns.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>as('a')&#8230;&#8203;as('b')</code>: both the start and end of the traversal have a declared variable.</p>
</li>
<li>
<p><code>as('a')&#8230;&#8203;</code>: only the start of the traversal has a declared variable.</p>
</li>
<li>
<p><code>&#8230;&#8203;</code>: there are no declared variables.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If a variable is at the start of a traversal pattern it <strong>must</strong> exist as a label in the path history of the traverser
else the traverser can not go down that path. If a variable is at the end of a traversal pattern then if the variable
exists in the path history of the traverser, the traverser&#8217;s current location <strong>must</strong> match (i.e. equal) its historic
location at that same label. However, if the variable does not exist in the path history of the traverser, then the
current location is labeled as the variable and thus, becomes a bound variable for subsequent traversal patterns. If a
traversal pattern does not have an end label, then the traverser must simply "survive" the pattern (i.e. not be
filtered) to continue to the next pattern. If a traversal pattern does not have a start label, then the traverser
can go down that path at any point, but will only go down that pattern once as a traversal pattern is executed once
and only once for the history of the traverser. Typically, traversal patterns that do not have a start and end label
are used in conjunction with <code>and()</code>, <code>or()</code>, and <code>where()</code>. Once the traverser has "survived" all the patterns (or at
least one for <code>or()</code>), <code>match()</code>-step analyzes the traverser&#8217;s path history and emits a <code>Map&lt;String,Object&gt;</code> of the
variable bindings to the next step in the traversal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
             match( <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
               __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().count().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>), <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
               __.not(__.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).in().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)), <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
               or( <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in().count().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).and().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).is(gt(<span class="integer">2</span>)))). <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
             dedup(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
             select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by() <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:lop,<span class="key">c</span>:<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A standard, step-labeled traversal can come prior to <code>match()</code>.</p>
</li>
<li>
<p>If the traverser&#8217;s path prior to entering <code>match()</code> has requisite label values, then those historic values are bound.</p>
</li>
<li>
<p>It is possible to use <a href="#a-note-on-barrier-steps">barrier steps</a> though they are computed locally to the pattern (as one would expect).</p>
</li>
<li>
<p>It is possible to <code>not()</code> a pattern.</p>
</li>
<li>
<p>It is possible to nest <code>and()</code>- and <code>or()</code>-steps for conjunction matching.</p>
</li>
<li>
<p>Both infix and prefix conjunction notation is supported.</p>
</li>
<li>
<p>It is possible to "distinct" the specified label combination.</p>
</li>
<li>
<p>The bound values are of different types&#8201;&#8212;&#8201;vertex ("a"), vertex ("b"), long ("c").</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="using-where-with-match">Using Where with Match</h4>
<div class="paragraph">
<p>Match is typically used in conjunction with both <code>select()</code> (demonstrated previously) and <code>where()</code> (presented here).
A <code>where()</code>-step allows the user to further constrain the result set provided by <code>match()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().match(
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
                 where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>, neq(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:josh]
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:peter]
==&gt;[<span class="key">a</span>:josh,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:josh,<span class="key">c</span>:peter]
==&gt;[<span class="key">a</span>:peter,<span class="key">c</span>:marko]
==&gt;[<span class="key">a</span>:peter,<span class="key">c</span>:josh]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>where()</code>-step can take either a <code>P</code>-predicate (example above) or a <code>Traversal</code> (example below). Using
<code>MatchPredicateStrategy</code>, <code>where()</code>-clauses are automatically folded into <code>match()</code> and thus, subject to the query
optimizer within <code>match()</code>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; traversal = g.V().match(
                             __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>), <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
                             __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),
                             __.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).
                             where(__.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)). <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
                           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>); <span class="predefined-constant">null</span> <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
gremlin&gt; traversal.toString() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;[GraphStep(vertex,<span class="type">[]</span>), MatchStep(AND,[[MatchStartStep(a), HasStep([~label.eq(person)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,[created],vertex), MatchEndStep(b)], [MatchStartStep(b), VertexStep(IN,[created],vertex), MatchEndStep(c)]]), WhereTraversalStep([WhereStartStep(a), VertexStep(OUT,[knows],vertex), WhereEndStep(c)]), SelectStep([a, c],[value(name)])]
gremlin&gt; traversal <span class="comment">// </span><b class="conum">(5)</b> <b class="conum">(6)</b>
==&gt;[<span class="key">a</span>:marko,<span class="key">c</span>:josh]
gremlin&gt; traversal.toString() <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;[TinkerGraphStep(vertex,[~label.eq(person)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), VertexStep(OUT,[created],vertex), MatchEndStep(b)], [MatchStartStep(b), VertexStep(IN,[created],vertex), MatchEndStep(c)], [MatchStartStep(a), WhereTraversalStep([WhereStartStep, VertexStep(OUT,[knows],vertex), WhereEndStep(c)]), MatchEndStep]]), SelectStep([a, c],[value(name)])]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Any <code>has()</code>-step traversal patterns that start with the match-key are pulled out of <code>match()</code> to enable the graph
system to leverage the filter for index lookups.</p>
</li>
<li>
<p>A <code>where()</code>-step with a traversal containing variable bindings declared in <code>match()</code>.</p>
</li>
<li>
<p>A useful trick to ensure that the traversal is not iterated by Gremlin Console.</p>
</li>
<li>
<p>The string representation of the traversal prior to its strategies being applied.</p>
</li>
<li>
<p>The Gremlin Console will automatically iterate anything that is an iterator or is iterable.</p>
</li>
<li>
<p>Both marko and josh are co-developers and marko knows josh.</p>
</li>
<li>
<p>The string representation of the traversal after the strategies have been applied (and thus, <code>where()</code> is folded into <code>match()</code>)</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
A <code>where()</code>-step is a filter and thus, variables within a <code>where()</code> clause are not globally bound to the
path of the traverser in <code>match()</code>. As such, <code>where()</code>-steps in <code>match()</code> are used for filtering, not binding.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="max-step">Max Step</h3>
<div class="paragraph">
<p>The <code>max()</code>-step (<strong>map</strong>) operates on a stream of numbers and determines which is the largest number in the stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).max()
==&gt;<span class="integer">35</span>
gremlin&gt; g.V().repeat(both()).times(<span class="integer">3</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).max()
==&gt;<span class="integer">35</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>max(local)</code> determines the max of the current, local object (not the objects in the traversal stream).
This works for <code>Collection</code> and <code>Number</code>-type objects. For any other object, a max of <code>Double.NaN</code> is returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="mean-step">Mean Step</h3>
<div class="paragraph">
<p>The <code>mean()</code>-step (<strong>map</strong>) operates on a stream of numbers and determines the average of those numbers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).mean()
==&gt;<span class="float">30.75</span>
gremlin&gt; g.V().repeat(both()).times(<span class="integer">3</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).mean() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="float">30.645833333333332</span>
gremlin&gt; g.V().repeat(both()).times(<span class="integer">3</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).dedup().mean()
==&gt;<span class="float">30.75</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Realize that traversers are being bulked by <code>repeat()</code>. There may be more of a particular number than another,
thus altering the average.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>mean(local)</code> determines the mean of the current, local object (not the objects in the traversal stream).
This works for <code>Collection</code> and <code>Number</code>-type objects. For any other object, a mean of <code>Double.NaN</code> is returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="min-step">Min Step</h3>
<div class="paragraph">
<p>The <code>min()</code>-step (<strong>map</strong>) operates on a stream of numbers and determines which is the smallest number in the stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).min()
==&gt;<span class="integer">27</span>
gremlin&gt; g.V().repeat(both()).times(<span class="integer">3</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).min()
==&gt;<span class="integer">27</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>min(local)</code> determines the min of the current, local object (not the objects in the traversal stream).
This works for <code>Collection</code> and <code>Number</code>-type objects. For any other object, a min of <code>Double.NaN</code> is returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="not-step">Not Step</h3>
<div class="paragraph">
<p>The <code>not()</code>-step (<strong>filter</strong>) removes objects from the traversal stream when the traversal provided as an argument does
not return any objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().not(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)).valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">name</span>:[lop],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">3</span>,<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">5</span>,<span class="key">lang</span>:[java]]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           not(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(gt(<span class="integer">1</span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;marko
==&gt;vadas
==&gt;peter</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>josh created two projects and vadas none</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="option-step">Option Step</h3>
<div class="paragraph">
<p>An option to a <a href="#branch-step"><code>branch()</code></a> or <a href="#choose-step"><code>choose()</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="optional-step">Optional Step</h3>
<div class="paragraph">
<p>The <code>optional()</code>-step (<strong>map</strong>) returns the result of the specified traversal if it yields a result else it returns the calling
element, i.e. the <code>identity()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">2</span>).optional(out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.V(<span class="integer">2</span>).optional(__.in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>vadas does not have an <code>out</code> "know" edge so vadas is returned.</p>
</li>
<li>
<p>vadas does have an <code>in</code> "knows" edge so marko is returned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><code>optional</code> is particularly useful for lifting entire graphs when used in conjunction with <code>path</code> or <code>tree</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).optional(out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).optional(out(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>))).path() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">2</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">3</span>]]
==&gt;[v[<span class="integer">2</span>]]
==&gt;[v[<span class="integer">4</span>]]
==&gt;[v[<span class="integer">6</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Returns the paths of everybody followed by who they know followed by what they created.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="or-step">Or Step</h3>
<div class="paragraph">
<p>The <code>or()</code>-step ensures that at least one of the provided traversals yield a result (<strong>filter</strong>). Please see
<a href="#and-step"><code>and()</code></a> for and-semantics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().or(
            __.outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>),
            __.inE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(gt(<span class="integer">1</span>))).
              values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;lop
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>or()</code>-step can take an arbitrary number of traversals. At least one of the traversals must produce at least one
output for the original traverser to pass to the next step.</p>
</div>
<div class="paragraph">
<p>An <a href="http://en.wikipedia.org/wiki/Infix_notation">infix notation</a> can be used as well. Though, with infix notation,
only two traversals can be or&#8217;d together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().where(outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).or().outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="order-step">Order Step</h3>
<div class="paragraph">
<p>When the objects of the traversal stream need to be sorted, <code>order()</code>-step (<strong>map</strong>) can be leveraged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order()
==&gt;josh
==&gt;lop
==&gt;marko
==&gt;peter
==&gt;ripple
==&gt;vadas
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order().by(decr)
==&gt;vadas
==&gt;ripple
==&gt;peter
==&gt;marko
==&gt;lop
==&gt;josh
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).order().by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, incr).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;marko
==&gt;josh
==&gt;peter</code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the most traversed objects in a traversal is an <code>Element</code>. An element can have properties associated with it
(i.e. key/value pairs). In many situations, it is desirable to sort an element traversal stream according to a
comparison of their properties.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V().order().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,incr).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;josh
==&gt;lop
==&gt;marko
==&gt;peter
==&gt;ripple
==&gt;vadas
gremlin&gt; g.V().order().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,decr).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;ripple
==&gt;peter
==&gt;marko
==&gt;lop
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>order()</code>-step allows the user to provide an arbitrary number of comparators for primary, secondary, etc. sorting.
In the example below, the primary ordering is based on the outgoing created-edge count. The secondary ordering is
based on the age of the person.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).order().by(outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count(), incr).
                                          by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, incr).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;marko
==&gt;peter
==&gt;josh
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).order().by(outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count(), incr).
                                          by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, decr).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;peter
==&gt;marko
==&gt;josh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Randomizing the order of the traversers at a particular point in the traversal is possible with <code>Order.shuffle</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).order().by(shuffle)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).order().by(shuffle)
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to use <code>order(local)</code> to order the current local object and not the entire traversal stream. This works for
<code>Collection</code>- and <code>Map</code>-type objects. For any other object, the object is returned unchanged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).fold().order(local).by(decr) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="integer">35</span>,<span class="integer">32</span>,<span class="integer">29</span>,<span class="integer">27</span>]
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).order(local).by(decr) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="integer">29</span>
==&gt;<span class="integer">27</span>
==&gt;<span class="integer">32</span>
==&gt;<span class="integer">35</span>
gremlin&gt; g.V().groupCount().by(inE().count()).order(local).by(values, decr) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="integer">1</span>:<span class="integer">3</span>,<span class="integer">0</span>:<span class="integer">2</span>,<span class="integer">3</span>:<span class="integer">1</span>]
gremlin&gt; g.V().groupCount().by(inE().count()).order(local).by(keys, incr) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;[<span class="integer">0</span>:<span class="integer">2</span>,<span class="integer">1</span>:<span class="integer">3</span>,<span class="integer">3</span>:<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The ages are gathered into a list and then that list is sorted in decreasing order.</p>
</li>
<li>
<p>The ages are not gathered and thus <code>order(local)</code> is "ordering" single integers and thus, does nothing.</p>
</li>
<li>
<p>The <code>groupCount()</code> map is ordered by its values in decreasing order.</p>
</li>
<li>
<p>The <code>groupCount()</code> map is ordered by its keys in increasing order.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>values</code> and <code>keys</code> enums are from <code>Column</code> which is used to select "columns" from a <code>Map</code>, <code>Map.Entry</code>, or <code>Path</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="pagerank-step">PageRank Step</h3>
<div class="paragraph">
<p>The <code>pageRank()</code>-step (<strong>map</strong>/<strong>sideEffect</strong>) calculates <a href="http://en.wikipedia.org/wiki/PageRank">PageRank</a> using <a href="#pagerankvertexprogram"><code>PageRankVertexProgram</code></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>pageRank()</code>-step is a <code>VertexComputing</code>-step and as such, can only be used against a graph that supports <code>GraphComputer</code> (OLAP).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().pageRank().by(<span class="string"><span class="delimiter">'</span><span class="content">pageRank</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">pageRank</span><span class="delimiter">'</span></span>)
==&gt;<span class="float">0.19250000000000003</span>
==&gt;<span class="float">0.19250000000000003</span>
==&gt;<span class="float">0.23181250000000003</span>
==&gt;<span class="float">0.15000000000000002</span>
==&gt;<span class="float">0.15000000000000002</span>
==&gt;<span class="float">0.4018125</span>
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           pageRank().
             by(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).
             by(<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>).
           order().by(<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>,decr).valueMap(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">friendRank</span>:[<span class="float">0.21375000000000002</span>],<span class="key">name</span>:[vadas]]
==&gt;[<span class="key">friendRank</span>:[<span class="float">0.21375000000000002</span>],<span class="key">name</span>:[josh]]
==&gt;[<span class="key">friendRank</span>:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[marko]]
==&gt;[<span class="key">friendRank</span>:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[peter]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <a href="#explain-step"><code>explain()</code></a>-step can be used to understand how the traversal is compiled into multiple <code>GraphComputer</code> jobs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           pageRank().
             by(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).
             by(<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>).
           order().by(<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>,decr).valueMap(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">friendRank</span><span class="delimiter">'</span></span>).explain()
==&gt;Traversal Explanation
=============================================================================================================================================================================================================================================
Original Traversal                    [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), OrderGlobalStep([[value(friendRank), decr]]), PropertyM
                                         apStep([name, friendRank],value)]

ConnectiveStrategy              [D]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), OrderGlobalStep([[value(friendRank), decr]]), PropertyM
                                         apStep([name, friendRank],value)]
VertexProgramStrategy           [D]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
RepeatUnrollStrategy            [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
MatchPredicateStrategy          [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
PathProcessorStrategy           [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
PathRetractionStrategy          [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
RangeByIsCountStrategy          [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
IncidentToAdjacentStrategy      [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
FilterRankingStrategy           [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
InlineFilterStrategy            [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
AdjacentToIncidentStrategy      [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
LazyBarrierStrategy             [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
MessagePassingReductionStrategy [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
OrderLimitStrategy              [O]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
TinkerGraphCountStrategy        [P]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
TinkerGraphStepStrategy         [P]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
ProfileStrategy                 [F]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
ComputerVerificationStrategy    [V]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
StandardVerificationStrategy    [V]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]
ComputerFinalizationStrategy    [T]   [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]

Final Traversal                       [TraversalVertexProgramStep([GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)])],graphfilter[none]), PageRankVertexProgramStep([VertexStep(OUT,[knows],edge)],friendRank,<span class="integer">30</span>,graphfilter[none]), Travers
                                         alVertexProgramStep([OrderGlobalStep([[value(friendRank), decr]]), PropertyMapStep([name, friendRank],value)],graphfilter[none]), ComputerResultStep]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="path-step">Path Step</h3>
<div class="paragraph">
<p>A traverser is transformed as it moves through a series of steps within a traversal. The history of the traverser is
realized by examining its path with <code>path()</code>-step (<strong>map</strong>).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/path-step.png" alt="path step" width="650">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>],ripple]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">3</span>],lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If edges are required in the path, then be sure to traverser those edges explicitly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().outE().inV().outE().inV().path()
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>],v[<span class="integer">4</span>],e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>],v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>],v[<span class="integer">4</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is possible to post-process the elements of the path in a round-robin fashion via <code>by()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out().out().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;[marko,<span class="integer">32</span>,ripple]
==&gt;[marko,<span class="integer">32</span>,lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, because <code>by()</code>-based post-processing, nothing prevents triggering yet another traversal. In the traversal
below, for each element of the path traversed thus far, if its a person (as determined by having an <code>age</code>-property),
then get all of their creations, else if its a creation, get all the people that created it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out().out().path().by(
                            choose(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>),
                                          out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>),
                                          __.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)).fold())
==&gt;[[lop],[ripple,lop],[josh]]
==&gt;[[lop],[ripple,lop],[marko,josh,peter]]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Generating path information is expensive as the history of the traverser is stored into a Java list. With
numerous traversers, there are numerous lists. Moreover, in an OLAP <a href="#graphcomputer"><code>GraphComputer</code></a> environment
this becomes exceedingly prohibitive as there are traversers emanating from all vertices in the graph in parallel.
In OLAP there are optimizations provided for traverser populations, but when paths are calculated (and each traverser
is unique due to its history), then these optimizations are no longer possible.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="path-data-structure">Path Data Structure</h4>
<div class="paragraph">
<p>The <code>Path</code> data structure is an ordered list of objects, where each object is associated to a <code>Set&lt;String&gt;</code> of
labels. An example is presented below to demonstrate both the <code>Path</code> API as well as how a traversal yields labeled paths.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/path-data-structure.png" alt="path data structure" width="350">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; path = g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
                       out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
                       has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">d</span><span class="delimiter">'</span></span>).
                       identity().as(<span class="string"><span class="delimiter">'</span><span class="content">e</span><span class="delimiter">'</span></span>).path().next()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;ripple
gremlin&gt; path.size()
==&gt;<span class="integer">4</span>
gremlin&gt; path.objects()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;ripple
gremlin&gt; path.labels()
==&gt;[b,a]
==&gt;<span class="type">[]</span>
==&gt;[c]
==&gt;[d,e]
gremlin&gt; path.a
==&gt;v[<span class="integer">1</span>]
gremlin&gt; path.b
==&gt;v[<span class="integer">1</span>]
gremlin&gt; path.c
==&gt;v[<span class="integer">5</span>]
gremlin&gt; path.d == path.e
==&gt;<span class="predefined-constant">true</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="peerpressure-step">PeerPressure Step</h3>
<div class="paragraph">
<p>The <code>peerPressure()</code>-step (<strong>map</strong>/<strong>sideEffect</strong>) clusters vertices using <a href="#peerpressurevertexprogram"><code>PeerPressureVertexProgram</code></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>peerPressure()</code>-step is a <code>VertexComputing</code>-step and as such, can only be used against a graph that supports <code>GraphComputer</code> (OLAP).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().peerPressure().by(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>)
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           peerPressure().by(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>).
           group().by(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="integer">1</span>:[marko,vadas,josh],<span class="integer">6</span>:[peter]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="profile-step">Profile Step</h3>
<div class="paragraph">
<p>The <code>profile()</code>-step (<strong>sideEffect</strong>) exists to allow developers to profile their traversals to determine statistical
information like step runtime, counts, etc.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Profiling a Traversal will impede the Traversal&#8217;s performance. This overhead is mostly excluded from the
profile results, but durations are not exact. Thus, durations are best considered in relation to each other.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).repeat(both()).times(<span class="integer">3</span>).hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).sum().profile()
==&gt;Traversal Metrics
Step                                                               Count  Traversers       <span class="predefined-type">Time</span> (ms)    % Dur
=============================================================================================================
TinkerGraphStep(vertex,<span class="type">[]</span>)                                             <span class="integer">6</span>           <span class="integer">6</span>           <span class="float">0.120</span>    <span class="float">13.21</span>
VertexStep(OUT,[created],vertex)                                       <span class="integer">4</span>           <span class="integer">4</span>           <span class="float">0.125</span>    <span class="float">13.77</span>
NoOpBarrierStep(<span class="integer">2500</span>)                                                  <span class="integer">4</span>           <span class="integer">2</span>           <span class="float">0.079</span>     <span class="float">8.69</span>
VertexStep(BOTH,vertex)                                               <span class="integer">10</span>           <span class="integer">4</span>           <span class="float">0.048</span>     <span class="float">5.38</span>
NoOpBarrierStep(<span class="integer">2500</span>)                                                 <span class="integer">10</span>           <span class="integer">3</span>           <span class="float">0.022</span>     <span class="float">2.49</span>
VertexStep(BOTH,vertex)                                               <span class="integer">24</span>           <span class="integer">7</span>           <span class="float">0.029</span>     <span class="float">3.24</span>
NoOpBarrierStep(<span class="integer">2500</span>)                                                 <span class="integer">24</span>           <span class="integer">5</span>           <span class="float">0.028</span>     <span class="float">3.10</span>
VertexStep(BOTH,vertex)                                               <span class="integer">58</span>          <span class="integer">11</span>           <span class="float">0.043</span>     <span class="float">4.83</span>
NoOpBarrierStep(<span class="integer">2500</span>)                                                 <span class="integer">58</span>           <span class="integer">6</span>           <span class="float">0.047</span>     <span class="float">5.17</span>
HasStep([~label.eq(person)])                                          <span class="integer">48</span>           <span class="integer">4</span>           <span class="float">0.084</span>     <span class="float">9.30</span>
PropertiesStep([age],value)                                           <span class="integer">48</span>           <span class="integer">4</span>           <span class="float">0.091</span>    <span class="float">10.10</span>
SumGlobalStep                                                          <span class="integer">1</span>           <span class="integer">1</span>           <span class="float">0.188</span>    <span class="float">20.72</span>
                                            &gt;TOTAL                     -           -           <span class="float">0.909</span>        -</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>profile()</code>-step generates a <code>TraversalMetrics</code> sideEffect object that contains the following information:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Step</code>: A step within the traversal being profiled.</p>
</li>
<li>
<p><code>Count</code>: The number of <em>represented</em> traversers that passed through the step.</p>
</li>
<li>
<p><code>Traversers</code>: The number of traversers that passed through the step.</p>
</li>
<li>
<p><code>Time (ms)</code>: The total time the step was actively executing its behavior.</p>
</li>
<li>
<p><code>% Dur</code>: The percentage of total time spent in the step.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-exercise.png" alt="gremlin exercise" width="120"></span> It is important to understand the difference between <code>Count</code>
and <code>Traversers</code>. Traversers can be merged and as such, when two traversers are "the same" they may be aggregated
into a single traverser. That new traverser has a <code>Traverser.bulk()</code> that is the sum of the two merged traverser
bulks. On the other hand, the <code>Count</code> represents the sum of all <code>Traverser.bulk()</code> results and thus, expresses the
number of "represented" (not enumerated) traversers. <code>Traversers</code> will always be less than or equal to <code>Count</code>.</p>
</div>
<div class="paragraph">
<p>A side effect key can also be passed to the <code>profile()</code>-step for situations when it is important to iterate the normal
results of the Traversal and retrieve the <code>TraversalMetrics</code> afterwards, as shown here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; t = g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).profile(<span class="string"><span class="delimiter">'</span><span class="content">metrics</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
gremlin&gt; t.iterate()
gremlin&gt; metrics = t.getSideEffects().get(<span class="string"><span class="delimiter">'</span><span class="content">metrics</span><span class="delimiter">'</span></span>)
==&gt;Traversal Metrics
Step                                                               Count  Traversers       <span class="predefined-type">Time</span> (ms)    % Dur
=============================================================================================================
TinkerGraphStep(vertex,<span class="type">[]</span>)                                             <span class="integer">6</span>           <span class="integer">6</span>           <span class="float">0.095</span>  -<span class="float">293.37</span>
VertexStep(OUT,[created],vertex)                                       <span class="integer">4</span>           <span class="integer">4</span>          -<span class="float">0.145</span>   <span class="float">449.19</span>
NoOpBarrierStep(<span class="integer">2500</span>)                                                  <span class="integer">4</span>           <span class="integer">2</span>           <span class="float">0.018</span>   -<span class="float">55.81</span>
                                            &gt;TOTAL                     -           -          -<span class="float">0.032</span>        -</code></pre>
</div>
</div>
<div class="paragraph">
<p>For traversal compilation information, please see <a href="#explain-step"><code>explain()</code></a>-step.</p>
</div>
</div>
<div class="sect2">
<h3 id="project-step">Project Step</h3>
<div class="paragraph">
<p>The <code>project()</code>-step (<strong>map</strong>) projects the current object into a <code>Map&lt;String,Object&gt;</code> keyed by provided labels. It is similar
to <a href="#select-step"><code>select()</code></a>-step, save that instead of retrieving and modulating historic traverser state, it modulates
the current state of the traverser.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
           project(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
             by(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count()).
           order().by(select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>),decr).
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)
==&gt;lop
==&gt;lop
==&gt;lop
==&gt;ripple
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).
                        project(<span class="string"><span class="delimiter">'</span><span class="content">out</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">in</span><span class="delimiter">'</span></span>).
                          by(outE().count()).
                          by(inE().count())
==&gt;[<span class="key">out</span>:<span class="integer">3</span>,<span class="keyword">in</span>:<span class="integer">0</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="program-step">Program Step</h3>
<div class="paragraph">
<p>The <code>program()</code>-step (<strong>map</strong>/<strong>sideEffect</strong>) is the "lambda" step for <code>GraphComputer</code> jobs. The step takes a
<a href="#vertexprogram"><code>VertexProgram</code></a> as an argument and will process the incoming graph accordingly. Thus, the user
can create their own <code>VertexProgram</code> and have it execute within a traversal. The configuration provided to the
vertex program includes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gremlin.vertexProgramStep.rootTraversal</code> is a serialization of a <code>PureTraversal</code> form of the root traversal.</p>
</li>
<li>
<p><code>gremlin.vertexProgramStep.stepId</code> is the step string id of the <code>program()</code>-step being executed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The user supplied <code>VertexProgram</code> can leverage that information accordingly within their vertex program. Example uses
are provided below.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Developing a <code>VertexProgram</code> is for expert users. Moreover, developing one that can be used effectively within
a traversal requires yet more expertise. This information is recommended to advanced users with a deep understanding of the
mechanics of Gremlin OLAP (<a href="#graphcomputer"><code>GraphComputer</code></a>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> TraverserSet&lt;<span class="predefined-type">Object</span>&gt; haltedTraversers;

<span class="directive">public</span> <span class="type">void</span> loadState(<span class="directive">final</span> Graph graph, <span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) {
  VertexProgram.super.loadState(graph, configuration);
  <span class="local-variable">this</span>.traversal = PureTraversal.loadState(configuration, VertexProgramStep.ROOT_TRAVERSAL, graph);
  <span class="local-variable">this</span>.programStep = <span class="keyword">new</span> TraversalMatrix&lt;&gt;(<span class="local-variable">this</span>.traversal.get()).getStepById(configuration.getString(ProgramVertexProgramStep.STEP_ID));
  <span class="comment">// if the traversal sideEffects will be used in the computation, add them as memory compute keys</span>
  <span class="local-variable">this</span>.memoryComputeKeys.addAll(MemoryTraversalSideEffects.getMemoryComputeKeys(<span class="local-variable">this</span>.traversal.get()));
  <span class="comment">// if master-traversal traversers may be propagated, create a memory compute key</span>
  <span class="local-variable">this</span>.memoryComputeKeys.add(MemoryComputeKey.of(TraversalVertexProgram.HALTED_TRAVERSERS, Operator.addAll, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>));
  <span class="comment">// returns an empty traverser set if there are no halted traversers</span>
  <span class="local-variable">this</span>.haltedTraversers = TraversalVertexProgram.loadHaltedTraversers(configuration);
}

<span class="directive">public</span> <span class="type">void</span> storeState(<span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) {
  VertexProgram.super.storeState(configuration);
  <span class="comment">// if halted traversers is null or empty, it does nothing</span>
  TraversalVertexProgram.storeHaltedTraversers(configuration, <span class="local-variable">this</span>.haltedTraversers);
}

<span class="directive">public</span> <span class="type">void</span> setup(<span class="directive">final</span> Memory memory) {
  <span class="keyword">if</span>(!<span class="local-variable">this</span>.haltedTraversers.isEmpty()) {
    <span class="comment">// do what you like with the halted master traversal traversers</span>
  }
  <span class="comment">// once used, no need to keep that information around (master)</span>
  <span class="local-variable">this</span>.haltedTraversers = <span class="predefined-constant">null</span>;
}

<span class="directive">public</span> <span class="type">void</span> execute(<span class="directive">final</span> Vertex vertex, <span class="directive">final</span> Messenger messenger, <span class="directive">final</span> Memory memory) {
  <span class="comment">// once used, no need to keep that information around (workers)</span>
  <span class="keyword">if</span>(<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.haltedTraversers)
    <span class="local-variable">this</span>.haltedTraversers = <span class="predefined-constant">null</span>;
  <span class="keyword">if</span>(vertex.property(TraversalVertexProgram.HALTED_TRAVERSERS).isPresent()) {
    <span class="comment">// haltedTraversers in execute() represent worker-traversal traversers</span>
    <span class="comment">// for example, from a traversal of the form g.V().out().program(...)</span>
    TraverserSet&lt;<span class="predefined-type">Object</span>&gt; haltedTraversers = vertex.value(TraversalVertexProgram.HALTED_TRAVERSERS);
    <span class="comment">// create a new halted traverser set that can be used by the next OLAP job in the chain</span>
    <span class="comment">// these are worker-traversers that are distributed throughout the graph</span>
    TraverserSet&lt;<span class="predefined-type">Object</span>&gt; newHaltedTraversers = <span class="keyword">new</span> TraverserSet&lt;&gt;();
    haltedTraversers.forEach(traverser -&gt; {
       newHaltedTraversers.add(traverser.split(traverser.get().toString(), <span class="local-variable">this</span>.programStep));
    });
    vertex.property(VertexProperty.Cardinality.single, TraversalVertexProgram.HALTED_TRAVERSERS, newHaltedTraversers);
    <span class="comment">// it is possible to create master-traversers that are localized to the master traversal (this is how results are ultimately delivered back to the user)</span>
    memory.add(TraversalVertexProgram.HALTED_TRAVERSERS,
               <span class="keyword">new</span> TraverserSet&lt;&gt;(<span class="local-variable">this</span>.traversal().get().getTraverserGenerator().generate(<span class="string"><span class="delimiter">&quot;</span><span class="content">an example</span><span class="delimiter">&quot;</span></span>, <span class="local-variable">this</span>.programStep, <span class="integer">1l</span>)));
  }

<span class="directive">public</span> <span class="type">boolean</span> terminate(<span class="directive">final</span> Memory memory) {
  <span class="comment">// the master-traversal will have halted traversers</span>
  <span class="keyword">assert</span> memory.exists(TraversalVertexProgram.HALTED_TRAVERSERS);
  <span class="directive">final</span> TraverserSet&lt;<span class="predefined-type">String</span>&gt; haltedTraversers = memory.get(TraversalVertexProgram.HALTED_TRAVERSERS);
  <span class="comment">// it will only have the traversers sent to the master traversal via memory</span>
  <span class="keyword">assert</span> haltedTraversers.stream().map(Traverser::get).filter(s -&gt; s.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">an example</span><span class="delimiter">&quot;</span></span>)).findAny().isPresent();
  <span class="comment">// it will not contain the worker traversers distributed throughout the vertices</span>
  <span class="keyword">assert</span> !haltedTraversers.stream().map(Traverser::get).filter(s -&gt; !s.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">an example</span><span class="delimiter">&quot;</span></span>)).findAny().isPresent();
  <span class="keyword">return</span> <span class="predefined-constant">true</span>;
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The test case <code>ProgramTest</code> in <code>gremlin-test</code> has an example vertex program called <code>TestProgram</code> that demonstrates
all the various ways in which traversal and traverser information is propagated within a vertex program and ultimately
usable by other vertex programs (including <code>TraversalVertexProgram</code>) down the line in an OLAP compute chain.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, an example is provided using <code>PageRankVertexProgram</code> which doesn&#8217;t use <a href="#pagerank-step"><code>pageRank()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
           program(PageRankVertexProgram.build().property(<span class="string"><span class="delimiter">'</span><span class="content">rank</span><span class="delimiter">'</span></span>).create(graph)).
             order().by(<span class="string"><span class="delimiter">'</span><span class="content">rank</span><span class="delimiter">'</span></span>, incr).
           valueMap(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">rank</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">name</span>:[marko],<span class="key">rank</span>:[<span class="float">0.15000000000000002</span>]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">rank</span>:[<span class="float">0.15000000000000002</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">rank</span>:[<span class="float">0.19250000000000003</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">rank</span>:[<span class="float">0.19250000000000003</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties_step">Properties Step</h3>
<div class="paragraph">
<p>The <code>properties()</code>-step (<strong>map</strong>) extracts properties from an <code>Element</code> in the traversal stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[location-&gt;san diego]
==&gt;vp[location-&gt;santa cruz]
==&gt;vp[location-&gt;brussels]
==&gt;vp[location-&gt;santa fe]
gremlin&gt; g.V(<span class="integer">1</span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">startTime</span>:<span class="integer">1997</span>,<span class="key">endTime</span>:<span class="integer">2001</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2001</span>,<span class="key">endTime</span>:<span class="integer">2004</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2004</span>,<span class="key">endTime</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2005</span>]
gremlin&gt; g.V(<span class="integer">1</span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">endTime</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">startTime</span>:<span class="integer">1997</span>,<span class="key">endTime</span>:<span class="integer">2001</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2001</span>,<span class="key">endTime</span>:<span class="integer">2004</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2004</span>,<span class="key">endTime</span>:<span class="integer">2005</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="propertymap-step">PropertyMap Step</h3>
<div class="paragraph">
<p>The <code>propertiesMap()</code>-step yields a Map representation of the properties of an element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().propertyMap()
==&gt;[<span class="key">name</span>:[vp[name-&gt;marko]],<span class="key">age</span>:[vp[age-&gt;<span class="integer">29</span>]]]
==&gt;[<span class="key">name</span>:[vp[name-&gt;vadas]],<span class="key">age</span>:[vp[age-&gt;<span class="integer">27</span>]]]
==&gt;[<span class="key">name</span>:[vp[name-&gt;lop]],<span class="key">lang</span>:[vp[lang-&gt;java]]]
==&gt;[<span class="key">name</span>:[vp[name-&gt;josh]],<span class="key">age</span>:[vp[age-&gt;<span class="integer">32</span>]]]
==&gt;[<span class="key">name</span>:[vp[name-&gt;ripple]],<span class="key">lang</span>:[vp[lang-&gt;java]]]
==&gt;[<span class="key">name</span>:[vp[name-&gt;peter]],<span class="key">age</span>:[vp[age-&gt;<span class="integer">35</span>]]]
gremlin&gt; g.V().propertyMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">29</span>]]]
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">27</span>]]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">32</span>]]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">35</span>]]]
gremlin&gt; g.V().propertyMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">29</span>]]]
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">27</span>]]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">32</span>]]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[vp[age-&gt;<span class="integer">35</span>]]]
gremlin&gt; g.E().propertyMap()
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">0.5</span>]]
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">1.0</span>]]
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">0.4</span>]]
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">1.0</span>]]
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">0.4</span>]]
==&gt;[<span class="key">weight</span>:p[weight-&gt;<span class="float">0.2</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="range-step">Range Step</h3>
<div class="paragraph">
<p>As traversers propagate through the traversal, it is possible to only allow a certain number of them to pass through
with <code>range()</code>-step (<strong>filter</strong>). When the low-end of the range is not met, objects are continued to be iterated. When
within the low (inclusive) and high (exclusive) range, traversers are emitted. Finally, when above the high range, the
traversal breaks out of iteration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().range(<span class="integer">0</span>,<span class="integer">3</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().range(<span class="integer">1</span>,<span class="integer">3</span>)
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().repeat(both()).times(<span class="integer">1000000</span>).emit().range(<span class="integer">6</span>,<span class="integer">10</span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>range()</code>-step can also be applied with <code>Scope.local</code>, in which case it operates on the incoming collection.
For example, it is possible to produce a <code>Map&lt;String, String&gt;</code> for each traversed path, but containing only the second
property value (the "b" step).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).in().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).range(local,<span class="integer">1</span>,<span class="integer">2</span>)
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:vadas]
==&gt;[<span class="key">b</span>:josh]
==&gt;[<span class="key">b</span>:ripple]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]
==&gt;[<span class="key">b</span>:lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The next example uses the <a href="#the-crew-toy-graph">The Crew</a> toy data set.  It produces a <code>List&lt;String&gt;</code> containing the
second and third location for each vertex.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().valueMap().select(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).range(local, <span class="integer">1</span>, <span class="integer">3</span>)
==&gt;[santa cruz,brussels]
==&gt;[dulles,purcellville]
==&gt;[baltimore,oakland]
==&gt;[kaiserslautern,aachen]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="repeat-step">Repeat Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-fade.png" alt="gremlin fade" width="350">
</div>
</div>
<div class="paragraph">
<p>The <code>repeat()</code>-step (<strong>branch</strong>) is used for looping over a traversal given some break predicate. Below are some
examples of <code>repeat()</code>-step in action.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).times(<span class="integer">2</span>).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]
gremlin&gt; g.V().until(has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">ripple</span><span class="delimiter">'</span></span>)).
               repeat(out()).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[marko,josh,ripple]
==&gt;[josh,ripple]
==&gt;[ripple]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>do-while semantics stating to do <code>out()</code> 2 times.</p>
</li>
<li>
<p>while-do semantics stating to break if the traverser is at a vertex named "ripple".</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
There are two modulators for <code>repeat()</code>: <code>until()</code> and <code>emit()</code>. If <code>until()</code> comes after <code>repeat()</code> it is
do/while looping. If <code>until()</code> comes before <code>repeat()</code> it is while/do looping. If <code>emit()</code> is placed after <code>repeat()</code>,
it is evaluated on the traversers leaving the repeat-traversal. If <code>emit()</code> is placed before <code>repeat()</code>, it is
evaluated on the traversers prior to entering the repeat-traversal.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>repeat()</code>-step also supports an "emit predicate", where the predicate for an empty argument <code>emit()</code> is
<code>true</code> (i.e. <code>emit() == emit{true}</code>). With <code>emit()</code>, the traverser is split in two&#8201;&#8212;&#8201;the traverser exits the code
block as well as continues back within the code block (assuming <code>until()</code> holds true).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).times(<span class="integer">2</span>).emit().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[marko,lop]
==&gt;[marko,vadas]
==&gt;[marko,josh]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]
gremlin&gt; g.V(<span class="integer">1</span>).emit().repeat(out()).times(<span class="integer">2</span>).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[marko]
==&gt;[marko,lop]
==&gt;[marko,vadas]
==&gt;[marko,josh]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>emit()</code> comes after <code>repeat()</code> and thus, emission happens after the <code>repeat()</code> traversal is executed. Thus,
no one vertex paths exist.</p>
</li>
<li>
<p>The <code>emit()</code> comes before <code>repeat()</code> and thus, emission happens prior to the <code>repeat()</code> traversal being executed.
Thus, one vertex paths exist.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>emit()</code>-modulator can take an arbitrary predicate.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).times(<span class="integer">2</span>).emit(has(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>)).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[marko,lop]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/repeat-step.png" alt="repeat step" width="500">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).times(<span class="integer">2</span>).emit().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[marko,lop]
==&gt;[marko,vadas]
==&gt;[marko,josh]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first time through the <code>repeat()</code>, the vertices lop, vadas, and josh are seen. Given that <code>loops==1</code>, the
traverser repeats. However, because the emit-predicate is declared true, those vertices are emitted. The next time through
 <code>repeat()</code>, the vertices traversed are ripple and lop (Josh&#8217;s created projects, as lop and vadas have no out edges).
  Given that <code>loops==2</code>, the until-predicate fails and ripple and lop are emitted.
Therefore, the traverser has seen the vertices: lop, vadas, josh, ripple, and lop.</p>
</div>
<div class="paragraph">
<p>Finally, note that both <code>emit()</code> and <code>until()</code> can take a traversal and in such, situations, the predicate is
determined by <code>traversal.hasNext()</code>. A few examples are provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).until(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>)).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[marko,lop]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]
gremlin&gt; g.V(<span class="integer">1</span>).emit(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)).repeat(out()).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[marko]
==&gt;[marko,vadas]
==&gt;[marko,josh]
gremlin&gt; g.V(<span class="integer">1</span>).repeat(out()).until(outE().count().is(<span class="integer">0</span>)).path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[marko,lop]
==&gt;[marko,vadas]
==&gt;[marko,josh,ripple]
==&gt;[marko,josh,lop]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Starting from vertex 1, keep taking outgoing edges until a software vertex is reached.</p>
</li>
<li>
<p>Starting from vertex 1, and in an infinite loop, emit the vertex if it is a person and then traverser the outgoing edges.</p>
</li>
<li>
<p>Starting from vertex 1, keep taking outgoing edges until a vertex is reached that has no more outgoing edges.</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The anonymous traversal of <code>emit()</code> and <code>until()</code> (not <code>repeat()</code>) process their current objects "locally."
In OLAP, where the atomic unit of computing is the vertex and its local "star graph," it is important that the
anonymous traversals do not leave the confines of the vertex&#8217;s star graph. In other words, they can not traverse to
an adjacent vertex&#8217;s properties or edges.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sack-step">Sack Step</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-sacks-running.png" alt="gremlin sacks running" width="175"></span> A traverser can contain a local data structure called a "sack".
The <code>sack()</code>-step is used to read and write sacks (<strong>sideEffect</strong> or <strong>map</strong>). Each sack of each traverser is created
when using <code>GraphTraversal.withSack(initialValueSupplier,splitOperator?,mergeOperator?)</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Initial value supplier</strong>: A <code>Supplier</code> providing the initial value of each traverser&#8217;s sack.</p>
</li>
<li>
<p><strong>Split operator</strong>: a <code>UnaryOperator</code> that clones the traverser&#8217;s sack when the traverser splits. If no split operator
is provided, then <code>UnaryOperator.identity()</code> is assumed.</p>
</li>
<li>
<p><strong>Merge operator</strong>: A <code>BinaryOperator</code> that unites two traverser&#8217;s sack when they are merged. If no merge operator is
provided, then traversers with sacks can not be merged.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two trivial examples are presented below to demonstrate the <strong>initial value supplier</strong>. In the first example below, a
traverser is created at each vertex in the graph (<code>g.V()</code>), with a 1.0 sack (<code>withSack(1.0f)</code>), and then the sack
value is accessed (<code>sack()</code>). In the second example, a random float supplier is used to generate sack values.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.withSack(<span class="float">1.0f</span>).V().sack()
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
gremlin&gt; rand = <span class="keyword">new</span> <span class="predefined-type">Random</span>()
==&gt;java.util.Random<span class="error">@</span><span class="integer">6</span>a4ba6f4
gremlin&gt; g.withSack {rand.nextFloat()}.V().sack()
==&gt;<span class="float">0.26806575</span>
==&gt;<span class="float">0.44459033</span>
==&gt;<span class="float">0.77047575</span>
==&gt;<span class="float">0.32030708</span>
==&gt;<span class="float">0.5653681</span>
==&gt;<span class="float">0.7913796</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A more complicated initial value supplier example is presented below where the sack values are used in a running
computation and then emitted at the end of the traversal. When an edge is traversed, the edge weight is multiplied
by the sack value (<code>sack(mult).by('weight')</code>). Note that the <a href="#by-step"><code>by()</code></a>-modulator can be any arbitrary traversal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.withSack(<span class="float">1.0f</span>).V().repeat(outE().sack(mult).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV()).times(<span class="integer">2</span>)
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.withSack(<span class="float">1.0f</span>).V().repeat(outE().sack(mult).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV()).times(<span class="integer">2</span>).sack()
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">0.4</span>
gremlin&gt; g.withSack(<span class="float">1.0f</span>).V().repeat(outE().sack(mult).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inV()).times(<span class="integer">2</span>).path().
               by().by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">1</span>],<span class="float">1.0</span>,v[<span class="integer">4</span>],<span class="float">1.0</span>,v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],<span class="float">1.0</span>,v[<span class="integer">4</span>],<span class="float">0.4</span>,v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-sacks-standing.png" alt="gremlin sacks standing" width="100"></span> When complex objects are used (i.e. non-primitives), then a
<strong>split operator</strong> should be defined to ensure that each traverser gets a clone of its parent&#8217;s sack. The first example
does not use a split operator and as such, the same map is propagated to all traversers (a global data structure). The
second example, demonstrates how <code>Map.clone()</code> ensures that each traverser&#8217;s sack contains a unique, local sack.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.withSack {[:]}.V().out().out().
               sack {m,v -&gt; m[v.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)] = v.value(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>); m}.sack() <span class="comment">// BAD: single map</span>
==&gt;[<span class="key">ripple</span>:java]
==&gt;[<span class="key">ripple</span>:java,<span class="key">lop</span>:java]
gremlin&gt; g.withSack {[:]}{<span class="local-variable">it</span>.clone()}.V().out().out().
               sack {m,v -&gt; m[v.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)] = v.value(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>); m}.sack() <span class="comment">// GOOD: cloned map</span>
==&gt;[<span class="key">ripple</span>:java]
==&gt;[<span class="key">lop</span>:java]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For primitives (i.e. integers, longs, floats, etc.), a split operator is not required as a primitives are
encoded in the memory address of the sack, not as a reference to an object.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If a <strong>merge operator</strong> is not provided, then traversers with sacks can not be bulked. However, in many situations,
merging the sacks of two traversers at the same location is algorithmically sound and good to provide so as to gain
the bulking optimization. In the examples below, the binary merge operator is <code>Operator.sum</code>. Thus, when two traverser
merge, their respective sacks are added together.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.withSack(<span class="float">1.0d</span>).V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.withSack(<span class="float">1.0d</span>).V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).sack() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
gremlin&gt; g.withSack(<span class="float">1.0d</span>, sum).V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).sack() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="float">2.0</span>
==&gt;<span class="float">2.0</span>
gremlin&gt; g.withSack(<span class="float">1.0d</span>).V(<span class="integer">1</span>).local(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier(normSack).inV()).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.withSack(<span class="float">1.0d</span>).V(<span class="integer">1</span>).local(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier(normSack).inV()).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier().sack() <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;<span class="float">0.5</span>
==&gt;<span class="float">0.5</span>
gremlin&gt; g.withSack(<span class="float">1.0d</span>,sum).V(<span class="integer">1</span>).local(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier(normSack).inV()).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier().sack() <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
gremlin&gt; g.withBulk(<span class="predefined-constant">false</span>).withSack(<span class="float">1.0f</span>,sum).V(<span class="integer">1</span>).local(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier(normSack).inV()).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier().sack() <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;<span class="float">1.0</span>
gremlin&gt; g.withBulk(<span class="predefined-constant">false</span>).withSack(<span class="float">1.0f</span>).V(<span class="integer">1</span>).local(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier(normSack).inV()).in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).barrier().sack() <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
==&gt;<span class="float">0.5</span>
==&gt;<span class="float">0.5</span>
gremlin&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>We find vertex 1 twice because he knows two other people</p>
</li>
<li>
<p>Without a merge operation the sack values are 1.0.</p>
</li>
<li>
<p>When specifying <code>sum</code> as the merge operation, the sack values are 2.0 because of bulking</p>
</li>
<li>
<p>Like 1, but using barrier internally</p>
</li>
<li>
<p>The <code>local(&#8230;&#8203;barrier(normSack)&#8230;&#8203;)</code> ensures that all traversers leaving vertex 1 have an evenly distributed amount of the initial 1.0 "energy" (50-50), i.e. the sack is 0.5 on each result</p>
</li>
<li>
<p>Like 3, but using <code>sum</code> as merge operator leads to the expected 1.0</p>
</li>
<li>
<p>There is now a single traverser with bulk of 2 and sack of 1.0 and thus, setting withBulk(false) yields the expected 1.0</p>
</li>
<li>
<p>Like 7, but without the sum operator</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="sample-step">Sample Step</h3>
<div class="paragraph">
<p>The <code>sample()</code>-step is useful for sampling some number of traversers previous in the traversal.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().outE().sample(<span class="integer">1</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>)
==&gt;<span class="float">0.5</span>
gremlin&gt; g.V().outE().sample(<span class="integer">1</span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>)
==&gt;<span class="float">0.5</span>
gremlin&gt; g.V().outE().sample(<span class="integer">2</span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>)
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>One of the more interesting use cases for <code>sample()</code> is when it is used in conjunction with <a href="#local-step"><code>local()</code></a>.
The combination of the two steps supports the execution of <a href="http://en.wikipedia.org/wiki/Random_walk">random walks</a>.
In the example below, the traversal starts are vertex 1 and selects one edge to traverse based on a probability
distribution generated by the weights of the edges. The output is always a single path as by selecting a single edge,
the traverser never splits and continues down a single path in the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).repeat(local(
                  bothE().sample(<span class="integer">1</span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).otherV()
                )).times(<span class="integer">5</span>)
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V(<span class="integer">1</span>).repeat(local(
                  bothE().sample(<span class="integer">1</span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).otherV()
                )).times(<span class="integer">5</span>).path()
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">4</span>],e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>],v[<span class="integer">5</span>],e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>],v[<span class="integer">4</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).repeat(local(
                  bothE().sample(<span class="integer">1</span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).otherV()
                )).times(<span class="integer">10</span>).path()
==&gt;[v[<span class="integer">1</span>],e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>],v[<span class="integer">2</span>],e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>],v[<span class="integer">1</span>],e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>],v[<span class="integer">4</span>],e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>],v[<span class="integer">1</span>],e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>],v[<span class="integer">4</span>],e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">1</span>],e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>],e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">6</span>],e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>],v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="select-step">Select Step</h3>
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/Functional_programming">Functional languages</a> make use of function composition and
lazy evaluation to create complex computations from primitive operations. This is exactly what <code>Traversal</code> does. One
of the differentiating aspects of Gremlin&#8217;s data flow approach to graph processing is that the flow need not always go
"forward," but in fact, can go back to a previously seen area of computation. Examples include <a href="#path-step"><code>path()</code></a>
as well as the <code>select()</code>-step (<strong>map</strong>). There are two general ways to use <code>select()</code>-step.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select labeled steps within a path (as defined by <code>as()</code> in a traversal).</p>
</li>
<li>
<p>Select objects out of a <code>Map&lt;String,Object&gt;</code> flow (i.e. a sub-map).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first use case is demonstrated via example below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>) <span class="comment">// no select</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">4</span>],<span class="key">c</span>:v[<span class="integer">5</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">4</span>],<span class="key">c</span>:v[<span class="integer">3</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">4</span>]]
==&gt;[<span class="key">a</span>:v[<span class="integer">1</span>],<span class="key">b</span>:v[<span class="integer">4</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>If the selection is one step, no map is returned.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When there is only one label selected, then a single object is returned. This is useful for stepping back in a
computation and easily moving forward again on the object reverted to.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out().out()
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V().out().out().path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">3</span>]]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out().out().select(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V().out().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).out().select(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V().out().out().as(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>) <span class="comment">// pointless</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When executing a traversal with <code>select()</code> on a standard traversal engine (i.e. OLTP), <code>select()</code> will do its
best to avoid calculating the path history and instead, will rely on a global data structure for storing the currently
selected object. As such, if only a subset of the path walked is required, <code>select()</code> should be used over the more
resource intensive <a href="#path-step"><code>path()</code></a>-step.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When the set of keys or values (i.e. columns) of a path or map are needed, use <code>select(keys)</code> and <code>select(values)</code>,
respectively. This is especially useful when one is only interested in the top N elements in a <code>groupCount()</code>
ranking.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">808</span> <span class="key">edges</span>:<span class="integer">8049</span>], standard]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">followedBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
               order(local).by(values,decr).limit(local, <span class="integer">5</span>)
==&gt;[PLAYING IN THE <span class="key">BAND</span>:<span class="integer">107</span>,JACK <span class="key">STRAW</span>:<span class="integer">99</span>,<span class="key">TRUCKING</span>:<span class="integer">94</span>,<span class="key">DRUMS</span>:<span class="integer">92</span>,ME AND MY <span class="key">UNCLE</span>:<span class="integer">86</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">followedBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
               order(local).by(values,decr).limit(local, <span class="integer">5</span>).select(keys)
==&gt;[PLAYING IN THE BAND,JACK STRAW,TRUCKING,DRUMS,ME AND MY UNCLE]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">followedBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
               order(local).by(values,decr).limit(local, <span class="integer">5</span>).select(keys).unfold()
==&gt;PLAYING IN THE BAND
==&gt;JACK STRAW
==&gt;TRUCKING
==&gt;DRUMS
==&gt;ME AND MY UNCLE</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly, for extracting the values from a path or map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">808</span> <span class="key">edges</span>:<span class="integer">8049</span>], standard]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">sungBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">All</span>:<span class="integer">9</span>,<span class="key">Weir_Garcia</span>:<span class="integer">1</span>,<span class="key">Lesh</span>:<span class="integer">19</span>,<span class="key">Weir_Kreutzmann</span>:<span class="integer">1</span>,<span class="key">Pigpen_Garcia</span>:<span class="integer">1</span>,<span class="key">Pigpen</span>:<span class="integer">36</span>,<span class="key">Unknown</span>:<span class="integer">6</span>,<span class="key">Weir_Bralove</span>:<span class="integer">1</span>,<span class="key">Joan_Baez</span>:<span class="integer">10</span>,<span class="key">Suzanne_Vega</span>:<span class="integer">2</span>,<span class="key">Welnick</span>:<span class="integer">10</span>,<span class="key">Lesh_Pigpen</span>:<span class="integer">1</span>,<span class="key">Elvin_Bishop</span>:<span class="integer">4</span>,<span class="key">Neil_Young</span>:<span class="integer">1</span>,<span class="key">Garcia_Weir_Lesh</span>:<span class="integer">1</span>,<span class="key">Hunter</span>:<span class="integer">3</span>,<span class="key">Hornsby</span>:<span class="integer">4</span>,<span class="key">Jon_Hendricks</span>:<span class="integer">2</span>,<span class="key">Weir_Hart</span>:<span class="integer">3</span>,<span class="key">Lesh_Mydland</span>:<span class="integer">1</span>,<span class="key">Mydland_Lesh</span>:<span class="integer">1</span>,<span class="key">instrumental</span>:<span class="integer">1</span>,<span class="key">Garcia</span>:<span class="integer">146</span>,<span class="key">Hart</span>:<span class="integer">2</span>,<span class="key">Welnick_Bralove</span>:<span class="integer">1</span>,<span class="key">Weir</span>:<span class="integer">99</span>,<span class="key">Garcia_Dawson</span>:<span class="integer">1</span>,<span class="key">Pigpen_Weir_Mydland</span>:<span class="integer">2</span>,<span class="key">Jorma_Kaukonen</span>:<span class="integer">4</span>,<span class="key">Joey_Covington</span>:<span class="integer">2</span>,<span class="key">Allman_Brothers</span>:<span class="integer">1</span>,<span class="key">Garcia_Lesh</span>:<span class="integer">3</span>,<span class="key">Boz_Scaggs</span>:<span class="integer">1</span>,Pigpen?:<span class="integer">1</span>,<span class="key">Keith_Godchaux</span>:<span class="integer">1</span>,<span class="key">Etta_James</span>:<span class="integer">1</span>,<span class="key">Weir_Wasserman</span>:<span class="integer">1</span>,<span class="key">Hall_and_Oates</span>:<span class="integer">2</span>,<span class="key">Grateful_Dead</span>:<span class="integer">17</span>,<span class="key">Spencer_Davis</span>:<span class="integer">2</span>,<span class="key">Pigpen_Mydland</span>:<span class="integer">3</span>,<span class="key">Beach_Boys</span>:<span class="integer">3</span>,<span class="key">Donna</span>:<span class="integer">4</span>,<span class="key">Bo_Diddley</span>:<span class="integer">7</span>,<span class="key">Bob_Dylan</span>:<span class="integer">22</span>,<span class="key">Hart_Kreutzmann</span>:<span class="integer">2</span>,<span class="key">Weir_Mydland</span>:<span class="integer">3</span>,<span class="key">Lesh_Hart_Kreutzmann</span>:<span class="integer">1</span>,<span class="key">Stephen_Stills</span>:<span class="integer">2</span>,<span class="key">Mydland</span>:<span class="integer">18</span>,<span class="key">Neville_Brothers</span>:<span class="integer">2</span>,<span class="key">Weir_Hart_Welnick</span>:<span class="integer">1</span>,<span class="key">Garcia_Lesh_Weir</span>:<span class="integer">1</span>,<span class="key">Garcia_Weir</span>:<span class="integer">3</span>,<span class="key">Neal_Cassady</span>:<span class="integer">1</span>,<span class="key">John_Fogerty</span>:<span class="integer">5</span>,<span class="key">Donna_Godchaux</span>:<span class="integer">2</span>,<span class="key">Pigpen_Weir</span>:<span class="integer">8</span>,<span class="key">Garcia_Kreutzmann</span>:<span class="integer">2</span>,<span class="key">None</span>:<span class="integer">6</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">sungBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).select(values) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="integer">9</span>,<span class="integer">1</span>,<span class="integer">19</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">36</span>,<span class="integer">6</span>,<span class="integer">1</span>,<span class="integer">10</span>,<span class="integer">2</span>,<span class="integer">10</span>,<span class="integer">1</span>,<span class="integer">4</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">3</span>,<span class="integer">4</span>,<span class="integer">2</span>,<span class="integer">3</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">146</span>,<span class="integer">2</span>,<span class="integer">1</span>,<span class="integer">99</span>,<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">4</span>,<span class="integer">2</span>,<span class="integer">1</span>,<span class="integer">3</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">17</span>,<span class="integer">2</span>,<span class="integer">3</span>,<span class="integer">3</span>,<span class="integer">4</span>,<span class="integer">7</span>,<span class="integer">22</span>,<span class="integer">2</span>,<span class="integer">3</span>,<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">18</span>,<span class="integer">2</span>,<span class="integer">1</span>,<span class="integer">1</span>,<span class="integer">3</span>,<span class="integer">1</span>,<span class="integer">5</span>,<span class="integer">2</span>,<span class="integer">8</span>,<span class="integer">2</span>,<span class="integer">6</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">song</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">sungBy</span><span class="delimiter">'</span></span>).groupCount().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).select(values).unfold().
               groupCount().order(local).by(values,decr).limit(local, <span class="integer">5</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="integer">1</span>:<span class="integer">22</span>,<span class="integer">2</span>:<span class="integer">12</span>,<span class="integer">3</span>:<span class="integer">7</span>,<span class="integer">4</span>:<span class="integer">4</span>,<span class="integer">6</span>:<span class="integer">2</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Which artist sung how many songs?</p>
</li>
<li>
<p>Get an anonymized set of song repertoire sizes.</p>
</li>
<li>
<p>What are the 5 most common song repertoire sizes?</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Note that <code>by()</code>-modulation is not supported with <code>select(keys)</code> and <code>select(values)</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is also an option to supply a <code>Pop</code> operation to <code>select()</code> to manipulate <code>List</code> objects in the <code>Traverser</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).repeat(out().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)).times(<span class="integer">2</span>).select(first, <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).repeat(out().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)).times(<span class="integer">2</span>).select(last, <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).repeat(out().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)).times(<span class="integer">2</span>).select(all, <span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>)
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">3</span>]]</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="using-where-with-select">Using Where with Select</h4>
<div class="paragraph">
<p>Like <a href="#match-step"><code>match()</code></a>-step, it is possible to use <code>where()</code>, as where is a filter that processes
<code>Map&lt;String,Object&gt;</code> streams.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:peter]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:josh,<span class="key">b</span>:peter]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:marko]
==&gt;[<span class="key">a</span>:peter,<span class="key">b</span>:josh]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
               where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).
               where(__.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).
               select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A standard <code>select()</code> that generates a <code>Map&lt;String,Object&gt;</code> of variables bindings in the path (i.e. <code>a</code> and <code>b</code>)
for the sake of a running example.</p>
</li>
<li>
<p>The <code>select().by('name')</code> projects each binding vertex to their name property value and <code>where()</code> operates to
ensure respective <code>a</code> and <code>b</code> strings are not the same.</p>
</li>
<li>
<p>The first <code>select()</code> projects a vertex binding set. A binding is filtered if <code>a</code> vertex equals <code>b</code> vertex. A
binding is filtered if <code>a</code> doesn&#8217;t know <code>b</code>. The second and final <code>select()</code> projects the name of the vertices.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="simplepath-step">SimplePath Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/simplepath-step.png" alt="simplepath step" width="400">
</div>
</div>
<div class="paragraph">
<p>When it is important that a traverser not repeat its path through the graph, <code>simplePath()</code>-step should be used
(<strong>filter</strong>). The <a href="#path-data-structure">path</a> information of the traverser is analyzed and if the path has repeated
objects in it, the traverser is filtered. If cyclic behavior is desired, see <a href="#cyclicpath-step"><code>cyclicPath()</code></a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).both().both()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">1</span>).both().both().simplePath()
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">1</span>).both().both().simplePath().path()
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">3</span>],v[<span class="integer">4</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">3</span>],v[<span class="integer">6</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>]]
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">4</span>],v[<span class="integer">3</span>]]
gremlin&gt; g.V().out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           simplePath().by(label).
           path()
gremlin&gt; g.V().out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           simplePath().
             by(label).
             from(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             to(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           path().
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>By using the <code>from()</code> and <code>to()</code> modulators traversers can ensure that only certain sections of the path are are acyclic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.addV().property(id, <span class="string"><span class="delimiter">'</span><span class="content">A</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
           addV().property(id, <span class="string"><span class="delimiter">'</span><span class="content">B</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           addV().property(id, <span class="string"><span class="delimiter">'</span><span class="content">C</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           addV().property(id, <span class="string"><span class="delimiter">'</span><span class="content">D</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">d</span><span class="delimiter">'</span></span>).
           addE(<span class="string"><span class="delimiter">'</span><span class="content">link</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           addE(<span class="string"><span class="delimiter">'</span><span class="content">link</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).
           addE(<span class="string"><span class="delimiter">'</span><span class="content">link</span><span class="delimiter">'</span></span>).from(<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>).to(<span class="string"><span class="delimiter">'</span><span class="content">d</span><span class="delimiter">'</span></span>).iterate()
gremlin&gt; g.V(<span class="string"><span class="delimiter">'</span><span class="content">A</span><span class="delimiter">'</span></span>).repeat(both().simplePath()).times(<span class="integer">3</span>).path() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[v[A],v[B],v[C],v[D]]
gremlin&gt; g.V(<span class="string"><span class="delimiter">'</span><span class="content">D</span><span class="delimiter">'</span></span>).repeat(both().simplePath()).times(<span class="integer">3</span>).path() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[v[D],v[C],v[B],v[A]]
gremlin&gt; g.V(<span class="string"><span class="delimiter">'</span><span class="content">A</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).
           repeat(both().simplePath().from(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)).times(<span class="integer">3</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           repeat(both().simplePath().from(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).times(<span class="integer">3</span>).path() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[v[A],v[B],v[C],v[D],v[C],v[B],v[A]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Traverse all acyclic 3-hop paths starting from vertex <code>A</code></p>
</li>
<li>
<p>Traverse all acyclic 3-hop paths starting from vertex <code>D</code></p>
</li>
<li>
<p>Traverse all acyclic 3-hop paths starting from vertex <code>A</code> and from there again all 3-hop paths. The second path may
cross the vertices from the first path.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="store-step">Store Step</h3>
<div class="paragraph">
<p>When <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy</a> aggregation is needed, <code>store()</code>-step (<strong>sideEffect</strong>)
should be used over <a href="#aggregate-step"><code>aggregate()</code></a>. The two steps differ in that <code>store()</code> does not block and only
stores objects in its side-effect collection as they pass through.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().aggregate(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).limit(<span class="integer">1</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">2</span>],v[<span class="integer">3</span>],v[<span class="integer">4</span>],v[<span class="integer">5</span>],v[<span class="integer">6</span>]]
gremlin&gt; g.V().store(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).limit(<span class="integer">1</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[v[<span class="integer">1</span>],v[<span class="integer">2</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is interesting to note that there are two results in the <code>store()</code> side-effect even though the interval
selection is for 1 object. Realize that when the second object is on its way to the <code>range()</code> filter (i.e. <code>[0..1]</code>),
it passes through <code>store()</code> and thus, stored before filtered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.E().store(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>)
==&gt;[<span class="float">0.5</span>,<span class="float">1.0</span>,<span class="float">1.0</span>,<span class="float">0.4</span>,<span class="float">0.4</span>,<span class="float">0.2</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="subgraph-step">Subgraph Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/subgraph-logo.png" alt="subgraph logo" width="380">
</div>
</div>
<div class="paragraph">
<p>Extracting a portion of a graph from a larger one for analysis, visualization or other purposes is a fairly common
use case for graph analysts and developers. The <code>subgraph()</code>-step (<strong>sideEffect</strong>) provides a way to produce an
<a href="http://mathworld.wolfram.com/Edge-InducedSubgraph.html">edge-induced subgraph</a> from virtually any traversal.
The following example demonstrates how to produce the "knows" subgraph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; subGraph = g.E().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).subgraph(<span class="string"><span class="delimiter">'</span><span class="content">subGraph</span><span class="delimiter">'</span></span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">subGraph</span><span class="delimiter">'</span></span>).next() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">3</span> <span class="key">edges</span>:<span class="integer">2</span>]
gremlin&gt; sg = subGraph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">3</span> <span class="key">edges</span>:<span class="integer">2</span>], standard]
gremlin&gt; sg.E() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>As this function produces "edge-induced" subgraphs, <code>subgraph()</code> must be called at edge steps.</p>
</li>
<li>
<p>The subgraph contains only "knows" edges.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A more common subgraphing use case is to get all of the graph structure surrounding a single vertex:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; subGraph = g.V(<span class="integer">3</span>).repeat(__.inE().subgraph(<span class="string"><span class="delimiter">'</span><span class="content">subGraph</span><span class="delimiter">'</span></span>).outV()).times(<span class="integer">3</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">subGraph</span><span class="delimiter">'</span></span>).next() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">4</span> <span class="key">edges</span>:<span class="integer">4</span>]
gremlin&gt; sg = subGraph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">4</span> <span class="key">edges</span>:<span class="integer">4</span>], standard]
gremlin&gt; sg.E()
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
==&gt;e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Starting at vertex <code>3</code>, traverse 3 steps away on in-edges, outputting all of that into the subgraph.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There can be multiple <code>subgraph()</code> calls within the same traversal. Each operating against either the same graph
(i.e. same side-effect key) or different graphs (i.e. different side-effect keys).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; t = g.V().outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).subgraph(<span class="string"><span class="delimiter">'</span><span class="content">knowsG</span><span class="delimiter">'</span></span>).inV().outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).subgraph(<span class="string"><span class="delimiter">'</span><span class="content">createdG</span><span class="delimiter">'</span></span>).
                   inV().inE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).subgraph(<span class="string"><span class="delimiter">'</span><span class="content">createdG</span><span class="delimiter">'</span></span>).iterate()
gremlin&gt; t.sideEffects.get(<span class="string"><span class="delimiter">'</span><span class="content">knowsG</span><span class="delimiter">'</span></span>).traversal().E()
==&gt;e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
gremlin&gt; t.sideEffects.get(<span class="string"><span class="delimiter">'</span><span class="content">createdG</span><span class="delimiter">'</span></span>).traversal().E()
==&gt;e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The <code>subgraph()</code>-step only writes to graphs that support user supplied ids for its elements. Moreover,
if no graph is specified via <code>withSideEffect()</code>, then <a href="#tinkergraph-gremlin">TinkerGraph</a> is assumed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sum-step">Sum Step</h3>
<div class="paragraph">
<p>The <code>sum()</code>-step (<strong>map</strong>) operates on a stream of numbers and sums the numbers together to yield a double. Note that
the current traverser number is multiplied by the traverser bulk to determine how many such numbers are being
represented.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).sum()
==&gt;<span class="integer">123</span>
gremlin&gt; g.V().repeat(both()).times(<span class="integer">3</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).sum()
==&gt;<span class="integer">1471</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>sum(local)</code> determines the sum of the current, local object (not the objects in the traversal stream).
This works for <code>Collection</code>-type objects. For any other object, a sum of <code>Double.NaN</code> is returned.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tail-step">Tail Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/tail-step.png" alt="tail step" width="530">
</div>
</div>
<div class="paragraph">
<p>The <code>tail()</code>-step is analogous to <a href="#limit-step"><code>limit()</code></a>-step, except that it emits the last <code>n</code>-objects instead of
the first <code>n</code>-objects.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order()
==&gt;josh
==&gt;lop
==&gt;marko
==&gt;peter
==&gt;ripple
==&gt;vadas
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order().tail() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;vadas
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order().tail(<span class="integer">1</span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;vadas
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).order().tail(<span class="integer">3</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;peter
==&gt;ripple
==&gt;vadas</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Last name (alphabetically).</p>
</li>
<li>
<p>Same as statement 1.</p>
</li>
<li>
<p>Last three names.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The <code>tail()</code>-step can also be applied with <code>Scope.local</code>, in which case it operates on the incoming collection.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).by(tail(local)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).by(unfold().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold()).tail(local) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).by(unfold().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold()).tail(local, <span class="integer">2</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[josh,ripple]
==&gt;[josh,lop]
gremlin&gt; g.V().valueMap().tail(local) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">lang</span>:[java]]
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">lang</span>:[java]]
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Only the most recent name from the "a" step (<code>List&lt;Vertex&gt;</code> becomes <code>Vertex</code>).</p>
</li>
<li>
<p>Same result as statement 1 (<code>List&lt;String&gt;</code> becomes <code>String</code>).</p>
</li>
<li>
<p><code>List&lt;String&gt;</code> for each path containing the last two names from the 'a' step.</p>
</li>
<li>
<p><code>Map&lt;String, Object&gt;</code> for each vertex, but containing only the last property value.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="timelimit-step">TimeLimit Step</h3>
<div class="paragraph">
<p>In many situations, a graph traversal is not about getting an exact answer as its about getting a relative ranking.
A classic example is <a href="http://en.wikipedia.org/wiki/Recommender_system">recommendation</a>. What is desired is a
relative ranking of vertices, not their absolute rank. Next, it may be desirable to have the traversal execute for
no more than 2 milliseconds. In such situations, <code>timeLimit()</code>-step (<strong>filter</strong>) can be used.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/timelimit-step.png" alt="timelimit step" width="400">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The method <code>clock(int runs, Closure code)</code> is a utility preloaded in the <a href="#gremlin-console">Gremlin Console</a>
that can be used to time execution of a body of code.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().repeat(both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)).times(<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).order(local).by(values,decr).next()
==&gt;v[<span class="integer">1</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">3</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">4</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">2</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">5</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">6</span>]=<span class="integer">1136688</span>
gremlin&gt; clock(<span class="integer">1</span>) {g.V().repeat(both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)).times(<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).order(local).by(values,decr).next()}
==&gt;<span class="float">2.498806</span>
gremlin&gt; g.V().repeat(timeLimit(<span class="integer">2</span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)).times(<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).order(local).by(values,decr).next()
==&gt;v[<span class="integer">1</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">3</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">4</span>]=<span class="integer">2744208</span>
==&gt;v[<span class="integer">2</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">5</span>]=<span class="integer">1136688</span>
==&gt;v[<span class="integer">6</span>]=<span class="integer">1136688</span>
gremlin&gt; clock(<span class="integer">1</span>) {g.V().repeat(timeLimit(<span class="integer">2</span>).both().groupCount(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>)).times(<span class="integer">16</span>).cap(<span class="string"><span class="delimiter">'</span><span class="content">m</span><span class="delimiter">'</span></span>).order(local).by(values,decr).next()}
==&gt;<span class="float">2.0562</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In essence, the relative order is respected, even through the number of traversers at each vertex is not. The primary
benefit being that the calculation is guaranteed to complete at the specified time limit (in milliseconds). Finally,
note that the internal clock of <code>timeLimit()</code>-step starts when the first traverser enters it. When the time limit is
reached, any <code>next()</code> evaluation of the step will yield a <code>NoSuchElementException</code> and any <code>hasNext()</code> evaluation will
yield <code>false</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="to-step">To Step</h3>
<div class="paragraph">
<p>The <code>to()</code>-step is not an actual step, but instead is a "step-modulator" similar to <a href="#as-step"><code>as()</code></a> and
<a href="#by-step"><code>by()</code></a>. If a step is able to accept traversals or strings then <code>to()</code> is the
means by which they are added. The general pattern is <code>step().to()</code>. See <a href="#from-step"><code>from()</code></a>-step.</p>
</div>
<div class="paragraph">
<p>The list of steps that support <code>to()</code>-modulation are: <a href="#simplepath-step"><code>simplePath()</code></a>, <a href="#cyclicpath-step"><code>cyclicPath()</code></a>,
 <a href="#path-step"><code>path()</code></a>, and <a href="#addedge-step"><code>addE()</code></a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="tree-step">Tree Step</h3>
<div class="paragraph">
<p>From any one element (i.e. vertex or edge), the emanating paths from that element can be aggregated to form a
<a href="http://en.wikipedia.org/wiki/Tree_(data_structure)">tree</a>. Gremlin provides <code>tree()</code>-step (<strong>sideEffect</strong>) for such
this situation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tree-step.png" alt="tree step" width="450">
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; tree = g.V().out().out().tree().next()
==&gt;v[<span class="integer">1</span>]={v[<span class="integer">4</span>]={v[<span class="integer">3</span>]={}, v[<span class="integer">5</span>]={}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to see how the paths of all the emanating traversers are united to form the tree.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/tree-step2.png" alt="tree step2" width="500">
</div>
</div>
<div class="paragraph">
<p>The resultant tree data structure can then be manipulated (see <code>Tree</code> JavaDoc).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; tree = g.V().out().out().tree().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).next()
==&gt;marko={josh={ripple={}, lop={}}}
gremlin&gt; tree[<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>]
==&gt;josh={ripple={}, lop={}}
gremlin&gt; tree[<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>][<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>]
==&gt;ripple={}
==&gt;lop={}
gremlin&gt; tree.getObjectsAtDepth(<span class="integer">3</span>)
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that when using <code>by()</code>-modulation, tree nodes are combined based on projection uniqueness, not on the
uniqueness of the original objects being projected. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).tree() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[v[<span class="integer">4</span>]:[v[<span class="integer">3</span>]:[<span class="key">lop</span>:<span class="type">[]</span>],v[<span class="integer">5</span>]:[<span class="key">ripple</span>:<span class="type">[]</span>]]]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
           tree().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by(label).by() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[<span class="key">josh</span>:[<span class="key">software</span>:[<span class="key">ripple</span>:<span class="type">[]</span>,<span class="key">lop</span>:<span class="type">[]</span>]]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>When the <code>tree()</code> is created, vertex 3 and 5 are unique and thus, form unique branches in the tree structure.</p>
</li>
<li>
<p>When the <code>tree()</code> is <code>by()</code>-modulated by <code>label</code>, then vertex 3 and 5 are both "software" and thus are merged to a single node in the tree.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="unfold-step">Unfold Step</h3>
<div class="paragraph">
<p>If the object reaching <code>unfold()</code> (<strong>flatMap</strong>) is an iterator, iterable, or map, then it is unrolled into a linear
form. If not, then the object is simply emitted. Please see <a href="#fold-step"><code>fold()</code></a> step for the inverse behavior.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).out().fold().inject(<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>,[<span class="float">1.23</span>,<span class="float">2.34</span>])
==&gt;gremlin
==&gt;[<span class="float">1.23</span>,<span class="float">2.34</span>]
==&gt;[v[<span class="integer">3</span>],v[<span class="integer">2</span>],v[<span class="integer">4</span>]]
gremlin&gt; g.V(<span class="integer">1</span>).out().fold().inject(<span class="string"><span class="delimiter">'</span><span class="content">gremlin</span><span class="delimiter">'</span></span>,[<span class="float">1.23</span>,<span class="float">2.34</span>]).unfold()
==&gt;gremlin
==&gt;<span class="float">1.23</span>
==&gt;<span class="float">2.34</span>
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>unfold()</code> does not recursively unroll iterators. Instead, <code>repeat()</code> can be used to for recursive unrolling.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]])
==&gt;<span class="integer">1</span>
==&gt;[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]]
gremlin&gt; inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]]).unfold()
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
==&gt;[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]
gremlin&gt; inject(<span class="integer">1</span>,[<span class="integer">2</span>,<span class="integer">3</span>,[<span class="integer">4</span>,<span class="integer">5</span>,[<span class="integer">6</span>]]]).repeat(unfold()).until(count(local).is(<span class="integer">1</span>)).unfold()
==&gt;<span class="integer">1</span>
==&gt;<span class="integer">2</span>
==&gt;<span class="integer">3</span>
==&gt;<span class="integer">4</span>
==&gt;<span class="integer">5</span>
==&gt;<span class="integer">6</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="union-step">Union Step</h3>
<div class="imageblock">
<div class="content">
<img src="../images/union-step.png" alt="union step" width="650">
</div>
</div>
<div class="paragraph">
<p>The <code>union()</code>-step (<strong>branch</strong>) supports the merging of the results of an arbitrary number of traversals. When a
traverser reaches a <code>union()</code>-step, it is copied to each of its internal steps. The traversers emitted from <code>union()</code>
are the outputs of the respective internal traversals.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">4</span>).union(
                  __.in().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>),
                  out().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>))
==&gt;<span class="integer">29</span>
==&gt;java
==&gt;java
gremlin&gt; g.V(<span class="integer">4</span>).union(
                  __.in().values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>),
                  out().values(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>)).path()
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">1</span>],<span class="integer">29</span>]
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">5</span>],java]
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">3</span>],java]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="value-step">Value Step</h3>
<div class="paragraph">
<p>The <code>value()</code>-step (<strong>map</strong>) takes a <code>Property</code> and extracts the value from it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).properties().value()
==&gt;marko
==&gt;san diego
==&gt;santa cruz
==&gt;brussels
==&gt;santa fe
gremlin&gt; g.V(<span class="integer">1</span>).properties().properties().value()
==&gt;<span class="integer">1997</span>
==&gt;<span class="integer">2001</span>
==&gt;<span class="integer">2001</span>
==&gt;<span class="integer">2004</span>
==&gt;<span class="integer">2004</span>
==&gt;<span class="integer">2005</span>
==&gt;<span class="integer">2005</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="valuemap-step">ValueMap Step</h3>
<div class="paragraph">
<p>The <code>valueMap()</code>-step yields a Map representation of the properties of an element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().valueMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().valueMap(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;<span class="type">[]</span>
==&gt;[<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.E().valueMap()
==&gt;[<span class="key">weight</span>:<span class="float">0.5</span>]
==&gt;[<span class="key">weight</span>:<span class="float">1.0</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.4</span>]
==&gt;[<span class="key">weight</span>:<span class="float">1.0</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.4</span>]
==&gt;[<span class="key">weight</span>:<span class="float">0.2</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important to note that the map of a vertex maintains a list of values for each key. The map of an edge or
vertex-property represents a single property (not a list). The reason is that vertices in TinkerPop3 leverage
<a href="#vertex-properties">vertex properties</a> which are support multiple values per key. Using the <a href="#the-crew-toy-graph">The Crew</a> toy graph, the point is made explicit.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">location</span>:[san diego,santa cruz,brussels,santa fe]]
==&gt;[<span class="key">name</span>:[stephen],<span class="key">location</span>:[centreville,dulles,purcellville]]
==&gt;[<span class="key">name</span>:[matthias],<span class="key">location</span>:[bremen,baltimore,oakland,seattle]]
==&gt;[<span class="key">name</span>:[daniel],<span class="key">location</span>:[spremberg,kaiserslautern,aachen]]
==&gt;[<span class="key">name</span>:[gremlin]]
==&gt;[<span class="key">name</span>:[tinkergraph]]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>)
==&gt;vp[location-&gt;san diego]
==&gt;vp[location-&gt;santa cruz]
==&gt;vp[location-&gt;brussels]
==&gt;vp[location-&gt;santa fe]
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">startTime</span>:<span class="integer">1997</span>,<span class="key">endTime</span>:<span class="integer">2001</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2001</span>,<span class="key">endTime</span>:<span class="integer">2004</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2004</span>,<span class="key">endTime</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">startTime</span>:<span class="integer">2005</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>id</code>, <code>label</code>, <code>key</code>, and <code>value</code> of the <code>Element</code> is desired, then a boolean triggers its insertion into the
returned map.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">location</span>:[san diego,santa cruz,brussels,santa fe],<span class="key">id</span>:<span class="integer">1</span>]
==&gt;[<span class="key">name</span>:[stephen],<span class="key">label</span>:person,<span class="key">location</span>:[centreville,dulles,purcellville],<span class="key">id</span>:<span class="integer">7</span>]
==&gt;[<span class="key">name</span>:[matthias],<span class="key">label</span>:person,<span class="key">location</span>:[bremen,baltimore,oakland,seattle],<span class="key">id</span>:<span class="integer">8</span>]
==&gt;[<span class="key">name</span>:[daniel],<span class="key">label</span>:person,<span class="key">location</span>:[spremberg,kaiserslautern,aachen],<span class="key">id</span>:<span class="integer">9</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).valueMap(<span class="predefined-constant">true</span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">1</span>]
==&gt;[<span class="key">name</span>:[stephen],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">7</span>]
==&gt;[<span class="key">name</span>:[matthias],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">8</span>]
==&gt;[<span class="key">name</span>:[daniel],<span class="key">label</span>:person,<span class="key">id</span>:<span class="integer">9</span>]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:san diego,<span class="key">startTime</span>:<span class="integer">1997</span>,<span class="key">id</span>:<span class="integer">6</span>,<span class="key">endTime</span>:<span class="integer">2001</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:santa cruz,<span class="key">startTime</span>:<span class="integer">2001</span>,<span class="key">id</span>:<span class="integer">7</span>,<span class="key">endTime</span>:<span class="integer">2004</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:brussels,<span class="key">startTime</span>:<span class="integer">2004</span>,<span class="key">id</span>:<span class="integer">8</span>,<span class="key">endTime</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:santa fe,<span class="key">startTime</span>:<span class="integer">2005</span>,<span class="key">id</span>:<span class="integer">9</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:centreville,<span class="key">startTime</span>:<span class="integer">1990</span>,<span class="key">id</span>:<span class="integer">10</span>,<span class="key">endTime</span>:<span class="integer">2000</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:dulles,<span class="key">startTime</span>:<span class="integer">2000</span>,<span class="key">id</span>:<span class="integer">11</span>,<span class="key">endTime</span>:<span class="integer">2006</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:purcellville,<span class="key">startTime</span>:<span class="integer">2006</span>,<span class="key">id</span>:<span class="integer">12</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:bremen,<span class="key">startTime</span>:<span class="integer">2004</span>,<span class="key">id</span>:<span class="integer">13</span>,<span class="key">endTime</span>:<span class="integer">2007</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:baltimore,<span class="key">startTime</span>:<span class="integer">2007</span>,<span class="key">id</span>:<span class="integer">14</span>,<span class="key">endTime</span>:<span class="integer">2011</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:oakland,<span class="key">startTime</span>:<span class="integer">2011</span>,<span class="key">id</span>:<span class="integer">15</span>,<span class="key">endTime</span>:<span class="integer">2014</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:seattle,<span class="key">startTime</span>:<span class="integer">2014</span>,<span class="key">id</span>:<span class="integer">16</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:spremberg,<span class="key">startTime</span>:<span class="integer">1982</span>,<span class="key">id</span>:<span class="integer">17</span>,<span class="key">endTime</span>:<span class="integer">2005</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:kaiserslautern,<span class="key">startTime</span>:<span class="integer">2005</span>,<span class="key">id</span>:<span class="integer">18</span>,<span class="key">endTime</span>:<span class="integer">2009</span>]
==&gt;[<span class="key">key</span>:location,<span class="key">value</span>:aachen,<span class="key">startTime</span>:<span class="integer">2009</span>,<span class="key">id</span>:<span class="integer">19</span>]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_values_step">Values Step</h3>
<div class="paragraph">
<p>The <code>values()</code>-step (<strong>map</strong>) extracts the values of properties from an <code>Element</code> in the traversal stream.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).values()
==&gt;marko
==&gt;san diego
==&gt;santa cruz
==&gt;brussels
==&gt;santa fe
gremlin&gt; g.V(<span class="integer">1</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>)
==&gt;san diego
==&gt;santa cruz
==&gt;brussels
==&gt;santa fe
gremlin&gt; g.V(<span class="integer">1</span>).properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).values()
==&gt;<span class="integer">1997</span>
==&gt;<span class="integer">2001</span>
==&gt;<span class="integer">2001</span>
==&gt;<span class="integer">2004</span>
==&gt;<span class="integer">2004</span>
==&gt;<span class="integer">2005</span>
==&gt;<span class="integer">2005</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vertex-steps">Vertex Steps</h3>
<div class="imageblock">
<div class="content">
<img src="../images/vertex-steps.png" alt="vertex steps" width="350">
</div>
</div>
<div class="paragraph">
<p>The vertex steps (<strong>flatMap</strong>) are fundamental to the Gremlin language. Via these steps, its possible to "move" on the
graph&#8201;&#8212;&#8201;i.e. traverse.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>out(string&#8230;&#8203;)</code>: Move to the outgoing adjacent vertices given the edge labels.</p>
</li>
<li>
<p><code>in(string&#8230;&#8203;)</code>: Move to the incoming adjacent vertices given the edge labels.</p>
</li>
<li>
<p><code>both(string&#8230;&#8203;)</code>: Move to both the incoming and outgoing adjacent vertices given the edge labels.</p>
</li>
<li>
<p><code>outE(string&#8230;&#8203;)</code>: Move to the outgoing incident edges given the edge labels.</p>
</li>
<li>
<p><code>inE(string&#8230;&#8203;)</code>: Move to the incoming incident edges given the edge labels.</p>
</li>
<li>
<p><code>bothE(string&#8230;&#8203;)</code>: Move to both the incoming and outgoing incident edges given the edge labels.</p>
</li>
<li>
<p><code>outV()</code>: Move to the outgoing vertex.</p>
</li>
<li>
<p><code>inV()</code>: Move to the incoming vertex.</p>
</li>
<li>
<p><code>bothV()</code>: Move to both vertices.</p>
</li>
<li>
<p><code>otherV()</code> : Move to the vertex that was not the vertex that was moved from.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">4</span>)
==&gt;v[<span class="integer">4</span>]
gremlin&gt; g.V(<span class="integer">4</span>).outE() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">4</span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
gremlin&gt; g.V(<span class="integer">4</span>).inE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
gremlin&gt; g.V(<span class="integer">4</span>).bothE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]
==&gt;e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]
==&gt;e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]
gremlin&gt; g.V(<span class="integer">4</span>).bothE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>).otherV()
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">4</span>).both(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">blah</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">4</span>).outE().inV() <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">4</span>).out() <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">3</span>]
gremlin&gt; g.V(<span class="integer">4</span>).inE().outV()
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V(<span class="integer">4</span>).inE().bothV()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">4</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>All outgoing edges.</p>
</li>
<li>
<p>All incoming knows-edges.</p>
</li>
<li>
<p>All incoming created-edges.</p>
</li>
<li>
<p>Moving forward touching edges and vertices.</p>
</li>
<li>
<p>Moving forward only touching vertices.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="where-step">Where Step</h3>
<div class="paragraph">
<p>The <code>where()</code>-step filters the current object based on either the object itself (<code>Scope.local</code>) or the path history
of the object (<code>Scope.global</code>) (<strong>filter</strong>). This step is typically used in conjuction with either
<a href="#match-step"><code>match()</code></a>-step or <a href="#select-step"><code>select()</code></a>-step, but can be used in isolation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V(<span class="integer">1</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).where(neq(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.withSideEffect(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,[<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">peter</span><span class="delimiter">'</span></span>]).V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).where(within(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;josh
==&gt;peter
gremlin&gt; g.V(<span class="integer">1</span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).where(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(gt(<span class="integer">1</span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;josh</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Who are marko&#8217;s collaborators, where marko can not be his own collaborator? (predicate)</p>
</li>
<li>
<p>Of the co-creators of marko, only keep those whose name is josh or peter. (using a sideEffect)</p>
</li>
<li>
<p>Which of marko&#8217;s collaborators have worked on more than 1 project? (using a traversal)</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Please see <a href="#using-where-with-match"><code>match().where()</code></a> and <a href="#using-where-with-select"><code>select().where()</code></a>
for how <code>where()</code> can be used in conjunction with <code>Map&lt;String,Object&gt;</code> projecting steps&#8201;&#8212;&#8201;i.e. <code>Scope.local</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A few more examples of filtering an arbitrary object based on a anonymous traversal is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().where(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;marko
==&gt;josh
==&gt;peter
gremlin&gt; g.V().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).where(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;josh
gremlin&gt; g.V().where(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).count().is(gte(<span class="integer">2</span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;josh
gremlin&gt; g.V().where(out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).where(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>))).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;marko
gremlin&gt; g.V().where(__.not(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>))).where(__.in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;vadas
gremlin&gt; g.V().where(__.not(out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).and().in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
==&gt;vadas
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,gt(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).
             by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:vadas]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,gt(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).or(eq(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>))).
             by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).
             by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).
             by(__.in(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>)).
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:vadas]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:josh]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>What are the names of the people who have created a project?</p>
</li>
<li>
<p>What are the names of the people that are known by someone one and have created a project?</p>
</li>
<li>
<p>What are the names of the people how have created two or more projects?</p>
</li>
<li>
<p>What are the names of the people who know someone that has created a project? (This only works in OLTP&#8201;&#8212;&#8201;see the <code>WARNING</code> below)</p>
</li>
<li>
<p>What are the names of the people who have not created anything, but are known by someone?</p>
</li>
<li>
<p>The concatenation of <code>where()</code>-steps is the same as a single <code>where()</code>-step with an and&#8217;d clause.</p>
</li>
<li>
<p>Marko knows josh and vadas but is only older than vadas.</p>
</li>
<li>
<p>Marko is younger than josh, but josh knows someone equal in age to marko (which is marko).</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The anonymous traversal of <code>where()</code> processes the current object "locally". In OLAP, where the atomic unit
of computing is the vertex and its local "star graph," it is important that the anonymous traversal does not leave
the confines of the vertex&#8217;s star graph. In other words, it can not traverse to an adjacent vertex&#8217;s properties or
edges. Note that is only a temporary limitation that will be addressed in a future version of TinkerPop3 (see
<a href="https://issues.apache.org/jira/browse/TINKERPOP-693">TINKERPOP-693</a>).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-note-on-predicates">A Note on Predicates</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A <code>P</code> is a predicate of the form <code>Function&lt;Object,Boolean&gt;</code>. That is, given some object, return true or false. The
provided predicates are outlined in the table below and are used in various steps such as <a href="#has-step"><code>has()</code></a>-step,
<a href="#where-step"><code>where()</code></a>-step, <a href="#is-step"><code>is()</code></a>-step, etc.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Predicate</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>eq(object)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming object equal to the provided object?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neq(object)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming object not equal to the provided object?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lt(number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number less than the provided number?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>lte(number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number less than or equal to the provided number?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gt(number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number greater than the provided number?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gte(number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number greater than or equal to the provided number?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>inside(number,number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number greater than the first provided number and less than the second?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>outside(number,number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number less than the first provided number or greater than the second?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>between(number,number)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming number greater than or equal to the first provided number and less than the second?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>within(objects&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming object in the array of provided objects?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>without(objects&#8230;&#8203;)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Is the incoming object not in the array of the provided objects?</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; eq(<span class="integer">2</span>)
==&gt;eq(<span class="integer">2</span>)
gremlin&gt; not(neq(<span class="integer">2</span>)) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;eq(<span class="integer">2</span>)
gremlin&gt; not(within(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>))
==&gt;without([a, b, c])
gremlin&gt; not(within(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).test(<span class="string"><span class="delimiter">'</span><span class="content">d</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; not(within(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">c</span><span class="delimiter">'</span></span>)).test(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">false</span>
gremlin&gt; within(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>).and(not(eq(<span class="integer">2</span>))).test(<span class="integer">3</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; inside(<span class="integer">1</span>,<span class="integer">4</span>).or(eq(<span class="integer">5</span>)).test(<span class="integer">3</span>) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; inside(<span class="integer">1</span>,<span class="integer">4</span>).or(eq(<span class="integer">5</span>)).test(<span class="integer">5</span>)
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; between(<span class="integer">1</span>,<span class="integer">2</span>) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;and(gte(<span class="integer">1</span>), lt(<span class="integer">2</span>))
gremlin&gt; not(between(<span class="integer">1</span>,<span class="integer">2</span>))
==&gt;or(lt(<span class="integer">1</span>), gte(<span class="integer">2</span>))</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The <code>not()</code> of a <code>P</code>-predicate is another <code>P</code>-predicate.</p>
</li>
<li>
<p><code>P</code>-predicates are arguments to various steps which internally <code>test()</code> the incoming value.</p>
</li>
<li>
<p><code>P</code>-predicates can be and&#8217;d together.</p>
</li>
<li>
<p><code>P</code>-predicates can be or' together.</p>
</li>
<li>
<p><code>and()</code> is a <code>P</code>-predicate and thus, a <code>P</code>-predicate can be composed of multiple <code>P</code>-predicates.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To reduce the verbosity of predicate expressions, it is good to
<code>import static org.apache.tinkerpop.gremlin.process.traversal.P.*</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, note that <a href="#where-step"><code>where()</code></a>-step takes a <code>P&lt;String&gt;</code>. The provided string value refers to a variable
binding, not to the explicit string value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).both().both().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).count()
==&gt;<span class="integer">30</span>
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).both().both().as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)).count()
==&gt;<span class="integer">18</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is possible for graph system providers and users to extend <code>P</code> and provide new predicates. For instance, a
<code>regex(pattern)</code> could be a graph system specific <code>P</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-note-on-barrier-steps">A Note on Barrier Steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/barrier.png" alt="barrier" width="165"></span> Gremlin is primarily a
<a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy</a>, stream processing language. This means that Gremlin fully
processes (to the best of its abilities) any traversers currently in the traversal pipeline before getting more data
from the start/head of the traversal. However, there are numerous situations in which a completely lazy computation
is not possible (or impractical). When a computation is not lazy, a "barrier step" exists. There are three types of
barriers:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>CollectingBarrierStep</code>: All of the traversers prior to the step are put into a collection and then processed in
some way (e.g. ordered) prior to the collection being "drained" one-by-one to the next step. Examples
include: <a href="#order-step"><code>order()</code></a>, <a href="#sample-step"><code>sample()</code></a>, <a href="#aggregate-step"><code>aggregate()</code></a>, <a href="#barrier-step"><code>barrier()</code></a>.</p>
</li>
<li>
<p><code>ReducingBarrierStep</code>: All of the traversers prior to the step are processed by a reduce function and once all the
previous traversers are processed, a single "reduced value" traverser is emitted to the next step. Note that the path
history leading up to a reducing barrier step is destroyed given its many-to-one nature. Examples include:
<a href="#fold-step"><code>fold()</code></a>, <a href="#count-step"><code>count()</code></a>, <a href="#sum-step"><code>sum()</code></a>, <a href="#max-step"><code>max()</code></a>, <a href="#min-step"><code>min()</code></a>.</p>
</li>
<li>
<p><code>SupplyingBarrierStep</code>: All of the traversers prior to the step are iterated (no processing) and then some provided
supplier yields a single traverser to continue to the next step. Examples include: <a href="#cap-step"><code>cap()</code></a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In Gremlin OLAP (see <a href="#traversalvertexprogram"><code>TraversalVertexProgram</code></a>), a barrier is introduced at the end of
every <a href="#vertex-steps">adjacent vertex step</a>. This means that the traversal does its best to compute as much as
possible at the current, local vertex. What it can&#8217;t compute without referencing an adjacent vertex is aggregated
into a barrier collection. When there are no more traversers at the local vertex, the barriered traversers are the
messages that are propagated to remote vertices for further processing.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-note-on-scopes">A Note on Scopes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>Scope</code> enum has two constants: <code>Scope.local</code> and <code>Scope.global</code>. Scope determines whether the particular step
being scoped is with respects to the current object (<code>local</code>) at that step or to the entire stream of objects up to that
step (<code>global</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).count() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="integer">2</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).fold().count() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="integer">1</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).fold().count(local) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="integer">2</span>
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).fold().count(global) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="integer">1</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Marko knows 2 people.</p>
</li>
<li>
<p>A list of Marko&#8217;s friends is created and thus, one object is counted (the single list).</p>
</li>
<li>
<p>A list of Marko&#8217;s friends is created and a <code>local</code>-count yields the number of objects in that list.</p>
</li>
<li>
<p><code>count(global)</code> is the same as <code>count()</code> as the default behavior for most scoped steps is <code>global</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The steps that support scoping are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#count-step"><code>count()</code></a>: count the local collection or global stream.</p>
</li>
<li>
<p><a href="#dedup-step"><code>dedup()</code></a>: dedup the local collection of global stream.</p>
</li>
<li>
<p><a href="#max-step"><code>max()</code></a>: get the max value in the local collection or global stream.</p>
</li>
<li>
<p><a href="#mean-step"><code>mean()</code></a>: get the mean value in the local collection or global stream.</p>
</li>
<li>
<p><a href="#min-step"><code>min()</code></a>: get the min value in the local collection or global stream.</p>
</li>
<li>
<p><a href="#order-step"><code>order()</code></a>: order the objects in the local collection or global stream.</p>
</li>
<li>
<p><a href="#range-step"><code>range()</code></a>: clip the local collection or global stream.</p>
</li>
<li>
<p><a href="#limit-step"><code>limit()</code></a>: clip the local collection or global stream.</p>
</li>
<li>
<p><a href="#sample-step"><code>sample()</code></a>: sample objects from the local collection or global stream.</p>
</li>
<li>
<p><a href="#tail-step"><code>tail()</code></a>: get the tail of the objects in the local collection or global stream.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A few more examples of the use of <code>Scope</code> are provided below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().both().group().by(label).select(<span class="string"><span class="delimiter">'</span><span class="content">software</span><span class="delimiter">'</span></span>).dedup(local)
==&gt;[v[<span class="integer">3</span>],v[<span class="integer">5</span>]]
gremlin&gt; g.V().groupCount().by(label).select(values).min(local)
==&gt;<span class="integer">2</span>
gremlin&gt; g.V().groupCount().by(label).order(local).by(values,decr)
==&gt;[<span class="key">person</span>:<span class="integer">4</span>,<span class="key">software</span>:<span class="integer">2</span>]
gremlin&gt; g.V().fold().sample(local,<span class="integer">2</span>)
==&gt;[v[<span class="integer">4</span>],v[<span class="integer">6</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, note that <a href="#local-step"><code>local()</code></a>-step is a "hard-scoped step" that transforms any internal traversal into a
locally-scoped operation. A contrived example is provided below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().fold().local(unfold().count())
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().fold().count(local)
==&gt;<span class="integer">6</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a-note-on-lambdas">A Note On Lambdas</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/lambda.png" alt="lambda" width="150"></span> A <a href="http://en.wikipedia.org/wiki/Anonymous_function">lambda</a> is a function
that can be referenced by software and thus, passed around like any other piece of data. In Gremlin, lambdas make it
possible to generalize the behavior of a step such that custom steps can be created (on-the-fly) by the user. However,
it is advised to avoid using lambdas if possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().filter{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) == <span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>}.
               flatMap{<span class="local-variable">it</span>.get().vertices(OUT,<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)}.
               map {<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)} <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;lop
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;lop</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A lambda-rich Gremlin traversal which should and can be avoided. (<strong>bad</strong>)</p>
</li>
<li>
<p>The same traversal (result), but without using lambdas. (<strong>good</strong>)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gremlin attempts to provide the user a comprehensive collection of steps in the hopes that the user will never need to
leverage a lambda in practice. It is advised that users only leverage a lambda if and only if there is no
corresponding lambda-less step that encompasses the desired functionality. The reason being, lambdas can not be
optimized by Gremlin&#8217;s compiler strategies as they can not be programmatically inspected (see
<a href="#traversalstrategy">traversal strategies</a>). It is also not currently possible to send a lambda for remote execution to Gremlin-Server or a driver that supports remote execution.</p>
</div>
<div class="paragraph">
<p>In many situations where a lambda could be used, either a corresponding step exists or a traversal can be provided in
its place. A <code>TraversalLambda</code> behaves like a typical lambda, but it can be optimized and it yields less objects than
the corresponding pure-lambda form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().out().out().path().by {<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}.
                                  by {<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}.
                                  by {g.V(<span class="local-variable">it</span>).in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold().next()} <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;[marko,josh,[josh]]
==&gt;[marko,josh,[marko,josh,peter]]
gremlin&gt; g.V().out().out().path().by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
                                  by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
                                  by(__.in(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).fold()) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;[marko,josh,[josh]]
==&gt;[marko,josh,[marko,josh,peter]]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The length-3 paths have each of their objects transformed by a lambda. (<strong>bad</strong>)</p>
</li>
<li>
<p>The length-3 paths have their objects transformed by a lambda-less step and a traversal lambda. (<strong>good</strong>)</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="traversalstrategy">TraversalStrategy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/traversal-strategy.png" alt="traversal strategy" width="125"></span> A <code>TraversalStrategy</code> analyzes a <code>Traversal</code> and, if the traversal
meets its criteria, can mutate it accordingly. Traversal strategies are executed at compile-time and form the foundation
of the Gremlin traversal machine&#8217;s compiler. There are 5 categories of strategies which are itemized below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There is an application-level feature that can be embedded into the traversal logic (<strong>decoration</strong>).</p>
</li>
<li>
<p>There is a more efficient way to express the traversal at the TinkerPop3 level (<strong>optimization</strong>).</p>
</li>
<li>
<p>There is a more efficient way to express the traversal at the graph system/language/driver level (<strong>provider optimization</strong>).</p>
</li>
<li>
<p>There are are some final adjustments/cleanups/analyses required before executing the traversal (<strong>finalization</strong>).</p>
</li>
<li>
<p>There are certain traversals that are not legal for the application or traversal engine (<strong>verification</strong>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <a href="#explain-step"><code>explain()</code></a>-step shows the user how each registered strategy mutates the traversal.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A simple <code>OptimizationStrategy</code> is the <code>IdentityRemovalStrategy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">IdentityRemovalStrategy</span> <span class="directive">extends</span> AbstractTraversalStrategy&lt;TraversalStrategy.OptimizationStrategy&gt; <span class="directive">implements</span> TraversalStrategy.OptimizationStrategy {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> IdentityRemovalStrategy INSTANCE = <span class="keyword">new</span> IdentityRemovalStrategy();

    <span class="directive">private</span> IdentityRemovalStrategy() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="directive">final</span> Traversal.Admin&lt;?, ?&gt; traversal) {
        <span class="keyword">if</span> (traversal.getSteps().size() &lt;= <span class="integer">1</span>)
            <span class="keyword">return</span>;

        <span class="keyword">for</span> (<span class="directive">final</span> IdentityStep&lt;?&gt; identityStep : TraversalHelper.getStepsOfClass(IdentityStep.class, traversal)) {
            <span class="keyword">if</span> (identityStep.getLabels().isEmpty() || !(identityStep.getPreviousStep() <span class="keyword">instanceof</span> EmptyStep)) {
                TraversalHelper.copyLabels(identityStep, identityStep.getPreviousStep(), <span class="predefined-constant">false</span>);
                traversal.removeStep(identityStep);
            }
        }
    }

    <span class="directive">public</span> <span class="directive">static</span> IdentityRemovalStrategy instance() {
        <span class="keyword">return</span> INSTANCE;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This strategy simply removes any <code>IdentityStep</code> steps in the Traversal as <code>aStep().identity().identity().bStep()</code>
is equivalent to <code>aStep().bStep()</code>. For those traversal strategies that require other strategies to execute prior or
post to the strategy, then the following two methods can be defined in <code>TraversalStrategy</code> (with defaults being an
empty set). If the <code>TraversalStrategy</code> is in a particular traversal category (i.e. decoration, optimization,
provider-optimization, finalization, or verification), then priors and posts are only possible within the respective category.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> S&gt;&gt; applyPrior();
<span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> S&gt;&gt; applyPost();</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>TraversalStrategy</code> categories are sorted within their category and the categories are then executed in
the following order: decoration, optimization, provider optimization, finalization, and verification. If a designed strategy
does not fit cleanly into these categories, then it can implement <code>TraversalStrategy</code> and its prior and posts can reference
strategies within any category. However, such generalization are strongly discouraged.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An example of a <code>GraphSystemOptimizationStrategy</code> is provided below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The expression above can be executed in a <code>O(|V|)</code> or <code>O(log(|V|)</code> fashion in <a href="#tinkergraph-gremlin">TinkerGraph</a>
depending on whether there is or is not an index defined for "name."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">TinkerGraphStepStrategy</span> <span class="directive">extends</span> AbstractTraversalStrategy&lt;TraversalStrategy.ProviderOptimizationStrategy&gt; <span class="directive">implements</span> TraversalStrategy.ProviderOptimizationStrategy {

    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> TinkerGraphStepStrategy INSTANCE = <span class="keyword">new</span> TinkerGraphStepStrategy();

    <span class="directive">private</span> TinkerGraphStepStrategy() {
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> apply(<span class="directive">final</span> Traversal.Admin&lt;?, ?&gt; traversal) {
        <span class="keyword">if</span> (TraversalHelper.onGraphComputer(traversal))
            <span class="keyword">return</span>;

        <span class="keyword">for</span> (<span class="directive">final</span> GraphStep originalGraphStep : TraversalHelper.getStepsOfClass(GraphStep.class, traversal)) {
            <span class="directive">final</span> TinkerGraphStep&lt;?, ?&gt; tinkerGraphStep = <span class="keyword">new</span> TinkerGraphStep&lt;&gt;(originalGraphStep);
            TraversalHelper.replaceStep(originalGraphStep, tinkerGraphStep, traversal);
            Step&lt;?, ?&gt; currentStep = tinkerGraphStep.getNextStep();
            <span class="keyword">while</span> (currentStep <span class="keyword">instanceof</span> HasStep || currentStep <span class="keyword">instanceof</span> NoOpBarrierStep) {
                <span class="keyword">if</span> (currentStep <span class="keyword">instanceof</span> HasStep) {
                    <span class="keyword">for</span> (<span class="directive">final</span> HasContainer hasContainer : ((HasContainerHolder) currentStep).getHasContainers()) {
                        <span class="keyword">if</span> (!GraphStep.processHasContainerIds(tinkerGraphStep, hasContainer))
                            tinkerGraphStep.addHasContainer(hasContainer);
                    }
                    TraversalHelper.copyLabels(currentStep, currentStep.getPreviousStep(), <span class="predefined-constant">false</span>);
                    traversal.removeStep(currentStep);
                }
                currentStep = currentStep.getNextStep();
            }
        }
    }

    <span class="directive">public</span> <span class="directive">static</span> TinkerGraphStepStrategy instance() {
        <span class="keyword">return</span> INSTANCE;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The traversal is redefined by simply taking a chain of <code>has()</code>-steps after <code>g.V()</code> (<code>TinkerGraphStep</code>) and providing
their <code>HasContainers</code> to <code>TinkerGraphStep</code>. Then its up to <code>TinkerGraphStep</code> to determine if an appropriate index exists.
Given that the strategy uses non-TinkerPop3 provided steps, it should go into the <code>ProviderOptimizationStrategy</code> category
to ensure the added step does not interfere with the assumptions of the <code>OptimizationStrategy</code> strategies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; t = g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>); <span class="predefined-constant">null</span>
gremlin&gt; t.toString()
==&gt;[GraphStep(vertex,<span class="type">[]</span>), HasStep([name.eq(marko)])]
gremlin&gt; t.iterate(); <span class="predefined-constant">null</span>
gremlin&gt; t.toString()
==&gt;[TinkerGraphStep(vertex,[name.eq(marko)])]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The reason that <code>OptimizationStrategy</code> and <code>ProviderOptimizationStrategy</code> are two different categories is
that optimization strategies should only rewrite the traversal using TinkerPop3 steps. This ensures that the
optimizations executed at the end of the optimization strategy round are TinkerPop3 compliant. From there, provider
optimizations can analyze the traversal and rewrite the traversal as desired using graph system specific steps (e.g.
replacing <code>GraphStep.HasStep&#8230;&#8203;HasStep</code> with <code>TinkerGraphStep</code>). If provider optimizations use graph system specific
steps and implement <code>OptimizationStrategy</code>, then other TinkerPop3 optimizations may fail to optimize the traversal or
mis-understand the graph system specific step behaviors (e.g. <code>ProviderVertexStep extends VertexStep</code>) and yield
incorrect semantics.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, here is a complicated traversal that has various components that are optimized by the default TinkerPop strategies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
                 and(has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>), <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
                     has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>),
                     filter(has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt(<span class="integer">20</span>)))). <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
           match(__.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,lt(<span class="integer">32</span>)), <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
                 __.as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).repeat(outE().inV()).times(<span class="integer">2</span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)). <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
             where(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,neq(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>)). <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
             where(__.as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).both().count().is(gt(<span class="integer">1</span>))). <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
           select(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
           groupCount().
             by(out().count()). <span class="invisible">//</span><b class="conum">9</b><span class="invisible">\</span>
           explain()
==&gt;Traversal Explanation
================================================================================================================================================================================================================================================
Original Traversal                 [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), RepeatStep([VertexStep(OUT,edge), EdgeVertexStep(IN), RepeatEndStep],until(loops(<span class="integer">2</span>)),emit(<span class="predefined-constant">false</span>)), MatchEndStep(b)]
                                      ]), WherePredicateStep(a,neq(b)), WhereTraversalStep([WhereStartStep(b), VertexStep(BOTH,vertex), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalS
                                      tep])]

ConnectiveStrategy           [D]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), RepeatStep([VertexStep(OUT,edge), EdgeVertexStep(IN), RepeatEndStep],until(loops(<span class="integer">2</span>)),emit(<span class="predefined-constant">false</span>)), MatchEndStep(b)]
                                      ]), WherePredicateStep(a,neq(b)), WhereTraversalStep([WhereStartStep(b), VertexStep(BOTH,vertex), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalS
                                      tep])]
RepeatUnrollStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarr
                                      ierStep(<span class="integer">2500</span>), MatchEndStep(b)]]), WherePredicateStep(a,neq(b)), WhereTraversalStep([WhereStartStep(b), VertexStep(BOTH,vertex), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), SelectOneStep(b), GroupCountStep([Verte
                                      xStep(OUT,vertex), CountGlobalStep])]
MatchPredicateStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarr
                                      ierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalStep([WhereStartStep, VertexStep(BOTH,vertex), CountGlobalStep, IsStep(g
                                      t(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
PathRetractionStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarr
                                      ierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalStep([WhereStartStep, VertexStep(BOTH,vertex), CountGlobalStep, IsStep(g
                                      t(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
RangeByIsCountStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,edge), EdgeVertexStep(IN), NoOpBarr
                                      ierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalStep([WhereStartStep, VertexStep(BOTH,vertex), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), Cou
                                      ntGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
IncidentToAdjacentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [Ma
                                      tchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalStep([WhereStartStep, VertexStep(BOTH,vertex), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), Match
                                      EndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
FilterRankingStrategy        [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), AndStep([[TraversalFilterStep([PropertiesStep([name],value)])], [HasStep([name.eq(marko)])], [TraversalFilterStep([HasStep([age.gt(<span class="integer">20</span>)])])]]), MatchS
                                      tep(AND,[[MatchStartStep(a), HasStep([age.lt(<span class="integer">32</span>)]), MatchEndStep], [MatchStartStep(a), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [Ma
                                      tchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalStep([WhereStartStep, VertexStep(BOTH,vertex), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), Match
                                      EndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
InlineFilterStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],value)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), Vertex
                                      Step(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversa
                                      lStep([WhereStartStep, VertexStep(BOTH,vertex), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,vertex), CountGlobalStep])]
AdjacentToIncidentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), Ver
                                      texStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTrave
                                      rsalStep([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]
LazyBarrierStrategy          [O]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), Ver
                                      texStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTrave
                                      rsalStep([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]
TinkerGraphCountStrategy     [P]   [GraphStep(vertex,<span class="type">[]</span>), HasStep([~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), Ver
                                      texStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTrave
                                      rsalStep([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]
TinkerGraphStepStrategy      [P]   [TinkerGraphStep(vertex,[~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), VertexStep
                                      (OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalSte
                                      p([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]
ProfileStrategy              [F]   [TinkerGraphStep(vertex,[~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), VertexStep
                                      (OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalSte
                                      p([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]
StandardVerificationStrategy [V]   [TinkerGraphStep(vertex,[~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), VertexStep
                                      (OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalSte
                                      p([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]

Final Traversal                    [TinkerGraphStep(vertex,[~label.eq(person)]), TraversalFilterStep([PropertiesStep([name],property)]), HasStep([name.eq(marko), age.gt(<span class="integer">20</span>), age.lt(<span class="integer">32</span>)])<span class="error">@</span>[a], MatchStep(AND,[[MatchStartStep(a), VertexStep
                                      (OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), VertexStep(OUT,vertex), NoOpBarrierStep(<span class="integer">2500</span>), MatchEndStep(b)], [MatchStartStep(a), WherePredicateStep(neq(b)), MatchEndStep], [MatchStartStep(b), WhereTraversalSte
                                      p([WhereStartStep, VertexStep(BOTH,edge), RangeGlobalStep(<span class="integer">0</span>,<span class="integer">2</span>), CountGlobalStep, IsStep(gt(<span class="integer">1</span>))]), MatchEndStep]]), SelectOneStep(b), GroupCountStep([VertexStep(OUT,edge), CountGlobalStep])]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>TinkerGraphStepStrategy</code> pulls in <code>has()</code>-step predicates for global, graph-centric index lookups.</p>
</li>
<li>
<p><code>FilterRankStrategy</code> sorts filter steps by their time/space execution costs.</p>
</li>
<li>
<p><code>InlineFilterStrategy</code> de-nests filters to increase the likelihood of filter concatenation and aggregation.</p>
</li>
<li>
<p><code>InlineFilterStrategy</code> pulls out named predicates from <code>match()</code>-step to more easily allow provider strategies to use indices.</p>
</li>
<li>
<p><code>RepeatUnrollStrategy</code> will unroll loops and <code>IncidentToAdjacentStrategy</code> will turn <code>outE().inV()</code>-patterns into <code>out()</code>.</p>
</li>
<li>
<p><code>MatchPredicateStrategy</code> will pull in <code>where()</code>-steps so that they can be subjected to <code>match()</code>-steps runtime query optimizer.</p>
</li>
<li>
<p><code>RangeByIsCountStrategy</code> will limit the traversal to only the number of traversers required for the <code>count().is(x)</code>-check.</p>
</li>
<li>
<p><code>PathRetractionStrategy</code> will remove paths from the traversers and increase the likelihood of bulking as path data is not required after <code>select('b')</code>.</p>
</li>
<li>
<p><code>AdjacentToIncidentStrategy</code> will turn <code>out()</code> into <code>outE()</code> to increase data access locality.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A collection of useful <code>DecorationStrategy</code> strategies are provided with TinkerPop3 and are generally useful to
end-users.  The following sub-sections detail these strategies:</p>
</div>
<div class="sect2">
<h3 id="_elementidstrategy">ElementIdStrategy</h3>
<div class="paragraph">
<p><code>ElementIdStrategy</code> provides control over element identifiers. Some Graph implementations, such as TinkerGraph,
allow specification of custom identifiers when creating elements:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = TinkerGraph.open().traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; v = g.addV().property(id,<span class="string"><span class="delimiter">'</span><span class="content">42a</span><span class="delimiter">'</span></span>).next()
==&gt;v[<span class="integer">42</span>a]
gremlin&gt; g.V(<span class="string"><span class="delimiter">'</span><span class="content">42a</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">42</span>a]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Other <code>Graph</code> implementations, such as Neo4j, generate element identifiers automatically and cannot be assigned.
As a helper, <code>ElementIdStrategy</code> can be used to make identifier assignment possible by using vertex and edge indicies
under the hood.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; strategy = ElementIdStrategy.build().create()
==&gt;ElementIdStrategy
gremlin&gt; g = graph.traversal().withStrategies(strategy)
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.addV().property(id, <span class="string"><span class="delimiter">'</span><span class="content">42a</span><span class="delimiter">'</span></span>).id()
==&gt;<span class="integer">42</span>a</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The key that is used to store the assigned identifier should be indexed in the underlying graph
database. If it is not indexed, then lookups for the elements that use these identifiers will perform a linear scan.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_eventstrategy">EventStrategy</h3>
<div class="paragraph">
<p>The purpose of the <code>EventStrategy</code> is to raise events to one or more <code>MutationListener</code> objects as changes to the
underlying <code>Graph</code> occur within a <code>Traversal</code>. Such a strategy is useful for logging changes, triggering certain
actions based on change, or any application that needs notification of some mutating operation during a <code>Traversal</code>.
If the transaction is rolled back, the event queue is reset.</p>
</div>
<div class="paragraph">
<p>The following events are raised to the <code>MutationListener</code>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>New vertex</p>
</li>
<li>
<p>New edge</p>
</li>
<li>
<p>Vertex property changed</p>
</li>
<li>
<p>Edge property changed</p>
</li>
<li>
<p>Vertex property removed</p>
</li>
<li>
<p>Edge property removed</p>
</li>
<li>
<p>Vertex removed</p>
</li>
<li>
<p>Edge removed</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To start processing events from a <code>Traversal</code> first implement the <code>MutationListener</code> interface. An example of this
implementation is the <code>ConsoleMutationListener</code> which writes output to the console for each event.  The following
console session displays the basic usage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; l = <span class="keyword">new</span> ConsoleMutationListener(graph)
==&gt;MutationListener[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]]
gremlin&gt; strategy = EventStrategy.build().addListener(l).create()
==&gt;EventStrategy
gremlin&gt; g = graph.traversal().withStrategies(strategy)
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.addV().property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">stephen</span><span class="delimiter">'</span></span>)
Vertex [v[<span class="integer">13</span>]] added to graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">6</span>]]
==&gt;v[<span class="integer">13</span>]
gremlin&gt; g.E().drop()
Edge [e[<span class="integer">7</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">2</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">6</span>]]
Edge [e[<span class="integer">8</span>][<span class="integer">1</span>-knows-&gt;<span class="integer">4</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">5</span>]]
Edge [e[<span class="integer">9</span>][<span class="integer">1</span>-created-&gt;<span class="integer">3</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">4</span>]]
Edge [e[<span class="integer">10</span>][<span class="integer">4</span>-created-&gt;<span class="integer">5</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">3</span>]]
Edge [e[<span class="integer">11</span>][<span class="integer">4</span>-created-&gt;<span class="integer">3</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">2</span>]]
Edge [e[<span class="integer">12</span>][<span class="integer">6</span>-created-&gt;<span class="integer">3</span>]] removed from graph [tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">1</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default, the <code>EventStrategy</code> is configured with an <code>EventQueue</code> that raises events as they occur within execution
of a <code>Step</code>.  As such, the final line of Gremlin execution that drops all edges shows a bit of an inconsistent count,
where the removed edge count is accounted for after the event is raised.  The strategy can also be configured with a
<code>TransactionalEventQueue</code> that captures the changes within a transaction and does not allow them to fire until the
transaction is committed.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>EventStrategy</code> is not meant for usage in tracking global mutations across separate processes.  In other
words, a mutation in one JVM process is not raised as an event in a different JVM process.  In addition, events are
not raised when mutations occur outside of the <code>Traversal</code> context.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_partitionstrategy">PartitionStrategy</h3>
<div class="imageblock">
<div class="content">
<img src="../images/partition-graph.png" alt="partition graph" width="325">
</div>
</div>
<div class="paragraph">
<p><code>PartitionStrategy</code> partitions the vertices and edges of a graph into <code>String</code> named partitions (i.e. buckets,
subgraphs, etc.). The idea behind <code>PartitionStrategy</code> is presented in the image above where each element is in a
single partition (represented by its color). Partitions can be read from, written to, and linked/joined by edges
that span one or two partitions (e.g. a tail vertex in one partition and a head vertex in another).</p>
</div>
<div class="paragraph">
<p>There are three primary configurations in <code>PartitionStrategy</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Partition Key - The property key that denotes a String value representing a partition.</p>
</li>
<li>
<p>Write Partition - A <code>String</code> denoting what partition all future written elements will be in.</p>
</li>
<li>
<p>Read Partitions - A <code>Set&lt;String&gt;</code> of partitions that can be read from.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The best way to understand <code>PartitionStrategy</code> is via example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; strategyA = PartitionStrategy.build().partitionKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">_partition</span><span class="delimiter">&quot;</span></span>).writePartition(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).readPartitions(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).create()
==&gt;PartitionStrategy
gremlin&gt; strategyB = PartitionStrategy.build().partitionKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">_partition</span><span class="delimiter">&quot;</span></span>).writePartition(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).readPartitions(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).create()
==&gt;PartitionStrategy
gremlin&gt; gA = graph.traversal().withStrategies(strategyA)
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; gA.addV() <span class="comment">// this vertex has a property of {_partition:&quot;a&quot;}</span>
==&gt;v[<span class="integer">13</span>]
gremlin&gt; gB = graph.traversal().withStrategies(strategyB)
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">7</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; gB.addV() <span class="comment">// this vertex has a property of {_partition:&quot;b&quot;}</span>
==&gt;v[<span class="integer">15</span>]
gremlin&gt; gA.V()
==&gt;v[<span class="integer">13</span>]
gremlin&gt; gB.V()
==&gt;v[<span class="integer">15</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Partitions may also extend to <code>VertexProperty</code> elements if the <code>Graph</code> can support meta-properties and if the
<code>includeMetaProperties</code> value is set to <code>true</code> when the <code>PartitionStrategy</code> is built.  The <code>partitionKey</code> will be
stored in the meta-properties of the <code>VertexProperty</code> and blind the traversal to those properties.  Please note that
the <code>VertexProperty</code> will only be hidden by way of the <code>Traversal</code> itself.  For example, calling <code>Vertex.property(k)</code>
bypasses the context of the <code>PartitionStrategy</code> and will thus allow all properties to be accessed.</p>
</div>
<div class="paragraph">
<p>By writing elements to particular partitions and then restricting read partitions, the developer is able to create
multiple graphs within a single address space. Moreover, by supporting references between partitions, it is possible
to merge those multiple graphs (i.e. join partitions).</p>
</div>
</div>
<div class="sect2">
<h3 id="_readonlystrategy">ReadOnlyStrategy</h3>
<div class="paragraph">
<p><code>ReadOnlyStrategy</code> is largely self-explanatory.  A <code>Traversal</code> that has this strategy applied will throw an
<code>IllegalStateException</code> if the <code>Traversal</code> has any mutating steps within it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_subgraphstrategy">SubgraphStrategy</h3>
<div class="paragraph">
<p><code>SubgraphStrategy</code> is similar to <code>PartitionStrategy</code> in that it constrains a <code>Traversal</code> to certain vertices, edges,
 and vertex properties as determined by a <code>Traversal</code>-based criterion defined individually for each.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createTheCrew()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>], standard]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by()
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:san diego]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:santa cruz]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:brussels]
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:santa fe]
==&gt;[<span class="key">a</span>:stephen,<span class="key">b</span>:centreville]
==&gt;[<span class="key">a</span>:stephen,<span class="key">b</span>:dulles]
==&gt;[<span class="key">a</span>:stephen,<span class="key">b</span>:purcellville]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:bremen]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:baltimore]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:oakland]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:seattle]
==&gt;[<span class="key">a</span>:daniel,<span class="key">b</span>:spremberg]
==&gt;[<span class="key">a</span>:daniel,<span class="key">b</span>:kaiserslautern]
==&gt;[<span class="key">a</span>:daniel,<span class="key">b</span>:aachen]
gremlin&gt; g = g.withStrategies(SubgraphStrategy.build().vertexProperties(hasNot(<span class="string"><span class="delimiter">'</span><span class="content">endTime</span><span class="delimiter">'</span></span>)).create()) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>], standard]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>). <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by()
==&gt;[<span class="key">a</span>:marko,<span class="key">b</span>:santa fe]
==&gt;[<span class="key">a</span>:stephen,<span class="key">b</span>:purcellville]
==&gt;[<span class="key">a</span>:matthias,<span class="key">b</span>:seattle]
==&gt;[<span class="key">a</span>:daniel,<span class="key">b</span>:aachen]
gremlin&gt; g.V().as(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).as(<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).
           select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">b</span><span class="delimiter">'</span></span>).by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).by().explain()
==&gt;Traversal Explanation
========================================================================================================================================================================================================================================
Original Traversal                 [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],value)<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]

SubgraphStrategy             [D]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
ConnectiveStrategy           [D]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
RepeatUnrollStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
MatchPredicateStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
PathRetractionStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
RangeByIsCountStrategy       [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
IncidentToAdjacentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
FilterRankingStrategy        [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), TraversalFilterStep([NotStep([PropertiesStep([endTime],value)])]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
InlineFilterStrategy         [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],value)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
AdjacentToIncidentStrategy   [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
LazyBarrierStrategy          [O]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
TinkerGraphCountStrategy     [P]   [GraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
TinkerGraphStepStrategy      [P]   [TinkerGraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
ProfileStrategy              [F]   [TinkerGraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]
StandardVerificationStrategy [V]   [TinkerGraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]

Final Traversal                    [TinkerGraphStep(vertex,<span class="type">[]</span>)<span class="error">@</span>[a], PropertiesStep([location],property), NotStep([PropertiesStep([endTime],property)]), PropertyValueStep<span class="error">@</span>[b], SelectStep([a, b],[value(name), identity])]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Get all vertices and their vertex property locations.</p>
</li>
<li>
<p>Create a <code>SubgraphStrategy</code> where vertex properties must not have an <code>endTime</code>-property (thus, the current location).</p>
</li>
<li>
<p>Get all vertices and their current vertex property locations.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This strategy is implemented such that the vertices attached to an <code>Edge</code> must both satisfy the vertex criterion
(if present) in order for the <code>Edge</code> to be considered a part of the subgraph.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The example below uses all three filters: vertex, edge, and vertex property. People vertices must have lived in more than three places,
edges must be labeled "develops," and vertex properties must be the persons current location or a non-location property.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createTheCrew()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>]
gremlin&gt; g = graph.traversal().withStrategies(SubgraphStrategy.build().
           vertices(or(hasNot(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>),properties(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>).count().is(gt(<span class="integer">3</span>)))).
           edges(hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">develops</span><span class="delimiter">'</span></span>)).
           vertexProperties(or(hasLabel(neq(<span class="string"><span class="delimiter">'</span><span class="content">location</span><span class="delimiter">'</span></span>)),hasNot(<span class="string"><span class="delimiter">'</span><span class="content">endTime</span><span class="delimiter">'</span></span>))).create())
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>], standard]
gremlin&gt; g.V().valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">location</span>:[santa fe],<span class="key">id</span>:<span class="integer">1</span>]
==&gt;[<span class="key">name</span>:[matthias],<span class="key">label</span>:person,<span class="key">location</span>:[seattle],<span class="key">id</span>:<span class="integer">8</span>]
==&gt;[<span class="key">name</span>:[gremlin],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">10</span>]
==&gt;[<span class="key">name</span>:[tinkergraph],<span class="key">label</span>:software,<span class="key">id</span>:<span class="integer">11</span>]
gremlin&gt; g.E().valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">label</span>:develops,<span class="key">id</span>:<span class="integer">13</span>,<span class="key">since</span>:<span class="integer">2009</span>]
==&gt;[<span class="key">label</span>:develops,<span class="key">id</span>:<span class="integer">14</span>,<span class="key">since</span>:<span class="integer">2010</span>]
==&gt;[<span class="key">label</span>:develops,<span class="key">id</span>:<span class="integer">21</span>,<span class="key">since</span>:<span class="integer">2012</span>]
gremlin&gt; g.V().outE().inV().
           path().
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).
             by().
             by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[marko,e[<span class="integer">13</span>][<span class="integer">1</span>-develops-&gt;<span class="integer">10</span>],gremlin]
==&gt;[marko,e[<span class="integer">14</span>][<span class="integer">1</span>-develops-&gt;<span class="integer">11</span>],tinkergraph]
==&gt;[matthias,e[<span class="integer">21</span>][<span class="integer">8</span>-develops-&gt;<span class="integer">10</span>],gremlin]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="dsl">Domain Specific Languages</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gremlin is a <a href="http://en.wikipedia.org/wiki/Domain-specific_language">domain specific language</a> (DSL) for traversing
graphs. It operates in the language of vertices, edges and properties. Typically, applications built with Gremlin are
not of the graph domain, but instead model their domain within a graph. For example, the
<a href="http://tinkerpop.apache.org/docs/current/images/tinkerpop-modern.png">"modern" toy graph</a> models
software and person domain objects with the relationships between them (i.e. a person "knows" another person and a
person "created" software).</p>
</div>
<div class="paragraph">
<p>An analyst who wanted to find out if "marko" knows "josh" could write the following Gremlin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).
  out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>).hasNext()</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this method achieves the desired answer, it requires the analyst to traverse the graph in the domain language
of the graph rather than the domain language of the social network. A more natural way for the analyst to write this
traversal might be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.persons(<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).knows(<span class="string"><span class="delimiter">'</span><span class="content">josh</span><span class="delimiter">'</span></span>).hasNext()</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the statement above, the traversal is written in the language of the domain, abstracting away the underlying
graph structure from the query. The two traversal results are equivalent and, indeed, the "Social DSL" produces
the same set of traversal steps as the "Graph DSL" thus producing equivalent strategy application and performance
runtimes.</p>
</div>
<div class="paragraph">
<p>To further the example of the Social DSL consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Graph DSL - find the number of persons who created at least 2 projects</span>
g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).
  where(outE(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).count().is(P.gte(<span class="integer">2</span>))).count()

<span class="comment">// Social DSL - find the number of persons who created at least 2 projects</span>
social.persons().where(createdAtLeast(<span class="integer">2</span>)).count()

<span class="comment">// Graph DSL - determine the age of the youngest friend &quot;marko&quot; has</span>
g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).
  out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>).min()

<span class="comment">// Social DSL - determine the age of the youngest friend &quot;marko&quot; has</span>
social.persons(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).youngestFriendsAge()</code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sections explain how to develop application specific DSLs for different <a href="#gremlin-variants">Gremlin Language Variants</a>
using the examples above of the Social DSL as the API for the implementation.</p>
</div>
<div class="sect2">
<h3 id="gremlin-java-dsl">Gremlin-Java</h3>
<div class="paragraph">
<p>Creating a DSL in Java requires the <code>@GremlinDsl</code> Java annotation in <code>gremlin-core</code>. This annotation should be applied
to a "DSL interface" that extends <code>GraphTraversal.Admin</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GremlinDsl</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SocialTraversalDsl</span>&lt;S, E&gt; <span class="directive">extends</span> GraphTraversal.Admin&lt;S, E&gt; {
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The name of the DSL interface should be suffixed with "TraversalDSL". All characters in the interface name
before that become the "name" of the DSL.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this interface, define the methods that the DSL will be composed of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GremlinDsl</span>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SocialTraversalDsl</span>&lt;S, E&gt; <span class="directive">extends</span> GraphTraversal.Admin&lt;S, E&gt; {
    <span class="directive">public</span> <span class="keyword">default</span> GraphTraversal&lt;S, Vertex&gt; knows(<span class="predefined-type">String</span> personName) {
        <span class="keyword">return</span> out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, personName);
    }

    <span class="directive">public</span> <span class="keyword">default</span> &lt;E2 <span class="directive">extends</span> <span class="predefined-type">Number</span>&gt; GraphTraversal&lt;S, E2&gt; youngestFriendsAge() {
        <span class="keyword">return</span> out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>).min();
    }

    <span class="directive">public</span> <span class="keyword">default</span> GraphTraversal&lt;S, <span class="predefined-type">Long</span>&gt; createdAtLeast(<span class="type">int</span> number) {
        <span class="keyword">return</span> outE(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).count().is(P.gte(number));
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Follow the TinkerPop convention of using <code>&lt;S,E&gt;</code> in naming generics as those conventions are taken into
account when generating the anonymous traversal class.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>@GremlinDsl</code> annotation is used by the <a href="https://docs.oracle.com/javase/8/docs/api/index.html?javax/annotation/processing/Processor.html">Java Annotation Processor</a>
to generate the boilerplate class structure required to properly use the DSL within the TinkerPop framework. These
classes can be generated and maintained by hand, but it would be time consuming, monotonous and error-prone to do so.
Typically, the Java compilation process is automatically configured to detect annotation processors on the classpath
and will automatically use them when found. If that does not happen, it may be necessary to make configuration changes
to the build to allow for the compilation process to be aware of the following <code>javax.annotation.processing.Processor</code>
implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.apache.tinkerpop.gremlin.process.traversal.dsl.GremlinDslProcessor</code></pre>
</div>
</div>
<div class="paragraph">
<p>The annotation processor will generate several classes for the DSL:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SocialTraversal</code> - A <code>Traversal</code> interface that extends the <code>SocialTraversalDsl</code> proxying methods to its underlying
interfaces (such as <code>GraphTraversal</code>) to instead return a <code>SocialTraversal</code></p>
</li>
<li>
<p><code>DefaultSocialTraversal</code> - A default implementation of <code>SocialTraversal</code> (typically not used directly by the user)</p>
</li>
<li>
<p><code>SocialTraversalSource</code> - Spawns <code>DefaultSocialTraversal</code> instances.</p>
</li>
<li>
<p><code>__</code> - Spawns anonymous <code>DefaultSocialTraversal</code> instances.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Using the DSL then just involves telling the <code>Graph</code> to use it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SocialTraversalSource social = graph.traversal(SocialTraversalSource.class);
social.V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).knows(<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SocialTraversalSource</code> can also be customized with DSL functions. As an additional step, include a class that
extends from <code>GraphTraversalSource</code> and with a name that is suffixed with "TraversalSourceDsl". Include in this class,
any custom methods required by the DSL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SocialTraversalSourceDsl</span> <span class="directive">extends</span> GraphTraversalSource {

    <span class="directive">public</span> SocialTraversalSourceDsl(<span class="directive">final</span> Graph graph, <span class="directive">final</span> TraversalStrategies traversalStrategies) {
        <span class="local-variable">super</span>(graph, traversalStrategies);
    }

    <span class="directive">public</span> SocialTraversalSourceDsl(<span class="directive">final</span> Graph graph) {
        <span class="local-variable">super</span>(graph);
    }

    <span class="directive">public</span> GraphTraversal&lt;Vertex, Vertex&gt; persons(<span class="predefined-type">String</span>... names) {
        GraphTraversalSource clone = <span class="local-variable">this</span>.clone();

        <span class="comment">// Manually add a &quot;start&quot; step for the traversal in this case the equivalent of V(). GraphStep is marked</span>
        <span class="comment">// as a &quot;start&quot; step by passing &quot;true&quot; in the constructor.</span>
        clone.getBytecode().addStep(GraphTraversal.Symbols.V);
        GraphTraversal&lt;Vertex, Vertex&gt; traversal = <span class="keyword">new</span> DefaultGraphTraversal&lt;&gt;(clone);
        traversal.asAdmin().addStep(<span class="keyword">new</span> GraphStep&lt;&gt;(traversal.asAdmin(), Vertex.class, <span class="predefined-constant">true</span>));

        traversal = traversal.hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>);
        <span class="keyword">if</span> (names.length &gt; <span class="integer">0</span>) traversal = traversal.has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, P.within(names));

        <span class="keyword">return</span> traversal;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then, back in the <code>SocialTraversal</code> interface, update the <code>GremlinDsl</code> annotation with the <code>traversalSource</code> argument
to point to the fully qualified class name of the <code>SocialTraversalSourceDsl</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@GremlinDsl</span>(traversalSource = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.company.SocialTraversalSourceDsl</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">interface</span> <span class="class">SocialTraversalDsl</span>&lt;S, E&gt; <span class="directive">extends</span> GraphTraversal.Admin&lt;S, E&gt; {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is then possible to use the <code>persons()</code> method to start traversals:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SocialTraversalSource social = graph.traversal(SocialTraversalSource.class);
social.persons(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).knows(<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using Maven, as shown in the <code>gremlin-archetype-dsl</code> module, makes developing DSLs with the annotation processor
straightforward in that it sets up appropriate paths to the generated code automatically.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_gremlin_python">Gremlin-Python</h3>
<div class="paragraph">
<p>Writing a Gremlin DSL in Python simply requires direct extension of several classes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>GraphTraversal</code> - which exposes the various steps used in traversal writing</p>
</li>
<li>
<p><code>__</code> - which spawns anonymous traversals from steps</p>
</li>
<li>
<p><code>GraphTraversalSource</code> - which spawns <code>GraphTraversal</code> instances</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Social DSL based on the <a href="http://tinkerpop.apache.org/docs/current/images/tinkerpop-modern.png">"modern" toy graph</a>
might look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">SocialTraversal</span>(GraphTraversal):

    <span class="keyword">def</span> <span class="function">knows</span>(<span class="predefined-constant">self</span>, person_name):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, person_name)

    <span class="keyword">def</span> <span class="function">youngestFriendsAge</span>(<span class="predefined-constant">self</span>):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>).min()

    <span class="keyword">def</span> <span class="function">createdAtLeast</span>(<span class="predefined-constant">self</span>, number):
        <span class="keyword">return</span> <span class="predefined-constant">self</span>.outE(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).count().is_(P.gte(number))

<span class="keyword">class</span> <span class="class">__</span>(AnonymousTraversal):
    <span class="decorator">@staticmethod</span>
    <span class="keyword">def</span> <span class="function">knows</span>(*args):
        <span class="keyword">return</span> SocialTraversal(<span class="predefined-constant">None</span>, <span class="predefined-constant">None</span>, Bytecode()).knows(*args)

    <span class="decorator">@staticmethod</span>
    <span class="keyword">def</span> <span class="function">youngestFriendsAge</span>(*args):
        <span class="keyword">return</span> SocialTraversal(<span class="predefined-constant">None</span>, <span class="predefined-constant">None</span>, Bytecode()).youngestFriendsAge(*args)

    <span class="decorator">@staticmethod</span>
    <span class="keyword">def</span> <span class="function">createdAtLeast</span>(*args):
        <span class="keyword">return</span> SocialTraversal(<span class="predefined-constant">None</span>, <span class="predefined-constant">None</span>, Bytecode()).createdAtLeast(*args)


<span class="keyword">class</span> <span class="class">SocialTraversalSource</span>(GraphTraversalSource):

    <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, *args, **kwargs):
        <span class="predefined">super</span>(SocialTraversalSource, <span class="predefined-constant">self</span>).__init__(*args, **kwargs)
        <span class="predefined-constant">self</span>.graph_traversal = SocialTraversal

    <span class="keyword">def</span> <span class="function">persons</span>(<span class="predefined-constant">self</span>, *args):
        traversal = <span class="predefined-constant">self</span>.get_graph_traversal()
        traversal.bytecode.add_step(<span class="string"><span class="delimiter">&quot;</span><span class="content">V</span><span class="delimiter">&quot;</span></span>)
        traversal.bytecode.add_step(<span class="string"><span class="delimiter">&quot;</span><span class="content">hasLabel</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">if</span> <span class="predefined">len</span>(args) &gt; <span class="integer">0</span>:
            traversal.bytecode.add_step(<span class="string"><span class="delimiter">&quot;</span><span class="content">has</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>, P.within(args))

        <span class="keyword">return</span> traversal</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>AnonymousTraversal</code> class above is just an alias for <code><em></code> as in
<code>from gremlin_python.process.graph_traversal import </em> as AnonymousTraversal</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Using the DSL is straightforward and just requires that the graph instance know the <code>SocialTraversalSource</code> should
be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">social = Graph().traversal(SocialTraversalSource).withRemote(DriverRemoteConnection(<span class="string"><span class="delimiter">'</span><span class="content">ws://localhost:8182/gremlin</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">g</span><span class="delimiter">'</span></span>))
social.persons(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).knows(<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>)
social.persons(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).youngestFriendsAge()
social.persons().filter(__.createdAtLeast(<span class="integer">2</span>)).count()</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="graphcomputer" class="sect0">The GraphComputer</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/graphcomputer-puffers.png" alt="graphcomputer puffers" width="350"></span> TinkerPop3 provides two primary means of interacting with a
graph: <a href="http://en.wikipedia.org/wiki/Online_transaction_processing">online transaction processing</a> (OLTP) and
<a href="http://en.wikipedia.org/wiki/Online_analytical_processing">online analytical processing</a> (OLAP). OLTP-based
graph systems allow the user to query the graph in real-time. However, typically, real-time performance is only
possible when a local traversal is enacted. A local traversal is one that starts at a particular vertex (or small set
of vertices) and touches a small set of connected vertices (by any arbitrary path of arbitrary length). In short, OLTP
queries interact with a limited set of data and respond on the order of milliseconds or seconds. On the other hand,
with OLAP graph processing, the entire graph is processed and thus, every vertex and edge is analyzed (some times
more than once for iterative, recursive algorithms). Due to the amount of data being processed, the results are
typically not returned in real-time and for massive graphs (i.e. graphs represented across a cluster of machines),
results can take on the order of minutes or hours.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OLTP</strong>: real-time, limited data accessed, random data access, sequential processing, querying</p>
</li>
<li>
<p><strong>OLAP</strong>: long running, entire data set accessed, sequential data access, parallel processing, batch processing</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/oltp-vs-olap.png" alt="oltp vs olap" width="600">
</div>
</div>
<div class="paragraph">
<p>The image above demonstrates the difference between Gremlin OLTP and Gremlin OLAP. With Gremlin OLTP, the graph is
walked by moving from vertex-to-vertex via incident edges. With Gremlin OLAP, all vertices are provided a
<code>VertexProgram</code>. The programs send messages to one another with the topological structure of the graph acting as the
communication network (though random message passing possible). In many respects, the messages passed are like
the OLTP traversers moving from vertex-to-vertex. However, all messages are moving independent of one another, in
parallel. Once a vertex program is finished computing, TinkerPop3&#8217;s OLAP engine supports any number
<a href="http://en.wikipedia.org/wiki/MapReduce"><code>MapReduce</code></a> jobs over the resultant graph.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>GraphComputer</code> was designed from the start to be used within a multi-JVM, distributed environment&#8201;&#8212;&#8201;in other words, a multi-machine compute cluster. As such, all the computing objects must be able to be migrated
between JVMs. The pattern promoted is to store state information in a <code>Configuration</code> object to later be regenerated
by a loading process. It is important to realize that <code>VertexProgram</code>, <code>MapReduce</code>, and numerous particular instances
rely heavily on the state of the computing classes (not the structure, but the processes) to be stored in a
<code>Configuration</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vertexprogram">VertexProgram</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/bsp-diagram.png" alt="bsp diagram" width="400"></span> GraphComputer takes a <code>VertexProgram</code>. A VertexProgram can be thought of
as a piece of code that is executed at each vertex in logically parallel manner until some termination condition is
met (e.g. a number of iterations have occurred, no more data is changing in the graph, etc.). A submitted
<code>VertexProgram</code> is copied to all the workers in the graph. A worker is not an explicit concept in the API, but is
assumed of all <code>GraphComputer</code> implementations. At minimum each vertex is a worker (though this would be inefficient
due to the fact that each vertex would maintain a VertexProgram). In practice, the workers partition the vertex set
and and are responsible for the execution of the VertexProgram over all the vertices within their sphere of influence.
The workers orchestrate the execution of the <code>VertexProgram.execute()</code> method on all their vertices in an
<a href="http://en.wikipedia.org/wiki/Bulk_synchronous_parallel">bulk synchronous parallel</a> (BSP) fashion. The vertices
are able to communicate with one another via messages. There are two kinds of messages in Gremlin OLAP:
<code>MessageScope.Local</code> and <code>MessageScope.Global</code>. A local message is a message to an adjacent vertex. A global
message is a message to any arbitrary vertex in the graph. Once the VertexProgram has completed its execution,
any number of <code>MapReduce</code> jobs are evaluated. MapReduce jobs are provided by the user via <code>GraphComputer.mapReduce()</code>
 or by the <code>VertexProgram</code> via <code>VertexProgram.getMapReducers()</code>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/graphcomputer.png" alt="graphcomputer" width="500">
</div>
</div>
<div class="paragraph">
<p>The example below demonstrates how to submit a VertexProgram to a graph&#8217;s GraphComputer. <code>GraphComputer.submit()</code>
yields a <code>Future&lt;ComputerResult&gt;</code>. The <code>ComputerResult</code> has the resultant computed graph which can be a full copy
of the original graph (see <a href="#hadoop-gremlin">Hadoop-Gremlin</a>) or a view over the original graph (see
<a href="#tinkergraph-gremlin">TinkerGraph</a>). The ComputerResult also provides access to computational side-effects called <code>Memory</code>
(which includes, for example, runtime, number of iterations, results of MapReduce jobs, and VertexProgram-specific
memory manipulations).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; result = graph.compute().program(PageRankVertexProgram.build().create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; result.memory().runtime
==&gt;<span class="integer">93</span>
gremlin&gt; g = result.graph().traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; g.V().valueMap()
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.4018125</span>],<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.23181250000000003</span>],<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This model of "vertex-centric graph computing" was made popular by Google&#8217;s
<a href="http://googleresearch.blogspot.com/2009/06/large-scale-graph-computing-at-google.html">Pregel</a> graph engine.
In the open source world, this model is found in OLAP graph computing systems such as <a href="https://giraph.apache.org/">Giraph</a>,
<a href="https://hama.apache.org/">Hama</a>. TinkerPop3 extends the
popularized model with integrated post-processing <a href="#mapreduce">MapReduce</a> jobs over the vertex set.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mapreduce">MapReduce</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The BSP model proposed by Pregel stores the results of the computation in a distributed manner as properties on the
elements in the graph. In many situations, it is necessary to aggregate those resultant properties into a single
result set (i.e. a statistic). For instance, assume a VertexProgram that computes a nominal cluster for each vertex
(i.e. <a href="http://en.wikipedia.org/wiki/Community_structure">a graph clustering algorithm</a>). At the end of the
computation, each vertex will have a property denoting the cluster it was assigned to. TinkerPop3 provides the
ability to answer global questions about the clusters. For instance, in order to answer the following questions,
<code>MapReduce</code> jobs are required:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>How many vertices are in each cluster? (<strong>presented below</strong>)</p>
</li>
<li>
<p>How many unique clusters are there? (<strong>presented below</strong>)</p>
</li>
<li>
<p>What is the average age of each vertex in each cluster?</p>
</li>
<li>
<p>What is the degree distribution of the vertices in each cluster?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A compressed representation of the <code>MapReduce</code> API in TinkerPop3 is provided below. The key idea is that the
<code>map</code>-stage processes all vertices to emit key/value pairs. Those values are aggregated on their respective key
for the <code>reduce</code>-stage to do its processing to ultimately yield more key/value pairs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">MapReduce</span>&lt;MK, MV, RK, RV, R&gt; {
  <span class="directive">public</span> <span class="type">void</span> map(<span class="directive">final</span> Vertex vertex, <span class="directive">final</span> MapEmitter&lt;MK, MV&gt; emitter);
  <span class="directive">public</span> <span class="type">void</span> reduce(<span class="directive">final</span> MK key, <span class="directive">final</span> <span class="predefined-type">Iterator</span>&lt;MV&gt; values, <span class="directive">final</span> ReduceEmitter&lt;RK, RV&gt; emitter);
  <span class="comment">// there are more methods</span>
}</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The vertex that is passed into the <code>MapReduce.map()</code> method does not contain edges. The vertex only
contains original and computed vertex properties. This reduces the amount of data required to be loaded and ensures
that MapReduce is used for post-processing computed results. All edge-based computing should be accomplished in the
<code>VertexProgram</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><span class="image"><img src="../images/mapreduce.png" alt="mapreduce" width="650"></span></p>
</div>
<div class="paragraph">
<p>The <code>MapReduce</code> extension to GraphComputer is made explicit when examining the
<a href="#peerpressurevertexprogram"><code>PeerPressureVertexProgram</code></a> and corresponding <code>ClusterPopulationMapReduce</code>.
In the code below, the GraphComputer result returns the computed on <code>Graph</code> as well as the <code>Memory</code> of the
computation (<code>ComputerResult</code>). The memory maintain the results of any MapReduce jobs. The cluster population
MapReduce result states that there are 5 vertices in cluster 1 and 1 vertex in cluster 6. This can be verified
(in a serial manner) by looking at the <code>PeerPressureVertexProgram.CLUSTER</code> property of the resultant graph. Notice
that the property is "hidden" unless it is directly accessed via name.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; result = graph.compute().program(PeerPressureVertexProgram.build().create()).mapReduce(ClusterPopulationMapReduce.build().create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>],memory[<span class="key">size</span>:<span class="integer">1</span>]]
gremlin&gt; result.memory().get(<span class="string"><span class="delimiter">'</span><span class="content">clusterPopulation</span><span class="delimiter">'</span></span>)
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span>
gremlin&gt; g = result.graph().traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; g.V().values(PeerPressureVertexProgram.CLUSTER).groupCount().next()
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span>
gremlin&gt; g.V().valueMap()
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">1</span>],<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">1</span>],<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">1</span>],<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">1</span>],<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">1</span>],<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[gremlin.peerPressureVertexProgram.cluster:[<span class="integer">6</span>],<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If there are numerous statistics desired, then its possible to register as many MapReduce jobs as needed. For
instance, the <code>ClusterCountMapReduce</code> determines how many unique clusters were created by the peer pressure algorithm.
Below both <code>ClusterCountMapReduce</code> and <code>ClusterPopulationMapReduce</code> are computed over the resultant graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; result = graph.compute().program(PeerPressureVertexProgram.build().create()).
                    mapReduce(ClusterPopulationMapReduce.build().create()).
                    mapReduce(ClusterCountMapReduce.build().create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>],memory[<span class="key">size</span>:<span class="integer">2</span>]]
gremlin&gt; result.memory().clusterPopulation
==&gt;<span class="integer">1</span>=<span class="integer">5</span>
==&gt;<span class="integer">6</span>=<span class="integer">1</span>
gremlin&gt; result.memory().clusterCount
==&gt;<span class="integer">2</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The MapReduce model of TinkerPop3 does not support MapReduce chaining. Thus, the order in which the
MapReduce jobs are executed is irrelevant. This is made apparent when realizing that the <code>map()</code>-stage takes a
<code>Vertex</code> as its input and the <code>reduce()</code>-stage yields key/value pairs. Thus, the results of reduce can not fed back
into a <code>map()</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_a_collection_of_vertexprograms">A Collection of VertexPrograms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TinkerPop3 provides a collection of VertexPrograms that implement common algorithms. This section discusses the various implementations.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The vertex programs presented are what are provided as of TinkerPop 3.2.6. Over time, with future releases,
more algorithms will be added.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="pagerankvertexprogram">PageRankVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-pagerank.png" alt="gremlin pagerank" width="400"></span> <a href="http://en.wikipedia.org/wiki/PageRank">PageRank</a> is perhaps the
most popular OLAP-oriented graph algorithm. This <a href="http://en.wikipedia.org/wiki/Centrality">eigenvector centrality</a>
variant was developed by Brin and Page of Google. PageRank defines a centrality value for all vertices in the graph,
where centrality is defined recursively where a vertex is central if it is connected to central vertices. PageRank is
an iterative algorithm that converges to a <a href="http://en.wikipedia.org/wiki/Ergodicity">steady state distribution</a>. If
the pageRank values are normalized to 1.0, then the pageRank value of a vertex is the probability that a random walker
will be seen that that vertex in the graph at any arbitrary moment in time. In order to help developers understand the
methods of a <code>VertexProgram</code>, the PageRankVertexProgram code is analyzed below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">PageRankVertexProgram</span> <span class="directive">implements</span> VertexProgram&lt;<span class="predefined-type">Double</span>&gt; {  <span class="invisible">//</span><b class="conum">1</b>

    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PAGE_RANK = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.pageRank</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> EDGE_COUNT = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.edgeCount</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> PROPERTY = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.property</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> VERTEX_COUNT = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.vertexCount</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> ALPHA = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.alpha</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> TOTAL_ITERATIONS = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.totalIterations</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> EDGE_TRAVERSAL = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.edgeTraversal</span><span class="delimiter">&quot;</span></span>;
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> INITIAL_RANK_TRAVERSAL = <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.initialRankTraversal</span><span class="delimiter">&quot;</span></span>;

    <span class="directive">private</span> MessageScope.Local&lt;<span class="predefined-type">Double</span>&gt; incidentMessageScope = MessageScope.Local.of(__::outE); <span class="invisible">//</span><b class="conum">2</b>
    <span class="directive">private</span> MessageScope.Local&lt;<span class="predefined-type">Double</span>&gt; countMessageScope = MessageScope.Local.of(<span class="keyword">new</span> MessageScope.Local.ReverseTraversalSupplier(<span class="local-variable">this</span>.incidentMessageScope));
    <span class="directive">private</span> PureTraversal&lt;Vertex, Edge&gt; edgeTraversal = <span class="predefined-constant">null</span>;
    <span class="directive">private</span> PureTraversal&lt;Vertex, ? <span class="directive">extends</span> <span class="predefined-type">Number</span>&gt; initialRankTraversal = <span class="predefined-constant">null</span>;
    <span class="directive">private</span> <span class="type">double</span> vertexCountAsDouble = <span class="float">1.0d</span>;
    <span class="directive">private</span> <span class="type">double</span> alpha = <span class="float">0.85d</span>;
    <span class="directive">private</span> <span class="type">int</span> totalIterations = <span class="integer">30</span>;
    <span class="directive">private</span> <span class="predefined-type">String</span> property = PAGE_RANK; <span class="invisible">//</span><b class="conum">3</b>
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;VertexComputeKey&gt; vertexComputeKeys;

    <span class="directive">private</span> PageRankVertexProgram() {

    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> loadState(<span class="directive">final</span> Graph graph, <span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) { <span class="invisible">//</span><b class="conum">4</b>
        <span class="keyword">if</span> (configuration.containsKey(INITIAL_RANK_TRAVERSAL))
            <span class="local-variable">this</span>.initialRankTraversal = PureTraversal.loadState(configuration, INITIAL_RANK_TRAVERSAL, graph);
        <span class="keyword">if</span> (configuration.containsKey(EDGE_TRAVERSAL)) {
            <span class="local-variable">this</span>.edgeTraversal = PureTraversal.loadState(configuration, EDGE_TRAVERSAL, graph);
            <span class="local-variable">this</span>.incidentMessageScope = MessageScope.Local.of(() -&gt; <span class="local-variable">this</span>.edgeTraversal.get().clone());
            <span class="local-variable">this</span>.countMessageScope = MessageScope.Local.of(<span class="keyword">new</span> MessageScope.Local.ReverseTraversalSupplier(<span class="local-variable">this</span>.incidentMessageScope));
        }
        <span class="local-variable">this</span>.vertexCountAsDouble = configuration.getDouble(VERTEX_COUNT, <span class="float">1.0d</span>);
        <span class="local-variable">this</span>.alpha = configuration.getDouble(ALPHA, <span class="float">0.85d</span>);
        <span class="local-variable">this</span>.totalIterations = configuration.getInt(TOTAL_ITERATIONS, <span class="integer">30</span>);
        <span class="local-variable">this</span>.property = configuration.getString(PROPERTY, PAGE_RANK);
        <span class="local-variable">this</span>.vertexComputeKeys = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;(<span class="predefined-type">Arrays</span>.asList(VertexComputeKey.of(<span class="local-variable">this</span>.property, <span class="predefined-constant">false</span>), VertexComputeKey.of(EDGE_COUNT, <span class="predefined-constant">true</span>))); <span class="invisible">//</span><b class="conum">5</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> storeState(<span class="directive">final</span> <span class="predefined-type">Configuration</span> configuration) {
        VertexProgram.super.storeState(configuration);
        configuration.setProperty(VERTEX_COUNT, <span class="local-variable">this</span>.vertexCountAsDouble);
        configuration.setProperty(ALPHA, <span class="local-variable">this</span>.alpha);
        configuration.setProperty(TOTAL_ITERATIONS, <span class="local-variable">this</span>.totalIterations);
        configuration.setProperty(PROPERTY, <span class="local-variable">this</span>.property);
        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.edgeTraversal)
            <span class="local-variable">this</span>.edgeTraversal.storeState(configuration, EDGE_TRAVERSAL);
        <span class="keyword">if</span> (<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.initialRankTraversal)
            <span class="local-variable">this</span>.initialRankTraversal.storeState(configuration, INITIAL_RANK_TRAVERSAL);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> GraphComputer.ResultGraph getPreferredResultGraph() {
        <span class="keyword">return</span> GraphComputer.ResultGraph.NEW;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> GraphComputer.Persist getPreferredPersist() {
        <span class="keyword">return</span> GraphComputer.Persist.VERTEX_PROPERTIES;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;VertexComputeKey&gt; getVertexComputeKeys() {   <span class="invisible">//</span><b class="conum">6</b>
        <span class="keyword">return</span> <span class="local-variable">this</span>.vertexComputeKeys;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Optional&lt;MessageCombiner&lt;<span class="predefined-type">Double</span>&gt;&gt; getMessageCombiner() {
        <span class="keyword">return</span> (Optional) PageRankMessageCombiner.instance();
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;MessageScope&gt; getMessageScopes(<span class="directive">final</span> Memory memory) {
        <span class="directive">final</span> <span class="predefined-type">Set</span>&lt;MessageScope&gt; set = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;&gt;();
        set.add(memory.isInitialIteration() ? <span class="local-variable">this</span>.countMessageScope : <span class="local-variable">this</span>.incidentMessageScope);
        <span class="keyword">return</span> set;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> PageRankVertexProgram clone() {
        <span class="keyword">try</span> {
            <span class="directive">final</span> PageRankVertexProgram clone = (PageRankVertexProgram) <span class="local-variable">super</span>.clone();
            <span class="keyword">if</span> (<span class="predefined-constant">null</span> != <span class="local-variable">this</span>.initialRankTraversal)
                clone.initialRankTraversal = <span class="local-variable">this</span>.initialRankTraversal.clone();
            <span class="keyword">return</span> clone;
        } <span class="keyword">catch</span> (<span class="directive">final</span> <span class="exception">CloneNotSupportedException</span> e) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">IllegalStateException</span>(e.getMessage(), e);
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setup(<span class="directive">final</span> Memory memory) {

    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> execute(<span class="directive">final</span> Vertex vertex, Messenger&lt;<span class="predefined-type">Double</span>&gt; messenger, <span class="directive">final</span> Memory memory) { <span class="invisible">//</span><b class="conum">7</b>
        <span class="keyword">if</span> (memory.isInitialIteration()) {
            messenger.sendMessage(<span class="local-variable">this</span>.countMessageScope, <span class="float">1.0d</span>); <span class="invisible">//</span><b class="conum">8</b>
        } <span class="keyword">else</span> <span class="keyword">if</span> (<span class="integer">1</span> == memory.getIteration()) {
            <span class="type">double</span> initialPageRank = (<span class="predefined-constant">null</span> == <span class="local-variable">this</span>.initialRankTraversal ?
                    <span class="float">1.0d</span> :
                    TraversalUtil.apply(vertex, <span class="local-variable">this</span>.initialRankTraversal.get()).doubleValue()) / <span class="local-variable">this</span>.vertexCountAsDouble;  <span class="invisible">//</span><b class="conum">9</b>
            <span class="type">double</span> edgeCount = IteratorUtils.reduce(messenger.receiveMessages(), <span class="float">0.0d</span>, (a, b) -&gt; a + b);
            vertex.property(VertexProperty.Cardinality.single, <span class="local-variable">this</span>.property, initialPageRank);
            vertex.property(VertexProperty.Cardinality.single, EDGE_COUNT, edgeCount);
            <span class="keyword">if</span> (!<span class="local-variable">this</span>.terminate(memory)) <span class="comment">// don't send messages if this is the last iteration</span>
                messenger.sendMessage(<span class="local-variable">this</span>.incidentMessageScope, initialPageRank / edgeCount);
        } <span class="keyword">else</span> {
            <span class="type">double</span> newPageRank = IteratorUtils.reduce(messenger.receiveMessages(), <span class="float">0.0d</span>, (a, b) -&gt; a + b); <span class="invisible">//</span><b class="conum">10</b>
            newPageRank = (<span class="local-variable">this</span>.alpha * newPageRank) + ((<span class="float">1.0d</span> - <span class="local-variable">this</span>.alpha) / <span class="local-variable">this</span>.vertexCountAsDouble);
            vertex.property(VertexProperty.Cardinality.single, <span class="local-variable">this</span>.property, newPageRank);
            <span class="keyword">if</span> (!<span class="local-variable">this</span>.terminate(memory)) <span class="comment">// don't send messages if this is the last iteration</span>
                messenger.sendMessage(<span class="local-variable">this</span>.incidentMessageScope, newPageRank / vertex.&lt;<span class="predefined-type">Double</span>&gt;value(EDGE_COUNT));
        }
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> terminate(<span class="directive">final</span> Memory memory) {
        <span class="keyword">return</span> memory.getIteration() &gt;= <span class="local-variable">this</span>.totalIterations;  <span class="invisible">//</span><b class="conum">11</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> StringFactory.vertexProgramString(<span class="local-variable">this</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">alpha=</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.alpha + <span class="string"><span class="delimiter">&quot;</span><span class="content">, iterations=</span><span class="delimiter">&quot;</span></span> + <span class="local-variable">this</span>.totalIterations);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p><code>PageRankVertexProgram</code> implements <code>VertexProgram&lt;Double&gt;</code> because the messages it sends are Java doubles.</p>
</li>
<li>
<p>The default path of energy propagation is via outgoing edges from the current vertex.</p>
</li>
<li>
<p>The resulting PageRank values for the vertices are stored as a vertex property.</p>
</li>
<li>
<p>A vertex program is constructed using an Apache <code>Configuration</code> to ensure easy dissemination across a cluster of JVMs.</p>
</li>
<li>
<p><code>EDGE_COUNT</code> is a transient "scratch data" compute key while <code>PAGE_RANK</code> is not.</p>
</li>
<li>
<p>A vertex program must define the "compute keys" that are the properties being operated on during the computation.</p>
</li>
<li>
<p>The "while"-loop of the vertex program.</p>
</li>
<li>
<p>In order to determine how to distribute the energy to neighbors, a "1"-count is used to determine how many incident vertices exist for the <code>MessageScope</code>.</p>
</li>
<li>
<p>Initially, each vertex is provided an equal amount of energy represented as a double.</p>
</li>
<li>
<p>Energy is aggregated, computed on according to the PageRank algorithm, and then disseminated according to the defined <code>MessageScope.Local</code>.</p>
</li>
<li>
<p>The computation is terminated after a pre-defined number of iterations.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The above <code>PageRankVertexProgram</code> is used as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; result = graph.compute().program(PageRankVertexProgram.build().create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; result.memory().runtime
==&gt;<span class="integer">44</span>
gremlin&gt; g = result.graph().traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; g.V().valueMap()
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.4018125</span>],<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.23181250000000003</span>],<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that <code>GraphTraversal</code> provides a <a href="#pagerank-step"><code>pageRank()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().pageRank().valueMap()
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.4018125</span>],<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.19250000000000003</span>],<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.23181250000000003</span>],<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[gremlin.pageRankVertexProgram.pageRank:[<span class="float">0.15000000000000002</span>],<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().pageRank().by(<span class="string"><span class="delimiter">'</span><span class="content">pageRank</span><span class="delimiter">'</span></span>).times(<span class="integer">5</span>).order().by(<span class="string"><span class="delimiter">'</span><span class="content">pageRank</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">pageRank</span>:[<span class="float">0.15000000000000002</span>],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">pageRank</span>:[<span class="float">0.15000000000000002</span>],<span class="key">age</span>:[<span class="integer">35</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">pageRank</span>:[<span class="float">0.19250000000000003</span>],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">pageRank</span>:[<span class="float">0.19250000000000003</span>],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java],<span class="key">pageRank</span>:[<span class="float">0.23181250000000003</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java],<span class="key">pageRank</span>:[<span class="float">0.4018125</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="peerpressurevertexprogram">PeerPressureVertexProgram</h3>
<div class="paragraph">
<p>The <code>PeerPressureVertexProgram</code> is a clustering algorithm that assigns a nominal value to each vertex in the graph.
The nominal value represents the vertex&#8217;s cluster. If two vertices have the same nominal value, then they are in the
same cluster. The algorithm proceeds in the following manner.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Every vertex assigns itself to a unique cluster ID (initially, its vertex ID).</p>
</li>
<li>
<p>Every vertex determines its per neighbor vote strength as 1.0d / incident edges count.</p>
</li>
<li>
<p>Every vertex sends its cluster ID and vote strength to its adjacent vertices as a <code>Pair&lt;Serializable,Double&gt;</code></p>
</li>
<li>
<p>Every vertex generates a vote energy distribution of received cluster IDs and changes its current cluster ID to the most frequent cluster ID.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>If there is a tie, then the cluster with the lowest <code>toString()</code> comparison is selected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Steps 3 and 4 repeat until either a max number of iterations has occurred or no vertex has adjusted its cluster anymore.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Note that <code>GraphTraversal</code> provides a <a href="#peerpressure-step"><code>peerPressure()</code></a>-step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().peerPressure().by(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java],<span class="key">cluster</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java],<span class="key">cluster</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">cluster</span>:[<span class="integer">6</span>],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; g.V().peerPressure().by(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>)).by(<span class="string"><span class="delimiter">'</span><span class="content">cluster</span><span class="delimiter">'</span></span>).valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java],<span class="key">cluster</span>:[<span class="integer">3</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">cluster</span>:[<span class="integer">1</span>],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java],<span class="key">cluster</span>:[<span class="integer">5</span>]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">cluster</span>:[<span class="integer">6</span>],<span class="key">age</span>:[<span class="integer">35</span>]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="bulkdumpervertexprogram">BulkDumperVertexProgram</h3>
<div class="paragraph">
<p>The <code>BulkDumperVertexProgram</code> can be used to export a whole graph in any of the provided Hadoop GraphOutputFormats (e.g.
<code>GraphSONOutputFormat</code>, <code>GryoOutputFormat</code> or <code>ScriptOutputFormat</code>). The input can be any Hadoop GraphInputFormat
(e.g. <code>GraphSONInputFormat</code>, <code>GryoInputFormat</code> or <code>ScriptInputFormat</code>). An <a href="#bulkdumpervertexprogramusingspark">example</a>
is provided in the SparkGraphComputer section.</p>
</div>
</div>
<div class="sect2">
<h3 id="bulkloadervertexprogram">BulkLoaderVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/batch-graph.png" alt="batch graph" width="220"></span> The <code>BulkLoaderVertexProgram</code> provides a generalized way for loading
graphs of any size into a persistent <code>Graph</code>. It is especially useful for large graphs (i.e. hundreds of millions
or billions of edges) as it can take advantage of the parallel processing offered by <code>GraphComputer</code> instances. The
input can be any existing <code>Graph</code> database supporting TinkerPop3 or any of the Hadoop GraphInputFormats (e.g.
<code>GraphSONInputFormat</code>, <code>GryoInputFormat</code> or <code>ScriptInputFormat</code>). The following example demonstrates how to load data
from one TinkerGraph to another:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; writeGraphConf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="integer">1068176</span>
gremlin&gt; writeGraphConf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.graph</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; writeGraphConf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.tinkergraph.graphFormat</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">gryo</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; writeGraphConf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.tinkergraph.graphLocation</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/tmp/tinkergraph.kryo</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; modern = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; blvp = BulkLoaderVertexProgram.build().
                    bulkLoader(OneTimeBulkLoader).
                    writeGraph(writeGraphConf).create(modern)
==&gt;BulkLoaderVertexProgram[bulkLoader=OneTimeBulkLoader, vertexIdProperty=<span class="predefined-constant">null</span>, userSuppliedIds=<span class="predefined-constant">false</span>, keepOriginalIds=<span class="predefined-constant">false</span>, batchSize=<span class="integer">0</span>]
gremlin&gt; modern.compute().workers(<span class="integer">1</span>).program(blvp).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; graph = GraphFactory.open(writeGraphConf)
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Available configuration options</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Builder Method</th>
<th class="tableblock halign-left valign-top">Purpose</th>
<th class="tableblock halign-left valign-top">Default Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bulkLoader(Class|String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the class of the bulk loader implementation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IncrementalBulkLoader</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>vertexIdProperty(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the name of the property in the target graph that holds the vertex id from the
source graph.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bulkLoader.vertex.id</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>keepOriginalIds(boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to keep the id&#8217;s from the source graph in the target graph or not. It&#8217;s
recommended to keep them if it&#8217;s planned to do further bulk loads using the same datasources.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>userSuppliedIds(boolean)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to use the id&#8217;s from the source graph as id&#8217;s in the target graph. If set to
<code>true</code>, <code>vertexIdProperty</code> will be ignored. Note, that the target graph must support user supplied identifiers.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>intermediateBatchSize(int)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the batch size for intermediate transactions. This is per thread in a
multi-threaded environment. 0 means that transactions will only be committed at the end of an iteration cycle.
It&#8217;s recommended to tune this property for the target graph and not use the default value of 0.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>writeGraph(String)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the path to a <code>GraphFactory</code> compatible configuration file for the target graph.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>BulkLoaderVertexProgram</code> uses the <code>IncrementalBulkLoader</code> by default. The other option is the <code>OneTimeBulkLoader</code>,
which doesn&#8217;t store any temporary IDs in the <code>writeGraph</code> and thus should only be used for initial bulk loads. Both
implementations should cover the majority of use-cases, but have a limitation though: They don&#8217;t support multi-valued
properties. <code>OneTimeBulkLoader</code> and <code>IncrementalBulkLoader</code> will handle every property as a single-valued property. A
custom <code>BulkLoader</code> implementation has to be used if the default behavior is not sufficient.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A custom <code>BulkLoader</code> implementation for incremental loading should use <code>GraphTraversal</code> methods to create/update
elements (e.g. <code>g.addV()</code> instead of <code>graph.addVertex()</code>). This way the <code>BulkLoaderVertexProgram</code> is able to efficiently
track changes in the underlying graph and can apply several optimization techniques.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Edges in the input graph must be present in both directions, e.g. from the source vertex to the target vertex
as an out-edge and from the target vertex to the source vertex as an in-edge. This is especially important if the input
graph is a <code>HadoopGraph</code>. <code>BulkLoaderVertexProgram</code> will likely fail with a <code>FastNoSuchElementException</code> if one of the
edges is missing.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="traversalvertexprogram">TraversalVertexProgram</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/traversal-vertex-program.png" alt="traversal vertex program" width="250"></span> The <code>TraversalVertexProgram</code> is a "special" VertexProgram in
that it can be executed via a <code>Traversal</code> and a <code>GraphComputer</code>. In Gremlin, it is possible to have
the same traversal executed using either the standard OLTP-engine or the <code>GraphComputer</code> OLAP-engine. The difference
being where the traversal is submitted.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This model of graph traversal in a BSP system was first implemented by the
<a href="https://github.com/thinkaurelius/faunus/wiki">Faunus</a> graph analytics engine and originally described in
<a href="http://markorodriguez.com/2011/04/19/local-and-distributed-traversal-engines/">Local and Distributed Traversal Engines</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.V().both().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount().next() <span class="comment">// OLTP</span>
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span>
gremlin&gt; g = graph.traversal().withComputer()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], graphcomputer]
gremlin&gt; g.V().both().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount().next() <span class="comment">// OLAP</span>
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/olap-traversal.png" alt="olap traversal" width="650">
</div>
</div>
<div class="paragraph">
<p>In the OLAP example above, a <code>TraversalVertexProgram</code> is (logically) sent to each vertex in the graph. Each instance
evaluation requires (logically) 5 BSP iterations and each iteration is interpreted as such:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>g.V()</code>: Put a traverser on each vertex in the graph.</p>
</li>
<li>
<p><code>both()</code>: Propagate each traverser to the vertices <code>both</code>-adjacent to its current vertex.</p>
</li>
<li>
<p><code>hasLabel('person')</code>: If the vertex is not a person, kill the traversers at that vertex.</p>
</li>
<li>
<p><code>values('age')</code>: Have all the traversers reference the integer age of their current vertex.</p>
</li>
<li>
<p><code>groupCount()</code>: Count how many times a particular age has been seen.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>While 5 iterations were presented, in fact, <code>TraversalVertexProgram</code> will execute the traversal in only
2 iterations. The reason being is that <code>g.V().both()</code> and <code>hasLabel('person').values('age').groupCount()</code> can be
executed in a single iteration as any message sent would simply be to the current executing vertex. Thus, a simple optimization
exists in Gremlin OLAP called "reflexive message passing" which simulates non-message-passing BSP iterations within a
single BSP iteration.</p>
</div>
<div class="paragraph">
<p>The same OLAP traversal can be executed using the standard <code>graph.compute()</code> model, though at the expense of verbosity.
<code>TraversalVertexProgram</code> provides a fluent <code>Builder</code> for constructing a <code>TraversalVertexProgram</code>. The specified
<code>traversal()</code> can be either a direct <code>Traversal</code> object or a
<a href="http://en.wikipedia.org/wiki/Scripting_for_the_Java_Platform">JSR-223</a> script that will generate a
<code>Traversal</code>. There is no benefit to using the model below. It is demonstrated to help elucidate how Gremlin OLAP traversals
are ultimately compiled for execution on a <code>GraphComputer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; result = graph.compute().program(TraversalVertexProgram.build().traversal(g.V().both().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>).groupCount(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>)).create()).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">2</span>]]
gremlin&gt; result.memory().a
==&gt;<span class="integer">32</span>=<span class="integer">3</span>
==&gt;<span class="integer">35</span>=<span class="integer">1</span>
==&gt;<span class="integer">27</span>=<span class="integer">1</span>
==&gt;<span class="integer">29</span>=<span class="integer">3</span>
gremlin&gt; result.memory().iteration
==&gt;<span class="integer">1</span>
gremlin&gt; result.memory().runtime
==&gt;<span class="integer">16</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="distributed-gremlin-gotchas">Distributed Gremlin Gotchas</h4>
<div class="paragraph">
<p>Gremlin OLTP is not identical to Gremlin OLAP.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
There are two primary theoretical differences between Gremlin OLTP and Gremlin OLAP. First, Gremlin OLTP
(via <code>Traversal</code>) leverages a <a href="http://en.wikipedia.org/wiki/Depth-first_search">depth-first</a> execution engine.
Depth-first execution has a limited memory footprint due to <a href="http://en.wikipedia.org/wiki/Lazy_evaluation">lazy evaluation</a>.
On the other hand, Gremlin OLAP (via <code>TraversalVertexProgram</code>) leverages a
<a href="http://en.wikipedia.org/wiki/Breadth-first_search">breadth-first</a> execution engine which maintains a larger memory
footprint, but a better time complexity due to vertex-local traversers being able to be "bulked." The second difference
is that Gremlin OLTP is executed in a serial/streaming fashion, while Gremlin OLAP is executed in a parallel/step-wise fashion. These two
fundamental differences lead to the behaviors enumerated below.
</td>
</tr>
</table>
</div>
<div class="imageblock" style="float: right">
<div class="content">
<img src="../images/gremlin-without-a-cause.png" alt="gremlin without a cause" width="200">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Traversal sideEffects are represented as a distributed data structure across <code>GraphComputer</code> workers. It is not
possible to get a global view of a sideEffect until after an iteration has occurred and global sideEffects are re-broadcasted to the workers.
In some situations, a "stale" local representation of the sideEffect is sufficient to ensure the intended semantics of the
traversal are respected. However, this is not generally true so be wary of traversals that require global views of a
sideEffect. To ensure a fresh global representation, use <code>barrier()</code> prior to accessing the global sideEffect. Note that this
only comes into play with custom steps and <a href="#lambda-steps">lambda steps</a>. The standard Gremlin step library is respective of OLAP semantics.</p>
</li>
<li>
<p>When evaluating traversals that rely on path information (i.e. the history of the traversal), practical
computational limits can easily be reached due the <a href="http://en.wikipedia.org/wiki/Combinatorial_explosion">combinatoric explosion</a>
of data. With path computing enabled, every traverser is unique and thus, must be enumerated as opposed to being
counted/merged. The difference being a collection of paths vs. a single 64-bit long at a single vertex. In other words,
 bulking is very unlikely with traversers that maintain path information. For more
information on this concept, please see <a href="https://thinkaurelius.wordpress.com/2012/11/11/faunus-provides-big-graph-data-analytics/">Faunus Provides Big Graph Data</a>.</p>
</li>
<li>
<p>Steps that are concerned with the global ordering of traversers do not have a meaningful representation in
OLAP. For example, what does <a href="#order-step"><code>order()</code></a>-step mean when all traversers are being processed in parallel?
Even if the traversers were aggregated and ordered, then at the next step they would return to being executed in
parallel and thus, in an unpredictable order. When <code>order()</code>-like steps are executed at the end of a traversal (i.e
the final step), <code>TraversalVertexProgram</code> ensures a serial representation is ordered accordingly. Moreover, it is intelligent enough
to maintain the ordering of <code>g.V().hasLabel("person").order().by("age").values("name")</code>. However, the OLAP traversal
<code>g.V().hasLabel("person").order().by("age").out().values("name")</code> will lose the original ordering as the <code>out()</code>-step
will rebroadcast traversers across the cluster.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="graph-filter">Graph Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most OLAP jobs do not require the entire source graph to faithfully execute their <code>VertexProgram</code>. For instance, if
<code>PageRankVertexProgram</code> is only going to compute the centrality of people in the friendship-graph, then the following
<code>GraphFilter</code> can be applied.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">graph.computer().
  vertices(hasLabel(<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>)).
  edges(bothE(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>)).
  program(PageRankVertexProgram...)</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two methods for constructing a <code>GraphFilter</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vertices(Traversal&lt;Vertex,Vertex&gt;)</code>: A traversal that will be used that can only analyze a vertex and its properties.
If the traversal <code>hasNext()</code>, the input <code>Vertex</code> is passed to the <code>GraphComputer</code>.</p>
</li>
<li>
<p><code>edges(Traversal&lt;Vertex,Edge&gt;)</code>: A traversal that will iterate all legal edges for the source vertex.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>GraphFilter</code> is a "push-down predicate" that providers can reason on to determine the most efficient way to provide
graph data to the <code>GraphComputer</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Apache TinkerPop provides <code>GraphFilterStrategy</code> <a href="#traversalstrategy">traversal strategy</a> which analyzes a submitted
OLAP traversal and, if possible, creates an appropriate <code>GraphFilter</code> automatically. For instance, <code>g.V().count()</code> would
yield a <code>GraphFilter.edges(limit(0))</code>. Thus, for traversal submissions, users typically do not need to be aware of creating
graph filters explicitly. Users can use the <a href="#explain-step"><code>explain()</code></a>-step to see the <code>GraphFilter</code> generated by <code>GraphFilterStrategy</code>.
</td>
</tr>
</table>
</div>
</div>
</div>
<h1 id="gremlin-applications" class="sect0">Gremlin Applications</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p>Gremlin applications represent tools that are built on top of the core APIs to help expose common functionality to
users when working with graphs.  There are two key applications:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Gremlin Console - A <a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> environment for
interactive development and analysis</p>
</li>
<li>
<p>Gremlin Server - A server that hosts script engines thus enabling remote Gremlin execution</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-lab-coat.png" alt="gremlin lab coat" width="310"></span> Gremlin is designed to be extensible, making it possible for users
and graph system/language providers to customize it to their needs.  Such extensibility is also found in the Gremlin
Console and Server, where a universal plugin system makes it possible to extend their capabilities.  One of the
important aspects of the plugin system is the ability to help the user install the plugins through the command line
thus automating the process of gathering dependencies and other error prone activities.</p>
</div>
<div class="paragraph">
<p>The process of plugin installation is handled by <a href="http://www.groovy-lang.org/Grape">Grape</a>, which helps resolve
dependencies into the classpath.  It is therefore important to ensure that Grape is properly configured in order to
use the automated capabilities of plugin installation.  Grape is configured by <code>~/.groovy/grapeConfig.xml</code> and
generally speaking, if that file is not present, the default settings will suffice.  However, they will not suffice
if a required dependency is not in one of the default configured repositories. Please see the
<a href="http://www.groovy-lang.org/Grape">Custom Ivy Settings</a> section of the Grape documentation for more details on
the defaults.  TinkerPop recommends the following configuration in that file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ivysettings&gt;</span>
  <span class="tag">&lt;settings</span> <span class="attribute-name">defaultResolver</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">downloadGrapes</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
  <span class="tag">&lt;resolvers&gt;</span>
    <span class="tag">&lt;chain</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">downloadGrapes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
      <span class="tag">&lt;filesystem</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">cachedGrapes</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;ivy</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user.home}/.groovy/grapes/[organisation]/[module]/ivy-[revision].xml</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;artifact</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user.home}/.groovy/grapes/[organisation]/[module]/[type]s/[artifact]-[revision].[ext]</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;/filesystem&gt;</span>
      <span class="tag">&lt;ibiblio</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">central</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">root</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://central.maven.org/maven2/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">m2compatible</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
      <span class="tag">&lt;ibiblio</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">java.net2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">root</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://download.java.net/maven/2/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">m2compatible</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;/chain&gt;</span>
  <span class="tag">&lt;/resolvers&gt;</span>
<span class="tag">&lt;/ivysettings&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The Graph configuration can also be modified to include the local system&#8217;s Maven <code>.m2</code> directory by one or both
of the following entries:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;ibiblio</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">apache-snapshots</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">root</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://repository.apache.org/snapshots/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">m2compatible</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;ibiblio</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">local</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">root</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file:${user.home}/.m2/repository/</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">m2compatible</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These configurations are useful during development (i.e. if one is working with locally built artifacts) of TinkerPop
Plugins.  It is important to take note of the order used for these references as Grape will check them in the order
they are specified and depending on that order, an artifact other than the one expected may be used which is typically
an issue when working with SNAPSHOT dependencies.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
If building TinkerPop from source, be sure to clear TinkerPop-related jars from the <code>~/.groovy/grapes</code>
directory as they can become stale on some systems and not re-import properly from the local <code>.m2</code> after fresh rebuilds.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-console">Gremlin Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-console.png" alt="gremlin console" width="325"></span> The Gremlin Console is an interactive terminal or
<a href="http://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> that can be used to traverse graphs
and interact with the data that they contain.  It represents the most common method for performing ad-hoc graph
analysis, small to medium sized data loading projects and other exploratory functions.  The Gremlin Console is
highly extensible, featuring a rich plugin system that allows new tools, commands,
<a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSLs</a>, etc. to be exposed to users.</p>
</div>
<div class="paragraph">
<p>To start the Gremlin Console, run <code>gremlin.sh</code> or <code>gremlin.bat</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin loaded: tinkerpop.server
plugin loaded: tinkerpop.utilities
plugin loaded: tinkerpop.tinkergraph
gremlin&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the above plugins are not loaded then they will need to be enabled or else certain examples will not work.
If using the standard Gremlin Console distribution, then the plugins should be enabled by default.  See below for
more information on the <code>:plugin use</code> command to manually enable plugins. These plugins, with the exception of
<code>tinkerpop.tinkergraph</code>, cannot be removed from the Console as they are a part of the <code>gremlin-console.jar</code> itself.
These plugins can only be deactivated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Gremlin Console is loaded and ready for commands. Recall that the console hosts the Gremlin-Groovy language.
Please review <a href="http://www.groovy-lang.org/">Groovy</a> for help on Groovy-related constructs. In short, Groovy is a
superset of Java. What works in Java, works in Groovy. However, Groovy provides many shorthands to make it easier
to interact with the Java API.  Moreover, Gremlin provides many neat shorthands to make it easier to express paths
through a property graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; i = <span class="string"><span class="delimiter">'</span><span class="content">goodbye</span><span class="delimiter">'</span></span>
==&gt;goodbye
gremlin&gt; j = <span class="string"><span class="delimiter">'</span><span class="content">self</span><span class="delimiter">'</span></span>
==&gt;self
gremlin&gt; i + <span class="string"><span class="delimiter">&quot;</span><span class="content"> </span><span class="delimiter">&quot;</span></span> + j
==&gt;goodbye self
gremlin&gt; <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>i<span class="inline-delimiter">}</span></span><span class="content"> </span><span class="inline"><span class="inline-delimiter">${</span>j<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
==&gt;goodbye self</code></pre>
</div>
</div>
<div class="paragraph">
<p>The "toy" graph provides a way to get started with Gremlin quickly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g = TinkerFactory.createModern().traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>], standard]
gremlin&gt; g.V()
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;vadas
==&gt;josh</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using Gremlin-Groovy in a Groovy class file, add <code>static { GremlinLoader.load() }</code> to the head of the file.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_console_commands">Console Commands</h3>
<div class="paragraph">
<p>In addition to the standard commands of the <a href="http://www.groovy-lang.org/Groovy+Shell">Groovy Shell</a>, Gremlin adds
some other useful operations.  The following table outlines the most commonly used commands:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-center valign-top">Alias</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:help</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Displays list of commands and descriptions.  When followed by a command name, it will display more specific help on that particular item.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:exit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ends the Console session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">import</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:i</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Import a class into the Console session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:clear</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sometimes the Console can get into a state where the command buffer no longer understands input (e.g. a misplaced <code>(</code> or <code>}</code>).  Use this command to clear that buffer.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:load</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:l</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Load a file or URL into the command buffer for execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:install</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Imports a maven library and its dependencies into the Console.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:uninstall</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removes a maven library and its dependencies. A restart of the console is required for removal to fully take effect.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:plugin</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:pin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plugin management functions to list, activate and deactivate available plugins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:remote</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:rem</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configures a "remote" context where Gremlin or results of Gremlin will be processed via usage of <code>:submit</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">:submit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">:&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Submit Gremlin to the currently active context defined by <code>:remote</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="console-preferences">Console Preferences</h3>
<div class="paragraph">
<p>Preferences are set with <code>:set name value</code>.  Values can contain spaces when quoted. All preferences are reset by <code>:purge preferences</code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Preference</th>
<th class="tableblock halign-center valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max-iteration</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Controls the maximum number of results that the Console will display. Default: 100 results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable ANSI color rendering. Default: true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of the ASCII art gremlin on startup.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">info.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of "info" type messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">error.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of "error" type messages.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vertex.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of vertices results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">edge.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of edges in results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">string.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Colors of strings in results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">number.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of numbers in results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of Tokens in results.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">input.prompt.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of the input prompt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result.prompt.color</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">colors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Color of the result prompt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">input.prompt</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text of the input prompt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result.prompt</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text of the result prompt.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">result.indicator.null</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text of the void/no results indicator - setting to empty string (i.e. "" at the
command line) will print no result line in these cases.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Colors can contain a comma-separated combination of 1 each of foreground, background, and attribute.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 13.3333%;">
<col style="width: 66.6667%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Foreground</th>
<th class="tableblock halign-center valign-top">Background</th>
<th class="tableblock halign-left valign-top">Attributes</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">black</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bold</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">blue</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_blue</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">faint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cyan</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_cyan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">underline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">green</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_green</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">magenta</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_magenta</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">red</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_red</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">white</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_white</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yellow</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">bg_yellow</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">:set gremlin.color bg_black,green,bold</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_dependencies_and_plugin_usage">Dependencies and Plugin Usage</h3>
<div class="paragraph">
<p>The Gremlin Console can dynamically load external code libraries and make them available to the user.  Furthermore,
those dependencies may contain Gremlin plugins which can expand the language, provide useful functions, etc.  These
important console features are managed by the <code>:install</code> and <code>:plugin</code> commands.</p>
</div>
<div class="paragraph">
<p>The following Gremlin Console session demonstrates the basics of these features:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin list  <span class="invisible">//</span><b class="conum">1</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.sugar
==&gt;tinkerpop.tinkergraph[active]
gremlin&gt; :plugin use tinkerpop.sugar  <span class="invisible">//</span><b class="conum">2</b>
==&gt;tinkerpop.sugar activated
gremlin&gt; :install org.apache.tinkerpop neo4j-gremlin 3.2.6  <span class="invisible">//</span><b class="conum">3</b>
==&gt;<span class="key">loaded</span>: [org.apache.tinkerpop, neo4j-gremlin, 3.2.6]
gremlin&gt; :plugin list <span class="invisible">//</span><b class="conum">4</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.sugar
==&gt;tinkerpop.tinkergraph[active]
==&gt;tinkerpop.neo4j
gremlin&gt; :plugin use tinkerpop.neo4j <span class="invisible">//</span><b class="conum">5</b>
==&gt;tinkerpop.neo4j activated
gremlin&gt; :plugin list <span class="invisible">//</span><b class="conum">6</b>
==&gt;tinkerpop.server[active]
==&gt;tinkerpop.gephi
==&gt;tinkerpop.sugar[active]
==&gt;tinkerpop.utilities[active]
==&gt;tinkerpop.neo4j[active]
==&gt;tinkerpop.tinkergraph[active]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Show a list of "available" plugins.  The list of "available" plugins is determined by the classes available on
the Console classpath.  Plugins need to be "active" for their features to be available.</p>
</li>
<li>
<p>To make a plugin "active" execute the <code>:plugin use</code> command and specify the name of the plugin to enable.</p>
</li>
<li>
<p>Sometimes there are external dependencies that would be useful within the Console.  To bring those in, execute
<code>:install</code> and specify the Maven coordinates for the dependency.</p>
</li>
<li>
<p>Note that there is a "tinkerpop.neo4j" plugin available, but it is not yet "active".</p>
</li>
<li>
<p>Again, to use the "tinkerpop.neo4j" plugin, it must be made "active" with <code>:plugin use</code>.</p>
</li>
<li>
<p>Now when the plugin list is displayed, the "tinkerpop.neo4j" plugin is displayed as "active".</p>
</li>
</ol>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Plugins must be compatible with the version of the Gremlin Console (or Gremlin Server) being used.  Attempts
to use incompatible versions cannot be guaranteed to work.  Moreover, be prepared for dependency conflicts in
third-party plugins, that may only be resolved via manual jar removal from the <code>ext/{plugin}</code> directory.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
It is possible to manage plugin activation and deactivation by manually editing the <code>ext/plugins.txt</code> file which
contains the class names of the "active" plugins.  It is also possible to clear dependencies added by <code>:install</code> by
deleting them from the <code>ext</code> directory.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="execution-mode">Execution Mode</h3>
<div class="paragraph">
<p>For automated tasks and batch executions of Gremlin, it can be useful to execute Gremlin scripts in "execution" mode
from the command line.  Consider the following file named <code>gremlin.groovy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graph = TinkerFactory.createModern()
g = graph.traversal()
g.V().each { println <span class="local-variable">it</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>This script creates the toy graph and then iterates through all its vertices printing each to the system out.  To
execute this script from the command line, <code>gremlin.sh</code> has the <code>-e</code> option used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ bin/gremlin.sh -e gremlin.groovy
v[1]
v[2]
v[3]
v[4]
v[5]
v[6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to pass arguments to scripts.  Any parameters following the file name specification are treated
as arguments to the script. They are collected into a list and passed in as a variable called "args".  The following
Gremlin script is exactly like the previous one, but it makes use of the "args" option to filter the vertices printed
to system out:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graph = TinkerFactory.createModern()
g = graph.traversal()
g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,args[<span class="integer">0</span>]).each { println <span class="local-variable">it</span> }</code></pre>
</div>
</div>
<div class="paragraph">
<p>When executed from the command line a parameter can be supplied:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ bin/gremlin.sh -e gremlin.groovy marko
v[1]
$ bin/gremlin.sh -e gremlin.groovy vadas
v[2]</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to pass multiple scripts by specifying multiple <code>-e</code> options. The scripts will execute in the order
that they are specified. Note that only the arguments from the last script executed will be preserved in the console.
Finally, if the arguments conflict with the reserved flags that <code>gremlin.sh</code> responds double quotes can be used to
wrap all the arugments to the option:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ bin/gremlin.sh -e &quot;gremlin.groovy -e -i --color&quot;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="interactive-mode">Interactive Mode</h3>
<div class="paragraph">
<p>The Gremlin Console can be started in an "interactive" mode. Interactive mode is like <a href="#execution-mode">execution mode</a>
but the console will not exit at the completion of the script, even if the script completes unsuccessfully. In such a
case, it will simply stop processing on the line that of the script that failed. In this way the state of the console
is such that a user could examine the state of things up to the point of failure which might make the script easier to
debug.</p>
</div>
<div class="paragraph">
<p>In addition to debugging, interactive mode is a helpful way for users to initialize their console environment to
avoid otherwise repetitive typing. For example, a user who spends a lot of time working with the TinkerPop "modern"
graph might create a script called <code>init.groovy</code> like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">graph = TinkerFactory.createModern()
g = graph.traversal()</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then start Gremlin Console as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin.sh -i init.groovy

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; g.V()
==&gt;v[1]
==&gt;v[2]
==&gt;v[3]
==&gt;v[4]
==&gt;v[5]
==&gt;v[6]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the user can now reference <code>g</code> (and <code>graph</code> for that matter) at startup without having to directly type that
variable initialization code into the console.</p>
</div>
<div class="paragraph">
<p>Like, execution mode, it is also possible to pass multiple scripts by specifying multiple <code>-i</code> options. See the
<a href="#execution-mode">Execution Mode Section</a> for more information on the specfics of that capability.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-server">Gremlin Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-server.png" alt="gremlin server" width="400"></span> Gremlin Server provides a way to remotely execute Gremlin scripts
against one or more <code>Graph</code> instances hosted within it.  The benefits of using Gremlin Server include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Allows any Gremlin Structure-enabled graph to exist as a standalone server, which in turn enables the ability for
multiple clients to communicate with the same graph database.</p>
</li>
<li>
<p>Enables execution of ad-hoc queries through remotely submitted Gremlin scripts.</p>
</li>
<li>
<p>Allows for the hosting of Gremlin-based DSLs (Domain Specific Language) that expand the Gremlin language to match
the language of the application domain, which will help support common graph use cases such as searching, ranking,
and recommendation.</p>
</li>
<li>
<p>Provides a method for Non-JVM languages (e.g. Python, Javascript, etc.) to communicate with the TinkerPop stack.</p>
</li>
<li>
<p>Exposes numerous methods for extension and customization to include serialization options, remote commands, etc.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Gremlin Server is the replacement for <a href="http://rexster.tinkerpop.com">Rexster</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Please see the <a href="http://tinkerpop.apache.org/docs/3.2.6/dev/provider/">Provider Documentation</a> for information
on how to develop a driver for Gremlin Server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, communication with Gremlin Server occurs over <a href="http://en.wikipedia.org/wiki/WebSocket">WebSocket</a> and
exposes a custom sub-protocol for interacting with the server.</p>
</div>
<div class="sect2">
<h3 id="starting-gremlin-server">Starting Gremlin Server</h3>
<div class="paragraph">
<p>Gremlin Server comes packaged with a script called <code>bin/gremlin-server.sh</code> to get it started (use <code>gremlin-server.bat</code>
on Windows):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin-server.sh conf/gremlin-server-modern.yaml
[INFO] GremlinServer -
         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----

[INFO] GremlinServer - Configuring Gremlin Server from conf/gremlin-server-modern.yaml
[INFO] MetricManager - Configured Metrics Slf4jReporter configured with interval=180000ms and loggerName=org.apache.tinkerpop.gremlin.server.Settings$Slf4jReporterMetrics
[INFO] GraphManager - Graph [graph] was successfully configured via [conf/tinkergraph-empty.properties].
[INFO] ServerGremlinExecutor - Initialized Gremlin thread pool.  Threads in pool named with pattern gremlin-*
[INFO] ScriptEngines - Loaded gremlin-groovy ScriptEngine
[INFO] GremlinExecutor - Initialized gremlin-groovy ScriptEngine with scripts/generate-modern.groovy
[INFO] ServerGremlinExecutor - Initialized GremlinExecutor and configured ScriptEngines.
[INFO] ServerGremlinExecutor - A GraphTraversalSource is now bound to [g] with graphtraversalsource[tinkergraph[vertices:0 edges:0], standard]
[INFO] OpLoader - Adding the standard OpProcessor.
[INFO] OpLoader - Adding the control OpProcessor.
[INFO] OpLoader - Adding the session OpProcessor.
[INFO] OpLoader - Adding the traversal OpProcessor.
[INFO] TraversalOpProcessor - Initialized cache for TraversalOpProcessor with size 1000 and expiration time of 600000 ms
[INFO] GremlinServer - Executing start up LifeCycleHook
[INFO] Logger$info - Loading 'modern' graph data.
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v1.0+gryo with org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV1d0
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v1.0+gryo-stringd with org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV1d0
[INFO] GremlinServer$1 - Gremlin Server configured with worker thread pool of 1, gremlin pool of 8 and boss thread pool of 1.
[INFO] GremlinServer$1 - Channel started at port 8182.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin Server is configured by the provided <a href="http://www.yaml.org/">YAML</a> file <code>conf/gremlin-server-modern.yaml</code>.
That file tells Gremlin Server many things such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The host and port to serve on</p>
</li>
<li>
<p>Thread pool sizes</p>
</li>
<li>
<p>Where to report metrics gathered by the server</p>
</li>
<li>
<p>The serializers to make available</p>
</li>
<li>
<p>The Gremlin <code>ScriptEngine</code> instances to expose and external dependencies to inject into them</p>
</li>
<li>
<p><code>Graph</code> instances to expose</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The log messages that printed above show a number of things, but most importantly, there is a <code>Graph</code> instance named
<code>graph</code> that is exposed in Gremlin Server.  This graph is an in-memory TinkerGraph and was empty at the start of the
server.  An initialization script at <code>scripts/generate-modern.groovy</code> was executed during startup.  It&#8217;s contents are
as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">

<span class="comment">// an init script that returns a Map allows explicit setting of global bindings.</span>
<span class="keyword">def</span> globals = [:]

<span class="comment">// Generates the modern graph into an &quot;empty&quot; TinkerGraph via LifeCycleHook.</span>
<span class="comment">// Note that the name of the key in the &quot;global&quot; map is unimportant.</span>
globals &lt;&lt; [hook : [
  <span class="key">onStartUp</span>: { ctx -&gt;
    ctx.logger.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Loading 'modern' graph data.</span><span class="delimiter">&quot;</span></span>)
      org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerFactory.generateModern(graph)
  }
] <span class="keyword">as</span> LifeCycleHook]

<span class="comment">// define the default TraversalSource to bind queries to - this one will be named &quot;g&quot;.</span>
globals &lt;&lt; [g : graph.traversal()]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The script above initializes a <code>Map</code> and assigns two key/values to it.  The first, assigned to "hook", defines a
<code>LifeCycleHook</code> for Gremlin Server.  The "hook" provides a way to tie script code into the Gremlin Server startup and
shutdown sequences.  The <code>LifeCycleHook</code> has two methods that can be implemented: <code>onStartUp</code> and <code>onShutDown</code>.
These events are called once at Gremlin Server start and once at Gremlin Server stop.  This is an important point
because code outside of the "hook" is executed for each <code>ScriptEngine</code> creation (multiple may be created when
"sessions" are enabled) and therefore the <code>LifeCycleHook</code> provides a way to ensure that a script is only executed a
single time. In this case, the startup hook loads the "modern" graph into the empty TinkerGraph instance, preparing
it for use.  The second key/value pair assigned to the <code>Map</code>, named "g", defines a <code>TraversalSource</code> from the <code>Graph</code>
bound to the "graph" variable in the YAML configuration file.  This variable <code>g</code>, as well as any other variable
assigned to the <code>Map</code>, will be made available as variables for future remote script executions.  In more general
terms, any key/value pairs assigned to a <code>Map</code> returned from the initialization script will become variables that
are global to all requests. In addition, any functions that are defined will be cached for future use.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Transactions on graphs in initialization scripts are not closed automatically after the script finishes
executing.  It is up to the script to properly commit or rollback transactions in the script itself.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="connecting-via-console">Connecting via Console</h3>
<div class="paragraph">
<p>With Gremlin Server running it is now possible to issue some scripts to it for processing.  Start Gremlin Console as
follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The console has the notion of a "remote", which represents a place a script will be sent from the console to be
evaluated elsewhere in some other context (e.g. Gremlin Server, Hadoop, etc.).  To create a remote in the console,
do the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:remote</code> command shown above displays the current status of the remote connection.  This command can also be
used to configure a new connection and change other related settings.  To actually send a script to the server a
different command is required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :&gt; g.V().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; :&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
gremlin&gt; :&gt; g.E().label().groupCount()
==&gt;{created=<span class="integer">4</span>, knows=<span class="integer">2</span>}
gremlin&gt; result
==&gt;result{object={created=<span class="integer">4</span>, knows=<span class="integer">2</span>} <span class="type">class</span>=<span class="class">java</span>.lang.String}
gremlin&gt; :remote close
==&gt;Removed - Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>:&gt;</code> command, which is a shorthand for <code>:submit</code>, sends the script to the server to execute there.  Results are
wrapped in an <code>Result</code> object which is a just a holder for each individual result.  The <code>class</code> shows the data type
for the containing value.  Note that the last script sent was supposed to return a <code>Map</code>, but its <code>class</code> is
<code>java.lang.String</code>.  By default, the connection is configured to only return text results.  In other words,
Gremlin Server is using <code>toString</code> to serialize all results back to the console.  This enables virtually any
object on the server to be returned to the console, but it doesn&#8217;t allow the opportunity to work with this data
in any way in the console itself.  A different configuration of the <code>:remote</code> is required to get the results back
as "objects":</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote-objects.yaml <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; :remote list <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;*<span class="integer">0</span> - Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]
gremlin&gt; :&gt; g.E().label().groupCount() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;[<span class="key">created</span>:<span class="integer">4</span>,<span class="key">knows</span>:<span class="integer">2</span>]
gremlin&gt; m = result[<span class="integer">0</span>].object <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;created=<span class="integer">4</span>
==&gt;knows=<span class="integer">2</span>
gremlin&gt; m.sort {<span class="local-variable">it</span>.value}
==&gt;knows=<span class="integer">2</span>
==&gt;created=<span class="integer">4</span>
gremlin&gt; script = <span class="string"><span class="delimiter">&quot;&quot;&quot;</span><span class="content">
                  matthias = graph.addVertex('name','matthias')
                  matthias.addEdge('co-creator',g.V().has('name','marko').next())
                  </span><span class="delimiter">&quot;&quot;&quot;</span></span>
==&gt;
         matthias = graph.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">matthias</span><span class="delimiter">'</span></span>)
         matthias.addEdge(<span class="string"><span class="delimiter">'</span><span class="content">co-creator</span><span class="delimiter">'</span></span>,g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).next())

gremlin&gt; :&gt; <span class="annotation">@script</span> <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;e[<span class="integer">15</span>][<span class="integer">13</span>-co-creator-&gt;<span class="integer">1</span>]
gremlin&gt; :&gt; g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">matthias</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">co-creator</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
gremlin&gt; :remote close
==&gt;Removed - Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>This configuration file specifies that results should be deserialized back into an <code>Object</code> in the console with
the caveat being that the server and console both know how to serialize and deserialize the result to be returned.</p>
</li>
<li>
<p>There are now two configured remote connections.  The one marked by an asterisk is the one that was just created
and denotes the current one that <code>:sumbit</code> will react to.</p>
</li>
<li>
<p>When the script is executed again, the <code>class</code> is no longer shown to be a <code>java.lang.String</code>.  It is instead a <code>java.util.HashMap</code>.</p>
</li>
<li>
<p>The last result of a remote script is always stored in the reserved variable <code>result</code>, which allows access to
the <code>Result</code> and by virtue of that, the <code>Map</code> itself.</p>
</li>
<li>
<p>If the submission requires multiple-lines to express, then a multi-line string can be created. The <code>:&gt;</code> command
realizes that the user is referencing a variable via <code>@</code> and submits the string script.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
In Groovy, <code>""" text """</code> is a convenient way to create a multi-line string and works well in concert with
<code>:&gt; @variable</code>. Note that this model of submitting a string variable works for all <code>:&gt;</code> based plugins, not just Gremlin Server.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Not all values that can be returned from a Gremlin script end up being serializable.  For example,
submitting <code>:&gt; graph</code> will return a <code>Graph</code> instance and in most cases those are not serializable by Gremlin Server
and will return a serialization error.  It should be noted that <code>TinkerGraph</code>, as a convenience for shipping around
small sub-graphs, is serializable from Gremlin Server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Gremlin Server <code>:remote config</code> command for the driver has the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Command</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">alias</p></td>
<td class="tableblock halign-left valign-top"><div><table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>pairs</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of key/value alias/binding pairs to apply to requests.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>reset</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clears any aliases that were supplied in previous configurations of the remote.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>show</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shows the current set of aliases which is returned as a <code>Map</code></p></td>
</tr>
</tbody>
</table></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeout</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Specifies the length of time in milliseconds a will wait for a response from the server. Specify "none" to
have no timeout. By default, this setting uses "none".</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="console-aliases">Aliases</h4>
<div class="paragraph">
<p>The <code>alias</code> configuration command for the Gremlin Server <code>:remote</code> can be useful in situations where there are
multiple <code>Graph</code> or <code>TraversalSource</code> instances on the server, as it becomes possible to rename them from the client
for purposes of execution within the context of a script.  Therefore, it becomes possible to submit commands this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote-objects.yaml
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; :remote config alias x g
==&gt;x=g
gremlin&gt; :&gt; x.E().label().groupCount()
==&gt;[<span class="key">created</span>:<span class="integer">4</span>,co-<span class="key">creator</span>:<span class="integer">1</span>,<span class="key">knows</span>:<span class="integer">2</span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="console-sessions">Sessions</h4>
<div class="paragraph">
<p>A <code>:remote</code> created in the following fashion will be "sessionless", meaning each script issued to the server with
<code>:&gt;</code> will be encased in a transaction and no state will be maintained from one request to the next.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote-objects.yaml
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In other words, the transaction will be automatically committed (or rolledback on error) and any variables declared
in that script will be forgotten for the next request. See the section on <a href="#sessions">Considering Sessions</a>
for more information on that topic.</p>
</div>
<div class="paragraph">
<p>To enable the remote to connect with a session the <code>connect</code> argument takes another argument as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml session
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>-[f6881ae6-<span class="integer">33</span>a6-<span class="float">477d</span>-a136-dfe86085f046]
gremlin&gt; :&gt; x = <span class="integer">1</span>
==&gt;<span class="integer">1</span>
gremlin&gt; :&gt; y = <span class="integer">2</span>
==&gt;<span class="integer">2</span>
gremlin&gt; :&gt; x + y
==&gt;<span class="integer">3</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>With the above command a session gets created with a random UUID for a session identifier. It is also possible to
assign a custom session identifier by adding it as the last argument to <code>:remote</code> command above. There is also the
option to replace "session" with "session-managed" to create a session that will auto-manage transactions (i.e. each
request will occur within the bounds of a transaction). In this way, the state of bound variables between requests are
maintained, but the need to manually managed the transactional scope of the graph is no longer required.</p>
</div>
</div>
<div class="sect3">
<h4 id="console-remote-console">Remote Console</h4>
<div class="paragraph">
<p>Previous examples have shown usage of the <code>:&gt;</code> command to send scripts to Gremlin Server. The Gremlin Console also
supports an additional method for doing this which can be more convenient when the intention is to exclusively
work with a remote connection to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml session
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>-[<span class="float">60189f</span><span class="integer">89</span>-eea9-<span class="integer">4</span>a57-<span class="integer">9</span>eed-<span class="integer">74</span>c77328ea23]
gremlin&gt; :remote console
==&gt;All scripts will now be sent to Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]-[<span class="float">60189f</span><span class="integer">89</span>-eea9-<span class="integer">4</span>a57-<span class="integer">9</span>eed-<span class="integer">74</span>c77328ea23] - type <span class="string"><span class="delimiter">'</span><span class="content">:remote console</span><span class="delimiter">'</span></span> to <span class="keyword">return</span> to local mode
gremlin&gt; x = <span class="integer">1</span>
==&gt;<span class="integer">1</span>
gremlin&gt; y = <span class="integer">2</span>
==&gt;<span class="integer">2</span>
gremlin&gt; x + y
==&gt;<span class="integer">3</span>
gremlin&gt; :remote console
==&gt;All scripts will now be evaluated locally - type <span class="string"><span class="delimiter">'</span><span class="content">:remote console</span><span class="delimiter">'</span></span> to <span class="keyword">return</span> to remote mode <span class="keyword">for</span> Gremlin Server - [localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>]-[<span class="float">60189f</span><span class="integer">89</span>-eea9-<span class="integer">4</span>a57-<span class="integer">9</span>eed-<span class="integer">74</span>c77328ea23]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the <code>:remote console</code> command is executed. It places the console in a state where the <code>:&gt;</code> is
no longer required. Each script line is actually automatically submitted to Gremlin Server for evalaution. The
variables <code>x</code> and <code>y</code> that were defined actually don&#8217;t exist locally - they only exist on the server! In this sense,
putting the console in this mode is basically like creating a window to a session on Gremlin Server.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using <code>:remote console</code> there is not much point to using a configuration that uses a serializer that returns
actual data. In other words, using a configuration like the one inside of <code>conf/remote-objects.yaml</code> isn&#8217;t typically
useful as in this mode the result will only ever be displayed but not used. Using a serializer configuration like
the one in <code>conf/remote.yaml</code> should perform better.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Console commands, those that begin with a colon (e.g. <code>:x</code>, <code>:remote</code>) do not execute remotely when in this mode.
They are all still evaluated locally.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-via-java">Connecting via Java</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>gremlin-driver<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-java.png" alt="gremlin java" width="175"></span> TinkerPop3 comes equipped with a reference client for Java-based
applications.  It is referred to as Gremlin Driver, which enables applications to send requests to Gremlin Server
and get back results.</p>
</div>
<div class="paragraph">
<p>Gremlin code is sent to the server from a <code>Client</code> instance.  A <code>Client</code> is created as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.open();  <span class="invisible">//</span><b class="conum">1</b>
Client client = cluster.connect(); <span class="invisible">//</span><b class="conum">2</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Opens a reference to <code>localhost</code> - note that there are many configuration options available in defining a <code>Cluster</code> object.</p>
</li>
<li>
<p>Creates a <code>Client</code> given the configuration options of the <code>Cluster</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once a <code>Client</code> instance is ready, it is possible to issue some Gremlin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="predefined-type">ResultSet</span> results = client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>);  <span class="invisible">//</span><b class="conum">1</b>
results.stream().map(i -&gt; i.get(<span class="predefined-type">Integer</span>.class) * <span class="integer">2</span>);       <span class="invisible">//</span><b class="conum">2</b>

CompletableFuture&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Result</span>&gt;&gt; results = client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>).all();  <span class="invisible">//</span><b class="conum">3</b>

CompletableFuture&lt;<span class="predefined-type">ResultSet</span>&gt; future = client.submitAsync(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>); <span class="invisible">//</span><b class="conum">4</b>

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,<span class="integer">4</span>);
client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,x]</span><span class="delimiter">&quot;</span></span>, params); <span class="invisible">//</span><b class="conum">5</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Submits a script that simply returns a <code>List</code> of integers.  This method blocks until the request is written to
the server and a <code>ResultSet</code> is constructed.</p>
</li>
<li>
<p>Even though the <code>ResultSet</code> is constructed, it does not mean that the server has sent back the results (or even
evaluated the script potentially).  The <code>ResultSet</code> is just a holder that is awaiting the results from the server.
In this case, they are streamed from the server as they arrive.</p>
</li>
<li>
<p>Submit a script, get a <code>ResultSet</code>, then return a <code>CompletableFuture</code> that will be called when all results have been returned.</p>
</li>
<li>
<p>Submit a script asynchronously without waiting for the request to be written to the server.</p>
</li>
<li>
<p>Parameterized request are considered the most efficient way to send Gremlin to the server as they can be cached,
which will boost performance and reduce resources required on the server.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>
<div class="paragraph">
<p>The following table describes the various configuration options for the Gremlin Driver:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.channelizer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of the client <code>Channelizer</code> that defines how to connect to the server.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Channelizer.WebSocketChannelizer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.enableSsl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if SSL should be enabled or not. If enabled on the server then it must be enabled on the client.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.keepAliveInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Length of time in milliseconds to wait on an idle connection before sending a keep-alive request. Set to zero to disable this feature.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1800000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.keyCertChainFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The X.509 certificate chain file in PEM format.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.keyFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>PKCS#8</code> private key file in PEM format.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.keyPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the <code>keyFile</code> if it is password-protected</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxContentLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length in bytes that a message can be sent to the server. This number can be no greater than the setting of the same name in the server configuration.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">65536</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxInProcessPerConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of in-flight requests that can occur on a connection.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxSimultaneousUsagePerConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of times that a connection can be borrowed from the pool simultaneously.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of a connection pool for a host.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxWaitForConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to wait for a new connection before timing out.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.maxWaitForSessionClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to wait for a session to close before timing out (does not apply to sessionless connections).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.minInProcessPerConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum number of in-flight requests that can occur on a connection.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.minSimultaneousUsagePerConnection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of times that a connection can be borrowed from the pool simultaneously.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.minSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The minimum size of a connection pool for a host.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.reconnectInitialDelay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to wait before trying to reconnect to a dead host for the first time.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.reconnectInterval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to wait before trying to reconnect to a dead host. This interval occurs after the time specified by the <code>reconnectInitialDelay</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.resultIterationBatchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The override value for the size of the result batches to be returned from the server.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">connectionPool.trustCertChainFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File location for a SSL Certificate Chain to use when SSL is enabled. If this value is not provided and SSL is enabled, the <code>TrustManager</code> will be established with a self-signed certificate which is NOT suitable for production purposes.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">hosts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The list of hosts that the driver will connect to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jaasEntry</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <code>AuthProperties.Property.JAAS_ENTRY</code> properties for authentication to Gremlin Server.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nioPoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the pool for handling request/response operations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">available processors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to submit on requests that require authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port of the Gremlin Server to connect to. The same port will be applied for all hosts.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8192</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sets the <code>AuthProperties.Property.PROTOCOL</code> properties for authentication to Gremlin Server.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializer.className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified class name of the <code>MessageSerializer</code> that will be used to communicate with the server. Note that the serializer configured on the client should be supported by the server configuration.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>GryoMessageSerializerV1d0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializer.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of configuration settings for the serializer.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to submit on requests that require authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workerPoolSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Size of the pool for handling background work.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">available processors * 2</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Please see the <a href="http://tinkerpop.apache.org/javadocs/3.2.6/core/org/apache/tinkerpop/gremlin/driver/Cluster.Builder.html">Cluster.Builder javadoc</a> to get more information on these settings.</p>
</div>
</div>
<div class="sect3">
<h4 id="_aliases">Aliases</h4>
<div class="paragraph">
<p>Scripts submitted to Gremlin Server automatically have the globally configured <code>Graph</code> and <code>TraversalSource</code> instances
made available to them.  Therefore, if Gremlin Server configures two <code>TraversalSource</code> instances called "g1" and "g2"
a script can simply reference them directly as:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">g1.V()</span><span class="delimiter">&quot;</span></span>)
client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">g2.V()</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>While this is an acceptable way to submit scripts, it has the downside of forcing the client to encode the server-side
variable name directly into the script being sent.  If the server configuration ever changed such that "g1" became
"g100", the client-side code might have to see a significant amount of change.  Decoupling the script code from the
server configuration can be managed by the <code>alias</code> method on <code>Client</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Client g1Client = client.alias(<span class="string"><span class="delimiter">&quot;</span><span class="content">g1</span><span class="delimiter">&quot;</span></span>)
Client g2Client = client.alias(<span class="string"><span class="delimiter">&quot;</span><span class="content">g2</span><span class="delimiter">&quot;</span></span>)
g1Client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">g.V()</span><span class="delimiter">&quot;</span></span>)
g2Client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">g.V()</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code demonstrates how the <code>alias</code> method can be used such that the script need only contain a reference
to "g" and "g1" and "g2" are automatically rebound into "g" on the server-side.</p>
</div>
</div>
<div class="sect3">
<h4 id="_serialization">Serialization</h4>
<div class="paragraph">
<p>When using Gryo serialization (the default serializer for the driver), it is important that the client and server
have the same serializers configured or else one or the other will experience serialization exceptions and fail to
always communicate.  Discrepancy in serializer registration between client and server can happen fairly easily as
graphs will automatically include serializers on the server-side, thus leaving the client to be configured manually.
This can be done manually as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">GryoMapper kryo = GryoMapper.build().addRegistry(TitanIoRegistry.INSTANCE).create();
MessageSerializer serializer = <span class="keyword">new</span> GryoMessageSerializerV1d0(kryo);
Cluster cluster = Cluster.build()
                .serializer(serializer)
                .create();
Client client = cluster.connect().init();</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code demonstrates using the <code>TitanIoRegistry</code> which is an <code>IoRegistry</code> instance.  It tells the serializer
what classes (from Titan in this case) to auto-register during serialization.  Gremlin Server roughly uses this same
approach when it configures it&#8217;s serializers, so using this same model will ensure compatibility when making requests.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="connecting-via-python">Connecting via Python</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">pip install gremlinpython</code></pre>
</div>
</div>
<div class="paragraph">
<p>TinkerPop3 also includes a client for Python-based applications.  It is referred to as Gremlin-Python Driver.
The <code>Client</code> class implementation/interface is based on the Java Driver, with some restrictions. Most notably,
Gremlin-Python does not yet implement the <code>Cluster</code> class. Instead, <code>Client</code> is instantiated directly.
Usage is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">from</span> <span class="include">gremlin_python.driver</span> <span class="keyword">import</span> <span class="include">client</span> <span class="invisible">//</span><b class="conum">1</b>
client = client.Client(<span class="string"><span class="delimiter">'</span><span class="content">ws://localhost:8182/gremlin</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">g</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">2</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Import the Gremlin-Python <code>client</code> module.</p>
</li>
<li>
<p>Opens a reference to <code>localhost</code> - note that there are various configuration options that can be passed
to the <code>Client</code> object upon instantiation as keyword arguments.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Once a <code>Client</code> instance is ready, it is possible to issue some Gremlin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">result_set = client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>)  <span class="invisible">//</span><b class="conum">1</b>
future_results = result_set.all()  <span class="invisible">//</span><b class="conum">2</b>
results = future_results.result() <span class="invisible">//</span><b class="conum">3</b>
<span class="keyword">assert</span> results == [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>] <span class="invisible">//</span><b class="conum">4</b>

future_result_set = client.submitAsync(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,4]</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">5</b>
result_set = future_result_set.result() <span class="invisible">//</span><b class="conum">6</b>
result = result_set.one() <span class="invisible">//</span><b class="conum">7</b>
<span class="keyword">assert</span> results == [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>, <span class="integer">4</span>] <span class="invisible">//</span><b class="conum">8</b>
<span class="keyword">assert</span> result_set.done.done() <span class="invisible">//</span><b class="conum">9</b>

client.close() <span class="invisible">//</span><b class="conum">10</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Submit a script that simply returns a <code>List</code> of integers.  This method blocks until the request is written to
the server and a <code>ResultSet</code> is constructed.</p>
</li>
<li>
<p>Even though the <code>ResultSet</code> is constructed, it does not mean that the server has sent back the results (or even
evaluated the script potentially).  The <code>ResultSet</code> is just a holder that is awaiting the results from the server. The <code>all</code> method
returns a <code>concurrent.futures.Future</code> that resolves to a list when it is complete.</p>
</li>
<li>
<p>Block until the the script is evaluated and results are sent back by the server.</p>
</li>
<li>
<p>Verify the result.</p>
</li>
<li>
<p>Submit the same script to the server but don&#8217;t block.</p>
</li>
<li>
<p>Wait until request is written to the server and <code>ResultSet</code> is constructed.</p>
</li>
<li>
<p>Read a single result off the result stream.</p>
</li>
<li>
<p>Again, verify the result.</p>
</li>
<li>
<p>Verify that the all results have been read and stream is closed.</p>
</li>
<li>
<p>Close client and underlying pool connections.</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_configuration_2">Configuration</h4>
<div class="paragraph">
<p>The following table describes the various configuration options for the Gremlin-Python Driver. They
can be passed to the <code>Client</code> instance as keyword arguments:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protocol_factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A callable that returns an instance of <code>AbstractBaseProtocol</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>gremlin_python.driver.protocol.GremlinServerWSProtocol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">transport_factory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A callable that returns an instance of <code>AbstractBaseTransport</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>gremlin_python.driver.tornado.transport.TornadoTransport</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pool_size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of connections used by the pool.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">max_workers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of worker threads.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Number of CPUs * 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">message_serializer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The message serializer implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>gremlin_python.driver.serializer.GraphSONMessageSerializer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password to submit on requests that require authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">""</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The username to submit on requests that require authentication.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">""</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_connecting_via_rest">Connecting via REST</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-rexster.png" alt="gremlin rexster" width="225"></span> While the default behavior for Gremlin Server is to provide a
WebSocket-based connection, it can also be configured to support <a href="http://en.wikipedia.org/wiki/Representational_state_transfer">REST</a>.
The REST endpoint provides for a communication protocol familiar to most developers, with a wide support of
programming languages, tools and libraries for accessing it.  As a result, REST provides a fast way to get started
with Gremlin Server.   It also may represent an easier upgrade path from <a href="http://rexster.tinkerpop.com/">Rexster</a>
as the API for the endpoint is very similar to Rexster&#8217;s <a href="https://github.com/tinkerpop/rexster/wiki/Gremlin-Extension">Gremlin Extension</a>.</p>
</div>
<div class="paragraph">
<p>Gremlin Server provides for a single REST endpoint - a Gremlin evaluator - which allows the submission of a Gremlin
script as a request.  For each request, it returns a response containing the serialized results of that script.
To enable this endpoint, Gremlin Server needs to be configured with the <code>HttpChannelizer</code>, which replaces the default. The <code>WsAndHttpChannelizer</code> may also be configured to enable both WebSockets and the REST endpoint.
<code>WebSocketChannelizer</code>, in the configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">channelizer</span>: <span class="string"><span class="content">org.apache.tinkerpop.gremlin.server.channel.HttpChannelizer</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">channelizer</span>: <span class="string"><span class="content">org.apache.tinkerpop.gremlin.server.channel.WsAndHttpChannelizer</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HttpChannelizer</code> is already configured in the <code>gremlin-server-rest-modern.yaml</code> file that is packaged with the Gremlin
Server distribution.  To utilize it, start Gremlin Server as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">bin/gremlin-server.sh conf/gremlin-server-rest-modern.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the server has started, issue a request.  Here&#8217;s an example with <a href="http://curl.haxx.se/">cURL</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ curl &quot;http://localhost:8182?gremlin=100-1&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:<span class="integer">99</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">0581cdba-b152-45c4-80fa-3d36a6eecf1c</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">200</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example showed a <code>GET</code> operation, but the preferred method for this endpoint is <code>POST</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-1\&quot;}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>which returns:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">result</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">data</span><span class="delimiter">&quot;</span></span>:<span class="integer">99</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">meta</span><span class="delimiter">&quot;</span></span>:{}},
  <span class="key"><span class="delimiter">&quot;</span><span class="content">requestId</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ef2fe16c-441d-4e13-9ddb-3c7b5dfb10ba</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>:<span class="integer">200</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">attributes</span><span class="delimiter">&quot;</span></span>:{},<span class="key"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also preferred that Gremlin scripts be parameterized when possible via <code>bindings</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-x\&quot;, \&quot;bindings\&quot;:{\&quot;x\&quot;:1}}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>bindings</code> argument is a <code>Map</code> of variables where the keys become available as variables in the Gremlin script.
Note that parameterization of requests is critical to performance, as repeated script compilation can be avoided on
each request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
It is possible to pass bindings via <code>GET</code> based requests.  Query string arguments prefixed with "bindings." will
be treated as parameters, where that prefix will be removed and the value following the period will become the
parameter name.  In other words, <code>bindings.x</code> will create a parameter named "x" that can be referenced in the submitted
Gremlin script.  The caveat is that these arguments will always be treated as <code>String</code> values.  To ensure that data
types are preserved or to pass complex objects such as lists or maps, use <code>POST</code> which will at least support the
allowed JSON data types.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, as Gremlin Server can host multiple <code>ScriptEngine</code> instances (e.g. <code>gremlin-groovy</code>, <code>nashorn</code>), it is
possible to define the language to utilize to process the request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;100-x\&quot;, \&quot;language\&quot;:\&quot;gremlin-groovy\&quot;, \&quot;bindings\&quot;:{\&quot;x\&quot;:1}}&quot; &quot;http://localhost:8182&quot;</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default this value is set to <code>gremlin-groovy</code>.  If using a <code>GET</code> operation, this value can be set as a query
string argument with by setting the <code>language</code> key.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Consider the size of the result of a submitted script being returned from the REST endpoint.  A script
that iterates thousands of results will serialize each of those in memory into a single JSON result set.  It is
quite possible that such a script will generate <code>OutOfMemoryError</code> exceptions on the server.  Consider the default
WebSocket configuration, which supports streaming, if that type of use case is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="connecting-via-remotegraph">Connecting via withRemote</h3>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>gremlin-driver<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/remote-graph.png" alt="remote graph" width="145"></span> A <code>TraversalSource</code> has several <code>withRemote()</code> methods which provide an
interesting alternative to the other methods for connecting to Gremlin Server. It is interesting in that all other
methods involve construction of a <code>String</code> representation of the <code>Traversal</code> which is then submitted as a script
to Gremlin Server (via driver or REST). This approach is quite akin to SQL, where query strings are embedded into code
and submitted to a database server. While there are patterns for taking this approach that can lead to maintainable
application code, using <code>withRemote()</code> could be a better method as it brings some good benefits with it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Get auto-complete when writing traversals in an IDE.</p>
</li>
<li>
<p>Get compile-time errors in traversal writing.</p>
</li>
<li>
<p>Get the feel of working with an embedded database.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One way to create a <code>Traversal</code> instance that is remote-enabled is by configuration file. Here is an example of what
that file looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gremlin.remote.remoteConnectionClass=org.apache.tinkerpop.gremlin.driver.remote.DriverRemoteConnection
gremlin.remote.driver.clusterFile=conf/remote-objects.yaml
gremlin.remote.driver.sourceName=g</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gremlin.remote.remoteConnectionClass</code> should be an implementation of the <code>RemoteConnection</code> interface in
<code>gremlin-core</code>. In this case, it points at the <code>gremlin-driver</code> implementation, called <code>DriverRemoteConnection</code>. The
other setting, <code>gremlin.remote.driver.clusterFile</code>, is a configuration to <code>DriverRemoteConnection</code>, and it
provides a pointer to the config file to use to construct a <code>gremlin-driver</code> <code>Cluster</code> object to be utilized when
connecting to Gremlin Server. Please see the <a href="#connecting-via-java">Connecting Via Java</a> section for more
information on those classes and their usage. Finally, the <code>gremlin.remote.driver.sourceName</code> setting tells the
<code>DriverRemoteConnection</code> the name of the <code>TraversalSource</code> in Gremlin Server to connect to.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin Server supports configurable serialization options. The <code>withRemote()</code> feature works best with
Gryo serialization. While it is compatible with GraphSON, unknown incompatibilities may arise
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Gremlin Server needs to be running for this example to work. Use the following configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bourne">$ bin/gremlin-server.sh conf/gremlin-server-modern.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>To configure a "remote" traversal, there first needs to be a <code>TraversalSource</code>. A <code>TraversalSource</code> can be generated
from any <code>Graph</code> instance with the <code>traversal()</code> method. Of course, any traversals generated from this source using the
<code>withRemote()</code> configuration option will not execute against the local graph. That could be confusing and it maybe be
easier to think of the local graph as being "empty". To that end, it is recommended that when using <code>withRemote()</code>,
the <code>TraversalSource</code> be generated with <code>EmptyGraph</code> as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = EmptyGraph.instance()
==&gt;emptygraph[empty]
gremlin&gt; g = graph.traversal().withRemote(<span class="string"><span class="delimiter">'</span><span class="content">conf/remote-graph.properties</span><span class="delimiter">'</span></span>)
==&gt;graphtraversalsource[emptygraph[empty], standard]
gremlin&gt; g.V().valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">id</span>:<span class="integer">1</span>,<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">2</span>,<span class="key">name</span>:[vadas],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">3</span>,<span class="key">name</span>:[lop],<span class="key">label</span>:software,<span class="key">lang</span>:[java]]
==&gt;[<span class="key">id</span>:<span class="integer">4</span>,<span class="key">name</span>:[josh],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">5</span>,<span class="key">name</span>:[ripple],<span class="key">label</span>:software,<span class="key">lang</span>:[java]]
==&gt;[<span class="key">id</span>:<span class="integer">6</span>,<span class="key">name</span>:[peter],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">35</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">13</span>,<span class="key">name</span>:[matthias],<span class="key">label</span>:vertex]
gremlin&gt; g.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the call to <code>close()</code> above. The call to <code>withRemote()</code> internally instantiates a <code>Client</code> instance that can only
be released by "closing" the <code>GraphTraversalSource</code>. It is important to take that step to release resources created
in that step.</p>
</div>
<div class="paragraph">
<p>If working with multiple remote <code>TraversalSource</code> instances it is more efficient to construct a <code>Cluster</code> object and
then re-use it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; cluster = Cluster.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/remote-objects.yaml</span><span class="delimiter">'</span></span>)
==&gt;localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; graph = EmptyGraph.instance()
==&gt;emptygraph[empty]
gremlin&gt; g = graph.traversal().withRemote(DriverRemoteConnection.using(cluster, <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span>))
==&gt;graphtraversalsource[emptygraph[empty], standard]
gremlin&gt; g.V().valueMap(<span class="predefined-constant">true</span>)
==&gt;[<span class="key">id</span>:<span class="integer">1</span>,<span class="key">name</span>:[marko],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">2</span>,<span class="key">name</span>:[vadas],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">3</span>,<span class="key">name</span>:[lop],<span class="key">label</span>:software,<span class="key">lang</span>:[java]]
==&gt;[<span class="key">id</span>:<span class="integer">4</span>,<span class="key">name</span>:[josh],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">5</span>,<span class="key">name</span>:[ripple],<span class="key">label</span>:software,<span class="key">lang</span>:[java]]
==&gt;[<span class="key">id</span>:<span class="integer">6</span>,<span class="key">name</span>:[peter],<span class="key">label</span>:person,<span class="key">age</span>:[<span class="integer">35</span>]]
==&gt;[<span class="key">id</span>:<span class="integer">13</span>,<span class="key">name</span>:[matthias],<span class="key">label</span>:vertex]
gremlin&gt; g.close()
gremlin&gt; cluster.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the <code>Cluster</code> instance is supplied externally, as is shown above, then it is not closed implicitly by the close of
"g".  Closing "g" will only close the <code>Client</code> instance associated with that <code>TraversalSource</code>. In this case, the
<code>Cluster</code> must also be closed explicitly. Closing "g" and the "cluster" aren&#8217;t actually both necessary - the close of
a <code>Cluster</code> will close all <code>Client</code> instance spawned by the <code>Cluster</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>RemoteGraph</code> uses the <code>TraversalOpProcessor</code> in Gremlin Server which requires a cache to enable the
retrieval of side-effects (if the <code>Traversal</code> produces any). That cache can be configured (e.g. controlling eviction
times and sizing) can be done in the Gremlin Server configuration file as described <a href="#traversalopprocessor">here</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, Gremlin <code>Bytecode</code> supports the encoding of bindings which allow GremlinServer to cache traversals that will
be reused over and over again save that some parameterization may change. Thus, instead of translating, compiling, and
then executing each submitted bytecode, it is possible to simply execute. To express bindings in Gremlin-Java and
Gremlin-Groovy, use <code>Bindings</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; cluster = Cluster.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/remote-objects.yaml</span><span class="delimiter">'</span></span>)
==&gt;localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; b = Bindings.instance()
==&gt;bindings[main]
gremlin&gt; g = EmptyGraph.instance().traversal().withRemote(DriverRemoteConnection.using(cluster, <span class="string"><span class="delimiter">&quot;</span><span class="content">g</span><span class="delimiter">&quot;</span></span>))
==&gt;graphtraversalsource[emptygraph[empty], standard]
gremlin&gt; g.V(b.of(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">1</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
gremlin&gt; g.V(b.of(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">4</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop
gremlin&gt; g.V(b.of(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">4</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).getBytecode()
==&gt;[<span class="type">[]</span>, [V(binding[id=<span class="integer">4</span>]), out(created), values(name)]]
gremlin&gt; g.V(b.of(<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">4</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).getBytecode().getBindings()
==&gt;id=<span class="integer">4</span>
gremlin&gt; cluster.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both traversals are abstractly defined as <code>g.V(id).out('created').values('name')</code> and thus, the first submission
can be cached for faster evaluation on the next submission.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_2">Configuring</h3>
<div class="paragraph">
<p>As mentioned earlier, Gremlin Server is configured though a YAML file.  By default, Gremlin Server will look for a
file called <code>conf/gremlin-server.yaml</code> to configure itself on startup.  To override this default, supply the file
to use to <code>bin/gremlin-server.sh</code> as in:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">bin/gremlin-server.sh conf/gremlin-server-min.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>gremlin-server.sh</code> file also serves a second purpose.  It can be used to "install" dependencies to the Gremlin
Server path.  For example, to be able to configure and use other <code>Graph</code> implementations, the dependencies must be
made available to Gremlin Server.  To do this, use the <code>-i</code> switch and supply the Maven coordinates for the dependency
to "install".  For example, to use Neo4j in Gremlin Server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">bin/gremlin-server.sh -i org.apache.tinkerpop neo4j-gremlin 3.2.6</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will "grab" the appropriate dependencies and copy them to the <code>ext</code> directory of Gremlin Server, which
will then allow them to be "used" the next time the server is started.  To uninstall dependencies, simply delete them
from the <code>ext</code> directory.</p>
</div>
<div class="paragraph">
<p>The following table describes the various configuration options that Gremlin Server expects:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication.authenticator</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of an <code>Authenticator</code> implementation to use.  If this setting is not present, then authentication is effectively disabled.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>AllowAllAuthenticator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication.authenticationHandler</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of an <code>AbstractAuthenticationHandler</code> implementation to use. If this setting is not present, but the <code>authentication.authenticator</code> is, it will use that authenticator with the default <code>AbstractAuthenticationHandler</code> implementation for the specified <code>Channelizer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">authentication.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of configuration settings to be passes to the <code>Authenticator</code> when it is constructed.  The settings available are dependent on the implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">channelizer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of the <code>Channelizer</code> implementation to use.  A <code>Channelizer</code> is a "channel initializer" which Gremlin Server uses to define the type of processing pipeline to use.  By allowing different <code>Channelizer</code> implementations, Gremlin Server can support different communication protocols (e.g. WebSocket, Java NIO, etc.).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>WebSocketChannelizer</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">graphManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of the <code>GraphManager</code> implementation to use.  A <code>GraphManager</code> is a class that adheres to the TinkerPop <code>GraphManager</code> interface, allowing custom implementations for storing and managing graph references, as well as defining custom methods to open and close graphs instantiations. It is important to note that the Tinkerpop Http and WebSocketChannelizers auto-commit and auto-rollback based on the graphs stored in the graphManager upon script execution completion.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DefaultGraphManager</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">graphs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>Graph</code> configuration files where the key of the <code>Map</code> becomes the name to which the <code>Graph</code> will be bound and the value is the file name of a <code>Graph</code> configuration file.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlinPool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of "Gremlin" threads available to execute actual scripts in a <code>ScriptEngine</code>. This pool represents the workers available to handle blocking operations in Gremlin Server. When set to <code>0</code>, Gremlin Server will use the value provided by <code>Runtime.availableProcessors()</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the host to bind the server to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">useEpollEventLoop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">try to use epoll event loops (works only on Linux os) instead of netty NIO.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAccumulationBufferComponents</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of request components that can be aggregated for a message.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxChunkSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of the content or each chunk.  If the content length exceeds this value, the transfer encoding of the decoded request will be converted to 'chunked' and the content will be split into multiple <code>HttpContent</code> objects.  If the transfer encoding of the HTTP request is 'chunked' already, each chunk will be split into smaller chunks if the length of the chunk exceeds this value.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8192</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxContentLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of the aggregated content for a message.  Works in concert with <code>maxChunkSize</code> where chunked requests are accumulated back into a single message.  A request exceeding this size will return a <code>413 - Request Entity Too Large</code> status code.  A response exceeding this size will raise an internal exception.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">65536</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxHeaderSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of all headers.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8192</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxInitialLineLength</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum length of the initial line (e.g.  "GET / HTTP/1.0") processed in a request, which essentially controls the maximum length of the submitted URI.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.consoleReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on console reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.consoleReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to console.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on CSV reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.fileName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The file to write metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.csvReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to file.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.addressingMode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>MULTICAST</code> or <code>UNICAST</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on Ganglia reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Ganglia host to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics for Ganglia.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.gangliaReporter.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Ganglia port to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8649</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on Graphite reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Graphite host to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics for Graphite.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the Graphite port to report Metrics to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2003</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.graphiteReporter.prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define a "prefix" to append to metrics keys reported to Graphite.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.jmxReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on JMX reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.slf4jReporter.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Turns on SLF4j reporting of metrics.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">metrics.slf4jReporter.interval</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds between reports of metrics to SLF4j.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">180000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">plugins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of plugins that should be activated on server startup in the available script engines. It assumes that the plugins are in Gremlin Server&#8217;s classpath.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port to bind the server to.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8182</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code> of <code>Map</code> settings, where each <code>Map</code> represents a <code>OpProcessor</code> implementation to use along with its configuration.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors[X].className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full class name of the <code>OpProcessor</code> implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">processors[X].config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> containing <code>OpProcessor</code> specific configurations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">resultIterationBatchSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the size in which the result of a request is "batched" back to the client.  In other words, if set to <code>1</code>, then a result that had ten items in it would get each result sent back individually.  If set to <code>2</code> the same ten results would come back in five batches of two each.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of <code>ScriptEngine</code> implementations to expose through Gremlin Server, where the key is the name given by the <code>ScriptEngine</code> implementation.  The key must match the name exactly for the <code>ScriptEngine</code> to be constructed.  The value paired with this key is itself a <code>Map</code> of configuration for that <code>ScriptEngine</code>.  If this value is not set, it will default to "gremlin-groovy".</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>gremlin-groovy</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.imports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of classes/packages to make available to the <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.staticImports</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of "static" imports to make available to the <code>ScriptEngine</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.scripts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of script files to execute on <code>ScriptEngine</code> initialization. <code>Graph</code> and <code>TraversalSource</code> instance references produced from scripts will be stored globally in Gremlin Server, therefore it is possible to use initialization scripts to add Traversal Strategies or create entirely new <code>Graph</code> instances all together. Instantiating a <code>LifeCycleHook</code> in a script provides a way to execute scripts when Gremlin Server starts and stops.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEngines.&lt;name&gt;.config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> of configuration settings for the <code>ScriptEngine</code>.  These settings are dependent on the <code>ScriptEngine</code> implementation being used.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">scriptEvaluationTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds before a script evaluation times out. The notion of "script evaluation" refers to the time it takes for the <code>ScriptEngine</code> to do its work and <strong>not</strong> any additional time it takes for the result of the evaluation to be iterated and serialized. This feature can be turned off by setting the value to <code>0</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">30000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>List</code> of <code>Map</code> settings, where each <code>Map</code> represents a <code>MessageSerializer</code> implementation to use along with its configuration. If this value is not set, then Gremlin Server will configure with GraphSON and Gryo but will not register any <code>ioRegistries</code> for configured graphs.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>empty</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers[X].className</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The full class name of the <code>MessageSerializer</code> implementation.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializers[X].config</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <code>Map</code> containing <code>MessageSerializer</code> specific configurations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.enabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if SSL is turned on or not.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.keyCertChainFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The X.509 certificate chain file in PEM format. If this value is not present and <code>ssl.enabled</code> is <code>true</code> a self-signed certificate will be used (not suitable for production).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.keyFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>PKCS#8</code> private key file in PEM format. If this value is not present and <code>ssl.enabled</code> is <code>true</code> a self-signed certificate will be used (not suitable for production).</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.keyPassword</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The password of the <code>keyFile</code> if it is password-protected</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.needClientAuth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. One of NONE, OPTIONAL, REQUIRE.  Enables client certificate authentication at the enforcement level specified. Can be used in combination with Authenticator.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ssl.trustCertChainFile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required when needClientAuth is OPTIONAL or REQUIRE. Trusted certificates for verifying the remote endpoint&#8217;s certificate. The file should contain an X.509 certificate chain in PEM format.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">strictTransactionManagement</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to <code>true</code> to require <code>aliases</code> to be submitted on every requests, where the <code>aliases</code> become the scope of transaction management.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadPoolBoss</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads available to Gremlin Server for accepting connections. Should always be set to <code>1</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">threadPoolWorker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The number of threads available to Gremlin Server for processing non-blocking reads and writes.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">writeBufferHighWaterMark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the number of bytes in the network send buffer exceeds this value then the channel is no longer writeable, accepting no additional writes until buffer is drained and the <code>writeBufferLowWaterMark</code> is met.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">65536</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">writeBufferLowWaterMark</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Once the number of bytes queued in the network send buffer exceeds the <code>writeBufferHighWaterMark</code>, the channel will not become writeable again until the buffer is drained and it drops below this value.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">65536</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Configuration of <a href="http://ganglia.sourceforge.net/">Ganglia</a> requires an additional library that is not
packaged with Gremlin Server due to its LGPL licensing that conflicts with the TinkerPop&#8217;s Apache 2.0 License.  To
run Gremlin Server with Ganglia monitoring, download the <code>org.acplt:oncrpc</code> jar from
<a href="http://repo1.maven.org/maven2/org/acplt/oncrpc/1.0.7/">here</a> and copy it to the Gremlin Server <code>/lib</code> directory
before starting the server.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="opprocessor-configurations">OpProcessor Configurations</h4>
<div class="paragraph">
<p>An <code>OpProcessor</code> provides a way to plug-in handlers to Gremlin Server&#8217;s processing flow. Gremlin Server uses this
plug-in system itself to expose the packaged functionality that it exposes. Configurations can be supplied to an
<code>OpProcessor</code> through the <code>processors</code> key in the Gremlin Server configuration file. Each <code>OpProcessor</code> can take a
<code>Map</code> of arguments which are specific to a particular implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">processors</span>:
  - <span class="string"><span class="content">{ className: org.apache.tinkerpop.gremlin.server.op.session.SessionOpProcessor, config: { sessionTimeout: 28800000 }}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following sub-sections describe those configurations for each <code>OpProcessor</code> implementations supplied with Gremlin
Server.</p>
</div>
<div class="sect4">
<h5 id="_sessionopprocessor">SessionOpProcessor</h5>
<div class="paragraph">
<p>The <code>SessionOpProcessor</code> provides a way to interact with Gremlin Server over a <a href="#sessions">session</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of parameters that can be passed on the request.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">perGraphCloseTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds to wait for each configured graph to close any open transactions when the session is killed.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sessionTimeout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds before a session will time out.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">28800000</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_standardopprocessor">StandardOpProcessor</h5>
<div class="paragraph">
<p>The <code>StandardOpProcessor</code> provides a way to interact with Gremlin Server without use of sessions and is the default
method for processing script evaluation requests.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxParameters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum number of parameters that can be passed on the request.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="traversalopprocessor">TraversalOpProcessor</h5>
<div class="paragraph">
<p>The <code>TraversalOpProcessor</code> provides a way to use <a href="#connecting-via-remotegraph">RemoteGraph</a>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cacheExpirationTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time in milliseconds before side-effects from a <code>Traversal</code> will be evicted.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cacheMaxSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum number of entries in the side-effect cache.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_security_and_execution">Security and Execution</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-server-secure.png" alt="gremlin server secure" width="175"></span> Gremlin Server provides for several features that aid in the
security of the graphs that it exposes.  It has built in SSL support and a pluggable authentication framework using
<a href="https://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer">SASL</a> (Simple Authentication and
Security Layer).  SSL options are described in the configuration settings table above, so this section will focus on
authentication.</p>
</div>
<div class="paragraph">
<p>By default, Gremlin Server is configured to allow all requests to be processed (i.e. no authentication).  To enable
authentication, Gremlin Server must be configured with an <code>Authenticator</code> implementation in its YAML file.  Gremlin
Server comes packaged with an implementation called <code>SimpleAuthenticator</code>.  The <code>SimpleAuthenticator</code> implements the
<code>PLAIN</code> SASL mechanism (i.e. plain text) to authenticate a request.  It validates username/password pairs against a
graph database, which must be provided to it as part of the configuration.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">authentication</span>: <span class="string"><span class="content">{</span><span class="content">
  authenticator: org.apache.tinkerpop.gremlin.server.auth.SimpleAuthenticator,
  config: {
    credentialsDb: conf/tinkergraph-credentials.properties}}</span></span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_quick_start">Quick Start</h5>
<div class="paragraph">
<p>A quick way to get started with the <code>SimpleAuthenticator</code> is to use TinkerGraph for the "credentials graph" and the
"sample" credential graph that is packaged with the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin-server.sh conf/gremlin-server-secure.yaml
[INFO] GremlinServer -
         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----

[INFO] GremlinServer - Configuring Gremlin Server from conf/gremlin-server-secure.yaml
...
[WARN] AbstractChannelizer - Enabling SSL with self-signed certificate (NOT SUITABLE FOR PRODUCTION)
[INFO] AbstractChannelizer - SSL enabled
[INFO] SimpleAuthenticator - Initializing authentication with the org.apache.tinkerpop.gremlin.server.auth.SimpleAuthenticator
[INFO] SimpleAuthenticator - CredentialGraph initialized at CredentialGraph{graph=tinkergraph[vertices:1 edges:0]}
[INFO] GremlinServer$1 - Gremlin Server configured with worker thread pool of 1, gremlin pool of 8 and boss thread pool of 1.
[INFO] GremlinServer$1 - Channel started at port 8182.</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to configuring the authenticator, <code>gremlin-server-secure.yaml</code> also enables SSL with a self-signed
certificate.  As SSL is enabled on the server it must also be enabled on the client when connecting.  To connect to
Gremlin Server with <code>gremlin-driver</code>, set the <code>credentials</code> and <code>enableSsl</code> when constructing the <code>Cluster</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.build().credentials(<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)
                                 .enableSsl(<span class="predefined-constant">true</span>).create();</code></pre>
</div>
</div>
<div class="paragraph">
<p>If connecting with Gremlin Console, which utilizes <code>gremlin-driver</code> for remote script execution, use the provided
<code>conf/remote-secure.yaml</code> file when defining the remote.  That file contains configuration for the username and
password as well as enablement of SSL from the client side.</p>
</div>
<div class="paragraph">
<p>Similarly, Gremlin Server can be configured for REST and security.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin-server.sh conf/gremlin-server-rest-secure.yaml
[INFO] GremlinServer -
         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----

[INFO] GremlinServer - Configuring Gremlin Server from conf/gremlin-server-secure.yaml
...
[WARN] AbstractChannelizer - Enabling SSL with self-signed certificate (NOT SUITABLE FOR PRODUCTION)
[INFO] AbstractChannelizer - SSL enabled
[INFO] SimpleAuthenticator - Initializing authentication with the org.apache.tinkerpop.gremlin.server.auth.SimpleAuthenticator
[INFO] SimpleAuthenticator - CredentialGraph initialized at CredentialGraph{graph=tinkergraph[vertices:1 edges:0]}
[INFO] GremlinServer$1 - Gremlin Server configured with worker thread pool of 1, gremlin pool of 8 and boss thread pool of 1.
[INFO] GremlinServer$1 - Channel started at port 8182.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the server has started, issue a request passing the credentials with an <code>Authentication</code> header, as described in <a href="http://tools.ietf.org/html/rfc2617#section-2">RFC2617</a>. Here&#8217;s a HTTP Basic authentication example with cURL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">curl -X POST --insecure -u stephen:password -d &quot;{\&quot;gremlin\&quot;:\&quot;100-1\&quot;}&quot; &quot;https://localhost:8182&quot;</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="credentials-dsl">Credentials Graph DSL</h5>
<div class="paragraph">
<p>The "credentials graph", which has been mentioned in previous sections, is used by Gremlin Server to hold the list of
users who can authenticate to the server.  It is possible to use virtually any <code>Graph</code> instance for this task as long
as it complies to a defined schema. The credentials graph stores users as vertices with the <code>label</code> of "user".  Each
"user" vertex has two properties: <code>username</code> and <code>password</code>.  Naturally, these are both <code>String</code> values.  The password
must not be stored in plain text and should be hashed.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Be sure to define an index on the <code>username</code> property, as this will be used for lookups.  If supported by
the <code>Graph</code>, consider specifying a unique constraint as well.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To aid with the management of a credentials graph, Gremlin Server provides a Gremlin Console plugin which can be
used to add and remove users so as to ensure that the schema is adhered to, thus ensuring compatibility with Gremlin
 Server.  In addition, as it is a plugin, it works naturally in the Gremlin Console as an extension of its
 capabilities (though one could use it programmatically, if desired).  This plugin is distributed with the Gremlin
 Console so it does not have to be "installed".  It does however need to be activated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin use tinkerpop.credentials
==&gt;tinkerpop.credentials activated</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please see the example usage as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>,Vertex.class)
gremlin&gt; credentials = credentials(graph)
==&gt;CredentialGraph{graph=tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]}
gremlin&gt; credentials.createUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">stephen</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; credentials.createUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">daniel</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">better-password</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">3</span>]
gremlin&gt; credentials.createUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">rainbow-dash</span><span class="delimiter">&quot;</span></span>)
==&gt;v[<span class="integer">6</span>]
gremlin&gt; credentials.findUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).properties()
==&gt;vp[password-&gt;<span class="error">$</span><span class="integer">2</span>a<span class="error">$</span><span class="octal">04</span><span class="error">$</span>xwG2BAkpRAPEY]
==&gt;vp[username-&gt;marko]
gremlin&gt; credentials.countUsers()
==&gt;<span class="integer">3</span>
gremlin&gt; credentials.removeUser(<span class="string"><span class="delimiter">&quot;</span><span class="content">daniel</span><span class="delimiter">&quot;</span></span>)
==&gt;<span class="integer">1</span>
gremlin&gt; credentials.countUsers()
==&gt;<span class="integer">2</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="script-execution">Script Execution</h5>
<div class="paragraph">
<p>It is important to remember that Gremlin Server exposes a <code>ScriptEngine</code> instance that allows for remote execution
of arbitrary code on the server.  Obviously, this situation can represent a security risk or, more minimally, provide
ways for "bad" scripts to be inadvertently executed. A simple example of a "valid" Gremlin script that would cause
some problems would be, <code>while(true) {}</code>, which would consume a thread in the Gremlin pool indefinitely, thus
preventing it from serving other requests.  Sending enough of these kinds of scripts would eventually consume all
available threads and Gremlin Server would stop responding.</p>
</div>
<div class="paragraph">
<p>Gremlin Server (more specifically the <code>GremlinGroovyScriptEngine</code>) provides methods to protect itself from these
kinds of troublesome scripts.  A user can configure the script engine with different <code>CompilerCustomizerProvider</code>
implementations.  Consider the basic configuration from the Gremlin Server YAML file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">scriptEngines</span>: <span class="string"><span class="content">{</span><span class="content">
  gremlin-groovy: {
    imports: [java.lang.Math],
    staticImports: [java.lang.Math.PI],
    scripts: [scripts/empty-sample.groovy]}}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration can be extended to include a <code>config</code> key as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">scriptEngines</span>: <span class="string"><span class="content">{</span><span class="content">
  gremlin-groovy: {
    imports: [java.lang.Math],
    staticImports: [java.lang.Math.PI],
    scripts: [scripts/empty-sample.groovy],
    config: {
      compilerCustomizerProviders: {
        &quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.TimedInterruptCustomizerProvider&quot;:[10000] }}}</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This configuration sets up the script engine with a <code>CompilerCustomizerProvider</code> implementation.  The
<code>TimedInterruptCustomizerProvider</code> injects checks that ensure that loops (like <code>while</code>) can only execute for <code>10000</code>
milliseconds.  With this configuration in place, a remote execution as follows, now times out rather than consuming
the thread continuously:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; :&gt; <span class="keyword">while</span>(<span class="predefined-constant">true</span>) { }
Execution timed out after <span class="integer">10000</span> units. Start <span class="key">time</span>: Fri Jul <span class="integer">24</span> <span class="integer">11</span>:<span class="octal">04</span>:<span class="integer">52</span> EDT <span class="integer">2015</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a number of pre-packaged <code>CustomizerProvider</code> implementations:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Customizer</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompileStaticCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Applies <code>CompileStatic</code> annotations to incoming scripts thus removing dynamic dispatch. More information about static compilation can be found in the <a href="http://docs.groovy-lang.org/latest/html/documentation/#_static_compilation">Groovy Documentation</a>.  It is possible to configure this <code>CustomizerProvider</code> by specifying a comma separated list of <a href="http://docs.groovy-lang.org/latest/html/documentation/#Typecheckingextensions-Workingwithextensions">type checking extensions</a> that can have the effect of securing calls to various methods.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CompilationOptionsCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The amount of time a script is allowed to compile before a warning message is sent to the logs.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ConfigurationCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Allows configuration of the Groovy <code>CompilerConfiguration</code> object by taking a <code>Map</code> of key/value pairs where the "key" is a property to set on the <code>CompilerConfiguration</code>.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ThreadInterruptCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Injects checks for thread interruption, thus allowing the thread to potentially respect calls to <code>Thread.interrupt()</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TimedInterruptCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Injects checks into loops to interrupt them if they exceed the configured timeout in milliseconds.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>TypeCheckedCustomizerProvider</code></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>Similar to the above mentioned, <code>CompileStaticCustomizerProvider</code>, the <code>TypeCheckedCustomizerProvider</code> injects <code>TypeChecked</code> annotations to incoming scripts.  More information on the nature of this annotation can be found in the <a href="http://docs.groovy-lang.org/latest/html/documentation/#_the_code_typechecked_code_annotation">Groovy Documentation</a>.  It too takes a comma separated list of <a href="http://docs.groovy-lang.org/latest/html/documentation/#Typecheckingextensions-Workingwithextensions">type checking extensions</a>.</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To provide some basic out-of-the-box protections against troublesome scripts, the following configuration can be used:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">scriptEngines</span>: <span class="string"><span class="content">{</span><span class="content">
  gremlin-groovy: {
    imports: [java.lang.Math],
    staticImports: [java.lang.Math.PI],
    scripts: [scripts/empty-sample.groovy],
    config: {
      compilerCustomizerProviders: {
        &quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.ThreadInterruptCustomizerProvider&quot;:[],
        &quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.TimedInterruptCustomizerProvider&quot;:[10000],
        &quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.CompilationOptionsCustomizerProvider&quot;:[8000],
        &quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.CompileStaticCustomizerProvider&quot;:[&quot;org.apache.tinkerpop.gremlin.groovy.jsr223.customizer.SimpleSandboxExtension&quot;]}}}}</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The above configuration could also use the <code>TypeCheckedCustomizerProvider</code> in place of the
<code>CompileStaticCustomizerProvider</code>.  The differences between <code>TypeChecked</code> and <code>CompileStatic</code> are beyond the scope of
this documentation.  Consult the latest <a href="http://docs.groovy-lang.org/latest/html/documentation/#_typing">Groovy Documentation</a>
for information on the differences. It is important to understand the impact that these configuration will have on
submitted scripts before enabling this feature.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The import of classes to the script engine is handled by the <code>ImportCustomizerProvider</code>.  As the concept of
"imports" is a first-class citizen (i.e. has its own configuration options), it is not recommended that the
<code>ImportCustomizerProvider</code> be used as a configuration option to <code>compilerCustomizerProviders</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This configuration uses the <code>SimpleSandboxExtension</code>, which blacklists calls to methods on the <code>System</code> class,
thereby preventing someone from remotely killing the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :&gt; <span class="predefined-type">System</span>.exit(<span class="integer">0</span>)
Script8.groovy: <span class="integer">1</span>: [Static type checking] - Not authorized to call <span class="local-variable">this</span> <span class="key">method</span>: java.lang.System<span class="error">#</span>exit(<span class="type">int</span>)
 <span class="error">@</span> line <span class="integer">1</span>, column <span class="integer">1</span>.
   System.exit(<span class="integer">0</span>)
   ^

<span class="integer">1</span> error</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SimpleSandboxExtension</code> is by no means a "complete" implementation protecting against all manner of nefarious
scripts, but it does provide an example for how such a capability might be implemented.  A more complete implementation
is offered in the <code>FileSandboxExtension</code> which uses a configuration file to white list certain classes and methods.
The configuration file is YAML-based and an example is presented as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">autoTypeUnknown</span>: <span class="string"><span class="content">true</span></span>
<span class="key">methodWhiteList</span>:
  - <span class="string"><span class="content">java\.lang\.Boolean.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Byte.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Character.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Double.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Enum.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Float.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Integer.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Long.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Math.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Number.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Object.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Short.*</span></span>
  - <span class="string"><span class="content">java\.lang\.String.*</span></span>
  - <span class="string"><span class="content">java\.lang\.StringBuffer.*</span></span>
  - <span class="string"><span class="content">java\.lang\.System#currentTimeMillis\(\)</span></span>
  - <span class="string"><span class="content">java\.lang\.System#nanoTime\(\)</span></span>
  - <span class="string"><span class="content">java\.lang\.Throwable.*</span></span>
  - <span class="string"><span class="content">java\.lang\.Void.*</span></span>
  - <span class="string"><span class="content">java\.util\..*</span></span>
  - <span class="string"><span class="content">org\.codehaus\.groovy\.runtime\.DefaultGroovyMethods.*</span></span>
  - <span class="string"><span class="content">org\.codehaus\.groovy\.runtime\.InvokerHelper#runScript\(java\.lang\.Class,java\.lang\.String\[\]\)</span></span>
  - <span class="string"><span class="content">org\.codehaus\.groovy\.runtime\.StringGroovyMethods.*</span></span>
  - <span class="string"><span class="content">groovy\.lang\.Script#&lt;init&gt;\(groovy.lang.Binding\)</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.structure\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.computer\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.computer\.bulkloading\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.computer\.clustering\.peerpressure\.*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.computer\.ranking\.pagerank\.*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.computer\.traversal\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.traversal\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.traversal\.dsl\.graph\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.process\.traversal\.engine\..*</span></span>
  - <span class="string"><span class="content">org\.apache\.tinkerpop\.gremlin\.server\.util\.LifeCycleHook.*</span></span>
<span class="key">staticVariableTypes</span>:
  <span class="key">graph</span>: <span class="string"><span class="content">org.apache.tinkerpop.gremlin.structure.Graph</span></span>
  <span class="key">g</span>: <span class="string"><span class="content">org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>There are three keys in this configuration file that control different aspects of the sandbox:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>autoTypeUnknown</code> - When set to <code>true</code>, unresolved variables are typed as <code>Object</code>.</p>
</li>
<li>
<p><code>methodWhiteList</code> - A white list of classes and methods that follow a regex pattern which can then be matched against
method descriptors to determine if they can be executed.  The method descriptor is the fully-qualified class name
of the method, its name and parameters. For example, <code>Math.ceil</code> would have a descriptor of
<code>java.lang.Math#ceil(double)</code>.</p>
</li>
<li>
<p><code>staticVariableTypes</code> - A list of variables that will be used in the <code>ScriptEngine</code> for which the types are
always known.  In the above example, the variable "graph" will always be bound to a <code>Graph</code> instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>At Gremlin Server startup, the <code>FileSandboxExtension</code> looks in the root of Gremlin Server installation directory for a
file called <code>sandbox.yaml</code> and configures itself.  To use a file in a different location set the
<code>gremlinServerSandbox</code> system property to the location of the file (e.g. <code>-DgremlinServerSandbox=conf/my-sandbox.yaml</code>).</p>
</div>
<div class="paragraph">
<p>The <code>FileSandboxExtension</code> provides for a basic configurable security function in Gremlin Server. More complex
sandboxing implementations can be developed by using this white listing model and extending from the
<code>AbstractSandboxExtension</code>.</p>
</div>
<div class="paragraph">
<p>A final thought on the topic of <code>CompilerCustomizerProvider</code> implementations is that they are not just for
"security" (though they are demonstrated in that capacity here).  They can be used for a variety of features that
can fine tune the Groovy compilation process.  Read more about compilation customization in the
<a href="http://docs.groovy-lang.org/latest/html/documentation/#compilation-customizers">Groovy Documentation</a>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_serialization_2">Serialization</h4>
<div class="paragraph">
<p>Gremlin Server can accept requests and return results using different serialization formats.  Serializers implement the
<code>MessageSerializer</code> interface. In doing so, they express the list of mime types they expect to support. When
configuring multiple serializers it is possible for two or more serializers to support the same mime type. Such a
situation may be common with a generic mime type such as <code>application/json</code>. Serializers are added in the order that
they are encountered in the configuration file and the first one added for a specific mime type will not be overridden
by other serializers that also support it.</p>
</div>
<div class="paragraph">
<p>The format of the serialization is configured by the <code>serializers</code> setting described in the table above.  Note that
some serializers have additional configuration options as defined by the <code>serializers[X].config</code> setting.  The
<code>config</code> setting is a <code>Map</code> where the keys and values get passed to the serializer at its initialization.  The
available and/or expected keys are dependent on the serializer being used.  Gremlin Server comes packaged with two
different serializers: GraphSON and Gryo.</p>
</div>
<div class="sect4">
<h5 id="_graphson">GraphSON</h5>
<div class="paragraph">
<p>The GraphSON serializer produces human readable output in JSON format and is a good configuration choice for those
trying to use TinkerPop from non-JVM languages.  JSON obviously has wide support across virtually all major
programming languages and can be consumed by a wide variety of tools.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  - <span class="string"><span class="content">{ className: org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerV1d0 }</span></span>
  - <span class="string"><span class="content">{ className: org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerV2d0 }</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above configuration represents the default serialization under the <code>application/json</code> MIME type and produces JSON
consistent with standard JSON data types.  It has the following configuration option:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ioRegistries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>IoRegistry</code> implementations to be applied to the serializer.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  - <span class="string"><span class="content">{ className: org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerGremlinV1d0 }</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>When the standard JSON data types are not enough (e.g. need to identify the difference between <code>double</code> and <code>float</code>
data types), the above configuration will embed types into the JSON itself.  The type embedding uses standard Java
type names, so interpretation from non-JVM languages will be required.  It has the MIME type of
<code>application/vnd.gremlin-v1.0+json</code> and the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ioRegistries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>IoRegistry</code> implementations to be applied to the serializer.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_gryo">Gryo</h5>
<div class="paragraph">
<p>The Gryo serializer utilizes Kryo-based serialization which produces a binary output.  This format is best consumed
by JVM-based languages.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml">  - <span class="string"><span class="content">{ className: org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerGremlinV1d0 }</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>It has the MIME type of <code>application/vnd.gremlin-v1.0+gryo</code> and the following configuration options:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Key</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bufferSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The maximum size of the Kryo buffer for use on a single object being serialized.  Increasing this value will correct <code>KryoException</code> errors that complain of "Buffer too small".</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>4096</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">classResolverSupplier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The fully qualified classname of a custom <code>Supplier&lt;ClassResolver&gt;</code> which will be used when constructing <code>Kryo</code> instances. There is no direct default for this setting, but without a setting the <code>GryoClassResolver</code> is used.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of classes with custom kryo <code>Serializer</code> implementations related to them in the form of <code>&lt;class&gt;;&lt;serializer-class&gt;</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ioRegistries</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of <code>IoRegistry</code> implementations to be applied to the serializer.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">serializeResultToString</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">When set to <code>true</code>, results are serialized by first calling <code>toString()</code> on each object in the result list resulting in an extended MIME Type of <code>application/vnd.gremlin-v1.0+gryo-stringd</code>.  When set to <code>false</code> Kryo-based serialization is applied.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>false</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As described above, there are multiple ways in which to register serializers for Kryo-based serialization.  These
configurations can be used in conjunction with one another where there is a specific ordering to how the configurations
are applied.  The <code>userMapperFromGraph</code> setting is applied first, followed by any <code>ioRegistries</code> and finalized by the
<code>custom</code> setting.</p>
</div>
<div class="paragraph">
<p>Those configuring or implementing a <code>Supplier&lt;ClassResolver&gt;</code> should consider this an "advanced" option and typically
important to use cases where server types need to be coerced to client types (i.e. a type is available on the server
but not on the client).  Implementations should typically instantiate <code>ClassResolver</code> implementations that are
extensions of the <code>GryoClassResolver</code> as this class is important to most serialization tasks in TinkerPop.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_metrics">Metrics</h4>
<div class="paragraph">
<p>Gremlin Server produces metrics about its operations that can yield some insight into how it is performing. These
metrics are exposed in a variety of ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Directly to the console where Gremlin Server is running</p>
</li>
<li>
<p>CSV file</p>
</li>
<li>
<p><a href="http://ganglia.info/">Ganglia</a></p>
</li>
<li>
<p><a href="http://graphite.wikidot.com/">Graphite</a></p>
</li>
<li>
<p><a href="http://www.slf4j.org/">SLF4j</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Java_Management_Extensions">JMX</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The configuration of each of these outputs is described in the Gremlin Server <a href="#_configuring_2">Configuring</a> section.
Regardless of the output, the metrics gathered are the same. Each metric is prefixed with
<code>org.apache.tinkerpop.gremlin.server.GremlinServer</code> and the following metrics are reported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>sessions</code> - the number of sessions open at the time the metric was last measured.</p>
</li>
<li>
<p><code>errors</code> - the number of total errors, mean rate, as well as the 1, 5, and 15-minute error rates.</p>
</li>
<li>
<p><code>op.eval</code> - the number of script evaluations, mean rate, 1, 5, and 15 minute rates, minimum, maximum, median, mean,
and standard deviation evaluation times, as well as the 75th, 95th, 98th, 99th and 99.9th percentile evaluation times
(note that these time apply to both sessionless and in-session requests).</p>
</li>
<li>
<p><code>op.traversal</code> - the number of <code>Traveral</code> executions, mean rate, 1, 5, and 15 minute rates, minimum, maximum, median,
mean, and standard deviation evaluation times, as well as the 75th, 95th, 98th, 99th and 99.9th percentile evaluation
times.</p>
</li>
<li>
<p><code>engine-name.session.session-id.*</code> - metrics related to different <code>GremlinScriptEngine</code> instances configured for
session-based requests where "engine-name" will be the actual name of the engine, such as "gremlin-groovy" and
"session-id" will be the identifier for the session itself.</p>
</li>
<li>
<p><code>engine-name.sessionless.*</code> - metrics related to different <code>GremlinScriptEngine</code> instances configured for sessionless
requests where "engine-name" will be the actual name of the engine, such as "gremlin-groovy".</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_best_practices">Best Practices</h3>
<div class="paragraph">
<p>The following sections define best practices for working with Gremlin Server.</p>
</div>
<div class="sect3">
<h4 id="_tuning">Tuning</h4>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-handdrawn.png" alt="gremlin handdrawn" width="120"></span> Tuning Gremlin Server for a particular environment may require some simple trial-and-error, but the following represent some basic guidelines that might be useful:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gremlin Server defaults to a very modest maximum heap size.  Consider increasing this value for non-trivial uses.  Maximum heap size (<code>-Xmx</code>) is defined with the <code>JAVA_OPTIONS</code> setting in <code>gremlin-server.sh</code>.</p>
</li>
<li>
<p>When configuring the size of <code>threadPoolWorker</code> start with the default of <code>1</code> and increment by one as needed to a maximum of <code>2*number of cores</code>.</p>
</li>
<li>
<p>The "right" size of the <code>gremlinPool</code> setting is somewhat dependent on the type of scripts that will be processed
by Gremlin Server.  As requests arrive to Gremlin Server they are decoded and queued to be processed by threads in
this pool.  When this pool is exhausted of threads, Gremlin Server will continue to accept incoming requests, but
the queue will continue to grow.  If left to grow too large, the server will begin to slow.  When tuning around
this setting, consider whether the bulk of the scripts being processed will be "fast" or "slow", where "fast"
generally means being measured in the low hundreds of milliseconds and "slow" means anything longer than that.</p>
</li>
<li>
<p>Scripts that are "slow" can really hurt Gremlin Server if they are not properly accounted for.  <code>ScriptEngine</code>
evaluations are blocking operations that aren&#8217;t always easily interrupted, so once a "slow" script is being evaluated in
the context of a <code>ScriptEngine</code> it must finish its work.  Lots of "slow" scripts will eventually consume the
<code>gremlinPool</code> preventing other scripts from getting processed from the queue.</p>
<div class="ulist">
<ul>
<li>
<p>To limit the impact of this problem, consider properly setting the <code>scriptEvaluationTimeout</code> to something "sane".
In other words, test the traversals being sent to Gremlin Server and determine the maximum time they take to evaluate
and iterate over results, then set the timeout value accordingly.</p>
</li>
<li>
<p>Note that <code>scriptEvaluationTimeout</code> can only attempt to interrupt the evaluation on timeout.  It allows Gremlin
Server to "ignore" the result of that evaluation, which means the thread in the <code>gremlinPool</code> that did the evaluation
may still be consumed after the timeout if interruption does not succeed on the thread.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Graph element serialization for <code>Vertex</code> and <code>Edge</code> can be expensive, as their data structures are complex given the
possible existence of multi-properties and meta-properties. When returning data from Gremlin Server only return the
data that is required. For example, if only two properties of a <code>Vertex</code> are needed then simply return the two rather
than returning the entire <code>Vertex</code> object itself. Even with an entire <code>Vertex</code>, it is typically much faster to issue
the query as <code>g.V(1).valueMap(true)</code> than <code>g.V(1)</code>, as the former returns a <code>Map</code> of the same data as a <code>Vertex</code>, but
without all the associated structure which can slow the response.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="parameterized-scripts">Parameterized Scripts</h4>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-parameterized.png" alt="gremlin parameterized" width="150"></span> Use script parameterization.  Period.  Gremlin Server caches
all scripts that are passed to it.  The cache is keyed based on the a hash of the script.  Therefore <code>g.V(1)</code> and
<code>g.V(2)</code> will be recognized as two separate scripts in the cache.  If that script is parameterized to <code>g.V(x)</code>
where <code>x</code> is passed as a parameter from the client, there will be no additional compilation cost for future requests
on that script.  Compilation of a script should be considered "expensive" and avoided when possible.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.open();
Client client = cluster.connect();

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,<span class="integer">4</span>);
client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,x]</span><span class="delimiter">&quot;</span></span>, params);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The more parameters that are used in a script the more expensive the compilation step becomes. Gremlin Server has a
<code>OpProcessor</code> setting called <code>maxParameters</code>, which is mentioned in the <a href="#opprocess-configuration">OpProcessor Configuration</a>
section. It controls the maximum number of parameters that can be passed to the server for script evaluation purposes.
Use of this setting can prevent accidental long run compilations, which individually are not terribly oppressive to
the server, but taken as a group under high concurrency would be considered detrimental.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cache_management">Cache Management</h4>
<div class="paragraph">
<p>If Gremlin Server processes a large number of unique scripts, the global function cache will grow beyond the memory
available to Gremlin Server and an <code>OutOfMemoryError</code> will loom.  Script parameterization goes a long way to solving
this problem and running out of memory should not be an issue for those cases.  If it is a problem or if there is no
script parameterization due to a given use case (perhaps using with use of <a href="#sessions">sessions</a>), it is possible to
better control the nature of the global function cache from the client side, by issuing scripts with a parameter to
help define how the garbage collector should treat the references.</p>
</div>
<div class="paragraph">
<p>The parameter is called <code>#jsr223.groovy.engine.keep.globals</code> and has four options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>hard</code> - available in the cache for the life of the JVM (default when not specified).</p>
</li>
<li>
<p><code>soft</code> - retained until memory is "low" and should be reclaimed before an <code>OutOfMemoryError</code> is thrown.</p>
</li>
<li>
<p><code>weak</code> - garbage collected even when memory is abundant.</p>
</li>
<li>
<p><code>phantom</code> - removed immediately after being evaluated by the <code>ScriptEngine</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By specifying an option other than <code>hard</code>, an <code>OutOfMemoryError</code> in Gremlin Server should be avoided.  Of course,
this approach will come with the downside that functions could be garbage collected and thus removed from the
cache, forcing Gremlin Server to recompile later if that script is later encountered.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.open();
Client client = cluster.connect();

<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>,<span class="predefined-type">Object</span>&gt; params = <span class="keyword">new</span> <span class="predefined-type">HashMap</span>&lt;&gt;();
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">x</span><span class="delimiter">&quot;</span></span>,<span class="integer">4</span>);
params.put(<span class="string"><span class="delimiter">&quot;</span><span class="content">#jsr223.groovy.engine.keep.globals</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">soft</span><span class="delimiter">&quot;</span></span>);
client.submit(<span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3,x]</span><span class="delimiter">&quot;</span></span>, params);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="sessions">Considering Sessions</h4>
<div class="paragraph">
<p>The preferred approach for issuing requests to Gremlin Server is to do so in a sessionless manner.  The concept of
"sessionless" refers to a request that is completely encapsulated within a single transaction, such that the script
in the request starts with a new transaction and ends with a closed transaction. Sessionless requests have automatic
transaction management handled by Gremlin Server, thus automatically opening and closing transactions as previously
described.  The downside to the sessionless approach is that the entire script to be executed must be known at the
time of submission so that it can all be executed at once.  This requirement makes it difficult for some use cases
where more control over the transaction is desired.</p>
</div>
<div class="paragraph">
<p>For such use cases, Gremlin Server supports sessions.  With sessions, the user is in complete control of the start
and end of the transaction. This feature comes with some additional expense to consider:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initialization scripts will be executed for each session created so any expense related to them will be established
each time a session is constructed.</p>
</li>
<li>
<p>There will be one script cache per session, which obviously increases memory requirements.  The cache is not shared,
so as to ensure that a session has isolation from other session environments. As a result, if the same script is
executed in each session the same compilation cost will be paid for each session it is executed in.</p>
</li>
<li>
<p>Each session will require its own thread pool with a single thread in it - this ensures that transactional
boundaries are managed properly from one request to the next.</p>
</li>
<li>
<p>If there are multiple Gremlin Server instances, communication from the client to the server must be bound to the
server that the session was initialized in.  Gremlin Server does not share session state as the transactional context
of a <code>Graph</code> is bound to the thread it was initialized in.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To connect to a session with Java via the <code>gremlin-driver</code>, it is necessary to create a <code>SessionedClient</code> from the
<code>Cluster</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.open();  <span class="invisible">//</span><b class="conum">1</b>
Client client = cluster.connect(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionName</span><span class="delimiter">&quot;</span></span>); <span class="invisible">//</span><b class="conum">2</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Opens a reference to <code>localhost</code> as <a href="#connecting-via-java">previously shown</a>.</p>
</li>
<li>
<p>Creates a <code>SessionedClient</code> given the configuration options of the Cluster. The <code>connect()</code> method is given a
<code>String</code> value that becomes the unique name of the session. It is often best to simply use a <code>UUID</code> to represent
the session.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It is also possible to have Gremlin Server manage the transactions as is done with sessionless requests. The user is
in control of enabling this feature when creating the <code>SessionedClient</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Cluster cluster = Cluster.open();
Client client = cluster.connect(<span class="string"><span class="delimiter">&quot;</span><span class="content">sessionName</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Specifying <code>true</code> to the <code>connect()</code> method signifies that the <code>client</code> should make each request as one encapsulated
in a transaction. With this configuration of <code>client</code> there is no need to close a transaction manually.</p>
</div>
<div class="paragraph">
<p>When using this mode of the <code>SessionedClient</code> it is important to recognize that global variable state for the session
is not rolled-back on failure depending on where the failure occurs. For example, sending the following script would
create a variable "x" in global session scope that would be acccessible on the next request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">x = <span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, sending this script which explicitly throws an exception:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">y = <span class="integer">2</span>
<span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">RuntimeException</span>()</code></pre>
</div>
</div>
<div class="paragraph">
<p>will result in an obvious failure during script evaluation and "y" will not be available to the next request. The
complication arises where the script evaluates successfully, but fails during result iteration or serialization. For
example, this script:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">a = <span class="integer">1</span>
g.addV()</code></pre>
</div>
</div>
<div class="paragraph">
<p>would sucessfully evaluate and return a <code>Traversal</code>.  The variable "a" would be available on the next request. However,
if there was a failure in transaction management on the call to <code>commit()</code>, "a" would still be available to the next
request.</p>
</div>
<div class="paragraph">
<p>A session is a "heavier" approach to the simple "request/response" approach of sessionless requests, but is sometimes
necessary for a given use case.</p>
</div>
</div>
<div class="sect3">
<h4 id="considering-transactions">Considering Transactions</h4>
<div class="paragraph">
<p>Gremlin Server performs automated transaction handling for "sessionless" requests (i.e. no state between requests) and
for "in-session" requests with that feature enabled. It will automatically commit or rollback transactions depending
on the success or failure of the request.</p>
</div>
<div class="paragraph">
<p>Another aspect of Transaction Management that should be considered is the usage of the <code>strictTransactionManagement</code>
setting.  It is <code>false</code> by default, but when set to <code>true</code>, it forces the user to pass <code>aliases</code> for all requests.
The aliases are then used to determine which graphs will have their transactions closed for that request. Running
Gremlin Server in this configuration should be more efficient when there are multiple graphs being hosted as
Gremlin Server will only close transactions on the graphs specified by the <code>aliases</code>. Keeping this setting <code>false</code>,
will simply have Gremlin Server close transactions on all graphs for every request.</p>
</div>
</div>
<div class="sect3">
<h4 id="considering-state">Considering State</h4>
<div class="paragraph">
<p>With REST and any sessionless requests, there is no variable state maintained between requests.  Therefore,
when <a href="#connecting-via-console">connecting with the console</a>, for example, it is not possible to create a variable in
one command and then expect to access it in the next:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote connect tinkerpop.server conf/remote.yaml
==&gt;Configured localhost/<span class="float">127.0</span><span class="float">.0</span><span class="float">.1</span>:<span class="integer">8182</span>
gremlin&gt; :&gt; x = <span class="integer">2</span>
==&gt;<span class="integer">2</span>
gremlin&gt; :&gt; <span class="integer">2</span> + x
No such <span class="key">property</span>: x <span class="keyword">for</span> <span class="type">class</span>: <span class="class">Script4</span>
Display stack trace? [yN] n</code></pre>
</div>
</div>
<div class="paragraph">
<p>The same behavior would be seen with REST or when using sessionless requests through one of the Gremlin Server drivers.
If having this behavior is desireable, then <a href="#sessions">consider sessions</a>.</p>
</div>
<div class="paragraph">
<p>There is an exception to this notion of state not existing between requests and that is globally defined functions.
All functions created via scripts are global to the server.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :&gt; <span class="keyword">def</span> <span class="function">subtractIt</span>(<span class="type">int</span> x, <span class="type">int</span> y) { x - y }
==&gt;<span class="predefined-constant">null</span>
gremlin&gt; :&gt; subtractIt(<span class="integer">8</span>,<span class="integer">7</span>)
==&gt;<span class="integer">1</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If this behavior is not desirable there are several options.  A first option would be to consider using sessions. Each
session gets its own <code>ScriptEngine</code>, which maintains its own isolated cache of global functions, whereas sessionless
requests uses a single function cache. A second option would be to define functions as closures:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :&gt; multiplyIt = { <span class="type">int</span> x, <span class="type">int</span> y -&gt; x * y }
==&gt;Script7<span class="error">$</span>_run_closure1<span class="error">@</span><span class="integer">6</span>b24f3ab
gremlin&gt; :&gt; multiplyIt(<span class="integer">7</span>, <span class="integer">8</span>)
No signature of <span class="key">method</span>: org.apache.tinkerpop.gremlin.groovy.jsr223.GremlinGroovyScriptEngine.multiplyIt() is applicable <span class="keyword">for</span> argument <span class="key">types</span>: (java.lang.Integer, java.lang.Integer) <span class="key">values</span>: [<span class="integer">7</span>, <span class="integer">8</span>]
Display stack trace? [yN]</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the function is declared this way, the function is viewed by the <code>ScriptEngine</code> as a variable rather than a global
function and since sessionless requests don&#8217;t maintain state, the function is forgotten for the next request. A final
option would be to manage the <code>ScriptEngine</code> cache manually:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bourne">$ curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;def divideIt(int x, int y){ x / y }\&quot;,\&quot;bindings\&quot;:{\&quot;#jsr223.groovy.engine.keep.globals\&quot;:\&quot;phantom\&quot;}}&quot; &quot;http://localhost:8182&quot;
{&quot;requestId&quot;:&quot;97fe1467-a943-45ea-8fd6-9e889a6c9381&quot;,&quot;status&quot;:{&quot;message&quot;:&quot;&quot;,&quot;code&quot;:200,&quot;attributes&quot;:{}},&quot;result&quot;:{&quot;data&quot;:[null],&quot;meta&quot;:{}}}
$ curl -X POST -d &quot;{\&quot;gremlin\&quot;:\&quot;divideIt(8, 2)\&quot;}&quot; &quot;http://localhost:8182&quot;
{&quot;message&quot;:&quot;Error encountered evaluating script: divideIt(8, 2)&quot;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above REST-based requests, the bindings contain a special parameter that tells the <code>ScriptEngine</code> cache to
immediately forget the script after execution. In this way, the function does not end up being globally available.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-plugins">Gremlin Plugins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="../images/gremlin-plugin.png" alt="gremlin plugin" width="125"></span></p>
</div>
<div class="paragraph">
<p>Plugins provide a way to expand the features of Gremlin Console and Gremlin Server. The following sections describe
the plugins that are available directly from TinkerPop. Please see the
<a href="http://tinkerpop.apache.org/docs/3.2.6/dev/provider/#gremlin-plugins">Provider Documentation</a> for information on
how to develop custom plugins.</p>
</div>
<div class="sect2">
<h3 id="credentials-plugin">Credentials Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-server.png" alt="gremlin server" width="200"></span> <a href="#gremlin-server">Gremlin Server</a> supports an authentication model
where user credentials are stored inside of a <code>Graph</code> instance.  This database can be managed with the
<a href="#credentials-dsl">Credentials DSL</a>, which can be installed in the console via the Credentials Plugin.  This plugin
is packaged with the console, but is not enabled by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin use tinkerpop.credentials
==&gt;tinkerpop.credentials activated</code></pre>
</div>
</div>
<div class="paragraph">
<p>This plugin imports the appropriate classes for managing the credentials graph.</p>
</div>
</div>
<div class="sect2">
<h3 id="gephi-plugin">Gephi Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gephi-logo.png" alt="gephi logo" width="200"></span> <a href="http://gephi.org/">Gephi</a> is an interactive visualization,
exploration, and analysis platform for graphs. The <a href="https://gephi.org/plugins/#/plugin/graphstreaming">Graph Streaming</a>
plugin for Gephi provides an API that can be leveraged to stream graph data to a running Gephi application. The Gephi
plugin for Gremlin Console utilizes this API to allow for graph and traversal visualization.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
These instructions have been tested with Gephi 0.9.1 and Graph Streaming plugin 1.0.3.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following instructions assume that Gephi has been download and installed.  It further assumes that the Graph
Streaming plugin has been installed (<code>Tools &gt; Plugins</code>). The following instructions explain how to visualize a
<code>Graph</code> and <code>Traversal</code>.</p>
</div>
<div class="paragraph">
<p>In Gephi, create a new project with <code>File &gt; New Project</code>.  In the lower left view, click the "Streaming" tab, open the
Master drop down, and right click <code>Master Server &gt; Start</code> which starts the Graph Streaming server in Gephi and by
default accepts requests at <code><a href="http://localhost:8080/workspace1" class="bare">http://localhost:8080/workspace1</a></code>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gephi-start-server.png" alt="gephi start server" width="800">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The Gephi Streaming Plugin doesn&#8217;t detect port conflicts and will appear to start the plugin successfully
even if there is something already active on that port it wants to connect to (which is 8080 by default).  Be sure
that there is nothing running on the port before Gephi will be using before starting the plugin.  Failing to do
this produce behavior where the console will appear to submit requests to Gephi successfully but nothing will
render.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Do not skip the <code>File &gt; New Project</code> step as it may prevent a newly started Gephi application from fully
enabling the streaming tab.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Start the <a href="#gremlin-console">Gremlin Console</a> and activate the Gephi plugin:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin use tinkerpop.gephi
==&gt;tinkerpop.gephi activated
gremlin&gt; graph = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; :remote connect tinkerpop.gephi
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace1 with stepDelay:1000, startRGBColor:[0.0, 1.0, 0.5], colorToFade:g, colorFadeRate:0.7, startSize:10.0,sizeDecrementRate:0.33</span>
gremlin&gt; :&gt; graph
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
==&gt;<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The above Gremlin session activates the Gephi plugin, creates the "modern" <code>TinkerGraph</code>, uses the <code>:remote</code> command
to setup a connection to the Graph Streaming server in Gephi (with default parameters that will be explained below),
and then uses <code>:submit</code> which sends the vertices and edges of the graph to the Gephi Streaming Server. The resulting
graph appears in Gephi as displayed in the left image below.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gephi-graph-submit.png" alt="gephi graph submit" width="800">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Issuing <code>:&gt; graph</code> again will clear the Gephi workspace and then re-write the graph.  To manually empty the
workspace do <code>:&gt; clear</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now that the graph is visualized in Gephi, it is possible to <a href="https://gephi.github.io/users/tutorial-layouts/">apply a layout algorithm</a>,
change the size and/or color of vertices and edges, and display labels/properties of interest.  Further information
can be found in Gephi&#8217;s tutorial on <a href="https://gephi.github.io/users/tutorial-visualization/">Visualization</a>.
After applying the Fruchterman Reingold layout, increasing the node size, decreasing the edge scale, and displaying
the id, name, and weight attributes the graph looks as displayed in the right image above.</p>
</div>
<div class="paragraph">
<p>Visualization of a <code>Traversal</code> has a different approach as the visualization occurs as the <code>Traversal</code> is executing,
thus showing a real-time view of its execution.  A <code>Traversal</code> must be "configured" to operate in this format and for
that it requires use of the <code>visualTraversal</code> option on the <code>config</code> function of the <code>:remote</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote config visualTraversal graph <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace1 with stepDelay:1000, startRGBColor:[0.0, 1.0, 0.5], colorToFade:g, colorFadeRate:0.7, startSize:10.0,sizeDecrementRate:0.33</span>
gremlin&gt; traversal = vg.V(<span class="integer">2</span>).in().out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).
                             has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt(<span class="integer">30</span>)).outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).
                             has(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>,gt(<span class="float">0.5d</span>)).inV();<span class="type">[]</span> <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
gremlin&gt; :&gt; traversal <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;v[<span class="integer">5</span>]
==&gt;<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Configure a "visual traversal" from your "graph" - this must be a <code>Graph</code> instance. This command will create a
new <code>TraversalSource</code> called "vg" that must be used to visualize any spawned traversals in Gephi.</p>
</li>
<li>
<p>Define the traversal to be visualized. Note that ending the line with <code>;[]</code> simply prevents iteration of
the traversal before it is submitted.</p>
</li>
<li>
<p>Submit the <code>Traversal</code> to visualize to Gephi.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When the <code>:&gt;</code> line is called, each step of the <code>Traversal</code> that produces or filters vertices generates events to
Gephi. The events update the color and size of the vertices at that step with <code>startRGBColor</code> and <code>startSize</code>
respectively. After the first step visualization, it sleeps for the configured <code>stepDelay</code> in milliseconds. On the
second step, it decays the configured <code>colorToFade</code> of all the previously visited vertices in prior steps, by
multiplying the current <code>colorToFade</code> value for each vertex with the <code>colorFadeRate</code>.  Setting the <code>colorFadeRate</code>
value to <code>1.0</code> will prevent the color decay.  The screenshots below show how the visualization evolves over the four
steps:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gephi-traversal.png" alt="gephi traversal" width="1200">
</div>
</div>
<div class="paragraph">
<p>To get a sense of how the visualization configuration parameters affect the output, see the example below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :remote config startRGBColor [<span class="float">0.0</span>,<span class="float">0.3</span>,<span class="float">1.0</span>]
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace1 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:g, colorFadeRate:0.7, startSize:10.0,sizeDecrementRate:0.33</span>
gremlin&gt; :remote config colorToFade b
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace1 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:b, colorFadeRate:0.7, startSize:10.0,sizeDecrementRate:0.33</span>
gremlin&gt; :remote config colorFadeRate <span class="float">0.5</span>
==&gt;<span class="predefined-type">Connection</span> to Gephi - <span class="key">http</span>:<span class="comment">//localhost:8080/workspace1 with stepDelay:1000, startRGBColor:[0.0, 0.3, 1.0], colorToFade:b, colorFadeRate:0.5, startSize:10.0,sizeDecrementRate:0.33</span>
gremlin&gt; :&gt; traversal
==&gt;<span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/gephi-traversal-config.png" alt="gephi traversal config" width="400">
</div>
</div>
<div class="paragraph">
<p>The visualization configuration above starts with a blue color now (most recently visited), fading the blue color
(so that dark green remains on oldest visited), and fading the blue color more quickly so that the gradient from dark
green to blue across steps has higher contrast. The following table provides a more detailed description of the
Gephi plugin configuration parameters as accepted via the <code>:remote config</code> command:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 66.6666%;">
<col style="width: 13.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Parameter</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Default</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">workspace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the workspace that your Graph Streaming server is started for.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">workspace1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host URL where the Graph Streaming server is configured for.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">localhost</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the URL that the Graph Streaming server is listening on.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8080</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sizeDecrementRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The rate at which the size of an element decreases on each step of the visualization.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.33</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">stepDelay</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The amount of time in milliseconds to pause between step visualizations.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startRGBColor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A size 3 float array of RGB color values which define the starting color to update most recently visited nodes with.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">[0.0,1.0,0.5]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">startSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size an element should be when it is most recently visited.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">colorToFade</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A single char from the set <code>{r,g,b,R,G,B}</code> determining which color to fade for vertices visited in prior steps</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">g</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">colorFadeRate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A float value in the range <code>(0.0,1.0]</code> which is multiplied against the current <code>colorToFade</code> value for prior vertices; a <code>1.0</code> value effectively turns off the color fading of prior step visited vertices</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0.7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">visualTraversal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Creates a <code>TraversalSource</code> variable in the Console named <code>vg</code> which can be used for visualizing traversals. This configuration option takes two parameters.  The first is required and is the name of the <code>Graph</code> instance variable that will generate the <code>TraversalSource</code>.  The second parameter is the variable name that the <code>TraversalSource</code> should have when referenced in the Console.  If left unspecified, this value defaults to <code>vg</code>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">vg</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="server-plugin">Server Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-server.png" alt="gremlin server" width="200"></span> <a href="#gremlin-server">Gremlin Server</a> remotely executes Gremlin scripts
that are submitted to it.  The Server Plugin provides a way to submit scripts to Gremlin Server for remote
processing.  Read more about the plugin and how it works in the Gremlin Server section on <a href="#connecting-via-console">Connecting via Console</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Server Plugin is enabled in the Gremlin Console by default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="sugar-plugin">Sugar Plugin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/gremlin-sugar.png" alt="gremlin sugar" width="120"></span> In previous versions of Gremlin-Groovy, there were numerous
<a href="http://en.wikipedia.org/wiki/Syntactic_sugar">syntactic sugars</a> that users could rely on to make their traversals
more succinct. Unfortunately, many of these conventions made use of <a href="http://docs.oracle.com/javase/tutorial/reflect/">Java reflection</a>
and thus, were not performant. In TinkerPop3, these conveniences have been removed in support of the standard
Gremlin-Groovy syntax being both inline with Gremlin-Java8 syntax as well as always being the most performant
representation. However, for those users that would like to use the previous syntactic sugars (as well as new ones),
there is <code>SugarGremlinPlugin</code> (a.k.a Gremlin-Groovy-Sugar).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
It is important that the sugar plugin is loaded in a Gremlin Console session prior to any manipulations of
the respective TinkerPop3 objects as Groovy will cache unavailable methods and properties.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin use tinkerpop.sugar
==&gt;tinkerpop.sugar activated</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
When using Sugar in a Groovy class file, add <code>static { SugarLoader.load() }</code> to the head of the file. Note that
<code>SugarLoader.load()</code> will automatically call <code>GremlinLoader.load()</code>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_graph_traversal_methods">Graph Traversal Methods</h4>
<div class="paragraph">
<p>If a <code>GraphTraversal</code> property is unknown and there is a corresponding method with said name off of <code>GraphTraversal</code>
then the property is assumed to be a method call. This enables the user to omit <code>( )</code> from the method name. However,
if the property does not reference a <code>GraphTraversal</code> method, then it is assumed to be a call to <code>values(property)</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">6</span>]
gremlin&gt; g.V.name <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V.outE.weight <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;<span class="float">0.4</span>
==&gt;<span class="float">0.5</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">1.0</span>
==&gt;<span class="float">0.4</span>
==&gt;<span class="float">0.2</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>There is no need for the parentheses in <code>g.V()</code>.</p>
</li>
<li>
<p>The traversal is interpreted as <code>g.V().values('name')</code>.</p>
</li>
<li>
<p>A chain of zero-argument step calls with a property value call.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_range_queries">Range Queries</h4>
<div class="paragraph">
<p>The <code>[x]</code> and <code>[x..y]</code> range operators in Groovy translate to <code>RangeStep</code> calls.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V[<span class="integer">0</span>..<span class="integer">2</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; g.V[<span class="integer">0</span>..&lt;<span class="integer">2</span>]
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g.V[<span class="integer">2</span>]
==&gt;v[<span class="integer">3</span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_logical_operators">Logical Operators</h4>
<div class="paragraph">
<p>The <code>&amp;</code> and <code>|</code> operator are overloaded in <code>SugarGremlinPlugin</code>. When used, they introduce the <code>AndStep</code> and <code>OrStep</code>
markers into the traversal. See <a href="#and-step"><code>and()</code></a> and <a href="#or-step"><code>or()</code></a> for more information.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V.where(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) &amp; outE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).name <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;marko
gremlin&gt; t = g.V.where(outE(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>) | inE(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>)).name; <span class="predefined-constant">null</span> <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
gremlin&gt; t.toString()
==&gt;[GraphStep(vertex,<span class="type">[]</span>), TraversalFilterStep([VertexStep(OUT,[knows],edge), OrStep, VertexStep(IN,[created],edge)]), PropertiesStep([name],value)]
gremlin&gt; t
==&gt;marko
==&gt;lop
==&gt;ripple
gremlin&gt; t.toString()
==&gt;[TinkerGraphStep(vertex,<span class="type">[]</span>), TraversalFilterStep([OrStep([[VertexStep(OUT,[knows],edge)], [VertexStep(IN,[created],edge)]])]), PropertiesStep([name],value)]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Introducing the <code>AndStep</code> with the <code>&amp;</code> operator.</p>
</li>
<li>
<p>Introducing the <code>OrStep</code> with the <code>|</code> operator.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_traverser_methods">Traverser Methods</h4>
<div class="paragraph">
<p>It is rare that a user will ever interact with a <code>Traverser</code> directly. However, if they do, some method redirects exist
to make it easy.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; g.V().map{<span class="local-variable">it</span>.get().value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)}  <span class="comment">// conventional</span>
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter
gremlin&gt; g.V.map{<span class="local-variable">it</span>.name}  <span class="comment">// sugar</span>
==&gt;marko
==&gt;vadas
==&gt;lop
==&gt;josh
==&gt;ripple
==&gt;peter</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="utilities-plugin">Utilities Plugin</h3>
<div class="paragraph">
<p>The Utilities Plugin provides various functions, helper methods and imports of external classes that are useful in the console.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The Utilities Plugin is enabled in the Gremlin Console by default.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="benchmarking-and-profiling">Benchmarking and Profiling</h4>
<div class="paragraph">
<p>The <a href="https://code.google.com/p/gperfutils/">GPerfUtils</a> library provides a number of performance utilities for
Groovy.  Specifically, these tools cover benchmarking and profiling.</p>
</div>
<div class="paragraph">
<p>Benchmarking allows execution time comparisons of different pieces of code. While such a feature is generally useful,
in the context of Gremlin, benchmarking can help compare traversal performance times to determine the optimal
approach.  Profiling helps determine the parts of a program which are taking the most execution time, yielding
low-level insight into the code being examined.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :plugin use tinkerpop.sugar <span class="comment">// Activate sugar plugin for use in benchmark</span>
==&gt;Specify the name of the plugin to use
gremlin&gt; benchmark{
          <span class="string"><span class="delimiter">'</span><span class="content">sugar</span><span class="delimiter">'</span></span> {g.V(<span class="integer">1</span>).name.next()}
          <span class="string"><span class="delimiter">'</span><span class="content">nosugar</span><span class="delimiter">'</span></span> {g.V(<span class="integer">1</span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).next()}
         }.prettyPrint()
Environment
===========
* <span class="key">Groovy</span>: <span class="float">2.4</span><span class="float">.11</span>
* <span class="key">JVM</span>: Java HotSpot(TM) <span class="integer">64</span>-Bit Server VM (<span class="float">25.121</span>-b13, Oracle Corporation)
    * <span class="key">JRE</span>: <span class="float">1.8</span><span class="float">.0</span>_121
    * Total <span class="key">Memory</span>: <span class="integer">1619</span> MB
    * Maximum <span class="key">Memory</span>: <span class="float">3566.5</span> MB
* <span class="key">OS</span>: Linux (<span class="float">3.13</span><span class="float">.0</span>-<span class="integer">107</span>-generic, amd64)

Options
=======
* Warm <span class="key">Up</span>: Auto (- <span class="integer">60</span> sec)
* CPU <span class="predefined-type">Time</span> <span class="key">Measurement</span>: On

          user  system    cpu   real

sugar    <span class="integer">19991</span>     <span class="integer">530</span>  <span class="integer">20521</span>  <span class="integer">20615</span>
nosugar  <span class="integer">11090</span>     <span class="integer">119</span>  <span class="integer">11209</span>  <span class="integer">11256</span>
gremlin&gt; profile { g.V().iterate() }.prettyPrint()
<span class="key">Flat</span>:

 %    cumulative   self            self     total    self    total   self    total
time   seconds    seconds  calls  ms/call  ms/call  min ms  min ms  max ms  max ms  name
<span class="float">52.3</span>        <span class="float">0.00</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">0.61</span>     <span class="float">1.16</span>    <span class="float">0.61</span>    <span class="float">1.16</span>    <span class="float">0.61</span>    <span class="float">1.16</span>  groovysh_evaluate<span class="error">$</span>_run_closure1.doCall
<span class="float">36.4</span>        <span class="float">0.00</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">0.42</span>     <span class="float">0.42</span>    <span class="float">0.42</span>    <span class="float">0.42</span>    <span class="float">0.42</span>    <span class="float">0.42</span>  org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.DefaultGraphTraversal.iterate
<span class="float">11.1</span>        <span class="float">0.00</span>     <span class="float">0.00</span>      <span class="integer">1</span>     <span class="float">0.13</span>     <span class="float">0.13</span>    <span class="float">0.13</span>    <span class="float">0.13</span>    <span class="float">0.13</span>    <span class="float">0.13</span>  org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource.V

Call <span class="key">graph</span>:

index  % time  self  children  calls  name
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      &lt;spontaneous&gt;
[<span class="integer">1</span>]     <span class="float">100.0</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.DefaultGraphTraversal.iterate [<span class="integer">2</span>]
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource.V [<span class="integer">3</span>]
------------------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
[<span class="integer">2</span>]      <span class="float">36.4</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.DefaultGraphTraversal.iterate [<span class="integer">2</span>]
------------------------------------------------------------------------------------------------------------------------------------
               <span class="float">0.00</span>      <span class="float">0.00</span>    <span class="integer">1</span>/<span class="integer">1</span>      groovysh_evaluate<span class="error">$</span>_run_closure1.doCall [<span class="integer">1</span>]
[<span class="integer">3</span>]      <span class="float">11.1</span>  <span class="float">0.00</span>      <span class="float">0.00</span>      <span class="integer">1</span>  org.apache.tinkerpop.gremlin.process.traversal.dsl.graph.GraphTraversalSource.V [<span class="integer">3</span>]
------------------------------------------------------------------------------------------------------------------------------------</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="describe-graph">Describe Graph</h4>
<div class="paragraph">
<p>A good implementation of the Gremlin APIs will validate their features against the <a href="#validating-with-gremlin-test">Gremlin test suite</a>.
To learn more about a specific implementation&#8217;s compliance with the test suite, use the <code>describeGraph</code> function.
The following shows the output for <code>HadoopGraph</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; describeGraph(HadoopGraph)
==&gt;
IMPLEMENTATION - org.apache.tinkerpop.gremlin.hadoop.structure.HadoopGraph
TINKERPOP TEST SUITE
- Compliant with (<span class="integer">5</span> of <span class="integer">10</span> suites)
&gt; org.apache.tinkerpop.gremlin.structure.StructureStandardSuite
&gt; org.apache.tinkerpop.gremlin.process.ProcessStandardSuite
&gt; org.apache.tinkerpop.gremlin.process.ProcessComputerSuite
&gt; org.apache.tinkerpop.gremlin.process.GroovyProcessStandardSuite
&gt; org.apache.tinkerpop.gremlin.process.GroovyProcessComputerSuite
- Opts out of <span class="integer">45</span> individual tests
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_hasXname_GarciaX__a_0writtenBy_b__a_0sungBy_bX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0sungBy_c__b_writtenBy_d__c_writtenBy_e__d_hasXname_George_HarisonX__e_hasXname_Bob_MarleyXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0writtenBy_c__b_writtenBy_d__c_sungBy_d__d_hasXname_GarciaXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0writtenBy_c__b_writtenBy_dX_whereXc_sungBy_dX_whereXd_hasXname_GarciaXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_knows_b__c_knows_bX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_created_b__c_created_bX_selectXa_b_cX_byXnameX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_out_asXcX_matchXb_knows_a__c_created_eX_selectXcX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_hasXname_GarciaX__a_0writtenBy_b__a_0sungBy_bX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_knows_b__c_knows_bX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_created_b__c_created_bX_selectXa_b_cX_byXnameX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_out_asXcX_matchXb_knows_a__c_created_eX_selectXcX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Giraph does a hard kill on failure and stops threads which stops test cases. Exception handling semantics are correct though.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0sungBy_c__b_writtenBy_d__c_writtenBy_e__d_hasXname_George_HarisonX__e_hasXname_Bob_MarleyXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0writtenBy_c__b_writtenBy_d__c_sungBy_d__d_hasXname_GarciaXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_matchXa_0sungBy_b__a_0writtenBy_c__b_writtenBy_dX_whereXc_sungBy_dX_whereXd_hasXname_GarciaXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.CountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_both_both_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.CountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX3X_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.CountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX8X_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.CountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX5X_asXaX_outXwrittenByX_asXbX_selectXa_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyCountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_both_both_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyCountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX3X_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyCountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX8X_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyCountTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXoutX_timesX5X_asXaX_outXwrittenByX_asXbX_selectXa_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.ProfileTest<span class="error">$</span>Traversals<span class="error">#</span>grateful_V_out_out_profile
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.ProfileTest<span class="error">$</span>Traversals<span class="error">#</span>grateful_V_out_out_profileXmetricsX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyProfileTest<span class="error">$</span>Traversals<span class="error">#</span>grateful_V_out_out_profile
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyProfileTest<span class="error">$</span>Traversals<span class="error">#</span>grateful_V_out_out_profileXmetricsX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTest<span class="error">#</span>g_V_hasLabelXsongX_groupXaX_byXnameX_byXproperties_groupCount_byXlabelXX_out_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTest<span class="error">#</span>g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTest<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_group_byXsongTypeX_byXcountX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTest<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_groupXaX_byXsongTypeX_byXcountX_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTestV3d0<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_group_byXsongTypeX_byXcountX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroupTestV3d0<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_groupXaX_byXsongTypeX_byXcountX_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_hasLabelXsongX_groupXaX_byXnameX_byXproperties_groupCount_byXlabelXX_out_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_outXfollowedByX_group_byXsongTypeX_byXbothE_group_byXlabelX_byXweight_sumXX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_group_byXsongTypeX_byXcountX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTest<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_groupXaX_byXsongTypeX_byXcountX_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTestV3d0<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_group_byXsongTypeX_byXcountX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.sideEffect.GroovyGroupTestV3d0<span class="error">$</span>Traversals<span class="error">#</span>g_V_repeatXbothXfollowedByXX_timesX2X_groupXaX_byXsongTypeX_byXcountX_capXaX
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.computer.GraphComputerTest<span class="error">#</span>shouldStartAndEndWorkersForVertexProgramAndMapReduce
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Spark executes map and combine in a lazy fashion and thus, fails the blocking aspect of this test</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.TraversalInterruptionTest<span class="error">#</span>*
        <span class="string"><span class="delimiter">&quot;</span><span class="content">The interruption model in the test can't guarantee interruption at the right time with HadoopGraph.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.TraversalInterruptionComputerTest<span class="error">#</span>*
        <span class="string"><span class="delimiter">&quot;</span><span class="content">This test makes use of a sideEffect to enforce when a thread interruption is triggered and thus isn't applicable to HadoopGraph</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>CountMatchTraversals<span class="error">#</span>g_V_matchXa_followedBy_count_isXgtX10XX_b__a_0followedBy_count_isXgtX10XX_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.MatchTest<span class="error">$</span>GreedyMatchTraversals<span class="error">#</span>g_V_matchXa_followedBy_count_isXgtX10XX_b__a_0followedBy_count_isXgtX10XX_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>CountMatchTraversals<span class="error">#</span>g_V_matchXa_followedBy_count_isXgtX10XX_b__a_0followedBy_count_isXgtX10XX_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
&gt; org.apache.tinkerpop.gremlin.process.traversal.step.map.GroovyMatchTest<span class="error">$</span>GreedyMatchTraversals<span class="error">#</span>g_V_matchXa_followedBy_count_isXgtX10XX_b__a_0followedBy_count_isXgtX10XX_bX_count
        <span class="string"><span class="delimiter">&quot;</span><span class="content">Hadoop-Gremlin is OLAP-oriented and for OLTP operations, linear-scan joins are required. This particular tests takes many minutes to execute.</span><span class="delimiter">&quot;</span></span>
- NOTE -
The describeGraph() function shows information about a Graph implementation.
It uses information found <span class="keyword">in</span> Java Annotations on the implementation itself to
determine <span class="local-variable">this</span> output and does not assess the actual code of the test cases of
the implementation itself.  Compliant implementations will faithfully and
honestly supply these Annotations to provide the most accurate depiction of
their support.</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-archetypes">Gremlin Archetypes</h2>
<div class="sectionbody">
<div class="paragraph">
<p>TinkerPop has a number of <a href="https://maven.apache.org/guides/introduction/introduction-to-archetypes.html">Maven archetypes</a>,
which provide example project templates to quickly get started with TinkerPop. The available archetypes are as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gremlin-archetype-dsl</code> - An example project that demonstrates how to build Domain Specific Languages with Gremlin in Java.</p>
</li>
<li>
<p><code>gremlin-archetype-server</code> - An example project that demonstrates the basic structure of a
<a href="#gremlin-server">Gremlin Server</a> project, how to connect with the Gremlin Driver, and how to embed Gremlin Server in
a testing framework.</p>
</li>
<li>
<p><code>gremlin-archetype-tinkergraph</code> - A basic example of how to structure a TinkerPop project with Maven.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can use Maven to generate these example projects with a command like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">$ mvn archetype:generate -DarchetypeGroupId=org.apache.tinkerpop -DarchetypeArtifactId=gremlin-archetype-server
      -DarchetypeVersion=3.2.6 -DgroupId=com.my -DartifactId=app -Dversion=0.1 -DinteractiveMode=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>This command will generate a new Maven project in a directory called "app" with a <code>pom.xml</code> specifying a <code>groupId</code> of
<code>com.my</code>. Please see the <code>README.asciidoc</code> in the root of each generated project for information on how to build and
execute it.</p>
</div>
</div>
</div>
<h1 id="implementations" class="sect0">Implementations</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-racecar.png" alt="gremlin racecar" width="325">
</div>
</div>
<div class="paragraph">
<p>TinkerPop offers several reference implementations of its interfaces that are not only meant for production usage,
but also represent models by which different graph providers can build their systems. More specific documentation
on how to build systems at this level of the API can be found in the
<a href="http://tinkerpop.apache.org/docs/3.2.6/dev/provider/">Provider Documentation</a>. The following sections
describe the various reference implementations and their usage.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tinkergraph-gremlin">TinkerGraph-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>tinkergraph-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/tinkerpop-character.png" alt="tinkerpop character" width="100"></span> TinkerGraph is a single machine, in-memory (with optional
persistence), non-transactional graph engine that provides both OLTP and OLAP functionality. It is deployed with
TinkerPop3 and serves as the reference implementation for other providers to study in order to understand the
semantics of the various methods of the TinkerPop3 API. Constructing a simple graph in Java8 is presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Graph g = TinkerGraph.open();
Vertex marko = g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>,<span class="integer">29</span>);
Vertex lop = g.addVertex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>);
marko.addEdge(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>,lop,<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>,<span class="float">0.6d</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above graph creates two vertices named "marko" and "lop" and connects them via a created-edge with a weight=0.6
property. Next, the graph can be queried as such.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.V().has(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>).out(<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>).values(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>g.V().has("name","marko")</code> part of the query can be executed in two ways.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A linear scan of all vertices filtering out those vertices that don&#8217;t have the name "marko"</p>
</li>
<li>
<p>A <code>O(log(|V|))</code> index lookup for all vertices with the name "marko"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Given the initial graph construction in the first code block, no index was defined and thus, a linear scan is executed.
However, if the graph was constructed as such, then an index lookup would be used.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">Graph g = TinkerGraph.open();
g.createIndex(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>,Vertex.class)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The execution times for a vertex lookup by property is provided below for both no-index and indexed version of
TinkerGraph over the Grateful Dead graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; clock(<span class="integer">1000</span>) {g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).iterate()} <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="float">0.236629348</span>
gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>], standard]
gremlin&gt; graph.createIndex(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,Vertex.class)
gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; clock(<span class="integer">1000</span>){g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).iterate()} <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="float">0.077380389</span></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Determine the average runtime of 1000 vertex lookups when no <code>name</code>-index is defined.</p>
</li>
<li>
<p>Determine the average runtime of 1000 vertex lookups when a <code>name</code>-index is defined.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Each graph system will have different mechanism by which indices and schemas are defined. TinkerPop3
does not require any conformance in this area. In TinkerGraph, the only definitions are around indices. With other
graph systems, property value types, indices, edge labels, etc. may be required to be defined <em>a priori</em> to adding
data to the graph.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
TinkerGraph is distributed with Gremlin Server and is therefore automatically available to it for configuration.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_configuration_3">Configuration</h3>
<div class="paragraph">
<p>TinkerGraph has several settings that can be provided on creation via <code>Configuration</code> object:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.vertexIdManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>IdManager</code> implementation to use for vertices.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.edgeIdManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>IdManager</code> implementation to use for edges.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.vertexPropertyIdManager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <code>IdManager</code> implementation to use for vertex properties.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.defaultVertexPropertyCardinality</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default <code>VertexProperty.Cardinality</code> to use when <code>Vertex.property(k,v)</code> is called.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.graphLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The path and file name for where TinkerGraph should persist the graph data. If a
value is specified here, the <code>gremlin.tinkergraph.graphFormat</code> should also be specified.  If this value is not
included (default), then the graph will stay in-memory and not be loaded/persisted to disk.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.tinkergraph.graphFormat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The format to use to serialize the graph which may be one of the following:
<code>graphml</code>, <code>graphson</code>, <code>gryo</code>, or a fully qualified class name that implements Io.Builder interface (which allows for
external third party graph reader/writer formats to be used for persistence).
If a value is specified here, then the <code>gremlin.tinkergraph.graphLocation</code> should
also be specified.  If this value is not included (default), then the graph will stay in-memory and not be
loaded/persisted to disk.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>IdManager</code> settings above refer to how TinkerGraph will control identifiers for vertices, edges and vertex
properties.  There are several options for each of these settings: <code>ANY</code>, <code>LONG</code>, <code>INTEGER</code>, <code>UUID</code>, or the fully
qualified class name of an <code>IdManager</code> implementation on the classpath.  When not specified, the default values
for all settings is <code>ANY</code>, meaning that the graph will work with any object on the JVM as the identifier and will
generate new identifiers from <code>Long</code> when the identifier is not user supplied.  TinkerGraph will also expect the
user to understand the types used for identifiers when querying, meaning that <code>g.V(1)</code> and <code>g.V(1L)</code> could return
two different vertices.  <code>LONG</code>, <code>INTEGER</code> and <code>UUID</code> settings will try to coerce identifier values to the expected
type as well as generate new identifiers with that specified type.</p>
</div>
<div class="paragraph">
<p>If the TinkerGraph is configured for persistence with <code>gremlin.tinkergraph.graphLocation</code> and
<code>gremlin.tinkergraph.graphFormat</code>, then the graph will be written to the specified location with the specified
format when <code>Graph.close()</code> is called.  In addition, if these settings are present, TinkerGraph will attempt to
load the graph from the specified location.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If choosing <code>graphson</code> as the <code>gremlin.tinkergraph.graphFormat</code>, be sure to also establish the  various
<code>IdManager</code> settings as well to ensure that identifiers are properly coerced to the appropriate types as GraphSON
can lose the identifier&#8217;s type during serialization (i.e. it will assume <code>Integer</code> when the default for TinkerGraph
is <code>Long</code>, which could lead to load errors that result in a message like, "Vertex with id already exists").
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is important to consider the data being imported to TinkerGraph with respect to <code>defaultVertexPropertyCardinality</code>
setting.  For example, if a <code>.gryo</code> file is known to contain multi-property data, be sure to set the default
cardinality to <code>list</code> or else the data will import as <code>single</code>.  Consider the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = TinkerGraph.open()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.io(gryo()).readGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">data/tinkerpop-crew.kryo</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>], standard]
gremlin&gt; g.V().properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[location-&gt;santa fe]
==&gt;vp[name-&gt;stephen]
==&gt;vp[location-&gt;purcellville]
==&gt;vp[name-&gt;matthias]
==&gt;vp[location-&gt;seattle]
==&gt;vp[name-&gt;daniel]
==&gt;vp[location-&gt;aachen]
==&gt;vp[name-&gt;gremlin]
==&gt;vp[name-&gt;tinkergraph]
gremlin&gt; conf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="integer">5</span>af64ce0
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin.tinkergraph.defaultVertexPropertyCardinality</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; graph = TinkerGraph.open(conf)
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">0</span> <span class="key">edges</span>:<span class="integer">0</span>]
gremlin&gt; graph.io(gryo()).readGraph(<span class="string"><span class="delimiter">&quot;</span><span class="content">data/tinkerpop-crew.kryo</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">14</span>], standard]
gremlin&gt; g.V().properties()
==&gt;vp[name-&gt;marko]
==&gt;vp[location-&gt;san diego]
==&gt;vp[location-&gt;santa cruz]
==&gt;vp[location-&gt;brussels]
==&gt;vp[location-&gt;santa fe]
==&gt;vp[name-&gt;stephen]
==&gt;vp[location-&gt;centreville]
==&gt;vp[location-&gt;dulles]
==&gt;vp[location-&gt;purcellville]
==&gt;vp[name-&gt;matthias]
==&gt;vp[location-&gt;bremen]
==&gt;vp[location-&gt;baltimore]
==&gt;vp[location-&gt;oakland]
==&gt;vp[location-&gt;seattle]
==&gt;vp[name-&gt;daniel]
==&gt;vp[location-&gt;spremberg]
==&gt;vp[location-&gt;kaiserslautern]
==&gt;vp[location-&gt;aachen]
==&gt;vp[name-&gt;gremlin]
==&gt;vp[name-&gt;tinkergraph]</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="neo4j-gremlin">Neo4j-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>neo4j-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span>
<span class="comment">&lt;!-- neo4j-tinkerpop-api-impl is NOT Apache 2 licensed - more information below --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
  <span class="tag">&lt;groupId&gt;</span>org.neo4j<span class="tag">&lt;/groupId&gt;</span>
  <span class="tag">&lt;artifactId&gt;</span>neo4j-tinkerpop-api-impl<span class="tag">&lt;/artifactId&gt;</span>
  <span class="tag">&lt;version&gt;</span>0.3-2.3.3<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://neo4j.com">Neo Technology</a> are the developers of the OLTP-based <a href="http://neo4j.com">Neo4j graph database</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Unless under a commercial agreement with Neo Technology, Neo4j is licensed
<a href="http://en.wikipedia.org/wiki/Affero_General_Public_License">AGPL</a>. The <code>neo4j-gremlin</code> module is licensed Apache2
because it only references the Apache2-licensed Neo4j API (not its implementation). Note that neither the
<a href="#gremlin-console">Gremlin Console</a> nor <a href="#gremlin-server">Gremlin Server</a> distribute with the Neo4j implementation
binaries. To access the binaries, use the <code>:install</code> command to download binaries from
<a href="http://search.maven.org/">Maven Central Repository</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For configuring Grape, the dependency resolver of Groovy, please refer to the <a href="#gremlin-applications">Gremlin Applications</a> section.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; :install org.apache.tinkerpop neo4j-gremlin 3.2.6
==&gt;<span class="key">Loaded</span>: [org.apache.tinkerpop, neo4j-gremlin, 3.2.6] - restart the console to use [tinkerpop.neo4j]
gremlin&gt; :q
...
gremlin&gt; :plugin use tinkerpop.neo4j
==&gt;tinkerpop.neo4j activated
gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[EmbeddedGraphDatabase [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
To host Neo4j in <a href="#gremlin-server">Gremlin Server</a>, the dependencies must first be "installed" or otherwise
copied to the Gremlin Server path. The automated method for doing this would be to execute
<code>bin/gremlin-server.sh -i org.apache.tinkerpop neo4j-gremlin 3.2.6</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_indices">Indices</h3>
<div class="paragraph">
<p>Neo4j 2.x indices leverage vertex labels to partition the index space. TinkerPop3 does not provide method interfaces
for defining schemas/indices for the underlying graph system. Thus, in order to create indices, it is important to
call the Neo4j API directly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>Neo4jGraphStep</code> will attempt to discern which indices to use when executing a traversal of the form <code>g.V().has()</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Gremlin-Console session below demonstrates Neo4j indices. For more information, please refer to the Neo4j documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manipulating indices with <a href="http://neo4j.com/docs/developer-manual/current/#query-schema-index">Cypher</a>.</p>
</li>
<li>
<p>Manipulating indices with the Neo4j <a href="http://neo4j.com/docs/stable/tutorials-java-embedded-new-index.html">Java API</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; graph.cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE INDEX ON :person(name)</span><span class="delimiter">&quot;</span></span>)
gremlin&gt; graph.tx().commit() <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
gremlin&gt; graph.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; graph.addVertex(label,<span class="string"><span class="delimiter">'</span><span class="content">dog</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">puppy</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">1</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;marko
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Schema mutations must happen in a different transaction than graph mutations</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Below demonstrates the runtime benefits of indices and demonstrates how if there is no defined index (only vertex
labels), a linear scan of the vertex-label partition is still faster than a linear scan of all vertices.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; graph.io(graphml()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.xml</span><span class="delimiter">'</span></span>)
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.tx().commit()
gremlin&gt; clock(<span class="integer">1000</span>) {g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).iterate()} <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;<span class="float">2.2044777759999996</span>
gremlin&gt; graph.cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">CREATE INDEX ON :artist(name)</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
gremlin&gt; g.tx().commit()
gremlin&gt; <span class="predefined-type">Thread</span>.sleep(<span class="integer">5000</span>) <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
gremlin&gt; clock(<span class="integer">1000</span>) {g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">artist</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).iterate()} <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
==&gt;<span class="float">0.232256006</span>
gremlin&gt; clock(<span class="integer">1000</span>) {g.V().has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">Garcia</span><span class="delimiter">'</span></span>).iterate()} <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
==&gt;<span class="float">2.380196942</span>
gremlin&gt; graph.cypher(<span class="string"><span class="delimiter">&quot;</span><span class="content">DROP INDEX ON :artist(name)</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
gremlin&gt; g.tx().commit()
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Find all artists whose name is Garcia which does a linear scan of the artist vertex-label partition.</p>
</li>
<li>
<p>Create an index for all artist vertices on their name property.</p>
</li>
<li>
<p>Neo4j indices are eventually consistent so this stalls to give the index time to populate itself.</p>
</li>
<li>
<p>Find all artists whose name is Garcia which uses the pre-defined schema index.</p>
</li>
<li>
<p>Find all vertices whose name is Garcia which requires a linear scan of all the data in the graph.</p>
</li>
<li>
<p>Drop the created index.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_multi_meta_properties">Multi/Meta-Properties</h3>
<div class="paragraph">
<p><code>Neo4jGraph</code> supports both multi- and meta-properties (see <a href="#vertex-properties">vertex properties</a>). These features
are not native to Neo4j and are implemented using "hidden" Neo4j nodes. For example, when a vertex has multiple
"name" properties, each property is a new node (multi-properties) which can have properties attached to it
(meta-properties). As such, the native, underlying representation may become difficult to query directly using
another graph language such as <a href="#_cypher">Cypher</a>. The default setting is to disable multi- and meta-properties.
However, if this feature is desired, then it can be activated via <code>gremlin.neo4j.metaProperties</code> and
<code>gremlin.neo4j.multiProperties</code> configurations being set to <code>true</code>. Once the configuration is set, it can not be
changed for the lifetime of the graph.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; conf = <span class="keyword">new</span> BaseConfiguration()
==&gt;org.apache.commons.configuration.BaseConfiguration<span class="error">@</span><span class="float">7e06</span>e03
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.neo4j.directory</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.neo4j.multiProperties</span><span class="delimiter">'</span></span>,<span class="predefined-constant">true</span>)
gremlin&gt; conf.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.neo4j.metaProperties</span><span class="delimiter">'</span></span>,<span class="predefined-constant">true</span>)
gremlin&gt; graph = Neo4jGraph.open(conf)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.addV().property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">michael</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">michael hunger</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">mhunger</span><span class="delimiter">'</span></span>)
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.V().properties(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).property(<span class="string"><span class="delimiter">'</span><span class="content">acl</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">public</span><span class="delimiter">'</span></span>)
==&gt;vp[name-&gt;michael]
==&gt;vp[name-&gt;michael hunger]
==&gt;vp[name-&gt;mhunger]
gremlin&gt; g.V(<span class="integer">0</span>).valueMap()
==&gt;[<span class="key">name</span>:[michael,michael hunger,mhunger]]
gremlin&gt; g.V(<span class="integer">0</span>).properties()
==&gt;vp[name-&gt;michael]
==&gt;vp[name-&gt;michael hunger]
==&gt;vp[name-&gt;mhunger]
gremlin&gt; g.V(<span class="integer">0</span>).properties().valueMap()
==&gt;[<span class="key">acl</span>:<span class="directive">public</span>]
==&gt;[<span class="key">acl</span>:<span class="directive">public</span>]
==&gt;[<span class="key">acl</span>:<span class="directive">public</span>]
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<code>Neo4jGraph</code> without multi- and meta-properties is in 1-to-1 correspondence with the native, underlying Neo4j
representation. It is recommended that if the user does not require multi/meta-properties, then they should not
enable them. Without multi- and meta-properties enabled, Neo4j can be interacted with with other tools and technologies
that do not leverage TinkerPop.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
When using a multi-property enabled <code>Neo4jGraph</code>, vertices may represent their properties on "hidden
nodes" adjacent to the vertex. If a vertex property key/value is required for indexing, then two indices are
required&#8201;&#8212;&#8201;e.g. <code>CREATE INDEX ON :person(name)</code> and <code>CREATE INDEX ON :vertexProperty(name)</code>
(see <a href="#_indices">Neo4j indices</a>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cypher">Cypher</h3>
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-loves-cypher.png" alt="gremlin loves cypher" width="400">
</div>
</div>
<div class="paragraph">
<p>NeoTechnology are the creators of the graph pattern-match query language <a href="https://neo4j.com/developer/cypher-query-language/">Cypher</a>.
It is possible to leverage Cypher from within Gremlin by using the <code>Neo4jGraph.cypher()</code> graph traversal method.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; graph.io(gryo()).readGraph(<span class="string"><span class="delimiter">'</span><span class="content">data/tinkerpop-modern.kryo</span><span class="delimiter">'</span></span>)
gremlin&gt; graph.cypher(<span class="string"><span class="delimiter">'</span><span class="content">MATCH (a {name:&quot;marko&quot;}) RETURN a</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:v[<span class="integer">0</span>]]
gremlin&gt; graph.cypher(<span class="string"><span class="delimiter">'</span><span class="content">MATCH (a {name:&quot;marko&quot;}) RETURN a</span><span class="delimiter">'</span></span>).select(<span class="string"><span class="delimiter">'</span><span class="content">a</span><span class="delimiter">'</span></span>).out(<span class="string"><span class="delimiter">'</span><span class="content">knows</span><span class="delimiter">'</span></span>).values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;josh
==&gt;vadas
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, like <a href="#match-step"><code>match()</code></a>-step in Gremlin, it is possible to do a declarative pattern match and then move
back into imperative Gremlin.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
For those developers using <a href="#gremlin-server">Gremlin Server</a> against Neo4j, it is possible to do Cypher queries
by simply placing the Cypher string in <code>graph.cypher(&#8230;&#8203;)</code> before submission to the server.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_multi_label">Multi-Label</h3>
<div class="paragraph">
<p>TinkerPop3 requires every <code>Element</code> to have a single, immutable string label (i.e. a <code>Vertex</code>, <code>Edge</code>, and
<code>VertexProperty</code>). In Neo4j, a <code>Node</code> (vertex) can have an
<a href="http://neo4j.com/docs/developer-manual/current/#graphdb-neo4j-labels">arbitrary number of labels</a> while a <code>Relationship</code>
(edge) can have one and only one. Furthermore, in Neo4j, <code>Node</code> labels are mutable while <code>Relationship</code> labels are
not. In order to handle this mismatch, three <code>Neo4jVertex</code> specific methods exist in Neo4j-Gremlin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">String</span>&gt; labels() <span class="comment">// get all the labels of the vertex</span>
<span class="directive">public</span> <span class="type">void</span> addLabel(<span class="predefined-type">String</span> label) <span class="comment">// add a label to the vertex</span>
<span class="directive">public</span> <span class="type">void</span> removeLabel(<span class="predefined-type">String</span> label) <span class="comment">// remove a label from the vertex</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>An example use case is presented below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = Neo4jGraph.open(<span class="string"><span class="delimiter">'</span><span class="content">/tmp/neo4j</span><span class="delimiter">'</span></span>)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; vertex = (Neo4jVertex) graph.addVertex(<span class="string"><span class="delimiter">'</span><span class="content">human::animal</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">1</b><span class="invisible">\</span>
==&gt;v[<span class="integer">0</span>]
gremlin&gt; vertex.label() <span class="invisible">//</span><b class="conum">2</b><span class="invisible">\</span>
==&gt;<span class="key">animal</span>::human
gremlin&gt; vertex.labels() <span class="invisible">//</span><b class="conum">3</b><span class="invisible">\</span>
==&gt;animal
==&gt;human
gremlin&gt; vertex.addLabel(<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">4</b><span class="invisible">\</span>
gremlin&gt; vertex.label()
==&gt;<span class="key">animal</span>::<span class="key">human</span>::organism
gremlin&gt; vertex.removeLabel(<span class="string"><span class="delimiter">'</span><span class="content">human</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">5</b><span class="invisible">\</span>
gremlin&gt; vertex.labels()
==&gt;animal
==&gt;organism
gremlin&gt; vertex.addLabel(<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">6</b><span class="invisible">\</span>
gremlin&gt; vertex.labels()
==&gt;animal
==&gt;organism
gremlin&gt; vertex.removeLabel(<span class="string"><span class="delimiter">'</span><span class="content">human</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">7</b><span class="invisible">\</span>
gremlin&gt; vertex.label()
==&gt;<span class="key">animal</span>::organism
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.V().has(label,<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>) <span class="invisible">//</span><b class="conum">8</b><span class="invisible">\</span>
gremlin&gt; g.V().has(label,of(<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>)) <span class="invisible">//</span><b class="conum">9</b><span class="invisible">\</span>
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.V().has(label,of(<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>)).has(label,of(<span class="string"><span class="delimiter">'</span><span class="content">animal</span><span class="delimiter">'</span></span>))
==&gt;v[<span class="integer">0</span>]
gremlin&gt; g.V().has(label,of(<span class="string"><span class="delimiter">'</span><span class="content">organism</span><span class="delimiter">'</span></span>).and(of(<span class="string"><span class="delimiter">'</span><span class="content">animal</span><span class="delimiter">'</span></span>)))
==&gt;v[<span class="integer">0</span>]
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Typecasting to a <code>Neo4jVertex</code> is only required in Java.</p>
</li>
<li>
<p>The standard <code>Vertex.label()</code> method returns all the labels in alphabetical order concatenated using <code>::</code>.</p>
</li>
<li>
<p><code>Neo4jVertex.labels()</code> method returns the individual labels as a set.</p>
</li>
<li>
<p><code>Neo4jVertex.addLabel()</code> method adds a single label.</p>
</li>
<li>
<p><code>Neo4jVertex.removeLabel()</code> method removes a single label.</p>
</li>
<li>
<p>Labels are unique and thus duplicate labels don&#8217;t exist.</p>
</li>
<li>
<p>If a label that does not exist is removed, nothing happens.</p>
</li>
<li>
<p><code>P.eq()</code> does a full string match and should only be used if multi-labels are not leveraged.</p>
</li>
<li>
<p><code>LabelP.of()</code> is specific to <code>Neo4jGraph</code> and used for multi-label matching.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<code>LabelP.of()</code> is only required if multi-labels are leveraged. <code>LabelP.of()</code> is used when
filtering/looking-up vertices by their label(s) as the standard <code>P.eq()</code> does a direct match on the <code>::</code>-representation
of <code>vertex.label()</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_loading_with_bulkloadervertexprogram">Loading with BulkLoaderVertexProgram</h3>
<div class="paragraph">
<p>The <a href="#bulkloadervertexprogram">BulkLoaderVertexProgram</a> is a generalized bulk loader that can be used to load
large amounts of data to and from Neo4j. The following code demonstrates how to load the modern graph from TinkerGraph
into Neo4j:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; wgConf = <span class="string"><span class="delimiter">'</span><span class="content">conf/neo4j-standalone.properties</span><span class="delimiter">'</span></span>
==&gt;conf/neo4j-standalone.properties
gremlin&gt; modern = TinkerFactory.createModern()
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>]
gremlin&gt; blvp = BulkLoaderVertexProgram.build().
                    keepOriginalIds(<span class="predefined-constant">false</span>).
                    writeGraph(wgConf).create(modern)
==&gt;BulkLoaderVertexProgram[bulkLoader=IncrementalBulkLoader, vertexIdProperty=bulkLoader.vertex.id, userSuppliedIds=<span class="predefined-constant">false</span>, keepOriginalIds=<span class="predefined-constant">false</span>, batchSize=<span class="integer">0</span>]
gremlin&gt; modern.compute().workers(<span class="integer">1</span>).program(blvp).submit().get()
==&gt;result[tinkergraph[<span class="key">vertices</span>:<span class="integer">6</span> <span class="key">edges</span>:<span class="integer">6</span>],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; graph = GraphFactory.open(wgConf)
==&gt;neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[neo4jgraph[Community [<span class="regexp"><span class="delimiter">/</span><span class="content">tmp</span><span class="delimiter">/</span></span>neo4j]], standard]
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># neo4j-standalone.properties

gremlin.graph=org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph
gremlin.neo4j.directory=/tmp/neo4j
gremlin.neo4j.conf.node_auto_indexing=true
gremlin.neo4j.conf.relationship_auto_indexing=true</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_high_availability_configuration">High Availability Configuration</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/neo4j-ha.png" alt="neo4j ha" width="400"></span> TinkerPop supports running Neo4j with its fault tolerant master-slave replication configuration, referred to as its
<a href="http://neo4j.com/docs/operations-manual/current/#_neo4j_cluster_install">High Availability (HA) cluster</a>. From the
TinkerPop perspective, configuring for HA is not that different than configuring for embedded mode as shown above. The
main difference is the usage of HA configuration options that enable the cluster. Once connected to a cluster, usage
from the TinkerPop perspective is largely the same.</p>
</div>
<div class="paragraph">
<p>In configuring for HA the most important thing to realize is that all Neo4j HA settings are simply passed through the
TinkerPop configuration settings given to the <code>GraphFactory.open()</code> or <code>Neo4j.open()</code> methods. For example, to
provide the all-important <code>ha.server_id</code> configuration option through TinkerPop, simply prefix that key with the
TinkerPop Neo4j key of <code>gremlin.neo4j.conf</code>.</p>
</div>
<div class="paragraph">
<p>The following properties demonstrates one of the three configuration files required to setup a simple three node HA
cluster on the same machine instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gremlin.graph=org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph
gremlin.neo4j.directory=/tmp/neo4j.server1
gremlin.neo4j.conf.ha.server_id=1
gremlin.neo4j.conf.ha.initial_hosts=localhost:5001\,localhost:5002\,localhost:5003
gremlin.neo4j.conf.ha.cluster_server=localhost:5001
gremlin.neo4j.conf.ha.server=localhost:6001</code></pre>
</div>
</div>
<div class="paragraph">
<p>Assuming the intent is to configure this cluster completely within TinkerPop (perhaps within three separate Gremlin
Server instances), the other two configuration files will be quite similar. The second will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gremlin.graph=org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph
gremlin.neo4j.directory=/tmp/neo4j.server2
gremlin.neo4j.conf.ha.server_id=2
gremlin.neo4j.conf.ha.initial_hosts=localhost:5001\,localhost:5002\,localhost:5003
gremlin.neo4j.conf.ha.cluster_server=localhost:5002
gremlin.neo4j.conf.ha.server=localhost:6002</code></pre>
</div>
</div>
<div class="paragraph">
<p>and the third will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gremlin.graph=org.apache.tinkerpop.gremlin.neo4j.structure.Neo4jGraph
gremlin.neo4j.directory=/tmp/neo4j.server3
gremlin.neo4j.conf.ha.server_id=3
gremlin.neo4j.conf.ha.initial_hosts=localhost:5001\,localhost:5002\,localhost:5003
gremlin.neo4j.conf.ha.cluster_server=localhost:5003
gremlin.neo4j.conf.ha.server=localhost:6003</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The backslashes in the values provided to <code>gremlin.neo4j.conf.ha.initial_hosts</code> prevent that configuration
setting as being interpreted as a <code>List</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create three separate Gremlin Server configuration files and point each at one of these Neo4j files. Since these Gremlin
Server instances will be running on the same machine, ensure that each Gremlin Server instance has a unique <code>port</code>
setting in that Gremlin Server configuration file. Start each Gremlin Server instance to bring the HA cluster online.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>Neo4jGraph</code> instances will block until all nodes join the cluster.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Neither Gremlin Server nor Neo4j will share transactions across the cluster. Be sure to either use Gremlin Server
managed transactions or, if using a session without that option, ensure that all requests are being routed to the
same server.</p>
</div>
<div class="paragraph">
<p>This example discussed use of Gremlin Server to demonstrate the HA configuration, but it is also easy to setup with
three Gremlin Console instances. Simply start three Gremlin Console instances and use <code>GraphFactory</code> to read those
configuration files to form the cluster. Furthermore, keep in mind that it is possible to have a Gremlin Console join
a cluster handled by two Gremlin Servers or Neo4j Enterprise. The only limits as to how the configuration can be
utilized are prescribed by Neo4j itself. Please refer to their
<a href="http://neo4j.com/docs/operations-manual/current/#ha-setup-tutorial">documentation</a> for more information on how
this feature works.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hadoop-gremlin">Hadoop-Gremlin</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>hadoop-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/hadoop-logo-notext.png" alt="hadoop logo notext" width="100"></span> <a href="http://hadoop.apache.org/">Hadoop</a> is a distributed
computing framework that is used to process data represented across a multi-machine compute cluster. When the
data in the Hadoop cluster represents a TinkerPop3 graph, then Hadoop-Gremlin can be used to process the graph
using both TinkerPop3&#8217;s OLTP and OLAP graph computing models.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
This section assumes that the user has a Hadoop 2.x cluster functioning. For more information on getting
started with Hadoop, please see the
<a href="http://hadoop.apache.org/docs/r2.7.2/hadoop-project-dist/hadoop-common/SingleCluster.html">Single Node Setup</a>
tutorial. Moreover, if using <code>GiraphGraphComputer</code> or <code>SparkGraphComputer</code> it is advisable that the reader also
familiarize their self with Giraph (<a href="http://giraph.apache.org/quick_start.html">Getting Started</a>) and Spark
(<a href="http://spark.apache.org/docs/latest/quick-start.html">Quick Start</a>).
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_installing_hadoop_gremlin">Installing Hadoop-Gremlin</h3>
<div class="paragraph">
<p>If using <a href="#gremlin-console">Gremlin Console</a>, it is important to install the Hadoop-Gremlin plugin. Note that
Hadoop-Gremlin requires a Gremlin Console restart after installing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; :install org.apache.tinkerpop hadoop-gremlin 3.2.6
==&gt;loaded: [org.apache.tinkerpop, hadoop-gremlin, 3.2.6] - restart the console to use [tinkerpop.hadoop]
gremlin&gt; :q
$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
gremlin&gt; :plugin use tinkerpop.hadoop
==&gt;tinkerpop.hadoop activated
gremlin&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is important that the <code>CLASSPATH</code> environmental variable references <code>HADOOP_CONF_DIR</code> and that the configuration
files in <code>HADOOP_CONF_DIR</code> contain references to a live Hadoop cluster. It is easy to verify a proper configuration
from within the Gremlin Console. If <code>hdfs</code> references the local file system, then there is a configuration issue.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">gremlin&gt; hdfs
==&gt;storage[org.apache.hadoop.fs.LocalFileSystem@65bb9029] // BAD

gremlin&gt; hdfs
==&gt;storage[DFS[DFSClient[clientName=DFSClient_NONMAPREDUCE_1229457199_1, ugi=user (auth:SIMPLE)]]] // GOOD</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>HADOOP_GREMLIN_LIBS</code> references locations that contain jars that should be uploaded to a respective
distributed cache (<a href="http://hadoop.apache.org/docs/current/hadoop-yarn/hadoop-yarn-site/YARN.html">YARN</a> or SparkServer).
Note that the locations in <code>HADOOP_GREMLIN_LIBS</code> can be colon-separated (<code>:</code>) and all jars from all locations will
be loaded into the cluster. Locations can be local paths (e.g. <code>/path/to/libs</code>), but may also be prefixed with a file
scheme to reference files or directories in different file systems (e.g. <code>hdfs:///path/to/distributed/libs</code>).
Typically, only the jars of the respective GraphComputer are required to be loaded (e.g. <code>GiraphGraphComputer</code> plugin lib
directory).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">export HADOOP_GREMLIN_LIBS=/usr/local/gremlin-console/ext/giraph-gremlin/lib</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_properties_files">Properties Files</h3>
<div class="paragraph">
<p><code>HadoopGraph</code> makes use of properties files which ultimately get turned into Apache configurations and/or
Hadoop configurations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">gremlin.graph=org.apache.tinkerpop.gremlin.hadoop.structure.HadoopGraph
gremlin.hadoop.inputLocation=tinkerpop-modern.kryo
gremlin.hadoop.graphReader=org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoInputFormat
gremlin.hadoop.outputLocation=output
gremlin.hadoop.graphWriter=org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoOutputFormat
gremlin.hadoop.jarsInDistributedCache=true
gremlin.hadoop.defaultGraphComputer=org.apache.tinkerpop.gremlin.spark.process.computer.SparkGraphComputer
####################################
# Spark Configuration              #
####################################
spark.master=local[4]
spark.executor.memory=1g
spark.serializer=org.apache.tinkerpop.gremlin.spark.structure.io.gryo.GryoSerializer
gremlin.spark.persistContext=true
#####################################
# GiraphGraphComputer Configuration #
#####################################
giraph.minWorkers=2
giraph.maxWorkers=2
giraph.useOutOfCoreGraph=true
giraph.useOutOfCoreMessages=true
mapreduce.map.java.opts=-Xmx1024m
mapreduce.reduce.java.opts=-Xmx1024m
giraph.numInputThreads=2
giraph.numComputeThreads=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>A review of the Hadoop-Gremlin specific properties are provided in the table below. For the respective OLAP
engines (<a href="#sparkgraphcomputer"><code>SparkGraphComputer</code></a> or <a href="#giraphgraphcomputer"><code>GiraphGraphComputer</code></a>) refer
to their respective documentation for configuration options.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.graph</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class of the graph to construct using GraphFactory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.inputLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location of the input file(s) for Hadoop-Gremlin to read the graph from.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class that the graph input file(s) are read with (e.g. an <code>InputFormat</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.outputLocation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location to write the computed HadoopGraph to.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphWriter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The class that the graph output file(s) are written with (e.g. an <code>OutputFormat</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.jarsInDistributedCache</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to upload the Hadoop-Gremlin jars to a distributed cache (necessary if jars are not on the machines' classpaths).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.defaultGraphComputer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default <code>GraphComputer</code> to use when <code>graph.compute()</code> is called. This is optional.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Along with the properties above, the numerous <a href="http://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-common/core-default.xml">Hadoop specific properties</a>
can be added as needed to tune and parameterize the executed Hadoop-Gremlin job on the respective Hadoop cluster.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
As the size of the graphs being processed becomes large, it is important to fully understand how the
underlying OLAP engine (e.g. Spark, Giraph, etc.) works and understand the numerous parameterizations offered by
these systems. Such knowledge can help alleviate out of memory exceptions, slow load times, slow processing times,
garbage collection issues, etc.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_oltp_hadoop_gremlin">OLTP Hadoop-Gremlin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/hadoop-pipes.png" alt="hadoop pipes" width="180"></span> It is possible to execute OLTP operations over a <code>HadoopGraph</code>.
However, realize that the underlying HDFS files are not random access and thus, to retrieve a vertex, a linear scan
is required. OLTP operations are useful for peeking into the graph prior to executing a long running OLAP job&#8201;&#8212;&#8201;e.g.
<code>g.V().valueMap().limit(10)</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
OLTP operations on <code>HadoopGraph</code> are not efficient. They require linear scans to execute and are unreasonable
for large graphs. In such large graph situations, make use of <a href="#traversalvertexprogram">TraversalVertexProgram</a>
which is the OLAP Gremlin machine.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; hdfs.copyFromLocal(<span class="string"><span class="delimiter">'</span><span class="content">data/tinkerpop-modern.kryo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">'</span></span>)
gremlin&gt; hdfs.ls()
==&gt;rw-r--r-- smallette supergroup <span class="integer">781</span> tinkerpop-modern.kryo
gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], standard]
gremlin&gt; g.V().count()
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;ripple
==&gt;lop
gremlin&gt; g.V().group().by{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}.by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>).next()
==&gt;a=[marko, vadas]
==&gt;e=[peter]
==&gt;i=[ripple]
==&gt;o=[lop, josh]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_olap_hadoop_gremlin">OLAP Hadoop-Gremlin</h3>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/hadoop-furnace.png" alt="hadoop furnace" width="180"></span> Hadoop-Gremlin was designed to execute OLAP operations via
<code>GraphComputer</code>. The OLTP examples presented previously are reproduced below, but using <code>TraversalVertexProgram</code>
for the execution of the Gremlin traversal.</p>
</div>
<div class="paragraph">
<p>A <code>Graph</code> in TinkerPop3 can support any number of <code>GraphComputer</code> implementations. Out of the box, Hadoop-Gremlin
supports the following two implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#sparkgraphcomputer"><code>SparkGraphComputer</code></a>: Leverages Apache Spark to execute TinkerPop3 OLAP computations.</p>
<div class="ulist">
<ul>
<li>
<p>The graph may fit within the total RAM of the cluster (supports larger graphs). Message passing is coordinated via
Spark map/reduce/join operations on in-memory and disk-cached data (average speed traversals).</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#giraphgraphcomputer"><code>GiraphGraphComputer</code></a>: Leverages Apache Giraph to execute TinkerPop3 OLAP computations.</p>
<div class="ulist">
<ul>
<li>
<p>The graph should fit within the total RAM of the Hadoop cluster (graph size restriction), though "out-of-core"
processing is possible. Message passing is coordinated via ZooKeeper for the in-memory graph (speedy traversals).</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<span class="image" style="float: left"><img src="../images/gremlin-sugar.png" alt="gremlin sugar" width="50"></span> For those wanting to use the <a href="#sugar-plugin">SugarPlugin</a> with
their submitted traversal, do <code>:remote config useSugar true</code> as well as <code>:plugin use tinkerpop.sugar</code> at the start of
the Gremlin Console session if it is not already activated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Note that <code>SparkGraphComputer</code> and <code>GiraphGraphComputer</code> are loaded via their respective plugins. Typically only
one plugin or the other is loaded depending on the desired <code>GraphComputer</code> to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
plugin activated: tinkerpop.hadoop
gremlin&gt; :install org.apache.tinkerpop giraph-gremlin 3.2.6
==&gt;loaded: [org.apache.tinkerpop, giraph-gremlin, 3.2.6] - restart the console to use [tinkerpop.giraph]
gremlin&gt; :install org.apache.tinkerpop spark-gremlin 3.2.6
==&gt;loaded: [org.apache.tinkerpop, spark-gremlin, 3.2.6] - restart the console to use [tinkerpop.spark]
gremlin&gt; :q
$ bin/gremlin.sh

         \,,,/
         (o o)
-----oOOo-(3)-oOOo-----
plugin activated: tinkerpop.server
plugin activated: tinkerpop.utilities
plugin activated: tinkerpop.tinkergraph
plugin activated: tinkerpop.hadoop
gremlin&gt; :plugin use tinkerpop.giraph
==&gt;tinkerpop.giraph activated
gremlin&gt; :plugin use tinkerpop.spark
==&gt;tinkerpop.spark activated</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Hadoop, Spark, and Giraph all depend on many of the same libraries (e.g. ZooKeeper, Snappy, Netty, Guava,
etc.). Unfortunately, typically these dependencies are not to the same versions of the respective libraries. As such,
it is best to <strong>not</strong> have both Spark and Giraph plugins loaded in the same console session nor in the same Java
project (though intelligent <code>&lt;exclusion&gt;</code>-usage can help alleviate conflicts in a Java project).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="sparkgraphcomputer">SparkGraphComputer</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>spark-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/spark-logo.png" alt="spark logo" width="175"></span> <a href="http://spark.apache.org">Spark</a> is an Apache Software Foundation
project focused on general-purpose OLAP data processing. Spark provides a hybrid in-memory/disk-based distributed
computing model that is similar to Hadoop&#8217;s MapReduce model. Spark maintains a fluent function chaining DSL that is
arguably easier for developers to work with than native Hadoop MapReduce. Spark-Gremlin provides an implementation of
the bulk-synchronous parallel, distributed message passing algorithm within Spark and thus, any <code>VertexProgram</code> can be
executed over <code>SparkGraphComputer</code>.</p>
</div>
<div class="paragraph">
<p>Furthermore the <code>lib/</code> directory should be distributed across all machines in the SparkServer cluster. For this purpose
TinkerPop provides a helper script, which takes the Spark installation directory and the Spark machines as input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">bin/hadoop/init-tp-spark.sh /usr/local/spark spark@10.0.0.1 spark@10.0.0.2 spark@10.0.0.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the <code>lib/</code> directory is distributed, <code>SparkGraphComputer</code> can be used as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; g = graph.traversal().withComputer(SparkGraphComputer)
==&gt;graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], sparkgraphcomputer]
gremlin&gt; g.V().count()
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;lop
==&gt;ripple</code></pre>
</div>
</div>
<div class="paragraph">
<p>For using lambdas in Gremlin-Groovy, simply provide <code>:remote connect</code> a <code>TraversalSource</code> which leverages SparkGraphComputer.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; g = graph.traversal().withComputer(SparkGraphComputer)
==&gt;graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], sparkgraphcomputer]
gremlin&gt; :remote connect tinkerpop.hadoop graph g
==&gt;useTraversalSource=graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], sparkgraphcomputer]
==&gt;useSugar=<span class="predefined-constant">false</span>
gremlin&gt; :&gt; g.V().group().by{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}.by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
==&gt;[<span class="key">a</span>:[marko,vadas],<span class="key">i</span>:[ripple],<span class="key">e</span>:[peter],<span class="key">o</span>:[lop,josh]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SparkGraphComputer</code> algorithm leverages Spark&#8217;s caching abilities to reduce the amount of data shuffled across
the wire on each iteration of the <a href="#vertexprogram"><code>VertexProgram</code></a>. When the graph is loaded as a Spark RDD
(Resilient Distributed Dataset) it is immediately cached as <code>graphRDD</code>. The <code>graphRDD</code> is a distributed adjacency
list which encodes the vertex, its properties, and all its incident edges. On the first iteration, each vertex
(in parallel) is passed through <code>VertexProgram.execute()</code>. This yields an output of the vertex&#8217;s mutated state
(i.e. updated compute keys&#8201;&#8212;&#8201;<code>propertyX</code>) and its outgoing messages. This <code>viewOutgoingRDD</code> is then reduced to
<code>viewIncomingRDD</code> where the outgoing messages are sent to their respective vertices. If a <code>MessageCombiner</code> exists
for the vertex program, then messages are aggregated locally and globally to ultimately yield one incoming message
for the vertex. This reduce sequence is the "message pass." If the vertex program does not terminate on this
iteration, then the <code>viewIncomingRDD</code> is joined with the cached <code>graphRDD</code> and the process continues. When there
are no more iterations, there is a final join and the resultant RDD is stripped of its edges and messages. This
<code>mapReduceRDD</code> is cached and is processed by each <a href="#mapreduce"><code>MapReduce</code></a> job in the
<a href="#graphcomputer"><code>GraphComputer</code></a> computation.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../images/spark-algorithm.png" alt="spark algorithm" width="775">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphReader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A class for reading a graph-based RDD (e.g. an <code>InputRDD</code> or <code>InputFormat</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.hadoop.graphWriter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A class for writing a graph-based RDD (e.g. an <code>OutputRDD</code> or <code>OutputFormat</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.spark.graphStorageLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What <code>StorageLevel</code> to use for the cached graph during job execution (default <code>MEMORY_ONLY</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.spark.persistContext</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Whether to create a new <code>SparkContext</code> for every <code>SparkGraphComputer</code> or to reuse an existing one.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gremlin.spark.persistStorageLevel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What <code>StorageLevel</code> to use when persisted RDDs via <code>PersistedOutputRDD</code> (default <code>MEMORY_ONLY</code>).</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_inputrdd_and_outputrdd">InputRDD and OutputRDD</h5>
<div class="paragraph">
<p>If the provider/user does not want to use Hadoop <code>InputFormats</code>, it is possible to leverage Spark&#8217;s RDD
constructs directly. An <code>InputRDD</code> provides a read method that takes a <code>SparkContext</code> and returns a graphRDD. Likewise,
and <code>OutputRDD</code> is used for writing a graphRDD.</p>
</div>
<div class="paragraph">
<p>If the graph system provider uses an <code>InputRDD</code>, the RDD should maintain an associated <code>org.apache.spark.Partitioner</code>. By doing so,
<code>SparkGraphComputer</code> will not partition the loaded graph across the cluster as it has already been partitioned by the graph system provider.
This can save a significant amount of time and space resources. If the <code>InputRDD</code> does not have a registered partitioner,
<code>SparkGraphComputer</code> will partition the graph using a <code>org.apache.spark.HashPartitioner</code> with the number of partitions
being either the number of existing partitions in the input (i.e. input splits) or the user specified number of <code>GraphComputer.workers()</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_storage_levels">Storage Levels</h5>
<div class="paragraph">
<p>The <code>SparkGraphComputer</code> uses <code>MEMORY_ONLY</code> to cache the input graph and the output graph by default. Users should be aware of the impact of
different storage levels, since the default settings can quickly lead to memory issues on larger graphs. An overview of Spark&#8217;s persistence
settings is provided in <a href="http://spark.apache.org/docs/latest/programming-guide.html#rdd-persistence">Spark&#8217;s programming guide</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_using_a_persisted_context">Using a Persisted Context</h5>
<div class="paragraph">
<p>It is possible to persist the graph RDD between jobs within the <code>SparkContext</code> (e.g. SparkServer) by leveraging <code>PersistedOutputRDD</code>.
Note that <code>gremlin.spark.persistContext</code> should be set to <code>true</code> or else the persisted RDD will be destroyed when the <code>SparkContext</code> closes.
The persisted RDD is named by the <code>gremlin.hadoop.outputLocation</code> configuration. Similarly, <code>PersistedInputRDD</code> is used with respective
<code>gremlin.hadoop.inputLocation</code> to retrieve the persisted RDD from the <code>SparkContext</code>.</p>
</div>
<div class="paragraph">
<p>When using a persistent <code>SparkContext</code> the configuration used by the original Spark Configuration will be inherited by all threaded
references to that Spark Context. The exception to this rule are those properties which have a specific thread local effect.</p>
</div>
<div class="olist arabic">
<div class="title">Thread Local Properties</div>
<ol class="arabic">
<li>
<p>spark.jobGroup.id</p>
</li>
<li>
<p>spark.job.description</p>
</li>
<li>
<p>spark.job.interruptOnCancel</p>
</li>
<li>
<p>spark.scheduler.pool</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Finally, there is a <code>spark</code> object that can be used to manage persisted RDDs (see <a href="#interacting-with-spark">Interacting with Spark</a>).</p>
</div>
</div>
<div class="sect4">
<h5 id="bulkdumpervertexprogramusingspark">Exporting with BulkDumperVertexProgram</h5>
<div class="paragraph">
<p>The <a href="#bulkdumpervertexprogram">BulkDumperVertexProgram</a> exports a whole graph in any of the supported Hadoop GraphOutputFormats (<code>GraphSONOutputFormat</code>,
<code>GryoOutputFormat</code> or <code>ScriptOutputFormat</code>). The example below takes a Hadoop graph as the input (in <code>GryoInputFormat</code>) and exports it as a GraphSON file
(<code>GraphSONOutputFormat</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; hdfs.copyFromLocal(<span class="string"><span class="delimiter">'</span><span class="content">data/tinkerpop-modern.kryo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">tinkerpop-modern.kryo</span><span class="delimiter">'</span></span>)
gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; graph.configuration().setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.hadoop.graphWriter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">org.apache.tinkerpop.gremlin.hadoop.structure.io.graphson.GraphSONOutputFormat</span><span class="delimiter">'</span></span>)
gremlin&gt; graph.compute(SparkGraphComputer).program(BulkDumperVertexProgram.build().create()).submit().get()
==&gt;result[hadoopgraph[graphsoninputformat-&gt;graphsonoutputformat],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; hdfs.ls(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) ~g
gremlin&gt; hdfs.head(<span class="string"><span class="delimiter">'</span><span class="content">output/~g</span><span class="delimiter">'</span></span>)
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}},{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">32</span>}]}}
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}}],<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.5</span>}},{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">0</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">29</span>}]}}
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">12</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.2</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">35</span>}]}}
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}},{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}},{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">12</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.2</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>}]}}
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ripple</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>}]}}
==&gt;{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.5</span>}}]},<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vadas</span><span class="delimiter">&quot;</span></span>}],<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">27</span>}]}}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_loading_with_bulkloadervertexprogram_2">Loading with BulkLoaderVertexProgram</h5>
<div class="paragraph">
<p>The <a href="#bulkloadervertexprogram">BulkLoaderVertexProgram</a> is a generalized bulk loader that can be used to load large
amounts of data to and from different <code>Graph</code> implementations. The following code demonstrates how to load the
Grateful Dead graph from HadoopGraph into TinkerGraph over Spark:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; hdfs.copyFromLocal(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.kryo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">grateful-dead.kryo</span><span class="delimiter">'</span></span>)
gremlin&gt; readGraph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-grateful-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; writeGraph = <span class="string"><span class="delimiter">'</span><span class="content">conf/tinkergraph-gryo.properties</span><span class="delimiter">'</span></span>
==&gt;conf/tinkergraph-gryo.properties
gremlin&gt; blvp = BulkLoaderVertexProgram.build().
                    keepOriginalIds(<span class="predefined-constant">false</span>).
                    writeGraph(writeGraph).create(readGraph)
==&gt;BulkLoaderVertexProgram[bulkLoader=IncrementalBulkLoader, vertexIdProperty=bulkLoader.vertex.id, userSuppliedIds=<span class="predefined-constant">false</span>, keepOriginalIds=<span class="predefined-constant">false</span>, batchSize=<span class="integer">0</span>]
gremlin&gt; readGraph.compute(SparkGraphComputer).workers(<span class="integer">1</span>).program(blvp).submit().get()
==&gt;result[hadoopgraph[gryoinputformat-&gt;gryooutputformat],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; :set max-iteration <span class="integer">10</span>
gremlin&gt; graph = GraphFactory.open(writeGraph)
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">814</span> <span class="key">edges</span>:<span class="integer">8052</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">814</span> <span class="key">edges</span>:<span class="integer">8052</span>], standard]
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[Hart_Kreutzmann]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[TERRAPIN TRANSIT],<span class="key">songType</span>:[original],<span class="key">performances</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[THIS TIME FOREVER],<span class="key">songType</span>:[original],<span class="key">performances</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[HEY BO DIDDLEY],<span class="key">songType</span>:[cover],<span class="key">performances</span>:[<span class="integer">5</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[TILL THE MORNING COMES],<span class="key">songType</span>:[original],<span class="key">performances</span>:[<span class="integer">5</span>]]
...
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># hadoop-grateful-gryo.properties

#
# Hadoop Graph Configuration
#
gremlin.graph=org.apache.tinkerpop.gremlin.hadoop.structure.HadoopGraph
gremlin.hadoop.graphReader=org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoInputFormat
gremlin.hadoop.inputLocation=grateful-dead.kryo
gremlin.hadoop.outputLocation=output
gremlin.hadoop.jarsInDistributedCache=true

#
# SparkGraphComputer Configuration
#
spark.master=local[1]
spark.executor.memory=1g
spark.serializer=org.apache.tinkerpop.gremlin.spark.structure.io.gryo.GryoSerializer</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># tinkergraph-gryo.properties

gremlin.graph=org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph
gremlin.tinkergraph.graphFormat=gryo
gremlin.tinkergraph.graphLocation=/tmp/tinkergraph.kryo</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The path to TinkerGraph jars needs to be included in the <code>HADOOP_GREMLIN_LIBS</code> for the above example to work.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="giraphgraphcomputer">GiraphGraphComputer</h4>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
   <span class="tag">&lt;groupId&gt;</span>org.apache.tinkerpop<span class="tag">&lt;/groupId&gt;</span>
   <span class="tag">&lt;artifactId&gt;</span>giraph-gremlin<span class="tag">&lt;/artifactId&gt;</span>
   <span class="tag">&lt;version&gt;</span>3.2.6<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/giraph-logo.png" alt="giraph logo" width="100"></span> <a href="http://giraph.apache.org">Giraph</a> is an Apache Software Foundation
project focused on OLAP-based graph processing. Giraph makes use of the distributed graph computing paradigm made
popular by Google&#8217;s Pregel. In Giraph, developers write "vertex programs" that get executed at each vertex in
parallel. These programs communicate with one another in a bulk synchronous parallel (BSP) manner. This model aligns
with TinkerPop3&#8217;s <code>GraphComputer</code> API. TinkerPop3 provides an implementation of <code>GraphComputer</code> that works for Giraph
called <code>GiraphGraphComputer</code>. Moreover, with TinkerPop3&#8217;s <a href="#mapreduce">MapReduce</a>-framework, the standard
Giraph/Pregel model is extended to support an arbitrary number of MapReduce phases to aggregate and yield results
from the graph. Below are examples using <code>GiraphGraphComputer</code> from the <a href="#gremlin-console">Gremlin-Console</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Giraph uses a large number of Hadoop counters. The default for Hadoop is 120. In <code>mapred-site.xml</code> it is
possible to increase the limit it via the <code>mapreduce.job.counters.max</code> property. A good value to use is 1000. This
is a cluster-wide property so be sure to restart the cluster after updating.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
The maximum number of workers can be no larger than the number of map-slots in the Hadoop cluster minus 1.
For example, if the Hadoop cluster has 4 map slots, then <code>giraph.maxWorkers</code> can not be larger than 3. One map-slot
is reserved for the master compute node and all other slots can be allocated as workers to execute the VertexPrograms
on the vertices of the graph.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If <code>GiraphGraphComputer</code> will be used as the <code>GraphComputer</code> for <code>HadoopGraph</code> then its <code>lib</code> directory should be
specified in <code>HADOOP_GREMLIN_LIBS</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">export HADOOP_GREMLIN_LIBS=$HADOOP_GREMLIN_LIBS:/usr/local/gremlin-console/ext/giraph-gremlin/lib</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or, the user can specify the directory in the Gremlin Console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">System</span>.setProperty(<span class="string"><span class="delimiter">'</span><span class="content">HADOOP_GREMLIN_LIBS</span><span class="delimiter">'</span></span>,<span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">HADOOP_GREMLIN_LIBS</span><span class="delimiter">'</span></span>) + <span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span> + <span class="string"><span class="delimiter">'</span><span class="content">/usr/local/gremlin-console/ext/giraph-gremlin/lib</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; g = graph.traversal().withComputer(GiraphGraphComputer)
==&gt;graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], giraphgraphcomputer]
gremlin&gt; g.V().count()
INFO  org.apache.hadoop.mapreduce.Job  - The url to track the <span class="key">job</span>: <span class="key">http</span>:<span class="comment">//localhost:8088/proxy/application_1503335889340_0001/</span>
INFO  org.apache.hadoop.mapreduce.Job  - Running <span class="key">job</span>: job_1503335889340_0001
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0001 running <span class="keyword">in</span> uber mode : <span class="predefined-constant">false</span>
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">67</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">100</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0001 completed successfully
INFO  org.apache.hadoop.mapreduce.Job  - <span class="key">Counters</span>: <span class="integer">50</span>
        <span class="predefined-type">File</span> <span class="predefined-type">System</span> Counters
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">715485</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">977</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">1257</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">41</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">21</span>
        Job Counters
                Launched map tasks=<span class="integer">3</span>
                Other local map tasks=<span class="integer">3</span>
                Total time spent by all maps <span class="keyword">in</span> occupied slots (ms)=<span class="integer">225926</span>
                Total time spent by all reduces <span class="keyword">in</span> occupied slots (ms)=<span class="integer">0</span>
                Total time spent by all map tasks (ms)=<span class="integer">112963</span>
                Total vcore-milliseconds taken by all map tasks=<span class="integer">112963</span>
                Total megabyte-milliseconds taken by all map tasks=<span class="integer">231348224</span>
        <span class="predefined-type">Map</span>-Reduce Framework
                <span class="predefined-type">Map</span> input records=<span class="integer">3</span>
                <span class="predefined-type">Map</span> output records=<span class="integer">0</span>
                Input split bytes=<span class="integer">132</span>
                Spilled Records=<span class="integer">0</span>
                Failed Shuffles=<span class="integer">0</span>
                Merged <span class="predefined-type">Map</span> outputs=<span class="integer">0</span>
                GC time elapsed (ms)=<span class="integer">5608</span>
                CPU time spent (ms)=<span class="integer">18400</span>
                Physical memory (bytes) snapshot=<span class="integer">1755566080</span>
                Virtual memory (bytes) snapshot=<span class="integer">8567754752</span>
                Total committed heap usage (bytes)=<span class="integer">1527250944</span>
        Giraph Stats
                Aggregate edges=<span class="integer">0</span>
                Aggregate finished vertices=<span class="integer">0</span>
                Aggregate sent message message bytes=<span class="integer">0</span>
                Aggregate sent messages=<span class="integer">0</span>
                Aggregate vertices=<span class="integer">6</span>
                Current master task partition=<span class="integer">0</span>
                Current workers=<span class="integer">2</span>
                Last checkpointed superstep=<span class="integer">0</span>
                Sent message bytes=<span class="integer">0</span>
                Sent messages=<span class="integer">0</span>
                Superstep=<span class="integer">1</span>
        Giraph Timers
                Initialize (ms)=<span class="integer">2819</span>
                Input superstep (ms)=<span class="integer">5552</span>
                Setup (ms)=<span class="integer">103</span>
                Shutdown (ms)=<span class="integer">9227</span>
                Superstep <span class="integer">0</span> GiraphComputation (ms)=<span class="integer">3983</span>
                Total (ms)=<span class="integer">18867</span>
        Zookeeper base path
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0001=<span class="integer">0</span>
        Zookeeper halt node
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0001/_haltComputation=<span class="integer">0</span>
        Zookeeper <span class="key">server</span>:port
                <span class="key">localhost</span>:<span class="integer">22181</span>=<span class="integer">0</span>
        <span class="predefined-type">File</span> Input <span class="predefined-type">Format</span> Counters
                Bytes Read=<span class="integer">0</span>
        <span class="predefined-type">File</span> Output <span class="predefined-type">Format</span> Counters
                Bytes Written=<span class="integer">0</span>
==&gt;<span class="integer">6</span>
gremlin&gt; g.V().out().out().values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
INFO  org.apache.hadoop.mapreduce.Job  - The url to track the <span class="key">job</span>: <span class="key">http</span>:<span class="comment">//localhost:8088/proxy/application_1503335889340_0002/</span>
INFO  org.apache.hadoop.mapreduce.Job  - Running <span class="key">job</span>: job_1503335889340_0002
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0002 running <span class="keyword">in</span> uber mode : <span class="predefined-constant">false</span>
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">0</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">33</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">67</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">100</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0002 completed successfully
INFO  org.apache.hadoop.mapreduce.Job  - <span class="key">Counters</span>: <span class="integer">52</span>
        <span class="predefined-type">File</span> <span class="predefined-type">System</span> Counters
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">705255</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">977</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">1387</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">41</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">21</span>
        Job Counters
                Launched map tasks=<span class="integer">3</span>
                Other local map tasks=<span class="integer">3</span>
                Total time spent by all maps <span class="keyword">in</span> occupied slots (ms)=<span class="integer">256356</span>
                Total time spent by all reduces <span class="keyword">in</span> occupied slots (ms)=<span class="integer">0</span>
                Total time spent by all map tasks (ms)=<span class="integer">128178</span>
                Total vcore-milliseconds taken by all map tasks=<span class="integer">128178</span>
                Total megabyte-milliseconds taken by all map tasks=<span class="integer">262508544</span>
        <span class="predefined-type">Map</span>-Reduce Framework
                <span class="predefined-type">Map</span> input records=<span class="integer">3</span>
                <span class="predefined-type">Map</span> output records=<span class="integer">0</span>
                Input split bytes=<span class="integer">132</span>
                Spilled Records=<span class="integer">0</span>
                Failed Shuffles=<span class="integer">0</span>
                Merged <span class="predefined-type">Map</span> outputs=<span class="integer">0</span>
                GC time elapsed (ms)=<span class="integer">4833</span>
                CPU time spent (ms)=<span class="integer">22770</span>
                Physical memory (bytes) snapshot=<span class="integer">1782689792</span>
                Virtual memory (bytes) snapshot=<span class="integer">8563060736</span>
                Total committed heap usage (bytes)=<span class="integer">1556611072</span>
        Giraph Stats
                Aggregate edges=<span class="integer">0</span>
                Aggregate finished vertices=<span class="integer">0</span>
                Aggregate sent message message bytes=<span class="integer">744</span>
                Aggregate sent messages=<span class="integer">8</span>
                Aggregate vertices=<span class="integer">6</span>
                Current master task partition=<span class="integer">0</span>
                Current workers=<span class="integer">2</span>
                Last checkpointed superstep=<span class="integer">0</span>
                Sent message bytes=<span class="integer">0</span>
                Sent messages=<span class="integer">0</span>
                Superstep=<span class="integer">3</span>
        Giraph Timers
                Initialize (ms)=<span class="integer">2723</span>
                Input superstep (ms)=<span class="integer">4533</span>
                Setup (ms)=<span class="integer">85</span>
                Shutdown (ms)=<span class="integer">9201</span>
                Superstep <span class="integer">0</span> GiraphComputation (ms)=<span class="integer">4637</span>
                Superstep <span class="integer">1</span> GiraphComputation (ms)=<span class="integer">3044</span>
                Superstep <span class="integer">2</span> GiraphComputation (ms)=<span class="integer">3181</span>
                Total (ms)=<span class="integer">24682</span>
        Zookeeper base path
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0002=<span class="integer">0</span>
        Zookeeper halt node
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0002/_haltComputation=<span class="integer">0</span>
        Zookeeper <span class="key">server</span>:port
                <span class="key">localhost</span>:<span class="integer">22181</span>=<span class="integer">0</span>
        <span class="predefined-type">File</span> Input <span class="predefined-type">Format</span> Counters
                Bytes Read=<span class="integer">0</span>
        <span class="predefined-type">File</span> Output <span class="predefined-type">Format</span> Counters
                Bytes Written=<span class="integer">0</span>
==&gt;ripple
==&gt;lop</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
The examples above do not use lambdas (i.e. closures in Gremlin-Groovy). This makes the traversal
serializable and thus, able to be distributed to all machines in the Hadoop cluster. If a lambda is required in a
traversal, then the traversal must be sent as a <code>String</code> and compiled locally at each machine in the cluster. The
following example demonstrates the <code>:remote</code> command which allows for submitting Gremlin traversals as a <code>String</code>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; g = graph.traversal().withComputer(GiraphGraphComputer)
==&gt;graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], giraphgraphcomputer]
gremlin&gt; :remote connect tinkerpop.hadoop graph g
==&gt;useTraversalSource=graphtraversalsource[hadoopgraph[gryoinputformat-&gt;gryooutputformat], giraphgraphcomputer]
==&gt;useSugar=<span class="predefined-constant">false</span>
gremlin&gt; :&gt; g.V().group().by{<span class="local-variable">it</span>.value(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)[<span class="integer">1</span>]}.by(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)
INFO  org.apache.hadoop.mapreduce.Job  - The url to track the <span class="key">job</span>: <span class="key">http</span>:<span class="comment">//localhost:8088/proxy/application_1503335889340_0003/</span>
INFO  org.apache.hadoop.mapreduce.Job  - Running <span class="key">job</span>: job_1503335889340_0003
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0003 running <span class="keyword">in</span> uber mode : <span class="predefined-constant">false</span>
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">67</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">100</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0003 completed successfully
INFO  org.apache.hadoop.mapreduce.Job  - <span class="key">Counters</span>: <span class="integer">50</span>
        <span class="predefined-type">File</span> <span class="predefined-type">System</span> Counters
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">618867</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">977</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">1550</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">41</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">21</span>
        Job Counters
                Launched map tasks=<span class="integer">3</span>
                Other local map tasks=<span class="integer">3</span>
                Total time spent by all maps <span class="keyword">in</span> occupied slots (ms)=<span class="integer">279328</span>
                Total time spent by all reduces <span class="keyword">in</span> occupied slots (ms)=<span class="integer">0</span>
                Total time spent by all map tasks (ms)=<span class="integer">139664</span>
                Total vcore-milliseconds taken by all map tasks=<span class="integer">139664</span>
                Total megabyte-milliseconds taken by all map tasks=<span class="integer">286031872</span>
        <span class="predefined-type">Map</span>-Reduce Framework
                <span class="predefined-type">Map</span> input records=<span class="integer">3</span>
                <span class="predefined-type">Map</span> output records=<span class="integer">0</span>
                Input split bytes=<span class="integer">132</span>
                Spilled Records=<span class="integer">0</span>
                Failed Shuffles=<span class="integer">0</span>
                Merged <span class="predefined-type">Map</span> outputs=<span class="integer">0</span>
                GC time elapsed (ms)=<span class="integer">5290</span>
                CPU time spent (ms)=<span class="integer">49750</span>
                Physical memory (bytes) snapshot=<span class="integer">1829875712</span>
                Virtual memory (bytes) snapshot=<span class="integer">8580505600</span>
                Total committed heap usage (bytes)=<span class="integer">1659895808</span>
        Giraph Stats
                Aggregate edges=<span class="integer">0</span>
                Aggregate finished vertices=<span class="integer">0</span>
                Aggregate sent message message bytes=<span class="integer">0</span>
                Aggregate sent messages=<span class="integer">0</span>
                Aggregate vertices=<span class="integer">6</span>
                Current master task partition=<span class="integer">0</span>
                Current workers=<span class="integer">2</span>
                Last checkpointed superstep=<span class="integer">0</span>
                Sent message bytes=<span class="integer">0</span>
                Sent messages=<span class="integer">0</span>
                Superstep=<span class="integer">1</span>
        Giraph Timers
                Initialize (ms)=<span class="integer">2687</span>
                Input superstep (ms)=<span class="integer">10206</span>
                Setup (ms)=<span class="integer">95</span>
                Shutdown (ms)=<span class="integer">9602</span>
                Superstep <span class="integer">0</span> GiraphComputation (ms)=<span class="integer">9171</span>
                Total (ms)=<span class="integer">29077</span>
        Zookeeper base path
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0003=<span class="integer">0</span>
        Zookeeper halt node
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0003/_haltComputation=<span class="integer">0</span>
        Zookeeper <span class="key">server</span>:port
                <span class="key">localhost</span>:<span class="integer">22181</span>=<span class="integer">0</span>
        <span class="predefined-type">File</span> Input <span class="predefined-type">Format</span> Counters
                Bytes Read=<span class="integer">0</span>
        <span class="predefined-type">File</span> Output <span class="predefined-type">Format</span> Counters
                Bytes Written=<span class="integer">0</span>
==&gt;[<span class="key">a</span>:[vadas,marko],<span class="key">e</span>:[peter],<span class="key">i</span>:[ripple],<span class="key">o</span>:[josh,lop]]
gremlin&gt; result
==&gt;result[hadoopgraph[gryoinputformat-&gt;gryooutputformat],memory[<span class="key">size</span>:<span class="integer">1</span>]]
gremlin&gt; result.memory.runtime
==&gt;<span class="integer">63539</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the user explicitly specifies <code>giraph.maxWorkers</code> and/or <code>giraph.numComputeThreads</code> in the configuration,
then these values will be used by Giraph. However, if these are not specified and the user never calls
<code>GraphComputer.workers()</code> then <code>GiraphGraphComputer</code> will try to compute the number of workers/threads to use based
on the cluster&#8217;s profile.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_loading_with_bulkloadervertexprogram_3">Loading with BulkLoaderVertexProgram</h5>
<div class="paragraph">
<p>The <a href="#bulkloadervertexprogram">BulkLoaderVertexProgram</a> is a generalized bulk loader that can be used to load
large amounts of data to and from different <code>Graph</code> implementations. The following code demonstrates how to load
the Grateful Dead graph from HadoopGraph into TinkerGraph over Giraph:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; hdfs.copyFromLocal(<span class="string"><span class="delimiter">'</span><span class="content">data/grateful-dead.kryo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">grateful-dead.kryo</span><span class="delimiter">'</span></span>)
gremlin&gt; readGraph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-grateful-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; writeGraph = <span class="string"><span class="delimiter">'</span><span class="content">conf/tinkergraph-gryo.properties</span><span class="delimiter">'</span></span>
==&gt;conf/tinkergraph-gryo.properties
gremlin&gt; blvp = BulkLoaderVertexProgram.build().
                    keepOriginalIds(<span class="predefined-constant">false</span>).
                    writeGraph(writeGraph).create(readGraph)
==&gt;BulkLoaderVertexProgram[bulkLoader=IncrementalBulkLoader, vertexIdProperty=bulkLoader.vertex.id, userSuppliedIds=<span class="predefined-constant">false</span>, keepOriginalIds=<span class="predefined-constant">false</span>, batchSize=<span class="integer">0</span>]
gremlin&gt; readGraph.compute(GiraphGraphComputer).workers(<span class="integer">1</span>).program(blvp).submit().get()
INFO  org.apache.hadoop.mapreduce.Job  - The url to track the <span class="key">job</span>: <span class="key">http</span>:<span class="comment">//localhost:8088/proxy/application_1503335889340_0004/</span>
INFO  org.apache.hadoop.mapreduce.Job  - Running <span class="key">job</span>: job_1503335889340_0004
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0004 running <span class="keyword">in</span> uber mode : <span class="predefined-constant">false</span>
INFO  org.apache.hadoop.mapreduce.Job  -  map <span class="integer">100</span>% reduce <span class="integer">0</span>%
INFO  org.apache.hadoop.mapreduce.Job  - Job job_1503335889340_0004 completed successfully
INFO  org.apache.hadoop.mapreduce.Job  - <span class="key">Counters</span>: <span class="integer">52</span>
        <span class="predefined-type">File</span> <span class="predefined-type">System</span> Counters
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">342498</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">FILE</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes read=<span class="integer">332378</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of bytes written=<span class="integer">223651</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of read operations=<span class="integer">29</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of large read operations=<span class="integer">0</span>
                <span class="key">HDFS</span>: <span class="predefined-type">Number</span> of write operations=<span class="integer">14</span>
        Job Counters
                Launched map tasks=<span class="integer">2</span>
                Other local map tasks=<span class="integer">2</span>
                Total time spent by all maps <span class="keyword">in</span> occupied slots (ms)=<span class="integer">129696</span>
                Total time spent by all reduces <span class="keyword">in</span> occupied slots (ms)=<span class="integer">0</span>
                Total time spent by all map tasks (ms)=<span class="integer">64848</span>
                Total vcore-milliseconds taken by all map tasks=<span class="integer">64848</span>
                Total megabyte-milliseconds taken by all map tasks=<span class="integer">132808704</span>
        <span class="predefined-type">Map</span>-Reduce Framework
                <span class="predefined-type">Map</span> input records=<span class="integer">2</span>
                <span class="predefined-type">Map</span> output records=<span class="integer">0</span>
                Input split bytes=<span class="integer">88</span>
                Spilled Records=<span class="integer">0</span>
                Failed Shuffles=<span class="integer">0</span>
                Merged <span class="predefined-type">Map</span> outputs=<span class="integer">0</span>
                GC time elapsed (ms)=<span class="integer">1195</span>
                CPU time spent (ms)=<span class="integer">27740</span>
                Physical memory (bytes) snapshot=<span class="integer">1164800000</span>
                Virtual memory (bytes) snapshot=<span class="integer">5696258048</span>
                Total committed heap usage (bytes)=<span class="integer">903872512</span>
        Giraph Stats
                Aggregate edges=<span class="integer">0</span>
                Aggregate finished vertices=<span class="integer">0</span>
                Aggregate sent message message bytes=<span class="integer">477403</span>
                Aggregate sent messages=<span class="integer">8049</span>
                Aggregate vertices=<span class="integer">808</span>
                Current master task partition=<span class="integer">0</span>
                Current workers=<span class="integer">1</span>
                Last checkpointed superstep=<span class="integer">0</span>
                Sent message bytes=<span class="integer">0</span>
                Sent messages=<span class="integer">0</span>
                Superstep=<span class="integer">3</span>
        Giraph Timers
                Initialize (ms)=<span class="integer">1028</span>
                Input superstep (ms)=<span class="integer">2117</span>
                Setup (ms)=<span class="integer">53</span>
                Shutdown (ms)=<span class="integer">9011</span>
                Superstep <span class="integer">0</span> GiraphComputation (ms)=<span class="integer">2951</span>
                Superstep <span class="integer">1</span> GiraphComputation (ms)=<span class="integer">4022</span>
                Superstep <span class="integer">2</span> GiraphComputation (ms)=<span class="integer">2172</span>
                Total (ms)=<span class="integer">20349</span>
        Zookeeper base path
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0004=<span class="integer">0</span>
        Zookeeper halt node
                <span class="regexp"><span class="delimiter">/</span><span class="content">_hadoopBsp</span><span class="delimiter">/</span></span>job_1503335889340_0004/_haltComputation=<span class="integer">0</span>
        Zookeeper <span class="key">server</span>:port
                <span class="key">localhost</span>:<span class="integer">22181</span>=<span class="integer">0</span>
        <span class="predefined-type">File</span> Input <span class="predefined-type">Format</span> Counters
                Bytes Read=<span class="integer">0</span>
        <span class="predefined-type">File</span> Output <span class="predefined-type">Format</span> Counters
                Bytes Written=<span class="integer">0</span>
==&gt;result[hadoopgraph[gryoinputformat-&gt;gryooutputformat],memory[<span class="key">size</span>:<span class="integer">0</span>]]
gremlin&gt; :set max-iteration <span class="integer">10</span>
gremlin&gt; graph = GraphFactory.open(writeGraph)
==&gt;tinkergraph[<span class="key">vertices</span>:<span class="integer">1622</span> <span class="key">edges</span>:<span class="integer">16098</span>]
gremlin&gt; g = graph.traversal()
==&gt;graphtraversalsource[tinkergraph[<span class="key">vertices</span>:<span class="integer">1622</span> <span class="key">edges</span>:<span class="integer">16098</span>], standard]
gremlin&gt; g.V().valueMap()
==&gt;[<span class="key">name</span>:[marko],<span class="key">age</span>:[<span class="integer">29</span>]]
==&gt;[<span class="key">name</span>:[TOM DOOLEY],<span class="key">songType</span>:[cover],<span class="key">performances</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[vadas],<span class="key">age</span>:[<span class="integer">27</span>]]
==&gt;[<span class="key">name</span>:[lop],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[Dolly_Parton]]
==&gt;[<span class="key">name</span>:[josh],<span class="key">age</span>:[<span class="integer">32</span>]]
==&gt;[<span class="key">name</span>:[HEY BO DIDDLEY],<span class="key">songType</span>:[cover],<span class="key">performances</span>:[<span class="integer">5</span>]]
==&gt;[<span class="key">name</span>:[TOUGH MAMA],<span class="key">songType</span>:[cover],<span class="key">performances</span>:[<span class="integer">1</span>]]
==&gt;[<span class="key">name</span>:[ripple],<span class="key">lang</span>:[java]]
==&gt;[<span class="key">name</span>:[peter],<span class="key">age</span>:[<span class="integer">35</span>]]
...
gremlin&gt; graph.close()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># hadoop-grateful-gryo.properties

#
# Hadoop Graph Configuration
#
gremlin.graph=org.apache.tinkerpop.gremlin.hadoop.structure.HadoopGraph
gremlin.hadoop.graphReader=org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoInputFormat
gremlin.hadoop.graphWriter=org.apache.hadoop.mapreduce.lib.output.NullOutputFormat
gremlin.hadoop.inputLocation=grateful-dead.kryo
gremlin.hadoop.outputLocation=output
gremlin.hadoop.jarsInDistributedCache=true

#
# GiraphGraphComputer Configuration
#
giraph.minWorkers=1
giraph.maxWorkers=1
giraph.useOutOfCoreGraph=true
giraph.useOutOfCoreMessages=true
mapred.map.child.java.opts=-Xmx1024m
mapred.reduce.child.java.opts=-Xmx1024m
giraph.numInputThreads=4
giraph.numComputeThreads=4
giraph.maxMessagesInMemory=100000</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties"># tinkergraph-gryo.properties

gremlin.graph=org.apache.tinkerpop.gremlin.tinkergraph.structure.TinkerGraph
gremlin.tinkergraph.graphFormat=gryo
gremlin.tinkergraph.graphLocation=/tmp/tinkergraph.kryo</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The path to TinkerGraph needs to be included in the <code>HADOOP_GREMLIN_LIBS</code> for the above example to work.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_input_output_formats">Input/Output Formats</h3>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/adjacency-list.png" alt="adjacency list" width="300"></span> Hadoop-Gremlin provides various I/O formats&#8201;&#8212;&#8201;i.e. Hadoop
<code>InputFormat</code> and <code>OutputFormat</code>. All of the formats make use of an <a href="http://en.wikipedia.org/wiki/Adjacency_list">adjacency list</a>
representation of the graph where each "row" represents a single vertex, its properties, and its incoming and
outgoing edges.</p>
</div>
<div class="paragraph">
<p><br></p>
</div>
<div class="sect3">
<h4 id="gryo-io-format">Gryo I/O Format</h4>
<div class="ulist">
<ul>
<li>
<p><strong>InputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoInputFormat</code></p>
</li>
<li>
<p><strong>OutputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.gryo.GryoOutputFormat</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#gryo-reader-writer">Gryo</a> is a binary graph format that leverages <a href="https://github.com/EsotericSoftware/kryo">Kryo</a>
to make a compact, binary representation of a vertex. It is recommended that users leverage Gryo given its space/time
savings over text-based representations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The <code>GryoInputFormat</code> is splittable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="graphson-io-format">GraphSON I/O Format</h4>
<div class="ulist">
<ul>
<li>
<p><strong>InputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.graphson.GraphSONInputFormat</code></p>
</li>
<li>
<p><strong>OutputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.graphson.GraphSONOutputFormat</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#graphson-reader-writer">GraphSON</a> is a JSON based graph format. GraphSON is a space-expensive graph format in that
it is a text-based markup language. However, it is convenient for many developers to work with as its structure is
simple (easy to create and parse).</p>
</div>
<div class="paragraph">
<p>The data below represents an adjacency list representation of the classic TinkerGraph toy graph in GraphSON format.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}}],<span class="key"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.5</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">0</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">marko</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">29</span>}]}}
{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.5</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">vadas</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">27</span>}]}}
{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">12</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.2</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">lop</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>}]}}
{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}},{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.4</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">32</span>}]}}
{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">5</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">software</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outV</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">1.0</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">8</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">ripple</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">9</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">java</span><span class="delimiter">&quot;</span></span>}]}}
{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">outE</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">created</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">12</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">inV</span><span class="delimiter">&quot;</span></span>:<span class="integer">3</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">weight</span><span class="delimiter">&quot;</span></span>:<span class="float">0.2</span>}}]},<span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">peter</span><span class="delimiter">&quot;</span></span>}],<span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">11</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">35</span>}]}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="script-io-format">Script I/O Format</h4>
<div class="ulist">
<ul>
<li>
<p><strong>InputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.script.ScriptInputFormat</code></p>
</li>
<li>
<p><strong>OutputFormat</strong>: <code>org.apache.tinkerpop.gremlin.hadoop.structure.io.script.ScriptOutputFormat</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>ScriptInputFormat</code> and <code>ScriptOutputFormat</code> take an arbitrary script and use that script to either read or write
<code>Vertex</code> objects, respectively. This can be considered the most general <code>InputFormat</code>/<code>OutputFormat</code> possible in that
Hadoop-Gremlin uses the user provided script for all reading/writing.</p>
</div>
<div class="sect4">
<h5 id="_scriptinputformat">ScriptInputFormat</h5>
<div class="paragraph">
<p>The data below represents an adjacency list representation of the classic TinkerGraph toy graph. First line reads,
"vertex <code>1</code>, labeled <code>person</code> having 2 property values (<code>marko</code> and <code>29</code>) has 3 outgoing edges; the first edge is
labeled <code>knows</code>, connects the current vertex <code>1</code> with vertex <code>2</code> and has a property value <code>0.4</code>, and so on."</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>1:person:marko:29 knows:2:0.5,knows:4:1.0,created:3:0.4
2:person:vadas:27
3:project:lop:java
4:person:josh:32 created:3:0.4,created:5:1.0
5:project:ripple:java
6:person:peter:35 created:3:0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is no corresponding <code>InputFormat</code> that can parse this particular file (or some adjacency list variant of it).
As such, <code>ScriptInputFormat</code> can be used. With <code>ScriptInputFormat</code> a script is stored in HDFS and leveraged by each
mapper in the Hadoop job. The script must have the following method defined:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">parse</span>(<span class="predefined-type">String</span> line, ScriptElementFactory factory) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ScriptElementFactory</code> is a legacy from previous versions and, although it&#8217;s still functional, it should no longer be used.
In order to create vertices and edges, the <code>parse()</code> method gets access to a global variable named <code>graph</code>, which holds
the local <code>StarGraph</code> for the current line/vertex.</p>
</div>
<div class="paragraph">
<p>An appropriate <code>parse()</code> for the above adjacency list file is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">parse</span>(line, factory) {
    <span class="keyword">def</span> parts = line.split(<span class="regexp"><span class="delimiter">/</span><span class="content"> </span><span class="delimiter">/</span></span>)
    <span class="keyword">def</span> (id, label, name, x) = parts[<span class="integer">0</span>].split(<span class="regexp"><span class="delimiter">/</span><span class="content">:</span><span class="delimiter">/</span></span>).toList()
    <span class="keyword">def</span> v1 = graph.addVertex(T.id, id, T.label, label)
    <span class="keyword">if</span> (name != <span class="predefined-constant">null</span>) v1.property(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, name) <span class="comment">// first value is always the name</span>
    <span class="keyword">if</span> (x != <span class="predefined-constant">null</span>) {
        <span class="comment">// second value depends on the vertex label; it's either</span>
        <span class="comment">// the age of a person or the language of a project</span>
        <span class="keyword">if</span> (label.equals(<span class="string"><span class="delimiter">'</span><span class="content">project</span><span class="delimiter">'</span></span>)) v1.property(<span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>, x)
        <span class="keyword">else</span> v1.property(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="predefined-type">Integer</span>.valueOf(x))
    }
    <span class="keyword">if</span> (parts.length == <span class="integer">2</span>) {
        parts[<span class="integer">1</span>].split(<span class="regexp"><span class="delimiter">/</span><span class="content">,</span><span class="delimiter">/</span></span>).grep { !<span class="local-variable">it</span>.isEmpty() }.each {
            <span class="keyword">def</span> (eLabel, refId, weight) = <span class="local-variable">it</span>.split(<span class="regexp"><span class="delimiter">/</span><span class="content">:</span><span class="delimiter">/</span></span>).toList()
            <span class="keyword">def</span> v2 = graph.addVertex(T.id, refId)
            v1.addOutEdge(eLabel, v2, <span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>, <span class="predefined-type">Double</span>.valueOf(weight))
        }
    }
    <span class="keyword">return</span> v1
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resultant <code>Vertex</code> denotes whether the line parsed yielded a valid Vertex. As such, if the line is not valid
(e.g. a comment line, a skip line, etc.), then simply return <code>null</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_scriptoutputformat_support">ScriptOutputFormat Support</h5>
<div class="paragraph">
<p>The principle above can also be used to convert a vertex to an arbitrary <code>String</code> representation that is ultimately
streamed back to a file in HDFS. This is the role of <code>ScriptOutputFormat</code>. <code>ScriptOutputFormat</code> requires that the
provided script maintains a method with the following signature:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">stringify</span>(Vertex vertex) { ... }</code></pre>
</div>
</div>
<div class="paragraph">
<p>An appropriate <code>stringify()</code> to produce output in the same format that was shown in the <code>ScriptInputFormat</code> sample is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">stringify</span>(vertex) {
    <span class="keyword">def</span> v = vertex.values(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lang</span><span class="delimiter">'</span></span>).inject(vertex.id(), vertex.label()).join(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
    <span class="keyword">def</span> outE = vertex.outE().map {
        <span class="keyword">def</span> e = <span class="local-variable">it</span>.get()
        e.values(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>).inject(e.label(), e.inV().next().id()).join(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
    }.join(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)
    <span class="keyword">return</span> [v, outE].join(<span class="string"><span class="delimiter">'</span><span class="content">\t</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_storage_systems">Storage Systems</h3>
<div class="paragraph">
<p>Hadoop-Gremlin provides two implementations of the <code>Storage</code> API:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>FileSystemStorage</code>: Access HDFS and local file system data.</p>
</li>
<li>
<p><code>SparkContextStorage</code>: Access Spark persisted RDD data.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="interacting-with-hdfs">Interacting with HDFS</h4>
<div class="paragraph">
<p>The distributed file system of Hadoop is called <a href="http://en.wikipedia.org/wiki/Apache_Hadoop#Hadoop_distributed_file_system">HDFS</a>.
The results of any OLAP operation are stored in HDFS accessible via <code>hdfs</code>. For local file system access, there is <code>fs</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; graph.compute(SparkGraphComputer).program(PeerPressureVertexProgram.build().create(graph)).mapReduce(ClusterCountMapReduce.build().memoryKey(<span class="string"><span class="delimiter">'</span><span class="content">clusterCount</span><span class="delimiter">'</span></span>).create()).submit().get();
==&gt;result[hadoopgraph[gryoinputformat-&gt;gryooutputformat],memory[<span class="key">size</span>:<span class="integer">1</span>]]
gremlin&gt; hdfs.ls()
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) _bsp
==&gt;rw-r--r-- smallette supergroup <span class="integer">332226</span> grateful-dead.kryo
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) hadoop-gremlin-<span class="float">3.2</span><span class="float">.6</span>-libs
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) output
==&gt;rw-r--r-- smallette supergroup <span class="integer">781</span> tinkerpop-modern.kryo
gremlin&gt; hdfs.ls(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) clusterCount
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) ~g
gremlin&gt; hdfs.head(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>, GryoInputFormat)
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; hdfs.head(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">clusterCount</span><span class="delimiter">'</span></span>, SequenceFileInputFormat)
==&gt;<span class="integer">2</span>
gremlin&gt; hdfs.rm(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; hdfs.ls()
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) _bsp
==&gt;rw-r--r-- smallette supergroup <span class="integer">332226</span> grateful-dead.kryo
==&gt;rwxr-xr-x smallette supergroup <span class="integer">0</span> (D) hadoop-gremlin-<span class="float">3.2</span><span class="float">.6</span>-libs
==&gt;rw-r--r-- smallette supergroup <span class="integer">781</span> tinkerpop-modern.kryo</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="interacting-with-spark">Interacting with Spark</h4>
<div class="paragraph">
<p>If a Spark context is persisted, then Spark RDDs will remain the Spark cache and accessible over subsequent jobs.
RDDs are retrieved and saved to the <code>SparkContext</code> via <code>PersistedInputRDD</code> and <code>PersistedOutputRDD</code> respectivly.
Persisted RDDs can be accessed using <code>spark</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gremlin&gt; Spark.create(<span class="string"><span class="delimiter">'</span><span class="content">local[4]</span><span class="delimiter">'</span></span>)
==&gt;org.apache.spark.SparkContext<span class="error">@</span><span class="integer">422</span>ab737
gremlin&gt; graph = GraphFactory.open(<span class="string"><span class="delimiter">'</span><span class="content">conf/hadoop/hadoop-gryo.properties</span><span class="delimiter">'</span></span>)
==&gt;hadoopgraph[gryoinputformat-&gt;gryooutputformat]
gremlin&gt; graph.configuration().setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.hadoop.graphWriter</span><span class="delimiter">'</span></span>, PersistedOutputRDD.class.getCanonicalName())
gremlin&gt; graph.configuration().setProperty(<span class="string"><span class="delimiter">'</span><span class="content">gremlin.spark.persistContext</span><span class="delimiter">'</span></span>,<span class="predefined-constant">true</span>)
gremlin&gt; graph.compute(SparkGraphComputer).program(PeerPressureVertexProgram.build().create(graph)).mapReduce(ClusterCountMapReduce.build().memoryKey(<span class="string"><span class="delimiter">'</span><span class="content">clusterCount</span><span class="delimiter">'</span></span>).create()).submit().get();
==&gt;result[hadoopgraph[persistedinputrdd-&gt;persistedoutputrdd],memory[<span class="key">size</span>:<span class="integer">1</span>]]
gremlin&gt; spark.ls()
==&gt;output/clusterCount [Memory Deserialized <span class="integer">1</span>x Replicated]
==&gt;output/~g [Memory Deserialized <span class="integer">1</span>x Replicated]
gremlin&gt; spark.ls(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
==&gt;output/clusterCount [Memory Deserialized <span class="integer">1</span>x Replicated]
==&gt;output/~g [Memory Deserialized <span class="integer">1</span>x Replicated]
gremlin&gt; spark.head(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>, PersistedInputRDD)
==&gt;v[<span class="integer">4</span>]
==&gt;v[<span class="integer">1</span>]
==&gt;v[<span class="integer">6</span>]
==&gt;v[<span class="integer">3</span>]
==&gt;v[<span class="integer">5</span>]
==&gt;v[<span class="integer">2</span>]
gremlin&gt; spark.head(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">clusterCount</span><span class="delimiter">'</span></span>, PersistedInputRDD)
==&gt;<span class="integer">2</span>
gremlin&gt; spark.rm(<span class="string"><span class="delimiter">'</span><span class="content">output</span><span class="delimiter">'</span></span>)
==&gt;<span class="predefined-constant">true</span>
gremlin&gt; spark.ls()</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_command_line_example">A Command Line Example</h3>
<div class="imageblock">
<div class="content">
<img src="../images/pagerank-logo.png" alt="pagerank logo" width="300">
</div>
</div>
<div class="paragraph">
<p>The classic <a href="http://en.wikipedia.org/wiki/PageRank">PageRank</a> centrality algorithm can be executed over the
TinkerPop graph from the command line using <code>GiraphGraphComputer</code>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Be sure that the <code>HADOOP_GREMLIN_LIBS</code> references the location <code>lib</code> directory of the respective
<code>GraphComputer</code> engine being used or else the requisite dependencies will not be uploaded to the Hadoop cluster.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="text">$ hdfs dfs -copyFromLocal data/tinkerpop-modern.json tinkerpop-modern.json
$ hdfs dfs -ls
Found 2 items
-rw-r--r--   1 marko supergroup       2356 2014-07-28 13:00 /user/marko/tinkerpop-modern.json
$ hadoop jar target/giraph-gremlin-3.2.6-job.jar org.apache.tinkerpop.gremlin.giraph.process.computer.GiraphGraphComputer ../hadoop-gremlin/conf/hadoop-graphson.properties
15/09/11 08:02:08 WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
15/09/11 08:02:11 INFO computer.GiraphGraphComputer: HadoopGremlin(Giraph): PageRankVertexProgram[alpha=0.85,iterations=30]
15/09/11 08:02:12 INFO mapreduce.JobSubmitter: number of splits:3
15/09/11 08:02:12 INFO mapreduce.JobSubmitter: Submitting tokens for job: job_1441915907347_0028
15/09/11 08:02:12 INFO impl.YarnClientImpl: Submitted application application_1441915907347_0028
15/09/11 08:02:12 INFO job.GiraphJob: Tracking URL: http://markos-macbook:8088/proxy/application_1441915907347_0028/
15/09/11 08:02:12 INFO job.GiraphJob: Waiting for resources... Job will start only when it gets all 3 mappers
15/09/11 08:03:54 INFO mapreduce.Job: Running job: job_1441915907347_0028
15/09/11 08:03:55 INFO mapreduce.Job: Job job_1441915907347_0028 running in uber mode : false
15/09/11 08:03:55 INFO mapreduce.Job:  map 33% reduce 0%
15/09/11 08:03:57 INFO mapreduce.Job:  map 67% reduce 0%
15/09/11 08:04:01 INFO mapreduce.Job:  map 100% reduce 0%
15/09/11 08:06:17 INFO mapreduce.Job: Job job_1441915907347_0028 completed successfully
15/09/11 08:06:17 INFO mapreduce.Job: Counters: 80
    File System Counters
        FILE: Number of bytes read=0
        FILE: Number of bytes written=483918
        FILE: Number of read operations=0
        FILE: Number of large read operations=0
        FILE: Number of write operations=0
        HDFS: Number of bytes read=1465
        HDFS: Number of bytes written=1760
        HDFS: Number of read operations=39
        HDFS: Number of large read operations=0
        HDFS: Number of write operations=20
    Job Counters
        Launched map tasks=3
        Other local map tasks=3
        Total time spent by all maps in occupied slots (ms)=458105
        Total time spent by all reduces in occupied slots (ms)=0
        Total time spent by all map tasks (ms)=458105
        Total vcore-seconds taken by all map tasks=458105
        Total megabyte-seconds taken by all map tasks=469099520
    Map-Reduce Framework
        Map input records=3
        Map output records=0
        Input split bytes=132
        Spilled Records=0
        Failed Shuffles=0
        Merged Map outputs=0
        GC time elapsed (ms)=1594
        CPU time spent (ms)=0
        Physical memory (bytes) snapshot=0
        Virtual memory (bytes) snapshot=0
        Total committed heap usage (bytes)=527958016
    Giraph Stats
        Aggregate edges=0
        Aggregate finished vertices=0
        Aggregate sent message message bytes=13535
        Aggregate sent messages=186
        Aggregate vertices=6
        Current master task partition=0
        Current workers=2
        Last checkpointed superstep=0
        Sent message bytes=438
        Sent messages=6
        Superstep=31
    Giraph Timers
        Initialize (ms)=2996
        Input superstep (ms)=5209
        Setup (ms)=59
        Shutdown (ms)=9324
        Superstep 0 GiraphComputation (ms)=3861
        Superstep 1 GiraphComputation (ms)=4027
        Superstep 10 GiraphComputation (ms)=4000
        Superstep 11 GiraphComputation (ms)=4004
        Superstep 12 GiraphComputation (ms)=3999
        Superstep 13 GiraphComputation (ms)=4000
        Superstep 14 GiraphComputation (ms)=4005
        Superstep 15 GiraphComputation (ms)=4003
        Superstep 16 GiraphComputation (ms)=4001
        Superstep 17 GiraphComputation (ms)=4007
        Superstep 18 GiraphComputation (ms)=3998
        Superstep 19 GiraphComputation (ms)=4006
        Superstep 2 GiraphComputation (ms)=4007
        Superstep 20 GiraphComputation (ms)=3996
        Superstep 21 GiraphComputation (ms)=4006
        Superstep 22 GiraphComputation (ms)=4002
        Superstep 23 GiraphComputation (ms)=3998
        Superstep 24 GiraphComputation (ms)=4003
        Superstep 25 GiraphComputation (ms)=4001
        Superstep 26 GiraphComputation (ms)=4003
        Superstep 27 GiraphComputation (ms)=4005
        Superstep 28 GiraphComputation (ms)=4002
        Superstep 29 GiraphComputation (ms)=4001
        Superstep 3 GiraphComputation (ms)=3988
        Superstep 30 GiraphComputation (ms)=4248
        Superstep 4 GiraphComputation (ms)=4010
        Superstep 5 GiraphComputation (ms)=3998
        Superstep 6 GiraphComputation (ms)=3996
        Superstep 7 GiraphComputation (ms)=4005
        Superstep 8 GiraphComputation (ms)=4009
        Superstep 9 GiraphComputation (ms)=3994
        Total (ms)=138788
    File Input Format Counters
        Bytes Read=0
    File Output Format Counters
        Bytes Written=0
$ hdfs dfs -cat output/~g/*
{&quot;id&quot;:1,&quot;label&quot;:&quot;person&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:39,&quot;value&quot;:0.15000000000000002}],&quot;name&quot;:[{&quot;id&quot;:0,&quot;value&quot;:&quot;marko&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:10,&quot;value&quot;:3.0}],&quot;age&quot;:[{&quot;id&quot;:1,&quot;value&quot;:29}]}}
{&quot;id&quot;:5,&quot;label&quot;:&quot;software&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:35,&quot;value&quot;:0.23181250000000003}],&quot;name&quot;:[{&quot;id&quot;:8,&quot;value&quot;:&quot;ripple&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:6,&quot;value&quot;:0.0}],&quot;lang&quot;:[{&quot;id&quot;:9,&quot;value&quot;:&quot;java&quot;}]}}
{&quot;id&quot;:3,&quot;label&quot;:&quot;software&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:39,&quot;value&quot;:0.4018125}],&quot;name&quot;:[{&quot;id&quot;:4,&quot;value&quot;:&quot;lop&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:10,&quot;value&quot;:0.0}],&quot;lang&quot;:[{&quot;id&quot;:5,&quot;value&quot;:&quot;java&quot;}]}}
{&quot;id&quot;:4,&quot;label&quot;:&quot;person&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:39,&quot;value&quot;:0.19250000000000003}],&quot;name&quot;:[{&quot;id&quot;:6,&quot;value&quot;:&quot;josh&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:10,&quot;value&quot;:2.0}],&quot;age&quot;:[{&quot;id&quot;:7,&quot;value&quot;:32}]}}
{&quot;id&quot;:2,&quot;label&quot;:&quot;person&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:35,&quot;value&quot;:0.19250000000000003}],&quot;name&quot;:[{&quot;id&quot;:2,&quot;value&quot;:&quot;vadas&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:6,&quot;value&quot;:0.0}],&quot;age&quot;:[{&quot;id&quot;:3,&quot;value&quot;:27}]}}
{&quot;id&quot;:6,&quot;label&quot;:&quot;person&quot;,&quot;properties&quot;:{&quot;gremlin.pageRankVertexProgram.pageRank&quot;:[{&quot;id&quot;:35,&quot;value&quot;:0.15000000000000002}],&quot;name&quot;:[{&quot;id&quot;:10,&quot;value&quot;:&quot;peter&quot;}],&quot;gremlin.pageRankVertexProgram.edgeCount&quot;:[{&quot;id&quot;:6,&quot;value&quot;:1.0}],&quot;age&quot;:[{&quot;id&quot;:11,&quot;value&quot;:35}]}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vertex 4 ("josh") is isolated below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="js">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">4</span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">label</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>,
  <span class="key"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.pageRank</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">39</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="float">0.19250000000000003</span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">6</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">josh</span><span class="delimiter">&quot;</span></span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">gremlin.pageRankVertexProgram.edgeCount</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">10</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="float">2.0</span>}],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>:[{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">7</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>:<span class="integer">32</span>}]}
  }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="gremlin-variants" class="sect0">Gremlin Variants</h1>
<div class="openblock partintro">
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../images/gremlin-house-of-mirrors.png" alt="gremlin house of mirrors" width="1024">
</div>
</div>
<div class="paragraph">
<p>Gremlin is a graph traversal language that makes use of two fundamental programming constructs:
<a href="https://en.wikipedia.org/wiki/Function_composition">function composition</a> and
<a href="https://en.wikipedia.org/wiki/Nested_function">function nesting</a>. Given this generality, it is possible to embed
Gremlin in any modern programming language.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin-Java is the canonical representation of Gremlin and any (proper) Gremlin language variant will emulate its
structure as best as possible given the constructs of the host language. A strong correspondence between variants ensures
that the general Gremlin reference documentation is applicable to all variants and that users moving between development
languages can easily adopt the Gremlin variant for that language.
</td>
</tr>
</table>
</div>
<div class="imageblock" style="float: left">
<div class="content">
<img src="../images/gremlin-variant-architecture.png" alt="gremlin variant architecture" width="650">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The information herein describes how to use the Gremlin language variants distributed
with Apache TinkerPop. For information on how to build a Gremlin language variant,
please review the <a href="http://tinkerpop.apache.org/docs/current/tutorials/gremlin-language-variants/">Gremlin Language Variants</a>
tutorial.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-java">Gremlin-Java</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-java-drawing.png" alt="gremlin java drawing" width="130"></span> Apache TinkerPop&#8217;s Gremlin-Java implements Gremlin within the Java8
language and can be used by any Java8 compliant virtual machine. Gremlin-Java is considered the canonical, reference
implementation of Gremlin and serves as the foundation by which all other Gremlin language variants should emulate.</p>
</div>
<div class="sect2">
<h3 id="_the_lambda_solution">The Lambda Solution</h3>
<div class="paragraph">
<p>Supporting <a href="https://en.wikipedia.org/wiki/Anonymous_function">anonymous functions</a> across languages is difficult as
most language do not support lambda introspection and thus, code analysis. In Gremlin-Java, Java8 lambdas can be leveraged.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).map(t -&gt; t.get().value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>) + <span class="string"><span class="delimiter">&quot;</span><span class="content"> is the friend name</span><span class="delimiter">&quot;</span></span>) <span class="invisible">//</span><b class="conum">1</b>
g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).sideEffect(<span class="predefined-type">System</span>.out::println) <span class="invisible">//</span><b class="conum">2</b>
g.V().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).select(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).by((Function&lt;Vertex, <span class="predefined-type">Integer</span>&gt;) v -&gt; v.&lt;<span class="predefined-type">String</span>&gt;value(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>).length()) <span class="invisible">//</span><b class="conum">3</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A Java8 function is used to map a <code>Traverser&lt;S&gt;</code> to an object <code>E</code>.</p>
</li>
<li>
<p>Gremlin steps that take consumer arguments can be passed Java8 method references.</p>
</li>
<li>
<p>Gremlin-Java may sometimes require explicit lambda typing when types can not be automatically inferred.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>When sending traversals over the wire via a <code>RemoteConnection</code>, the static methods of <code>Lambda</code> should be used
and should denote a particular JSR-223 <code>ScriptEngine</code>. <code>Lambda</code> creates a string-based lambda that is then converted
into a lambda/closure/anonymous-function/etc. by the respective lambda language&#8217;s JSR-223 <code>ScriptEngine</code> implementation.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).map(Lambda.function(<span class="string"><span class="delimiter">&quot;</span><span class="content">it.get().value('name') + ' is the friend name'</span><span class="delimiter">&quot;</span></span>))
g.V().out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).sideEffect(Lambda.consumer(<span class="string"><span class="delimiter">&quot;</span><span class="content">println it</span><span class="delimiter">&quot;</span></span>))
g.V().as(<span class="string"><span class="delimiter">&quot;</span><span class="content">a</span><span class="delimiter">&quot;</span></span>).out(<span class="string"><span class="delimiter">&quot;</span><span class="content">knows</span><span class="delimiter">&quot;</span></span>).as(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).select(<span class="string"><span class="delimiter">&quot;</span><span class="content">b</span><span class="delimiter">&quot;</span></span>).by(Lambda.&lt;Vertex,<span class="predefined-type">Integer</span>&gt;function(<span class="string"><span class="delimiter">&quot;</span><span class="content">it.value('name').length()</span><span class="delimiter">&quot;</span></span>))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-groovy">Gremlin-Groovy</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-groovy-drawing.png" alt="gremlin groovy drawing" width="130"></span> Apache TinkerPop&#8217;s Gremlin-Groovy implements Gremlin within the
<a href="http://groovy.apache.org">Apache Groovy</a> language. As a JVM-based language variant, Gremlin-Groovy is backed by
Gremlin-Java constructs. Moreover, given its scripting nature, Gremlin-Groovy serves as the language of
<a href="#gremlin-console">Gremlin Console</a>.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
In Groovy, <code>as</code>, <code>in</code>, and <code>not</code> are reserved words. Gremlin-Groovy does not allow these steps to be called
statically from the anonymous traversal <code><em></code> and therefore, must always be prefixed with <code></em>.</code> For instance:
<code>g.V().as('a').in().as('b').where(<em>.not(</em>.as('a').out().as('b')))</code>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-python">Gremlin-Python</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/gremlin-python-drawing.png" alt="gremlin python drawing" width="130"></span> Apache TinkerPop&#8217;s Gremlin-Python implements Gremlin within
the <a href="https://www.python.org/">Python</a> language and can be used on any Python virtual machine including the popular
<a href="https://en.wikipedia.org/wiki/CPython">CPython</a> machine. Python&#8217;s syntax has the same constructs as Java including
"dot notation" for function chaining (<code>a.b.c</code>), round bracket function arguments (<code>a(b,c)</code>), and support for global
namespaces (<code>a(b())</code> vs <code>a(__.b())</code>). As such, anyone familiar with Gremlin-Java will immediately be able to work
with Gremlin-Python. Moreover, there are a few added constructs to Gremlin-Python that make traversals a bit more succinct.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
In Python, <code>as</code>, <code>in</code>, <code>and</code>, <code>or</code>, <code>is</code>, <code>not</code>, <code>from</code>, and <code>global</code> are reserved words. Gremlin-Python simply
postfixes <code><em></code> to the end of these terms for their use with graph traversal. For instance: <code>g.V().as</em>('a').in_().as_('b').select('a','b')</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To install Gremlin-Python, use Python&#8217;s <a href="https://en.wikipedia.org/wiki/Pip_(package_manager)">pip</a> package manager.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">pip install gremlinpython</code></pre>
</div>
</div>
<div class="paragraph">
<p>Gremlin-Python users will typically make use of the following classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python</span> <span class="keyword">import</span> <span class="include">statics</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.structure.graph</span> <span class="keyword">import</span> <span class="include">Graph</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.graph_traversal</span> <span class="keyword">import</span> <span class="include">__</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.strategies</span> <span class="keyword">import</span> <span class="include">*</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.driver.driver_remote_connection</span> <span class="keyword">import</span> <span class="include">DriverRemoteConnection</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In Gremlin-Python there exists <code>GraphTraversalSource</code>, <code>GraphTraversal</code>, and <code>__</code> which mirror the respective classes in Gremlin-Java.
The <code>GraphTraversalSource</code> requires a driver in order to communicate with <a href="#gremlin-server">GremlinServer</a> (or any
<a href="#connecting-via-remotegraph"><code>RemoteConnection</code></a>-enabled server). The <code>gremlin_python.driver.driver_remote_connection</code>
is provided with Apache TinkerPop&#8217;s Gremlin-Python distribution.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
For developers wishing to provide another <strong>driver implementation</strong>, be sure to extend <code>RemoteConnection</code> in
<code>gremlin_python.driver</code> so it can then be used by Gremlin-Python&#8217;s <code>GraphTraversal</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When Gremlin Server is running, Gremlin-Python can communicate with Gremlin Server. The <code>conf/gremlin-server-modern-py.yaml</code>
configuration maintains a <code>GremlinJythonScriptEngine</code> as well as the appropriate serializers for communicating <code>Bytecode</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin-Python is compatible with GraphSON 2.0 only, so this serializer must be configured in Gremlin Server.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ bin/gremlin-server.sh -i org.apache.tinkerpop gremlin-python 3.2.6
$ bin/gremlin-server.sh conf/gremlin-server-modern-py.yaml
[INFO] GremlinServer -
       \,,,/
       (o o)
---oOOo-(3)-oOOo---

[INFO] GremlinServer - Configuring Gremlin Server from conf/gremlin-server-modern-py.yaml
[INFO] MetricManager - Configured Metrics Slf4jReporter configured with interval=180000ms and loggerName=org.apache.tinkerpop.gremlin.server.Settings$Slf4jReporterMetrics
[INFO] GraphManager - Graph [graph] was successfully configured via [conf/tinkergraph-empty.properties].
[INFO] ServerGremlinExecutor - Initialized Gremlin thread pool.  Threads in pool named with pattern gremlin-*
[INFO] Logger - 51 attributes loaded from 40 stream(s) in 16ms, 51 saved, 614 ignored: [&quot;Ant-Version&quot;, &quot;Archiver-Version&quot;, &quot;Bnd-LastModified&quot;, &quot;Boot-Class-Path&quot;, &quot;Build-Jdk&quot;, &quot;Build-Version&quot;, &quot;Built-By&quot;, &quot;Bundle-ClassPath&quot;, &quot;Bundle-Description&quot;, &quot;Bundle-DocURL&quot;, &quot;Bundle-License&quot;, &quot;Bundle-ManifestVersion&quot;, &quot;Bundle-Name&quot;, &quot;Bundle-RequiredExecutionEnvironment&quot;, &quot;Bundle-SymbolicName&quot;, &quot;Bundle-Vendor&quot;, &quot;Bundle-Version&quot;, &quot;Can-Redefine-Classes&quot;, &quot;Created-By&quot;, &quot;DynamicImport-Package&quot;, &quot;Eclipse-BuddyPolicy&quot;, &quot;Export-Package&quot;, &quot;Extension-Name&quot;, &quot;Extension-name&quot;, &quot;Fragment-Host&quot;, &quot;Ignore-Package&quot;, &quot;Implementation-Build&quot;, &quot;Implementation-Title&quot;, &quot;Implementation-URL&quot;, &quot;Implementation-Vendor&quot;, &quot;Implementation-Vendor-Id&quot;, &quot;Implementation-Version&quot;, &quot;Import-Package&quot;, &quot;Include-Resource&quot;, &quot;JCabi-Build&quot;, &quot;JCabi-Date&quot;, &quot;JCabi-Version&quot;, &quot;Main-Class&quot;, &quot;Main-class&quot;, &quot;Manifest-Version&quot;, &quot;Originally-Created-By&quot;, &quot;Private-Package&quot;, &quot;Require-Capability&quot;, &quot;Specification-Title&quot;, &quot;Specification-Vendor&quot;, &quot;Specification-Version&quot;, &quot;Tool&quot;, &quot;X-Compile-Source-JDK&quot;, &quot;X-Compile-Target-JDK&quot;, &quot;hash&quot;, &quot;version&quot;]
[INFO] ScriptEngines - Loaded gremlin-jython ScriptEngine
[INFO] ScriptEngines - Loaded gremlin-python ScriptEngine
[INFO] ScriptEngines - Loaded gremlin-groovy ScriptEngine
[INFO] GremlinExecutor - Initialized gremlin-groovy ScriptEngine with scripts/generate-modern.groovy
[INFO] ServerGremlinExecutor - Initialized GremlinExecutor and configured ScriptEngines.
[INFO] ServerGremlinExecutor - A GraphTraversalSource is now bound to [g] with graphtraversalsource[tinkergraph[vertices:0 edges:0], standard]
[INFO] OpLoader - Adding the standard OpProcessor.
[INFO] OpLoader - Adding the control OpProcessor.
[INFO] OpLoader - Adding the session OpProcessor.
[INFO] OpLoader - Adding the traversal OpProcessor.
[INFO] TraversalOpProcessor - Initialized cache for TraversalOpProcessor with size 1000 and expiration time of 600000 ms
[INFO] GremlinServer - Executing start up LifeCycleHook
[INFO] Logger$info - Loading 'modern' graph data.
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v1.0+gryo with org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV1d0
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v1.0+gryo-stringd with org.apache.tinkerpop.gremlin.driver.ser.GryoMessageSerializerV1d0
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v1.0+json with org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerGremlinV1d0
[INFO] AbstractChannelizer - Configured application/vnd.gremlin-v2.0+json with org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerGremlinV2d0
[INFO] AbstractChannelizer - Configured application/json with org.apache.tinkerpop.gremlin.driver.ser.GraphSONMessageSerializerV1d0
[INFO] GremlinServer$1 - Gremlin Server configured with worker thread pool of 1, gremlin pool of 8 and boss thread pool of 1.
[INFO] GremlinServer$1 - Channel started at port 8182.</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The command to use <code>-i</code> need only be executed once to gather <code>gremlin-python</code> dependencies into Gremlin Servers'
path. Future starts of Gremlin Server will not require that command.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Within the CPython console, an empty <code>Graph</code> is created and a traversal source is spawned with <code>RemoteStrategy</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; graph = Graph()
&gt;&gt;&gt; g = graph.traversal().withRemote(DriverRemoteConnection(<span class="string"><span class="delimiter">'</span><span class="content">ws://localhost:8182/gremlin</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">g</span><span class="delimiter">'</span></span>))</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a traversal from the <code>GraphTraversalSource</code> is iterated, the traversal&#8217;s <code>Bytecode</code> is sent over the wire
via the registered <code>RemoteConnection</code>. The bytecode is used to construct the equivalent traversal at the remote traversal source.
Moreover, typically the bytecode is analyzed to determine which language the bytecode should be translated to. If the traversal
does not contain lambdas, the remote location (e.g. Gremlin Server) will typically
use Gremlin-Java. If it has lambdas written in Groovy, it will use Gremlin-Groovy (e.g. <code>GremlinGroovyScriptEngine</code>).
Likewise, if it has lambdas represented in Python, it will use Gremlin-Python (e.g. <code>GremlinJythonScriptEngine</code>).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin-Python&#8217;s <code>Traversal</code> class supports the standard Gremlin methods such as <code>next()</code>, <code>nextTraverser()</code>,
<code>toSet()</code>, <code>toList()</code>, etc. Such "terminal" methods trigger the evaluation of the traversal.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_remoteconnection_submission">RemoteConnection Submission</h3>
<div class="paragraph">
<p>There are various ways to submit a traversal to a <code>RemoteConnection</code>. Just as in Gremlin-Java, there are various
"terminal/action methods" off of <code>Traversal</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Traversal.next()</code></p>
</li>
<li>
<p><code>Traversal.nextTraverser()</code></p>
</li>
<li>
<p><code>Traversal.toList()</code></p>
</li>
<li>
<p><code>Traversal.toSet()</code></p>
</li>
<li>
<p><code>Traversal.iterate()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_gremlin_python_sugar">Gremlin-Python Sugar</h3>
<div class="paragraph">
<p>Python supports meta-programming and operator overloading. There are three uses of these techniques in Gremlin-Python that
makes traversals a bit more concise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V().both()[<span class="integer">1</span>:<span class="integer">3</span>].toList()
[v[<span class="integer">2</span>], v[<span class="integer">4</span>]]
&gt;&gt;&gt; g.V().both()[<span class="integer">1</span>].toList()
[v[<span class="integer">2</span>]]
&gt;&gt;&gt; g.V().both().name.toList()
[lop, lop, lop, vadas, josh, josh, josh, marko, marko, marko, peter, ripple]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_static_enums_and_methods">Static Enums and Methods</h3>
<div class="paragraph">
<p>Gremlin has various tokens (e.g. <code>T</code>, <code>P</code>, <code>Order</code>, <code>Operator</code>, etc.) that are represented in Gremlin-Python as Python <code>Enums</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">T</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Order</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Cardinality</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Column</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Direction</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Operator</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">P</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Pop</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Scope</span>
&gt;&gt;&gt; <span class="keyword">from</span> <span class="include">gremlin_python.process.traversal</span> <span class="keyword">import</span> <span class="include">Barrier</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These can be used analogously to how they are used in Gremlin-Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,P.gt(<span class="integer">30</span>)).order().by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,Order.decr).toList()
[v[<span class="integer">6</span>], v[<span class="integer">4</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, by importing the <code>statics</code> of Gremlin-Python, the class prefixes can be ommitted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; statics.load_statics(<span class="predefined">globals</span>())</code></pre>
</div>
</div>
<div class="paragraph">
<p>With statics loaded its possible to represent the above traversal as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V().hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>).has(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,gt(<span class="integer">30</span>)).order().by(<span class="string"><span class="delimiter">'</span><span class="content">age</span><span class="delimiter">'</span></span>,decr).toList()
[v[<span class="integer">6</span>], v[<span class="integer">4</span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, statics includes all the <code><em></code>-methods and thus, anonymous traversals like <code></em>.out()</code> can be expressed as below.
That is, without the <code>__.</code>-prefix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V().repeat(out()).times(<span class="integer">2</span>).name.fold().toList()
[[ripple, lop]]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bindings">Bindings</h3>
<div class="paragraph">
<p>When a traversal bytecode is sent over a <code>RemoteConnection</code> (e.g. Gremlin Server), it will be translated, compiled, and then executed.
If the same traversal is sent again, translation and compilation can be skipped as the previously compiled version should be cached.
Many traversals are unique up to some parameterization. For instance, <code>g.V(1).out('created').name</code> is considered different
from <code>g.V(4).out('created').name'</code> as they have different script "string" representations. However, <code>g.V(x).out('created').name</code> with bindings of <code>{x : 1}</code> and
<code>{x : 4}</code> are considered the same. If a traversal is going to be executed repeatedly, but with different parameters, then bindings should be used.
In Gremlin-Python, bindings are 2-tuples and used as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V((<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">1</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).name.toList()
[lop]
&gt;&gt;&gt; g.V((<span class="string"><span class="delimiter">'</span><span class="content">id</span><span class="delimiter">'</span></span>,<span class="integer">4</span>)).out(<span class="string"><span class="delimiter">'</span><span class="content">created</span><span class="delimiter">'</span></span>).name.toList()
[ripple, lop]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traversal_strategies">Traversal Strategies</h3>
<div class="paragraph">
<p>In order to add and remove <a href="#traversalstrategy">traversal strategies</a> from a traversal source, Gremlin-Python has a
<code>TraversalStrategy</code> class along with a collection of subclasses that mirror the standard Gremlin-Java strategies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g = g.withStrategies(SubgraphStrategy(vertices=hasLabel(<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>),edges=has(<span class="string"><span class="delimiter">'</span><span class="content">weight</span><span class="delimiter">'</span></span>,gt(<span class="float">0.5</span>))))
null
&gt;&gt;&gt; g.V().name.toList()
[marko, vadas, josh, peter]
&gt;&gt;&gt; g.V().outE().valueMap(<span class="predefined-constant">True</span>).toList()
[[label:knows, weight:<span class="float">1.0</span>, <span class="predefined">id</span>:<span class="integer">8</span>]]
&gt;&gt;&gt; g = g.withoutStrategies(SubgraphStrategy)
null
&gt;&gt;&gt; g.V().name.toList()
[marko, vadas, lop, josh, ripple, peter]
&gt;&gt;&gt; g.V().outE().valueMap(<span class="predefined-constant">True</span>).toList()
[[label:created, weight:<span class="float">0.4</span>, <span class="predefined">id</span>:<span class="integer">9</span>], [label:knows, weight:<span class="float">0.5</span>, <span class="predefined">id</span>:<span class="integer">7</span>], [label:knows, weight:<span class="float">1.0</span>, <span class="predefined">id</span>:<span class="integer">8</span>], [label:created, weight:<span class="float">1.0</span>, <span class="predefined">id</span>:<span class="integer">10</span>], [label:created, weight:<span class="float">0.4</span>, <span class="predefined">id</span>:<span class="integer">11</span>], [label:created, weight:<span class="float">0.2</span>, <span class="predefined">id</span>:<span class="integer">12</span>]]
&gt;&gt;&gt; g = g.withComputer(workers=<span class="integer">2</span>,vertices=has(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">marko</span><span class="delimiter">'</span></span>))
null
&gt;&gt;&gt; g.V().name.toList()
[marko]
&gt;&gt;&gt; g.V().outE().valueMap(<span class="predefined-constant">True</span>).toList()
[[label:created, weight:<span class="float">0.4</span>, <span class="predefined">id</span>:<span class="integer">9</span>], [label:knows, weight:<span class="float">0.5</span>, <span class="predefined">id</span>:<span class="integer">7</span>], [label:knows, weight:<span class="float">1.0</span>, <span class="predefined">id</span>:<span class="integer">8</span>]]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Many of the <code>TraversalStrategy</code> classes in Gremlin-Python are proxies to the respective strategy on
Apache TinkerPop&#8217;s JVM-based Gremlin traversal machine. As such, their <code>apply(Traversal)</code> method does nothing. However,
the strategy is encoded in the Gremlin-Python bytecode and transmitted to the Gremlin traversal machine for
re-construction machine-side.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_lambda_solution_2">The Lambda Solution</h3>
<div class="paragraph">
<p>Supporting <a href="https://en.wikipedia.org/wiki/Anonymous_function">anonymous functions</a> across languages is difficult as
most language do not support lambda introspection and thus, code analysis. In Gremlin-Python,
a <a href="https://docs.python.org/2/reference/expressions.html#lambda">Python lambda</a> should be represented as a zero-arg callable
that returns a string representation of a lambda. The default lambda language is <code>gremlin-python</code> and can be changed via
<code>gremlin_python.statics.default_lambda_language</code>. When the lambda is represented in <code>Bytecode</code> its language is encoded
such that the remote connection host can infer which translator and ultimate execution engine to use.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python">&gt;&gt;&gt; g.V().out().map(<span class="keyword">lambda</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">lambda x: len(x.get().value('name'))</span><span class="delimiter">&quot;</span></span>).sum().toList() <span class="comment">#</span><b class="conum">(1)</b>
[<span class="integer">24</span>]
&gt;&gt;&gt; statics.default_lambda_language <span class="comment">#</span><b class="conum">(2)</b>
gremlin-python
&gt;&gt;&gt; g.V().out().map(<span class="keyword">lambda</span>: (<span class="string"><span class="delimiter">&quot;</span><span class="content">it.get().value('name').length()</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin-groovy</span><span class="delimiter">&quot;</span></span>)).sum().toList() <span class="comment">#</span><b class="conum">(3)</b>
[<span class="integer">24</span>]
&gt;&gt;&gt; statics.default_lambda_language = <span class="string"><span class="delimiter">'</span><span class="content">gremlin-groovy</span><span class="delimiter">'</span></span> <span class="comment">#</span><b class="conum">(4)</b>
null
&gt;&gt;&gt; g.V().out().map(<span class="keyword">lambda</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">it.get().value('name').length()</span><span class="delimiter">&quot;</span></span>).sum().toList() <span class="comment">#</span><b class="conum">(5)</b>
[<span class="integer">24</span>]
&gt;&gt;&gt; g.V().out().map(<span class="keyword">lambda</span>: (<span class="string"><span class="delimiter">&quot;</span><span class="content">lambda x: len(x.get().value('name'))</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">gremlin-python</span><span class="delimiter">&quot;</span></span>)).sum().toList() <span class="comment">#</span><b class="conum">(6)</b>
[<span class="integer">24</span>]
&gt;&gt;&gt; statics.default_lambda_language = <span class="string"><span class="delimiter">'</span><span class="content">gremlin-python</span><span class="delimiter">'</span></span> <span class="comment">#</span><b class="conum">(7)</b>
null
&gt;&gt;&gt; g.V().out().map(<span class="keyword">lambda</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">x: len(x.get().value('name'))</span><span class="delimiter">&quot;</span></span>).sum().toList() <span class="comment">#</span><b class="conum">(8)</b>
[<span class="integer">24</span>]</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>A zero-arg lambda yields a string representation of a lambda in Gremlin-Python.</p>
</li>
<li>
<p>The default lambda language is currently Gremlin-Python.</p>
</li>
<li>
<p>A zero-arg lambda yields a 2-tuple where the second element is the language of the lambda (Gremlin-Groovy).</p>
</li>
<li>
<p>The default lambda language can be statically changed.</p>
</li>
<li>
<p>A zero-arg lambda yields a string representation of a closure in Gremlin-Groovy.</p>
</li>
<li>
<p>A zero-arg lambda yields a 2-tuple where the second element is the language of the lambda (Gremlin-Python).</p>
</li>
<li>
<p>The default lambda language is changed back to Gremlin-Python.</p>
</li>
<li>
<p>If the <code>lambda</code>-prefix is not provided, then it is appended automatically in order to give a more natural look to the expression.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_custom_serialization">Custom Serialization</h3>
<div class="paragraph">
<p>Gremlin-Python provides a GraphSON 2.0 serialization package with the standard Apache TinkerPop <code>g</code>-types registered
(see <a href="http://tinkerpop.apache.org/docs/3.2.6/dev/io/#graphson-2d0">GraphSON 2.0</a>). It is possible for users to add
new types by creating serializers and deserializers in Python and registering them with the <code>RemoteConnection</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">class</span> <span class="class">MyType</span>(<span class="predefined">object</span>):
  GRAPHSON_PREFIX = <span class="string"><span class="delimiter">&quot;</span><span class="content">providerx</span><span class="delimiter">&quot;</span></span>
  GRAPHSON_BASE_TYPE = <span class="string"><span class="delimiter">&quot;</span><span class="content">MyType</span><span class="delimiter">&quot;</span></span>
  GRAPHSON_TYPE = GraphSONUtil.formatType(GRAPHSON_PREFIX, GRAPHSON_BASE_TYPE)

  <span class="keyword">def</span> <span class="function">__init__</span>(<span class="predefined-constant">self</span>, x, y):
    <span class="predefined-constant">self</span>.x = x
    <span class="predefined-constant">self</span>.y = y

  <span class="decorator">@classmethod</span>
  <span class="keyword">def</span> <span class="function">objectify</span>(cls, value, reader):
    <span class="keyword">return</span> cls(value[<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>], value[<span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>])

  <span class="decorator">@classmethod</span>
  <span class="keyword">def</span> <span class="function">dictify</span>(cls, value, writer):
    <span class="keyword">return</span> GraphSONUtil.typedValue(cls.GRAPHSON_BASE_TYPE,
                                  {<span class="string"><span class="delimiter">'</span><span class="content">x</span><span class="delimiter">'</span></span>: value.x, <span class="string"><span class="delimiter">'</span><span class="content">y</span><span class="delimiter">'</span></span>: value.y},
                                  cls.GRAPHSON_PREFIX)

graphson_reader = GraphSONReader({MyType.GRAPHSON_TYPE: MyType})
graphson_writer = GraphSONWriter({MyType: MyType})

connection = DriverRemoteConnection(<span class="string"><span class="delimiter">'</span><span class="content">ws://localhost:8182/gremlin</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">g</span><span class="delimiter">'</span></span>,
                                     graphson_reader=graphson_reader,
                                     graphson_writer=graphson_writer)</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gremlin-DotNet">Gremlin.Net</h2>
<div class="sectionbody">
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
Gremlin.Net does not yet have an official release. It is for developers who want to experiment with TinkerPop
in the .NET ecosystem.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apache TinkerPop&#8217;s Gremlin-DotNet implements Gremlin within the C# language. It targets .NET Standard and can
therefore be used on different operating systems and with different .NET frameworks, such as .NET Framework
and <a href="https://www.microsoft.com/net/core">.NET Core</a>. Since the C# syntax is very similar to that of Java, it should be very easy to switch between
Gremlin-Java and Gremlin-DotNet. The only major syntactical difference is that all method names in Gremlin-DotNet
use PascalCase as opposed to camelCase in Gremlin-Java in order to comply with .NET conventions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="powershell">nuget install Gremlin.Net</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Gremlin-DotNet there exists <code>GraphTraversalSource</code>, <code>GraphTraversal</code>, and <code>__</code> which mirror the respective classes
in Gremlin-Java. The <code>GraphTraversalSource</code> requires a driver in order to communicate with <a href="#gremlin-server">GremlinServer</a> (or any
RemoteConnection-enabled server).</p>
</div>
<div class="paragraph">
<p>The <code>Gremlin.Net.Driver.Remote.DriverRemoteConnection</code> is provided as part of Apache TinkerPops Gremlin-DotNet.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
For developers wishing to provide another driver implementation, be sure to implement <code>IRemoteConnection</code> in
<code>Gremlin.Net.Process.Remote</code> so it can then be used by Gremlin-DotNets <code>GraphTraversal</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When Gremlin Server is running, Gremlin-DotNet can communicate with Gremlin Server by sending traversals serialized as <code>Bytecode</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin-DotNet is compatible with GraphSON 2.0 only, so this serializer must be configured in Gremlin Server.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A traversal source can be spawned with <code>RemoteStrategy</code> from an empty <code>Graph</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">var graph = new Graph();
var g = graph.Traversal().WithRemote(new DriverRemoteConnection(new GremlinClient(new GremlinServer(&quot;localhost&quot;, 8182))));</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a traversal from the <code>GraphTraversalSource</code> is iterated, the traversals <code>Bytecode</code> is sent over the wire via the registered
<code>IRemoteConnection</code>. The bytecode is used to construct the equivalent traversal at the remote traversal source.
Since Gremlin-DotNet currently doesn&#8217;t support lambda expressions, all traversals can be translated to Gremlin-Java on the remote
location (e.g. Gremlin Server).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Gremlin-DotNets <code>ITraversal</code> interface supports the standard Gremlin methods such as <code>Next()</code>, <code>NextTraverser()</code>, <code>ToSet()</code>,
<code>ToList()</code>, etc. Such "terminal" methods trigger the evaluation of the traversal.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_remoteconnection_submission_2">RemoteConnection Submission</h3>
<div class="paragraph">
<p>Very similar to Gremlin-Python and Gremlin-Java, there are various ways to submit a traversal to a <code>IRemoteConnection</code> using
terminal/action methods off of <code>ITraversal</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>ITraversal.Next()</code></p>
</li>
<li>
<p><code>ITraversal.NextTraverser()</code></p>
</li>
<li>
<p><code>ITraversal.ToList()</code></p>
</li>
<li>
<p><code>ITraversal.ToSet()</code></p>
</li>
<li>
<p><code>ITraversal.Iterate()</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_static_enums_and_methods_2">Static Enums and Methods</h3>
<div class="paragraph">
<p>Gremlin has various tokens (e.g. <code>T</code>, <code>P</code>, <code>Order</code>, <code>Operator</code>, etc.) that are represented in Gremlin-DotNet as Enums.</p>
</div>
<div class="paragraph">
<p>These can be used analogously to how they are used in Gremlin-Java.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">g.V().HasLabel(&quot;person&quot;).Has(&quot;age&quot;,P.Gt(30)).Order().By(&quot;age&quot;,Order.decr).ToList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, the class prefixes can be ommitted with a <code>using static</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">using static Gremlin.Net.Process.Traversal.P;
using static Gremlin.Net.Process.Traversal.Order;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then it is possible to represent the above traversal as below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">g.V().HasLabel(&quot;person&quot;).Has(&quot;age&quot;,Gt(30)).Order().By(&quot;age&quot;,decr).ToList()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, with using static <code><em></code>, anonymous traversals like <code></em>.Out()</code> can be expressed as below. That is, without the <code>__.</code>-prefix.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">g.V().Repeat(Out()).Times(2).Values(&quot;name&quot;).Fold().ToList()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bindings_2">Bindings</h3>
<div class="paragraph">
<p>When a traversal bytecode is sent over a <code>IRemoteConnection</code> (e.g. Gremlin Server), it will be translated, compiled,
and then executed. If the same traversal is sent again, translation and compilation can be skipped as the previously
compiled version should be cached. Many traversals are unique up to some parameterization. For instance,
<code>g.V(1).Out("created").Values("name")</code> is considered different from <code>g.V(4).Out("created").Values("Name")</code>
as they have different script "string" representations. However, <code>g.V(x).Out("created").Values("name")</code> with bindings of
<code>{x : 1}</code> and <code>{x : 4}</code> are considered the same. If a traversal is going to be executed repeatedly, but with different
parameters, then bindings should be used. In Gremlin-DotNet, bindings are objects that can be created as follows.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">var b = new Bindings();
g.V(b.Of(&quot;id&quot;, 1)).Out(&quot;created&quot;).Values(&quot;name&quot;).toList()
g.V(b.Of(&quot;id&quot;, 4)).Out(&quot;created&quot;).Values(&quot;name&quot;).toList()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_traversal_strategies_2">Traversal Strategies</h3>
<div class="paragraph">
<p>In order to add and remove traversal strategies from a traversal source, Gremlin-DotNet has an <code>AbstractTraversalStrategy</code>
class along with a collection of subclasses that mirror the standard Gremlin-Java strategies.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">g = g.WithStrategies(new SubgraphStrategy(vertexCriterion: HasLabel(&quot;person&quot;),
    edgeCriterion: Has(&quot;weight&quot;, Gt(0.5))));
var names = g.V().Values(&quot;name&quot;).ToList();  // names: [marko, vadas, josh, peter]

g = g.WithoutStrategies(new SubgraphStrategy());
names = g.V().Values(&quot;name&quot;).ToList(); // names: [marko, vadas, lop, josh, ripple, peter]

var edgeValueMaps = g.V().OutE().ValueMap(true).ToList();
// edgeValueMaps: [[label:created, id:9, weight:0.4], [label:knows, id:7, weight:0.5], [label:knows, id:8, weight:1.0],
//     [label:created, id:10, weight:1.0], [label:created, id:11, weight:0.4], [label:created, id:12, weight:0.2]]

g = g.WithComputer(workers: 2, vertices: Has(&quot;name&quot;, &quot;marko&quot;));
names = g.V().Values(&quot;name&quot;).ToList();  // names: [marko]

edgeValueMaps = g.V().OutE().ValueMap(true).ToList();
// edgeValueMaps: [[label:created, id:9, weight:0.4], [label:knows, id:7, weight:0.5], [label:knows, id:8, weight:1.0]]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Many of the TraversalStrategy classes in Gremlin-DotNet are proxies to the respective strategy on Apache TinkerPops
JVM-based Gremlin traversal machine. As such, their <code>Apply(ITraversal)</code> method does nothing. However, the strategy is
encoded in the Gremlin-DotNet bytecode and transmitted to the Gremlin traversal machine for re-construction machine-side.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_custom_serialization_2">Custom Serialization</h3>
<div class="paragraph">
<p>Gremlin-DotNet provides a GraphSON 2.0 serialization package with the standard Apache TinkerPop<code>g</code>-types registered
(see <a href="http://tinkerpop.apache.org/docs/3.2.6/dev/io/<mark>graphson-2d0">GraphSON 2.0</a>). It is possible for users to add new
types by creating serializers and deserializers in C</mark> (or any other .NET language) and registering them with the <code>GremlinClient</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="csharp">internal class MyType
{
    public static string GraphsonPrefix = &quot;providerx&quot;;
    public static string GraphsonBaseType = &quot;MyType&quot;;
    public static string GraphsonType = GraphSONUtil.FormatTypeName(GraphsonPrefix, GraphsonBaseType);

    public MyType(int x, int y)
    {
        X = x;
        Y = y;
    }

    public int X { get; }
    public int Y { get; }
}

internal class MyClassWriter : IGraphSONSerializer
{
    public Dictionary&lt;string, dynamic&gt; Dictify(dynamic objectData, GraphSONWriter writer)
    {
        MyType myType = objectData;
        var valueDict = new Dictionary&lt;string, object&gt;
        {
            {&quot;x&quot;, myType.X},
            {&quot;y&quot;, myType.Y}
        };
        return GraphSONUtil.ToTypedValue(nameof(TestClass), valueDict, MyType.GraphsonPrefix);
    }
}

internal class MyTypeReader : IGraphSONDeserializer
{
    public dynamic Objectify(JToken graphsonObject, GraphSONReader reader)
    {
        var x = reader.ToObject(graphsonObject[&quot;x&quot;]);
        var y = reader.ToObject(graphsonObject[&quot;y&quot;]);
        return new MyType(x, y);
    }
}

var graphsonReader = new GraphSONReader(
    new Dictionary&lt;string, IGraphSONDeserializer&gt; {{MyType.GraphsonType, new MyTypeReader()}});
var graphsonWriter = new GraphSONWriter(
    new Dictionary&lt;Type, IGraphSONSerializer&gt; {{typeof(MyType), new MyClassWriter()}});

var gremlinClient = new GremlinClient(new GremlinServer(&quot;localhost&quot;, 8182), graphsonReader, graphsonWriter);</code></pre>
</div>
</div>
</div>
</div>
</div>
<h1 id="conclusion" class="sect0">Conclusion</h1>
<div class="openblock partintro">
<div class="content">
<span class="image" style="float: left"><img src="../images/tinkerpop-character.png" alt="tinkerpop character" width="100"></span> The world that we know, you and me, is but a subset of the world
that Gremlin has weaved within The TinkerPop. Gremlin has constructed a fully connected graph and only the subset that
makes logical sense to our traversing thoughts is the fragment we have come to know and have come to see one another
within. But there are many more out there, within other webs of logics unfathomed. From any thought, every other
thought, we come to realize that which is&#8201;&#8212;&#8201;The TinkerPop.
</div>
</div>
<h1 id="acknowledgements" class="sect0">Acknowledgements</h1>
<div class="openblock partintro">
<div class="content">
<div class="paragraph">
<p><span class="image" style="float: left"><img src="../images/yourkit-logo.png" alt="yourkit logo" width="200"></span> YourKit supports the TinkerPop open source project with its full-featured
Java Profiler. YourKit, LLC is the creator of innovative and intelligent tools for profiling Java and .NET
applications. YourKit&#8217;s leading software products: <a href="http://www.yourkit.com/java/profiler/index.jsp">YourKit Java Profiler</a>
and <a href="http://www.yourkit.com/.net/profiler/index.jsp">YourKit .NET Profiler</a></p>
</div>
<div class="paragraph">
<p><span class="image" style="float: right"><img src="../images/ketrina-tinkerpop3.png" alt="ketrina tinkerpop3" width="150"></span> <a href="http://ketrinayim.tumblr.com">Ketrina Yim</a>&#8201;&#8212;&#8201;Designing
Gremlin and his friends for TinkerPop was one of my first major projects as a freelancer, and it&#8217;s delightful to
see them on the Web and all over the documentation! Drawing and tweaking the characters over time is like watching
them grow up. They&#8217;ve gone from sketches on paper to full-color logos, and from logos to living characters that
cheerfully greet visitors to the TinkerPop website. And it&#8217;s been a great time all throughout!</p>
</div>
<div class="paragraph">
<p>&#8230;&#8203;in the beginning.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-08-21 14:33:10 EDT
</div>
</div>
</body>
</html>
